<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeFreebies</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- åŸæœ¬è¿™é‡Œæœ‰â€œé¡µé¢åŠ è½½æ—¶æ¸…é™¤æ‰€æœ‰æœ¬åœ°ç¼“å­˜â€çš„è„šæœ¬
         å·²ç§»é™¤ï¼Œæ”¹ä¸ºä»…åœ¨ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•æ—¶æ¸…é™¤æœ¬åœ°æ•°æ® -->

    <!-- Firebase SDK - å¤šé‡åŠ è½½ç­–ç•¥ -->
    <script>
        // Firebase SDK åŠ è½½ç®¡ç†å™¨
        (function () {
            let loadAttempt = 0;
            const maxAttempts = 4;

            // å®šä¹‰å¤šä¸ª CDN æº
            const cdnSources = [
                {
                    name: 'Google Official CDN',
                    app: 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js',
                    database: 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js'
                },
                {
                    name: 'jsDelivr CDN',
                    app: 'https://cdn.jsdelivr.net/npm/firebase@9.23.0/firebase-app-compat.js',
                    database: 'https://cdn.jsdelivr.net/npm/firebase@9.23.0/firebase-database-compat.js'
                },
                {
                    name: 'unpkg CDN',
                    app: 'https://unpkg.com/firebase@9.23.0/firebase-app-compat.js',
                    database: 'https://unpkg.com/firebase@9.23.0/firebase-database-compat.js'
                },
                {
                    name: 'CloudFlare CDN',
                    app: 'https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js',
                    database: 'https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js'
                }
            ];

            function loadFirebaseSDK(sourceIndex = 0) {
                if (sourceIndex >= cdnSources.length) {
                    console.error('âŒ æ‰€æœ‰ Firebase CDN æºå‡åŠ è½½å¤±è´¥');
                    console.log('ğŸ’¡ åº”ç”¨å°†ä»¥æœ¬åœ°æ¨¡å¼è¿è¡Œ');
                    window.firebaseLoadFailed = true;
                    return;
                }

                const source = cdnSources[sourceIndex];
                console.log(`ğŸ”„ [${sourceIndex + 1}/${cdnSources.length}] å°è¯•ä» ${source.name} åŠ è½½ Firebase SDK...`);

                // åˆ›å»º app script
                const appScript = document.createElement('script');
                appScript.src = source.app;
                appScript.crossOrigin = 'anonymous';

                // åˆ›å»º database script
                const dbScript = document.createElement('script');
                dbScript.src = source.database;
                dbScript.crossOrigin = 'anonymous';

                let appLoaded = false;
                let dbLoaded = false;

                // è¶…æ—¶å¤„ç†
                const timeout = setTimeout(() => {
                    if (!appLoaded || !dbLoaded) {
                        console.warn(`â±ï¸ ${source.name} åŠ è½½è¶…æ—¶ï¼Œå°è¯•ä¸‹ä¸€ä¸ªæº...`);
                        loadFirebaseSDK(sourceIndex + 1);
                    }
                }, 10000); // 10ç§’è¶…æ—¶

                appScript.onload = function () {
                    appLoaded = true;
                    console.log(`âœ… Firebase App å·²ä» ${source.name} åŠ è½½`);

                    // åŠ è½½ database script
                    dbScript.onload = function () {
                        dbLoaded = true;
                        console.log(`âœ… Firebase Database å·²ä» ${source.name} åŠ è½½`);
                        clearTimeout(timeout);

                        // éªŒè¯ Firebase å¯¹è±¡
                        setTimeout(() => {
                            if (typeof firebase !== 'undefined') {
                                console.log('âœ…âœ… Firebase SDK å®Œå…¨åŠ è½½æˆåŠŸï¼');
                                console.log('ğŸ“¦ Firebase ç‰ˆæœ¬:', firebase.SDK_VERSION || 'unknown');
                                window.firebaseLoadSuccess = true;
                            } else {
                                console.error('âŒ Firebase å¯¹è±¡æœªå®šä¹‰ï¼Œå°è¯•ä¸‹ä¸€ä¸ªæº...');
                                loadFirebaseSDK(sourceIndex + 1);
                            }
                        }, 500);
                    };

                    dbScript.onerror = function () {
                        console.error(`âŒ Firebase Database ä» ${source.name} åŠ è½½å¤±è´¥`);
                        clearTimeout(timeout);
                        loadFirebaseSDK(sourceIndex + 1);
                    };

                    document.head.appendChild(dbScript);
                };

                appScript.onerror = function () {
                    console.error(`âŒ Firebase App ä» ${source.name} åŠ è½½å¤±è´¥`);
                    clearTimeout(timeout);
                    loadFirebaseSDK(sourceIndex + 1);
                };

                document.head.appendChild(appScript);
            }

            // å¼€å§‹åŠ è½½
            loadFirebaseSDK(0);
        })();
        // çª—å£å¤§å°æ”¹å˜æ—¶å¤„ç†
        window.addEventListener('resize', function () {
            // ç§»åŠ¨ç«¯å¯¼èˆªæ”¹ä¸ºé»˜è®¤å±•ç¤ºï¼Œæ— éœ€åœ¨ resize æ—¶åŠ¨æ€åˆ›å»º/åˆ é™¤
        });
    </script>

    <!-- é¦–æ¬¡è¿›å…¥é¡µé¢æ—¶æ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ˆä»…å½“å‰æµè§ˆå™¨ä¼šè¯æ‰§è¡Œä¸€æ¬¡ï¼Œé¿å…åˆ·æ–°åé‡å¤æ¸…ç©ºå¯¼è‡´é‡æ–°ç™»å½•ï¼‰ -->
    <script>
        (function () {
            try {
                const FLAG_KEY = 'initialClearDone';

                // ä½¿ç”¨ sessionStorage ä½œä¸ºâ€œæœ¬ä¼šè¯å·²æ¸…ç†â€çš„æ ‡è®°
                if (!sessionStorage.getItem(FLAG_KEY)) {
                    console.log('ğŸ§¹ é¦–æ¬¡è¿›å…¥é¡µé¢ï¼Œå¼€å§‹æ¸…ç©ºæœ¬åœ°æ‰€æœ‰æ•°æ®ï¼ˆlocalStorage / IndexedDB / Cacheï¼‰...');

                    // 1. æ¸…ç©º localStorage
                    try {
                        localStorage.clear();
                        console.log('âœ… localStorage å·²æ¸…ç©º');
                    } catch (e) {
                        console.warn('æ¸…ç©º localStorage æ—¶å‡ºé”™:', e);
                    }

                    // 2. å°è¯•æ¸…ç©º IndexedDB
                    try {
                        if ('indexedDB' in window && indexedDB.databases) {
                            indexedDB.databases().then(databases => {
                                databases.forEach(db => {
                                    if (db.name) {
                                        indexedDB.deleteDatabase(db.name);
                                        console.log(`âœ… å·²æ¸…é™¤ IndexedDB: ${db.name}`);
                                    }
                                });
                            }).catch(e => {
                                console.warn('æ¸…é™¤ IndexedDB æ—¶å‡ºé”™:', e);
                            });
                        }
                    } catch (e) {
                        console.warn('è®¿é—® IndexedDB æ—¶å‡ºé”™:', e);
                    }

                    // 3. å°è¯•æ¸…ç©º Service Worker ç¼“å­˜
                    try {
                        if ('caches' in window) {
                            caches.keys().then(names => {
                                names.forEach(name => {
                                    caches.delete(name);
                                    console.log(`âœ… å·²æ¸…é™¤ Service Worker ç¼“å­˜: ${name}`);
                                });
                            }).catch(e => {
                                console.warn('æ¸…é™¤ Service Worker ç¼“å­˜æ—¶å‡ºé”™:', e);
                            });
                        }
                    } catch (e) {
                        console.warn('è®¿é—® Service Worker ç¼“å­˜æ—¶å‡ºé”™:', e);
                    }

                    // é‡è¦ï¼šä¸æ¸…ç©º sessionStorageï¼Œä»¥ä¾¿æœ¬æ¬¡ä¼šè¯åç»­åˆ·æ–°ä¸å†é‡å¤æ¸…ç†
                    sessionStorage.setItem(FLAG_KEY, '1');
                    console.log('âœ… åˆæ¬¡è¿›å…¥é¡µé¢çš„æœ¬åœ°æ•°æ®æ¸…ç†å·²å®Œæˆï¼Œæœ¬ä¼šè¯åç»­ä¸å†é‡å¤æ‰§è¡Œ');
                } else {
                    console.log('â„¹ï¸ æœ¬æµè§ˆå™¨ä¼šè¯å·²å®Œæˆè¿‡åˆå§‹æ¸…ç†ï¼Œä¸å†é‡å¤æ¸…ç©ºæœ¬åœ°æ•°æ®');
                }
            } catch (e) {
                console.warn('åˆå§‹åŒ–æœ¬åœ°æ•°æ®æ¸…ç†é€»è¾‘æ—¶å‡ºé”™:', e);
            }
        })();
    </script>

    <style>
        /* ç°ä»£åŒ–é…è‰²ç³»ç»Ÿ */
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --primary-hover: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #adb5bd;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            
            /* å…¼å®¹æ€§å˜é‡ */
            --primary-soft: rgba(67, 97, 238, 0.1);
            --secondary-soft: rgba(247, 37, 133, 0.1);
            --dark-soft: rgba(33, 37, 41, 0.06);
            --border-subtle: rgba(0, 0, 0, 0.1);
            
            /* é˜´å½±ç³»ç»Ÿ */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.2);
            --shadow-soft: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.12);
            
            /* åœ†è§’ç³»ç»Ÿ */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* è¿‡æ¸¡åŠ¨ç”» */
            --transition-fast: 150ms ease;
            --transition-normal: 300ms ease;
            --transition-slow: 500ms ease;
        }

        /* ===== Messenger/WhatsApp å•æ­¥å¼¹çª—ä¸“ç”¨æ ·å¼ï¼ˆå‚è€ƒ"éäºšé©¬é€Šä¸‹å•æ­¥éª¤.html"ï¼Œä½œç”¨äº whatsapp-modal-single-step å†…éƒ¨ï¼‰ ===== */
        #whatsapp-modal-single-step .window-container {
            width: 100%;
            max-width: 600px;
            /* æ¡Œé¢ç«¯ï¼šä¸€æ¬¡æ˜¾ç¤ºå®Œï¼Œä¸æ»šåŠ¨ï¼›ç§»åŠ¨ç«¯ï¼šå…è®¸æ»šåŠ¨ */
            max-height: 95vh;
            background: white;
            border-radius: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: window-appear 0.5s ease-out;
            margin: 0 auto;
        }
        
        /* å…³é—­çª—å£åçš„æ ·å¼ */
        #whatsapp-modal-single-step .window-container.window-closed {
            animation: window-close 0.4s ease-in forwards;
        }
        
        @keyframes window-close {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            50% {
                opacity: 0.5;
                transform: scale(0.9) translateY(20px);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
                visibility: hidden;
            }
        }

        /* æ¡Œé¢ç«¯ï¼šç§»é™¤æ»šåŠ¨ï¼Œç¡®ä¿ä¸€æ¬¡æ˜¾ç¤ºå®Œ */
        @media (min-width: 769px) {
            #whatsapp-modal-single-step .window-container {
                overflow-y: visible;
                max-height: none;
            }
        }

        #whatsapp-modal-single-step .window-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        /* å·²åˆ é™¤å…³é—­æŒ‰é’®æ ·å¼ */

        #whatsapp-modal-single-step .window-header {
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        #whatsapp-modal-single-step .window-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBwYXR0ZXJuVHJhbnNmb3JtPSJyb3RhdGUoNDUpIj48cmVjdCB3aWR0aD0iMiIgaGVpZ2h0PSI1MCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA3KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNwYXR0ZXJuKSIvPjwvc3ZnPg==');
        }

        #whatsapp-modal-single-step .window-header h1 {
            font-size: 2.4rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            margin-bottom: 10px;
            position: relative;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #whatsapp-modal-single-step .step-container {
            padding: 40px 30px 30px;
            background: #fafbfd;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #whatsapp-modal-single-step .step-icon-container {
            width: 100px;
            height: 100px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 106, 255, 0.2);
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
            transition: all 0.3s ease;
        }

        #whatsapp-modal-single-step .step-icon {
            font-size: 3.5rem;
            color: white;
        }

        #whatsapp-modal-single-step .step-title {
            font-size: 2rem;
            font-weight: 800;
            color: #2d3748;
            margin-bottom: 10px;
            text-align: center;
            letter-spacing: -0.3px;
        }

        #whatsapp-modal-single-step .step-subtitle {
            font-size: 1.1rem;
            color: #e53e3e; /* çº¢è‰²çªå‡º */
            font-weight: 700;
            line-height: 1.5;
            text-align: center;
            max-width: 500px;
            margin: 0 auto 30px;
        }

        #whatsapp-modal-single-step .contact-switcher {
            width: 100%;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        #whatsapp-modal-single-step .switcher-label {
            font-size: 1rem;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 5px;
        }

        #whatsapp-modal-single-step .switcher-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 320px;
        }

        #whatsapp-modal-single-step .contact-btn {
            flex: 1;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
        }

        #whatsapp-modal-single-step .contact-btn:hover {
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        #whatsapp-modal-single-step .contact-btn.active {
            border-color: transparent;
            color: white;
        }

        #whatsapp-modal-single-step .contact-btn.messenger-btn.active {
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
            box-shadow: 0 5px 15px rgba(0, 106, 255, 0.2);
        }

        #whatsapp-modal-single-step .contact-btn.whatsapp-btn.active {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.2);
        }

        #whatsapp-modal-single-step .contact-btn i {
            font-size: 1.2rem;
        }

        #whatsapp-modal-single-step .copy-container {
            width: 100%;
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 16px;
            background: white;
            border: 1px solid #e9ecef;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        #whatsapp-modal-single-step .copy-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        #whatsapp-modal-single-step .copy-text {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 16px;
            font-size: 1rem;
            color: #495057;
            margin-bottom: 20px;
            word-break: break-all;
            line-height: 1.5;
            font-family: 'Courier New', monospace;
            min-height: 80px;
        }

        #whatsapp-modal-single-step .copy-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #whatsapp-modal-single-step .copy-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        #whatsapp-modal-single-step .send-action {
            width: 100%;
            margin-top: 10px;
        }

        #whatsapp-modal-single-step .send-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 18px;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(0, 106, 255, 0.25);
        }

        #whatsapp-modal-single-step .send-btn.messenger-btn {
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
        }

        #whatsapp-modal-single-step .send-btn.whatsapp-btn {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.25);
        }

        #whatsapp-modal-single-step .send-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        #whatsapp-modal-single-step .send-btn i {
            font-size: 1.5rem;
        }

        /* å·²ç¡®è®¤æŒ‰é’®æ ·å¼ */
        #whatsapp-modal-single-step .confirmed-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
            display: none; /* é»˜è®¤éšè— */
        }

        #whatsapp-modal-single-step .confirmed-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        #whatsapp-modal-single-step .confirmed-btn:active {
            transform: translateY(0);
        }

        #whatsapp-modal-single-step .confirmed-btn i {
            font-size: 1.5rem;
        }

        #whatsapp-modal-single-step .footer-note {
            text-align: center;
            padding: 20px;
            font-size: 0.95rem;
            color: #a0aec0;
            background: white;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            font-weight: 500;
        }

        #whatsapp-modal-single-step .progress-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 30px 20px;
            background: #fafbfd;
        }

        #whatsapp-modal-single-step .progress-dots {
            display: flex;
            gap: 10px;
        }

        #whatsapp-modal-single-step .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e0;
            transition: all 0.3s ease;
        }

        #whatsapp-modal-single-step .progress-dot.active {
            background: #006AFF;
            transform: scale(1.2);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse-red {
            0%, 100% {
                text-shadow: 0 0 10px rgba(229, 62, 62, 0.3);
            }
            50% {
                text-shadow: 0 0 15px rgba(229, 62, 62, 0.6);
            }
        }

        @keyframes pulse-blue {
            0%, 100% {
                box-shadow: 0 6px 20px rgba(0, 106, 255, 0.25);
            }
            50% {
                box-shadow: 0 6px 20px rgba(0, 106, 255, 0.4);
            }
        }

        @keyframes pulse-green {
            0%, 100% {
                box-shadow: 0 6px 20px rgba(37, 211, 102, 0.25);
            }
            50% {
                box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        @keyframes copy-highlight {
            0%, 100% {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            }
            50% {
                box-shadow: 0 5px 15px rgba(0, 106, 255, 0.1);
            }
        }

        #whatsapp-modal-single-step .step-subtitle {
            animation: pulse-red 2s ease-in-out infinite;
        }

        #whatsapp-modal-single-step .step-icon-container {
            animation: float 4s ease-in-out infinite;
        }

        #whatsapp-modal-single-step .send-btn.messenger-btn {
            animation: pulse-blue 3s ease-in-out infinite;
        }

        #whatsapp-modal-single-step .send-btn.whatsapp-btn {
            animation: pulse-green 3s ease-in-out infinite;
        }

        #whatsapp-modal-single-step .copy-container {
            animation: copy-highlight 6s ease-in-out infinite;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šåœ¨ä¸€å±å†…å®Œæ•´æ˜¾ç¤ºå•æ­¥å¼¹çª— */
        @media (max-width: 480px) {
            /* æ•´ä¸ªå¼¹çª—å®¹å™¨å°½é‡å¡«æ»¡è§†å£ï¼Œä½†ä¸è¶…è¿‡ä¸€å± */
            #whatsapp-modal-single-step .window-container {
                max-height: 100vh;
                border-radius: 18px;
            }

            /* å¤´éƒ¨åŒºåŸŸæ›´ç´§å‡‘ */
            #whatsapp-modal-single-step .window-header {
                padding: 18px 16px 14px;
            }

            #whatsapp-modal-single-step .window-header h1 {
                font-size: 1.8rem;
                margin-bottom: 4px;
            }

            /* ä¸»ä½“å†…å®¹åŒºåŸŸå‹ç¼©ä¸Šä¸‹å†…è¾¹è· */
            #whatsapp-modal-single-step .step-container {
                padding: 20px 16px 16px;
            }

            /* å›¾æ ‡ç¨å¾®ç¼©å°ï¼Œå‡å°‘é«˜åº¦å ç”¨ */
            #whatsapp-modal-single-step .step-icon-container {
                width: 72px;
                height: 72px;
                margin-bottom: 16px;
            }

            #whatsapp-modal-single-step .step-icon {
                font-size: 2.4rem;
            }

            /* æ ‡é¢˜ã€è¯´æ˜æ–‡å­—ç¼©å°ä¸€ç‚¹å¹¶å‡å°‘é—´è· */
            #whatsapp-modal-single-step .step-title {
                font-size: 1.5rem;
                margin-bottom: 6px;
            }

            #whatsapp-modal-single-step .step-subtitle {
                font-size: 0.95rem;
                margin-bottom: 16px;
            }

            /* è”ç³»æ–¹å¼åˆ‡æ¢åŒºæ•´ä½“æ›´ç´§å‡‘ */
            #whatsapp-modal-single-step .contact-switcher {
                margin-bottom: 16px;
            }

            #whatsapp-modal-single-step .switcher-buttons {
                max-width: 100%;
            }

            #whatsapp-modal-single-step .contact-btn {
                padding: 10px;
                font-size: 0.9rem;
            }

            /* æ–‡æœ¬å¤åˆ¶åŒºåŸŸç¼©å°å†…è¾¹è·å’Œæœ€å°é«˜åº¦ */
            #whatsapp-modal-single-step .copy-container {
                padding: 16px 14px;
                margin-bottom: 18px;
            }

            #whatsapp-modal-single-step .copy-title {
                font-size: 1.05rem;
                margin-bottom: 10px;
            }

            #whatsapp-modal-single-step .copy-text {
                padding: 10px;
                font-size: 0.9rem;
                min-height: 60px;
            }

            #whatsapp-modal-single-step .copy-btn {
                padding: 12px;
                font-size: 1rem;
            }

            /* å‘é€æŒ‰é’®å’Œåº•éƒ¨åŒºåŸŸé«˜åº¦å‹ç¼© */
            #whatsapp-modal-single-step .send-btn {
                padding: 14px;
                font-size: 1.05rem;
            }

            #whatsapp-modal-single-step .progress-indicator {
                padding: 8px 16px 10px;
            }

            #whatsapp-modal-single-step .footer-note {
                padding: 10px 12px 14px;
                font-size: 0.85rem;
            }
        }

        /* ===== æ¡Œé¢ç«¯ä¼˜åŒ–ï¼šç¡®ä¿ä¸¤ä¸ªæ¨¡æ€çª—å£ä¸€æ¬¡æ˜¾ç¤ºå®Œï¼Œæ— éœ€æ»šåŠ¨ ===== */
        @media (min-width: 769px) {
            /* ä¸¤æ­¥æµç¨‹æ¨¡æ€çª—å£ - ä½¿ç”¨ flex å¸ƒå±€ç¡®ä¿å†…å®¹åœ¨ä¸€å±å†… */
            .whatsapp-modal-content.whatsapp-modal-two-steps {
                display: flex;
                flex-direction: column;
                max-height: 95vh;
            }

            .whatsapp-modal-two-steps .modal-header {
                flex-shrink: 0;
                padding: 18px 35px 20px !important;
            }

            .whatsapp-modal-two-steps .modal-header h1 {
                font-size: 1.9rem !important;
                margin-bottom: 4px !important;
            }

            .whatsapp-modal-two-steps .modal-header p {
                font-size: 0.95rem !important;
            }

            .whatsapp-modal-two-steps .whatsapp-modal-body {
                flex: 1;
                display: flex;
                flex-direction: column;
                padding: 20px 25px 15px !important;
                min-height: 0;
            }

            .whatsapp-modal-two-steps .steps-container {
                flex: 1;
                min-height: 0;
                gap: 15px !important;
            }

            .whatsapp-modal-two-steps .step {
                min-height: auto !important;
                display: flex;
                flex-direction: column;
                padding: 22px 18px !important;
            }

            .whatsapp-modal-two-steps .step-number {
                width: 38px !important;
                height: 38px !important;
                font-size: 1.1rem !important;
                margin-bottom: 15px !important;
            }

            .whatsapp-modal-two-steps .step-icon-container {
                width: 65px !important;
                height: 65px !important;
                margin-bottom: 15px !important;
            }

            .whatsapp-modal-two-steps .step-icon {
                font-size: 2.3rem !important;
            }

            .whatsapp-modal-two-steps .step-title {
                font-size: 1.3rem !important;
                margin-bottom: 6px !important;
            }

            .whatsapp-modal-two-steps .step-subtitle {
                font-size: 0.9rem !important;
                margin-bottom: 12px !important;
                min-height: auto !important;
            }

            .whatsapp-modal-two-steps .contact-switcher {
                margin-bottom: 12px !important;
            }

            .whatsapp-modal-two-steps .switcher-label {
                font-size: 0.8rem !important;
                margin-bottom: 3px !important;
            }

            .whatsapp-modal-two-steps .switcher-buttons {
                gap: 6px !important;
            }

            .whatsapp-modal-two-steps .contact-btn {
                padding: 8px !important;
                font-size: 0.85rem !important;
            }

            .whatsapp-modal-two-steps .copy-container {
                padding: 15px !important;
                margin-bottom: 12px !important;
            }

            .whatsapp-modal-two-steps .copy-title {
                font-size: 0.95rem !important;
                margin-bottom: 10px !important;
            }

            .whatsapp-modal-two-steps .copy-text {
                padding: 10px !important;
                margin-bottom: 10px !important;
                min-height: 50px !important;
                font-size: 0.85rem !important;
            }

            .whatsapp-modal-two-steps .copy-btn {
                padding: 8px !important;
                font-size: 0.9rem !important;
            }

            /* Step 2 æ–‡æ¡ˆé«˜äº®æ ·å¼ï¼ˆå‚è€ƒ 1.1 äºšé©¬é€Šä¸‹å•æ­¥éª¤.htmlï¼‰ */
            .whatsapp-modal-two-steps .highlight-red {
                color: #e53e3e !important;
                font-weight: 700 !important;
            }

            .whatsapp-modal-two-steps .step-action {
                margin-top: auto;
            }

            .whatsapp-modal-two-steps .action-btn {
                padding: 12px !important;
                font-size: 0.95rem !important;
            }

            .whatsapp-modal-two-steps .progress-indicator {
                padding: 10px 25px 8px !important;
                flex-shrink: 0;
            }

            .whatsapp-modal-two-steps .footer-note {
                padding: 10px 18px !important;
                font-size: 0.85rem !important;
                flex-shrink: 0;
            }
            
            /* ä¸¤æ­¥æµç¨‹ï¼šå…³é—­æŒ‰é’®æ˜¾ç¤ºæ§åˆ¶ */
            .whatsapp-modal-two-steps .close-btn.show {
                opacity: 1 !important;
                visibility: visible !important;
                transition: opacity 0.5s ease, visibility 0.5s ease !important;
            }
            
            /* ä¸¤æ­¥æµç¨‹ï¼šç¡®è®¤æŒ‰é’®æ ·å¼ */
            .whatsapp-modal-two-steps .confirmed-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                width: 100%;
                padding: 16px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                border: none;
                border-radius: 12px;
                font-weight: 700;
                font-size: 1.1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                text-decoration: none;
                box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
                display: none; /* é»˜è®¤éšè— */
            }
            
            .whatsapp-modal-two-steps .confirmed-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            }
            
            .whatsapp-modal-two-steps .confirmed-btn i {
                font-size: 1.4rem;
            }
            
            /* ä¸¤æ­¥æµç¨‹ï¼šç§»åŠ¨ç«¯æ»šåŠ¨æç¤º */
            .whatsapp-modal-two-steps .mobile-scroll-hint {
                display: none;
                position: absolute;
                bottom: 15px;
                left: 0;
                width: 100%;
                text-align: center;
                z-index: 10;
                animation: bounce 2s infinite;
                pointer-events: none;
            }
            
            .whatsapp-modal-two-steps .mobile-scroll-hint-content {
                display: inline-flex;
                flex-direction: column;
                align-items: center;
                background: rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                padding: 10px 15px;
                color: white;
                font-weight: 600;
                font-size: 0.9rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            
            .whatsapp-modal-two-steps .mobile-scroll-hint i {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-8px);
                }
                60% {
                    transform: translateY(-4px);
                }
            }
            
            /* ä¸¤æ­¥æµç¨‹ï¼šçª—å£å…³é—­åŠ¨ç”» */
            .whatsapp-modal-two-steps.window-closed {
                animation: window-close 0.4s ease-in forwards;
            }
            
            @keyframes window-close {
                0% {
                    opacity: 1;
                    transform: scale(1) translateY(0);
                }
                50% {
                    opacity: 0.5;
                    transform: scale(0.9) translateY(20px);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.8) translateY(50px);
                    visibility: hidden;
                }
            }

            /* å•æ­¥æµç¨‹æ¨¡æ€çª—å£ - ç´§å‡‘å¸ƒå±€ */
            #whatsapp-modal-single-step .window-header {
                padding: 20px 35px 18px !important;
            }

            #whatsapp-modal-single-step .window-header h1 {
                font-size: 1.9rem !important;
                margin-bottom: 4px !important;
            }

            #whatsapp-modal-single-step .step-container {
                padding: 25px 25px 18px !important;
            }

            #whatsapp-modal-single-step .step-icon-container {
                width: 80px !important;
                height: 80px !important;
                margin-bottom: 18px !important;
            }

            #whatsapp-modal-single-step .step-icon {
                font-size: 2.8rem !important;
            }

            #whatsapp-modal-single-step .step-title {
                font-size: 1.6rem !important;
                margin-bottom: 6px !important;
            }

            #whatsapp-modal-single-step .step-subtitle {
                font-size: 0.95rem !important;
                margin-bottom: 18px !important;
            }

            #whatsapp-modal-single-step .contact-switcher {
                margin-bottom: 15px !important;
            }

            #whatsapp-modal-single-step .copy-container {
                padding: 18px !important;
                margin-bottom: 15px !important;
            }

            #whatsapp-modal-single-step .copy-title {
                font-size: 1.05rem !important;
                margin-bottom: 10px !important;
            }

            #whatsapp-modal-single-step .copy-text {
                padding: 12px !important;
                margin-bottom: 12px !important;
                min-height: 55px !important;
                font-size: 0.9rem !important;
            }

            #whatsapp-modal-single-step .copy-btn {
                padding: 10px !important;
                font-size: 0.95rem !important;
            }

            #whatsapp-modal-single-step .send-action {
                margin-top: 6px !important;
            }

            #whatsapp-modal-single-step .send-btn {
                padding: 14px !important;
                font-size: 1.05rem !important;
            }

            #whatsapp-modal-single-step .progress-indicator {
                padding: 0 25px 12px !important;
            }

            #whatsapp-modal-single-step .footer-note {
                padding: 12px 18px !important;
                font-size: 0.85rem !important;
            }
        }

        @keyframes window-appear {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* WhatsApp æŒ‡å¼•æµ®å±‚ä¸é«˜äº® */
        .whatsapp-guide-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2200;
            display: none;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border: none;
            border-radius: 999px;
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
            color: #fff;
            font-weight: 700;
            box-shadow: 0 12px 30px rgba(0, 106, 255, 0.35);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .whatsapp-guide-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 36px rgba(0, 106, 255, 0.45);
        }

        .whatsapp-guide-toggle:active {
            transform: translateY(0);
        }

        .whatsapp-guide-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2000);
            backdrop-filter: blur(2px);
            z-index: 2400;
            opacity: 0;
            transition: opacity 0.25s ease;
            padding: 20px;
        }

        .whatsapp-guide-overlay.active {
            opacity: 1;
        }

        .whatsapp-guide-content {
            width: 100%;
            max-width: 520px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.82), rgba(255, 255, 255, 0.721));
            border: 1px solid rgba(255, 255, 255, 0.35);
            border-radius: 20px;
            padding: 22px 22px 18px;
            color: #0f172a;
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px) saturate(160%);
        }

        .whatsapp-guide-step {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            padding: 8px 12px;
            border-radius: 12px;
            background: linear-gradient(135deg, #e0f2fe 0%, #e2e8f0 100%);
            color: #0f172a;
            margin-bottom: 12px;
        }

        .whatsapp-guide-title {
            margin: 0 0 8px;
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -0.3px;
            color: #0f172a;
            text-align: center;
        }

        .whatsapp-guide-desc {
            font-size: 1.05rem;
            line-height: 1.6;
            color: #1f2937;
            margin-bottom: 12px;
        }

        .whatsapp-guide-desc .guide-action {
            display: block;
            font-weight: 800;
            font-size: 1.18rem;
            color: #1677ff;
            padding: 6px 0;
            text-align: center;
            margin-bottom: 6px;
        }

        .whatsapp-guide-desc .guide-subtext {
            display: block;
            font-size: 0.88rem;
            color: #6b7280;
            margin-top: 2px;
            text-align: center;
        }

        .whatsapp-guide-desc .guide-steps {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .whatsapp-guide-desc .guide-step-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #e0f2fe 0%, #d9f99d 100%);
            color: #0f172a;
            font-weight: 700;
            border-radius: 999px;
            box-shadow: 0 10px 24px rgba(59, 130, 246, 0.18);
        }

        .whatsapp-guide-desc .guide-step-chip .step-number {
            display: inline-flex;
            top: 4px;
            width: 22px;
            height: 22px;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #0f172a;
            color: #ffffff;
            font-size: 0.75rem;
            font-weight: 800;
        }

        .whatsapp-guide-list {
            margin: 10px 0 16px;
            padding: 12px 14px;
            border-radius: 14px;
            background: #f8fafc00;
            border: 1px solid #e2e8f0;
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .whatsapp-guide-list .guide-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.98rem;
            color: #0f172a;
        }

        .whatsapp-guide-list .guide-item i {
            width: 26px;
            height: 26px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #e0e7ff;
            color: #1d4ed8;
        }

        .whatsapp-guide-progress {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 14px;
        }

        .whatsapp-guide-progress-fill {
            width: 0;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: inherit;
            transition: width 0.25s ease;
        }

        .whatsapp-guide-actions {
            display: flex;
            gap: 10px;
            margin-top: 6px;
            justify-content: center;
        }

        .whatsapp-guide-btn {
            flex: 0 0 auto;
            min-width: 160px;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
        }

        .whatsapp-guide-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            box-shadow: 0 12px 28px rgba(102, 126, 234, 0.35);
        }

        .whatsapp-guide-btn-secondary {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #0f172a;
            border: 1px solid #cbd5e1;
            box-shadow: 0 8px 18px rgba(148, 163, 184, 0.25);
        }

        .whatsapp-guide-btn:hover {
            transform: translateY(-2px);
        }

        .whatsapp-guide-btn:active {
            transform: translateY(0);
        }

        .whatsapp-guide-highlight {
            position: relative;
            box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.35), 0 16px 40px rgba(0, 0, 0, 0.25);
            border-radius: 16px;
            animation: guide-focus-pulse 1.4s ease-in-out infinite;
            z-index: 2100;
        }

        .whatsapp-guide-highlight-button {
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.35), 0 14px 32px rgba(16, 185, 129, 0.25);
            animation: guide-focus-pulse-green 1.4s ease-in-out infinite;
        }

        @keyframes guide-focus-pulse {
            0%, 100% { box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.32), 0 16px 40px rgba(0, 0, 0, 0.25); }
            50% { box-shadow: 0 0 0 6px rgba(0, 106, 255, 0.2), 0 18px 44px rgba(0, 0, 0, 0.3); }
        }

        @keyframes guide-focus-pulse-green {
            0%, 100% { box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3), 0 14px 32px rgba(16, 185, 129, 0.25); }
            50% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.2), 0 16px 36px rgba(16, 185, 129, 0.32); }
        }

        @media (max-width: 640px) {
            .whatsapp-guide-content {
                padding: 18px 16px 14px;
            }

            .whatsapp-guide-title {
                font-size: 1.35rem;
            }

            .whatsapp-guide-desc {
                font-size: 1rem;
            }

            .whatsapp-guide-toggle {
                right: 14px;
                bottom: 14px;
            }
        }

        /* è®¢å•æ“ä½œæŒ‰é’®æ ·å¼ */
        .order-action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        @media (max-width: 600px) {
            .order-action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            .order-action-buttons .btn {
                width: 100%;
                justify-content: center;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'PingFang SC',
                'Microsoft Yahei', sans-serif;
        }

        /* ç°ä»£åŒ–æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: var(--radius-md);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: var(--radius-md);
            border: 2px solid var(--gray-100);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
        }

        /* ç„¦ç‚¹å¯è§æ€§ä¼˜åŒ– */
        *:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* é€‰æ‹©æ–‡æœ¬æ ·å¼ */
        ::selection {
            background: var(--primary-light);
            color: white;
        }

        ::-moz-selection {
            background: var(--primary-light);
            color: white;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(to bottom, #ffffff, var(--gray-100));
            color: var(--dark);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* é¡µé¢åŠ è½½é®ç½© */
        #page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        #page-loader.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary);
            border-right: 4px solid var(--primary-light);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.2);
        }

        /* äº§å“è¯„ä»·å¡ç‰‡ */
        .review-item {
            position: relative;
        }

        .review-admin-actions {
            position: absolute;
            top: 12px;
            right: 16px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .review-item:hover .review-admin-actions {
            opacity: 1;
        }

        .review-admin-actions .btn-icon {
            border: none;
            background: transparent;
            color: #999;
            cursor: pointer;
            padding: 4px;
        }

        .review-admin-actions .btn-icon:hover {
            color: #d9534f;
        }

        /* å•æ¡ç”¨æˆ·å›å¤ï¼ˆå°è¯„è®ºï¼‰ç®¡ç†å‘˜æ“ä½œæŒ‰é’® */
        .customer-reply-item {
            position: relative;
        }

        .customer-reply-admin-actions {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .customer-reply-item:hover .customer-reply-admin-actions {
            opacity: 1;
        }
        
        .loader-text {
            font-size: 18px;
            color: #666;
            font-weight: 500;
        }
        
        .loader-progress {
            margin-top: 15px;
            font-size: 14px;
            color: #999;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é¡µé¢å†…å®¹åˆå§‹éšè— */
        body.loading .container,
        body.loading nav {
            opacity: 0;
            pointer-events: none;
        }

        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px 80px;
            animation: containerFadeIn 0.6s ease-out;
        }

        @keyframes containerFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç°ä»£åŒ–å¯¼èˆªæ  */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: var(--shadow-sm);
            /* å–æ¶ˆå›ºå®š/ç²˜æ€§å®šä½ï¼Œæ”¹ä¸ºéšé¡µé¢æ»šåŠ¨ */
            position: static;
        }

        /* ä½¿ navbar å±…ä¸­ï¼Œè§†è§‰ä¸ŠæŠŠç™½è‰²èƒŒæ™¯é™åˆ¶åˆ°å†…éƒ¨ .nav-container */
        .navbar {
            display: flex;
            justify-content: center;
            background: transparent !important;
            box-shadow: none !important; /* è®©å†…å±‚å®¹å™¨æ‰¿æ‹…é˜´å½± */
            border-bottom: none !important;
        }

        /* æŠŠç™½è‰²èƒŒæ™¯ã€åœ†è§’å’Œé˜´å½±ç§»åˆ° nav-containerï¼Œä½¿å…¶å®½åº¦å— max-width é™åˆ¶ */
        .navbar > .nav-container {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            width: 100% !important;
            max-width: 1100px !important;
            margin: 12px auto !important; /* é¡¶éƒ¨ç•™ç™½ï¼Œé¿å…ç´§è´´æµè§ˆå™¨é¡¶ç«¯ */
            padding: 8px 12px !important;
            box-sizing: border-box !important;
        }
        

        /* åº•éƒ¨å¯¼èˆªï¼ˆç§»åŠ¨ç«¯ï¼‰ - æµ®èµ·å¼åœ†è§’æ¡å½¢å¯¼èˆª */
        .bottom-nav {
            display: none;
        }

        .bottom-nav-item {
            flex: 1;
            height: 100%;
            border: none;
            background: none;
            font-size: 13px;
            color: #4b5563;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: color var(--transition-fast), transform var(--transition-fast), opacity var(--transition-fast);
        }

        /* åº•éƒ¨å¯¼èˆª FAQ æŒ‰é’®ä¸“å±é¢œè‰²ï¼ˆä½¿ç”¨ data-role æ ‡è®°ï¼‰ */
        .bottom-nav-item[data-role="faq"] {
            color: var(--primary);
            font-weight: 600;
        }

        /* å…è®¸åº•éƒ¨å¯¼èˆªæ–‡æœ¬å“åº”äº‹ä»¶ï¼ˆæŸäº›æµè§ˆå™¨/å¸ƒå±€ä¸­ span ä¼šé˜»æ­¢çˆ¶å…ƒç´ æ¥æ”¶äº‹ä»¶ï¼‰ */
        .bottom-nav-item span {
            pointer-events: auto !important;
        }

        /* å¼ºåˆ¶æå‡å¯¼èˆªä¸ About/FAQ æŒ‰é’®çš„å±‚çº§å¹¶ç¡®ä¿å¯ç‚¹å‡»ï¼Œä¼˜å…ˆçº§æé«˜ä»¥æ’é™¤é®æŒ¡é—®é¢˜ */
        header, nav, .nav-container, .navbar, .nav-links, .bottom-nav, .about-cta, .mobile-faq-cta {
            position: relative !important;
            z-index: 2147483647 !important;
            pointer-events: auto !important;
        }

        /* åº•éƒ¨å¯¼èˆªäº¤äº’ï¼šç‚¹å‡»ä¸å½“å‰çŠ¶æ€åé¦ˆï¼ˆä¸æ”¹é¢œè‰²ï¼‰ */
        .bottom-nav-item:active {
            transform: scale(0.95);
            opacity: 0.8;
        }

        /* ç§»åŠ¨ç«¯é¦–é¡µé¡¶éƒ¨ FAQ å¿«æ·æŒ‰é’®ï¼ˆé»˜è®¤éšè—ï¼Œä»…åœ¨å°å±æ˜¾ç¤ºï¼Œä½äºå¯¼èˆªæ ä¸­é—´ï¼‰ */
        .mobile-faq-cta {
            display: none;
            margin-left: 12px;
            padding: 6px 12px; /* ç¼©å°æŒ‰é’®å°ºå¯¸ */
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(244, 114, 182, 0.08));
            border: 1px solid rgba(129, 140, 248, 0.5);
            color: #111827;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.12);
            transform: translateY(0); /* é»˜è®¤ä¸åç§»ï¼Œä¾¿äºåç»­ç§»åŠ¨ä»…å½±å“è‡ªèº« */
            transition: transform var(--transition-fast); /* å¹³æ»‘ç§»åŠ¨ï¼Œä¸å½±å“å…¶å®ƒå…ƒç´  */
        }

        /* About æŒ‰é’®ï¼šç®€åŒ–æ ·å¼ï¼Œä»…ä¿ç•™æ–‡å­—ï¼Œå°½é‡ä½è°ƒ */
        .about-cta {
            display: none;
            margin-left: 8px;
            padding: 0; /* å–æ¶ˆé†’ç›®çš„å†…è¾¹è· */
            border-radius: 0;
            background: transparent; /* é€æ˜èƒŒæ™¯ï¼Œä¸çªå‡º */
            border: none;
            color: #1d1919; /* ä¸æ˜¾çœ¼çš„ç°è‰² */
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            cursor: pointer;
            box-shadow: none;
            transform: none;
            transition: none;
        }

        .mobile-faq-cta i {
            color: #4f46e5;
            font-size: 14px;
        }

        .mobile-faq-cta span.mobile-faq-text-sub {
            font-weight: 500;
            font-size: 12px;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .mobile-faq-cta {
                display: inline-flex;
            }
            .about-cta {
                display: inline-flex;
            }
            /* ç§»åŠ¨ç«¯éšè—é¡¶éƒ¨æ–‡å­—ç‰ˆ FAQ é“¾æ¥ï¼Œä¿ç•™é†’ç›®çš„æŒ‰é’® */
            .nav-links a#faq-link {
                display: none;
            }
            /* ç§»åŠ¨ç«¯é¡¶éƒ¨å¯¼èˆªé‡æ–°å¸ƒå±€ï¼šå·¦ä¾§ Logoï¼Œå³ä¾§ä¾æ¬¡ä¸º FAQ ä¸ ç™»å½•/æ³¨å†Œï¼Œä¸‰å—ä¿æŒåŒä¸€è¡Œ */
            .nav-container {
                display: grid;
                grid-template-columns: auto auto 1fr auto;
                align-items: center;
                column-gap: 8px;
            }
            .logo {
                order: 1;
                margin-left: 0;
            }
            .mobile-faq-cta {
                order: 2;
                margin-left: 4px;
                justify-self: flex-start; /* ç´§æŒ¨ logo */
                transform: translateY(12px); /* å°† FAQ æŒ‰é’®å‘ä¸‹ç§»åŠ¨ï¼Œä¸å½±å“å…¶å®ƒå…ƒç´ å¸ƒå±€ */
            }
            .about-cta {
                order: 3;
                margin-left: 6px;
                justify-self: flex-start; /* ä¸ FAQ å·¦å¯¹é½ï¼Œé¿å…è¢«å±…ä¸­è¦†ç›– */
            }
            .user-actions {
                order: 3;
                justify-content: flex-end;
                align-self: center;       /* ä¸ Logo / FAQ å‚ç›´å±…ä¸­åœ¨åŒä¸€è¡Œ */
                white-space: nowrap;      /* é˜²æ­¢ç™»å½•/æ³¨å†ŒæŒ‰é’®æ¢è¡Œ */
            }
            .search-bar {
                order: 4;
                grid-column: 1 / 5;       /* å æ®ä¸‹ä¸€è¡Œæ•´è¡Œ */
                width: 100%;
            }
            /* ä¸ºäº†å‡å°å®½åº¦ï¼Œçª„å±ä¸‹éšè— FAQ çš„å‰¯æ ‡é¢˜ */
            .mobile-faq-cta span.mobile-faq-text-sub {
                display: none;
            }
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0; /* ç¼©çª„å‚ç›´å†…è¾¹è·ï¼Œå‡å°‘å¯¼èˆªæ å ç”¨é«˜åº¦ */
            gap: 24px;
            /* ç¼©çŸ­å¯¼èˆªæ åœ¨å¤§å±çš„æ¨ªå‘é•¿åº¦ï¼Œé¿å…è¦†ç›–æˆ–å¤ªé è¾¹ */
            max-width: 1100px;
            margin: 0 auto;
        }
        /* å¼ºåˆ¶è¦†ç›–ä»»ä½•åç»­æ ·å¼ï¼Œç¡®ä¿ nav-container åœ¨å¤§å±è¢«é™åˆ¶å®½åº¦å¹¶å±…ä¸­ */
        .navbar > .nav-container {
            width: 100% !important;
            max-width: 1100px !important;
            margin: 0 auto !important;
            box-sizing: border-box !important;
            padding-left: 12px !important;
            padding-right: 12px !important;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.04em;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            min-height: 60px;
            /* ç•¥å¾®å‡å°å·¦ä¾§ logo åŒºåŸŸå®½åº¦ï¼Œé¿å…è¢«å¯¼èˆªæ é®æŒ¡ */
            flex: 0 0 110px;
            min-width: 110px;
            margin-left: 8px;
        }
        
        .logo img {
            height: 52px;
            /* å…è®¸ logo å›¾ç‰‡åœ¨æ›´å®½çš„å®¹å™¨ä¸­æ˜¾ç¤ºæ›´å¤§ */
            max-width: 320px;
            width: auto;
            object-fit: contain;
            display: block;
        }
        
        /* å¼ºåˆ¶è¦†ç›–å†…è”æ ·å¼ï¼Œç¡®ä¿ logo åœ¨æ¡Œé¢/å¤§å±å¯è§æ›´å¤§å°ºå¯¸ */
        #site-logo-img {
            max-width: 220px !important; /* ç¼©å° logo æœ€å¤§å®½åº¦ï¼Œé¿å…è¢«å¯¼èˆªé®æŒ¡ */
            height: 52px !important;
            width: auto !important;
            display: block !important;
        }

        /* çª„å±æ¢å¤è‡ªé€‚åº”ï¼Œé¿å…å›ºå®šå®½åº¦å½±å“ç§»åŠ¨ç«¯å¸ƒå±€ */
        @media (max-width: 768px) {
            .logo {
                flex: 0 0 auto !important;
                min-width: initial !important;
            }
        }

        .nav-links {
            display: flex;
            list-style: none;
            padding: 0;
            border-radius: 0;
            background: transparent;
            border: none;
            gap: 0;
        }

        .nav-links li {
            margin-left: 0;
            display: flex;
            align-items: center;
        }

        .nav-links a {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            text-decoration: none;
            color: var(--gray);
            font-weight: 500;
            font-size: 15px;
            line-height: 1.4;
            min-height: 48px;
            transition: all var(--transition-fast);
        }

        /* FAQ é¡¶éƒ¨å¯¼èˆªæŒ‰é’®ä¸“å±æ ·å¼ï¼šæµ…è‰²æ¸å˜æè¾¹ + æ–‡å­—é«˜äº® */
        .nav-links a#faq-link {
            color: var(--primary-dark);
            border: 1px solid rgba(99, 102, 241, 0.5);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.06), rgba(139, 92, 246, 0.08));
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);
        }

        .nav-links a#faq-link:hover {
            color: #fff;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.35);
        }

        /* é¡¶éƒ¨å¯¼èˆªï¼šå¢åŠ ä¸‹åˆ’çº¿å¾®äº¤äº’ï¼Œä¸æ”¹å˜åŸæœ‰é…è‰² */
        .nav-links a::after {
            content: '';
            position: absolute;
            left: 16px;
            right: 16px;
            bottom: 8px;
            height: 2px;
            border-radius: var(--radius-full);
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transform: scaleX(0);
            transform-origin: center;
            opacity: 0;
            transition: transform var(--transition-fast), opacity var(--transition-fast);
        }

        .nav-links a:hover {
            color: var(--primary);
            background: var(--primary-soft);
            transform: translateY(-1px);
        }

        .nav-links a:hover::after {
            transform: scaleX(1);
            opacity: 0.9;
        }

        .nav-links a.active {
            color: white;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        .nav-links a.active::after {
            transform: scaleX(1);
            opacity: 1;
        }

        .search-bar {
            display: flex;
            width: 42%; /* ç¼©çŸ­ï¼šä» 42% è°ƒæ•´ä¸º 30% */
            border-radius: var(--radius-md);
            background: #ffffff;
            border: 2px solid var(--gray-300);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
        }

        .search-bar:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            transform: translateY(-1px);
        }

        /* ç”µè¯è¾“å…¥æ ·å¼ï¼ˆå¸¦+1å‰ç¼€ï¼‰ */
        .phone-input-wrapper {
            display: flex;
            align-items: center;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-md);
            overflow: hidden;
            background: #fff;
            transition: all var(--transition-fast);
        }

        .phone-input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .phone-prefix {
            padding: 10px 12px;
            background: #f3f2f1;
            border-right: 1px solid #ddd;
            font-weight: 600;
            color: var(--dark);
            letter-spacing: 0.05em;
        }

        .phone-input-wrapper .phone-input {
            border: none;
            flex: 1;
            padding: 10px 12px;
            font-size: 14px;
            outline: none;
        }

        .phone-input-wrapper.error {
            border-color: #d32f2f;
            box-shadow: 0 0 0 1px rgba(211, 47, 47, 0.3);
        }

        .phone-input-hint {
            font-size: 12px;
            color: #6b6a69;
            margin-top: 6px;
        }

        .admin-pagination {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
            padding-top: 8px;
            border-top: 1px solid #f0f0f0;
        }

        .admin-pagination .pagination-actions {
            display: flex;
            gap: 8px;
        }

        .admin-pagination button {
            padding: 6px 14px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            background: #fff;
            color: #4b5563;
            cursor: pointer;
            transition: background var(--transition-fast), color var(--transition-fast);
        }

        .admin-pagination button:hover:not(:disabled) {
            background: var(--primary-light);
            color: var(--primary);
        }

        .admin-pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .admin-pagination .pagination-info {
            font-size: 13px;
            color: #6b7280;
        }

        .search-bar input {
            flex: 1;
            padding: 10px 16px;
            border: none;
            outline: none;
            background: transparent;
            font-size: 14px;
            color: var(--dark);
        }

        .search-bar input::placeholder {
            color: #9ca3af;
        }

        .search-bar button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 400;
            transition: background var(--transition-fast);
        }

        .search-bar button:hover {
            background: var(--primary-hover);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-actions a {
            margin-left: 0;
            color: var(--dark);
            text-decoration: none;
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            border-radius: var(--radius-md);
            border: 2px solid var(--gray-300);
            background: #ffffff;
            transition: all var(--transition-fast);
        }

        .user-actions a:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .user-actions i {
            font-size: 18px;
        }

        /* ç°ä»£åŒ–è½®æ’­å›¾ */
        .carousel {
            position: relative;
            width: 100%;
            aspect-ratio: 21 / 9;
            overflow: hidden;
            border-radius: var(--radius-lg);
            margin: 32px 0 48px;
            box-shadow: var(--shadow-lg);
            transform: translateZ(0);
            transition: box-shadow var(--transition-normal), transform var(--transition-normal);
        }

        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease, transform 0.8s ease;
            background-size: cover;
            background-position: center;
            transform: scale(1.02);
        }

        .carousel-slide.active {
            opacity: 1;
            transform: scale(1);
        }

        .carousel-content {
            display: none; /* éšè—è½®æ’­å›¾ä¸­çš„æ–‡å­—å’ŒæŒ‰é’® */
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 40px;
            color: white;
        }

        .carousel-content h2 {
            margin-bottom: 10px;
            font-size: 28px;
        }

        .carousel-content p {
            margin-bottom: 15px;
        }

        .carousel-btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 2px;
            text-decoration: none;
            font-weight: 400;
            transition: background var(--transition-fast);
        }

        .carousel-btn:hover {
            background: var(--primary-hover);
        }

        .carousel-indicators {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .indicator:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: scale(1.2);
        }

        .indicator.active {
            background: white;
            width: 32px;
            border-radius: var(--radius-full);
            transform: scale(1.1);
        }

        /* è½®æ’­è¿›åº¦æ¡ï¼ˆè‡ªåŠ¨æ’­æ”¾è§†è§‰æç¤ºï¼Œä¸æ”¹å˜ä»»ä½•é€»è¾‘ï¼‰ */
        .carousel::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            height: 3px;
            background: rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .carousel::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            height: 3px;
            width: 100%;
            transform-origin: left;
            transform: scaleX(0);
            background: rgba(255, 255, 255, 0.8);
            animation: carouselProgress 6s linear infinite;
            pointer-events: none;
        }

        @keyframes carouselProgress {
            from {
                transform: scaleX(0);
            }
            to {
                transform: scaleX(1);
            }
        }

        /* è½®æ’­å›¾å·¦å³åˆ‡æ¢æŒ‰é’® */
        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.65);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 3;
            transition: background 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
            user-select: none;
            opacity: 1; /* å§‹ç»ˆå¯è§ */
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.4);
            font-size: 24px;
            line-height: 1;
        }

        .carousel-arrow:hover {
            background: rgba(0, 0, 0, 0.85);
            opacity: 1;
            transform: translateY(-50%) scale(1.08);
        }

        .carousel-arrow.prev {
            left: 16px;
        }

        .carousel-arrow.next {
            right: 16px;
        }

        /* äº§å“ç½‘æ ¼æ ·å¼ */
        .section-title {
            margin: 64px 0 32px;
            font-size: 36px;
            color: var(--dark);
            border-left: 5px solid transparent;
            border-image: linear-gradient(180deg, #6366f1, #8b5cf6) 1;
            padding-left: 20px;
            font-weight: 600;
            line-height: 1.2;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 20px;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: var(--radius-full);
        }

        /* ç½‘æ ¼ç³»ç»Ÿç°ä»£åŒ– */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            padding: 20px 0;
            margin-bottom: 80px;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        /* é¦–é¡µäº§å“åŠ è½½ä¸­å ä½ */
        .products-loading {
            width: 100%;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            background: #ffffff;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.04);
            margin-top: 12px;
            margin-bottom: 24px;
        }

        .products-loading-spinner {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 4px solid #e5e7eb;
            border-top-color: #6366f1;
            animation: homeProductsSpin 0.9s linear infinite;
            margin-bottom: 10px;
        }

        .products-loading-text {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        @keyframes homeProductsSpin {
            to {
                transform: rotate(360deg);
            }
        }


        /* ç°ä»£åŒ–äº§å“å¡ç‰‡ */
        .product-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal), border-color var(--transition-normal);
            border: 1px solid var(--gray-200);
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            animation: cardFadeIn 0.5s ease-out backwards;
        }

        @keyframes cardFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* äº¤é”™åŠ¨ç”»æ•ˆæœ */
        .product-card:nth-child(1) { animation-delay: 0s; }
        .product-card:nth-child(2) { animation-delay: 0.05s; }
        .product-card:nth-child(3) { animation-delay: 0.1s; }
        .product-card:nth-child(4) { animation-delay: 0.15s; }
        .product-card:nth-child(5) { animation-delay: 0.2s; }
        .product-card:nth-child(6) { animation-delay: 0.25s; }
        .product-card:nth-child(n+7) { animation-delay: 0.3s; }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-light);
        }

        .product-card:hover::before {
            opacity: 1;
        }

        /* æ‹–æ”¾æ’åºç›¸å…³æ ·å¼ */
        .product-card.draggable {
            cursor: move;
            user-select: none;
        }

        .product-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .product-card.drag-over {
            border: 2px dashed var(--primary, #ffc107);
            background-color: rgba(255, 193, 7, 0.1);
            transform: scale(1.02);
        }

        #admin-products-grid.dragging-active {
            position: relative;
        }

        #admin-products-grid.dragging-active .product-card:not(.dragging) {
            transition: transform 0.2s ease;
        }

        .product-image {
            width: 100%;
            background-color: var(--gray-100);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            transition: all var(--transition-normal);
            overflow: visible; /* å…è®¸å›¾ç‰‡å®Œæ•´æ˜¾ç¤º */
        }

        .product-image img {
            width: 100%;
            height: auto; /* æŒ‰åŸå›¾æ¯”ä¾‹è‡ªé€‚åº” */
            object-fit: contain; /* ä¿è¯æ•´å¼ å›¾ç‰‡å®Œå…¨æ˜¾ç¤ºï¼Œä¸è¢«è£å‰ª */
            display: block;
            max-width: 100%;
        }

        .product-card:hover .product-image {
            transform: scale(1.03);
        }

        .product-info {
            padding: 20px 24px 24px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* é¦–é¡µç²¾é€‰åŒºåŸŸå•ç‹¬æ§åˆ¶å¡ç‰‡å°ºå¯¸ */
        #featured-showcase #products-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 28px;
            max-width: 1350px;
        }

        #featured-showcase .product-card {
            max-width: 300px;
            min-height: 460px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
        }

        #featured-showcase .product-image {
            width: 100%;
            padding: 0; /* å»æ‰å†…è¾¹è·ç»™å›¾ç‰‡æ›´å¤šç©ºé—´ */
            overflow: visible;
        }

        #featured-showcase .product-info {
            padding: 18px;
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: space-between;
        }

        .product-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--dark);
            line-height: 1.5;
            min-height: 48px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            transition: color var(--transition-fast);
        }

        .product-card:hover .product-title {
            color: var(--primary);
        }

        .product-price {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            margin-top: auto;
            position: relative;
            padding-bottom: 4px;
            overflow: hidden;
        }

        /* äº§å“ä»·æ ¼è½»å¾®ä¸‹åˆ’çº¿åŠ¨ç”»ï¼Œå¢å¼ºè§†è§‰è€Œä¸æ”¹é¢œè‰² */
        .product-price::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 2px;
            border-radius: var(--radius-full);
            background: currentColor;
            opacity: 0.15;
            transform: translateX(-100%);
            transition: transform var(--transition-normal);
        }

        .product-card:hover .product-price::after {
            transform: translateX(0);
        }

        .product-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            margin-top: 6px;
        }

        /* ç°ä»£åŒ–æŒ‰é’® */
        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            flex: 1;
            justify-content: center;
            min-height: 40px;
            box-shadow: var(--shadow-sm);
            transform: translateY(0);
        }

        /* æŒ‰é’®ï¼šç»Ÿä¸€æ‚¬åœä¸æŒ‰å‹åé¦ˆï¼ˆåªè°ƒæ•´é˜´å½±å’Œä½ç§»ï¼Œä¸æ”¹é¢œè‰²ï¼‰ */
        .btn:hover:not(:disabled):not(.disabled) {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active:not(:disabled):not(.disabled) {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .btn:disabled,
        .btn.disabled {
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
            transform: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: none;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: #0e6b0e;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: none;
        }

        .btn-danger:hover {
            background: #a4262c;
        }

        /* ç°ä»£åŒ–æ ‡ç­¾å’Œå¾½ç«  */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-new {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .badge-sale {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .badge-hot {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        /* æ‚¬åœæ•ˆæœé›†åˆ */
        .hover-lift {
            transition: transform var(--transition-normal);
        }

        .hover-lift:hover {
            transform: translateY(-4px);
        }

        .hover-glow {
            transition: box-shadow var(--transition-normal);
        }

        .hover-glow:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        /* éª¨æ¶å±åŠ è½½æ•ˆæœ */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-md);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ç°ä»£åŒ–é€šçŸ¥å’Œæç¤ºæ¡† */
        .alert {
            padding: 16px 20px;
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(76, 201, 240, 0.05));
            border-left: 4px solid var(--success);
            color: var(--dark);
        }

        .alert-warning {
            background: linear-gradient(135deg, rgba(248, 150, 30, 0.1), rgba(248, 150, 30, 0.05));
            border-left: 4px solid var(--warning);
            color: var(--dark);
        }

        .alert-danger {
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.1), rgba(230, 57, 70, 0.05));
            border-left: 4px solid var(--danger);
            color: var(--dark);
        }

        /* é¦–é¡µç²¾é€‰å±•ç¤º */
        .featured-showcase {
            margin-top: 48px;
            background: #ffffff;
            border-radius: var(--radius-lg);
            padding: 48px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
        }

        .featured-showcase::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #10b981);
        }

        .featured-head {
            display: flex;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
            margin-bottom: 32px;
        }

        .featured-head h2 {
            margin: 0;
            font-size: 36px;
            color: var(--dark);
            font-weight: 300;
            line-height: 1.2;
        }

        .featured-head p {
            margin: 12px 0 0;
            color: var(--gray);
            max-width: 600px;
            font-size: 16px;
            line-height: 1.6;
        }

        .featured-meta {
            font-size: 13px;
            color: #9ca3af;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .featured-meta i {
            color: var(--primary);
        }

        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 32px 0 24px;
        }

        .category-item {
            padding: 10px 20px;
            border-radius: var(--radius-full);
            background: #ffffff;
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid var(--gray-300);
            min-height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .category-item:hover {
            background: var(--primary-soft);
            border-color: var(--primary-light);
            color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .category-item.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: #fff;
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }

        #products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 28px;
        }

        .home-feature-card {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(15, 23, 42, 0.08);
            display: flex;
            flex-direction: column;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            border: 1px solid rgba(15, 23, 42, 0.05);
        }

        .home-feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);
        }

        .home-feature-image {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1; /* ä¿æŒæ–¹å½¢å ä½ï¼Œå†…éƒ¨å±…ä¸­ç¼©æ”¾ */
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f7f8fa;
        }

        .home-feature-image img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œå®Œæ•´å±•ç¤ºå›¾ç‰‡ */
            display: block;
        }

        .home-feature-tag {
            position: absolute;
            top: 14px;
            left: 14px;
            padding: 4px 12px;
            border-radius: 999px;
            background: rgba(0, 0, 0, 0.65);
            color: #fff;
            font-size: 12px;
        }

        /* é¦–é¡µäº§å“å¡ç‰‡ - äºšé©¬é€Šå›¾æ ‡ï¼ˆä»…æœ‰äºšé©¬é€Šé“¾æ¥çš„äº§å“æ˜¾ç¤ºï¼‰ */
        .home-feature-amazon-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            /* é»˜è®¤æŒ‰ç§»åŠ¨ç«¯å°ºå¯¸ï¼š28x28 */
            width: 28px !important;
            height: 28px !important;
            border-radius: 50%;
            background: #ffffff;
            padding: 0;
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.25);
            object-fit: contain;
            pointer-events: none;
        }

        /* PC ç«¯ï¼šæ”¾å¤§åˆ° 40x40ï¼ˆè§†å£å®½åº¦å¤§äºç­‰äº 1024pxï¼‰ */
        @media (min-width: 1024px) {
            .home-feature-amazon-icon {
                width: 40px !important;
                height: 40px !important;
            }
        }

        .home-feature-body {
            padding: 22px 24px 26px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ï¼Œç§»é™¤å›ºå®šé«˜åº¦é¿å…ç•™ç™½ */
        }

        .home-feature-body h3 {
            margin: 0;
            font-size: 20px;
            color: var(--dark);
        }

        .home-feature-price {
            font-size: 26px;
            color: #ef4444;
            margin: 6px 0;
        }

        .home-feature-stock {
            font-size: 14px;
            color: #9ca3af;
        }

        .home-feature-actions {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            margin-top: auto;
        }

        .home-feature-actions .btn {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        /* æ¨¡æ€æ¡†æ ·å¼ */
        /* ç°ä»£åŒ–æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.25s ease;
            overflow-y: auto;
            padding: 20px 0;
        }

        /* æ¡Œé¢ç«¯ï¼šç§»é™¤æ¨¡æ€çª—å£çš„æ»šåŠ¨å’Œpaddingï¼Œç¡®ä¿ä¸€æ¬¡æ˜¾ç¤ºå®Œ */
        @media (min-width: 769px) {
            .modal {
                overflow-y: visible;
                padding: 0;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            border-radius: var(--radius-lg);
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.25s ease;
            transform-origin: center center;
            display: flex;
            flex-direction: column;
        }

        /* æ¡Œé¢ç«¯ï¼šç§»é™¤æ¨¡æ€å†…å®¹çš„æ»šåŠ¨ */
        @media (min-width: 769px) {
            .modal-content {
                overflow-y: visible;
                max-height: none;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Consent note for auth/register modals (å°æ¡æ¬¾æç¤º) */
        .modal .consent-note {
            border: none;
            padding: 6px 8px;
            margin: 6px 0 4px;
            border-radius: 6px;
            font-size: 0.72rem;
            color: #6b7280; /* muted gray */
            text-align: center;
            background: transparent;
        }
        .modal .consent-note a {
            color: #1f68cf; /* slightly darker gray for links */
            text-decoration: underline;
            font-weight: 500;
            margin: 0 4px;
        }
        .modal .consent-note a:hover {
            /* keep same underline on hover but slightly darker */
            color: #374151;
        }

        .modal-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-weight: 600;
            font-size: 20px;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 24px;
            /* åŸæ¥è¿™é‡Œæœ‰ max-height: 70vh å’Œ overflow-y: auto;
               ä¼šåœ¨å†…å®¹è¾ƒé«˜æ—¶å‡ºç°å†…éƒ¨æ»šåŠ¨æ¡ã€‚
               ç°åœ¨æ”¹ä¸ºç”±å¤–å±‚æ¨¡æ€æ•´ä½“æ»šåŠ¨ï¼Œä¸åœ¨å†…å®¹åŒºåŸŸå•ç‹¬æ»šåŠ¨ã€‚ */
        }
        
        /* æ‰“å¼€æ¨¡æ€æ¡†æ—¶é”å®šé¡µé¢æ»šåŠ¨ï¼ˆå…è®¸æ¨¡æ€æ¡†è‡ªèº«æ»šåŠ¨ï¼‰ */
        body.modal-open {
            overflow: hidden;
        }
        
        /* WhatsAppæ¨¡æ€æ¡†æ ·å¼ - å‚è€ƒäºšé©¬é€Šä¸‹å•æ­¥éª¤æ ·å¼ */
        .whatsapp-modal-content {
            max-width: 900px;
            max-height: 90vh;
            border-radius: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: window-appear 0.5s ease-out;
        }

        /* æ¡Œé¢ç«¯ï¼šç§»é™¤WhatsAppæ¨¡æ€å†…å®¹çš„æ»šåŠ¨ */
        @media (min-width: 769px) {
            .whatsapp-modal-content {
                overflow-y: visible;
                max-height: none;
            }
        }
        
        @keyframes window-appear {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .whatsapp-modal-content:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }
        
        .whatsapp-modal-content.whatsapp-modal-two-steps {
            max-width: 900px;
        }
        
        .whatsapp-modal-content.whatsapp-modal-single-step {
            max-width: 600px;
        }
        
        .whatsapp-modal-body {
            padding: 30px;
            background: #fafbfd;
        }

        /* æ¡Œé¢ç«¯ï¼šç¡®ä¿æ¨¡æ€çª—å£å†…å®¹ä¸æ»šåŠ¨ */
        @media (min-width: 769px) {
            .whatsapp-modal-body {
                overflow-y: visible;
            }
        }
        
        /* æ­¥éª¤å®¹å™¨æ ·å¼ */
        .steps-container {
            display: flex;
            gap: 20px;
            padding: 0;
        }
        
        .step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 35px 25px;
            border-radius: 18px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            position: relative;
            background: white;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.04);
            min-height: 480px;
        }
        
        .step:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        
        .step-number {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease;
        }
        
        .step:hover .step-number {
            transform: scale(1.1);
        }
        
        .step-icon-container {
            width: 75px;
            height: 75px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .step:hover .step-icon-container {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .amazon-icon-container {
            background: linear-gradient(135deg, #FF9900 0%, #FFAC33 100%);
        }
        
        .messenger-icon-container {
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
        }
        
        .whatsapp-icon-container {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        }
        
        .step-icon {
            font-size: 2.8rem;
            color: white;
        }
        
        .step-text {
            text-align: center;
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .step-title {
            font-size: 1.6rem;
            font-weight: 800;
            color: #2d3748;
            margin-bottom: 10px;
            letter-spacing: -0.2px;
        }
        
        .step-subtitle {
            font-size: 1.05rem;
            color: #718096;
            font-weight: 500;
            line-height: 1.5;
            margin-bottom: 25px;
            min-height: 50px;
        }
        
        /* å¤åˆ¶æ–‡æœ¬å®¹å™¨æ ·å¼ */
        .copy-container {
            width: 100%;
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 14px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .copy-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .copy-text {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 14px;
            font-size: 0.95rem;
            color: #495057;
            margin-bottom: 15px;
            word-break: break-all;
            line-height: 1.5;
            font-family: 'Courier New', monospace;
            position: relative;
            min-height: 70px;
        }
        
        .copy-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .copy-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* åˆ‡æ¢å™¨æ ·å¼ */
        .contact-switcher {
            width: 100%;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .switcher-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 600;
        }
        
        .switcher-buttons {
            display: flex;
            gap: 8px;
            width: 100%;
            max-width: 280px;
        }
        
        .contact-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
        }
        
        .contact-btn:hover {
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .contact-btn.active {
            border-color: transparent;
            color: white;
        }
        
        .contact-btn.messenger-btn.active {
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
            box-shadow: 0 5px 15px rgba(0, 106, 255, 0.2);
        }
        
        .contact-btn.whatsapp-btn.active {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.2);
        }
        
        .contact-btn i {
            font-size: 1.1rem;
        }
        
        /* æŒ‰é’®åŒºåŸŸ */
        .step-action {
            width: 100%;
            margin-top: auto;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 16px;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .action-btn.amazon-btn {
            background: linear-gradient(135deg, #FF9900 0%, #FFAC33 100%);
            box-shadow: 0 6px 20px rgba(255, 153, 0, 0.25);
        }
        
        .action-btn.messenger-btn {
            background: linear-gradient(135deg, #006AFF 0%, #0084FF 100%);
            box-shadow: 0 6px 20px rgba(0, 106, 255, 0.25);
        }
        
        .action-btn.whatsapp-btn {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.25);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .action-btn:active {
            transform: translateY(0);
        }
        
        .action-btn i {
            font-size: 1.4rem;
        }
        
        .progress-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 30px 20px;
            background: #fafbfd;
        }
        
        .progress-dots {
            display: flex;
            gap: 10px;
        }
        
        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e0;
            transition: all 0.3s ease;
        }
        
        .progress-dot.active {
            background: #667eea;
            transform: scale(1.2);
        }
        
        .footer-note {
            text-align: center;
            padding: 18px;
            font-size: 0.9rem;
            color: #a0aec0;
            background: white;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            font-weight: 500;
        }
        
        /* æˆåŠŸæç¤º */
        .copy-success {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            animation: slide-in 0.3s ease-out;
            display: none;
        }
        
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }
        
        .step-icon-container {
            animation: float 4s ease-in-out infinite;
        }
        
        .step:nth-child(1) .step-icon-container {
            animation-delay: 0.2s;
        }
        
        .step:nth-child(2) .step-icon-container {
            animation-delay: 0.4s;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 6px 20px rgba(255, 153, 0, 0.25);
            }
            50% {
                box-shadow: 0 6px 20px rgba(255, 153, 0, 0.4);
            }
        }
        
        .amazon-btn {
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse-blue {
            0%, 100% {
                box-shadow: 0 6px 20px rgba(0, 106, 255, 0.25);
            }
            50% {
                box-shadow: 0 6px 20px rgba(0, 106, 255, 0.4);
            }
        }
        
        .messenger-btn {
            animation: pulse-blue 3s ease-in-out infinite;
        }
        
        @keyframes pulse-green {
            0%, 100% {
                box-shadow: 0 6px 20px rgba(37, 211, 102, 0.25);
            }
            50% {
                box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
            }
        }
        
        .whatsapp-btn {
            animation: pulse-green 3s ease-in-out infinite;
        }
        
        @media (max-width: 768px) {
            .modal {
                padding: 5px 0;
                /* ç§»åŠ¨ç«¯åŒæ ·ä¿æŒå‚ç›´å±…ä¸­æ˜¾ç¤ºç™»å½•/æ³¨å†Œç­‰å¼¹çª— */
                align-items: center;
            }
            
            .modal-content {
                width: 98%;
                max-height: 98vh;
                margin: 5px auto;
            }
            
            .whatsapp-modal-content {
                max-width: 98%;
                max-height: 98vh;
            }
            
            /* ç§»åŠ¨ç«¯æ ‡é¢˜åŒºåŸŸä¼˜åŒ– */
            .whatsapp-modal-content .modal-header {
                padding: 15px 20px 18px !important;
            }
            
            .whatsapp-modal-content .modal-header h1 {
                font-size: 1.6rem !important;
                margin-bottom: 4px !important;
            }
            
            .whatsapp-modal-content .modal-header p {
                font-size: 0.85rem !important;
            }
            
            .whatsapp-modal-body {
                padding: 15px 12px !important;
            }
            
            .steps-container {
                flex-direction: column;
                gap: 12px;
            }
            
            .step {
                padding: 18px 15px;
                min-height: auto;
                border-radius: 12px;
            }
            
            .step-number {
                width: 36px;
                height: 36px;
                font-size: 1rem;
                margin-bottom: 12px;
            }
            
            .step-title {
                font-size: 1.15rem;
                margin-bottom: 6px;
            }
            
            .step-subtitle {
                font-size: 0.85rem;
                margin-bottom: 15px;
                min-height: auto;
                line-height: 1.4;
            }
            
            .step-icon-container {
                width: 55px;
                height: 55px;
                margin-bottom: 12px;
                border-radius: 14px;
            }
            
            .step-icon {
                font-size: 1.8rem;
            }
            
            /* ä¸¤æ­¥æµç¨‹ï¼šç§»åŠ¨ç«¯æ»šåŠ¨æç¤ºæ˜¾ç¤º */
            .whatsapp-modal-two-steps .mobile-scroll-hint {
                display: block;
            }
            
            /* ä¸¤æ­¥æµç¨‹ï¼šç§»åŠ¨ç«¯ç¡®è®¤æŒ‰é’®æ ·å¼ */
            .whatsapp-modal-two-steps .confirmed-btn {
                padding: 14px;
                font-size: 1rem;
            }
            
            .action-btn {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .copy-container {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 10px;
            }
            
            .copy-title {
                font-size: 0.95rem;
                margin-bottom: 10px;
            }
            
            .copy-text {
                padding: 10px;
                font-size: 0.8rem;
                margin-bottom: 10px;
                min-height: 50px;
                border-radius: 8px;
            }
            
            .copy-btn {
                padding: 10px;
                font-size: 0.85rem;
            }
            
            .switcher-buttons {
                max-width: 100%;
                gap: 6px;
            }
            
            .switcher-label {
                font-size: 0.8rem;
                margin-bottom: 6px;
            }
            
            .contact-switcher {
                margin-bottom: 12px;
            }
            
            .contact-btn {
                padding: 8px 10px;
                font-size: 0.8rem;
                border-radius: 8px;
            }
            
            .contact-btn i {
                font-size: 0.95rem;
            }
            
            /* è¿›åº¦æŒ‡ç¤ºå™¨å’Œåº•éƒ¨æ–‡å­— */
            .progress-indicator {
                margin-top: 12px;
                margin-bottom: 8px;
            }
            
            .footer-note {
                font-size: 0.75rem;
                margin-top: 8px;
                padding: 12px !important;
            }
            
            /* å…³é—­æŒ‰é’®ä¼˜åŒ– - ç¡®ä¿è¶³å¤Ÿå¤§ä»¥ä¾¿ç‚¹å‡» */
            .whatsapp-modal-content .close-btn,
            .whatsapp-modal-content .close-modal {
                width: 36px !important;
                height: 36px !important;
                min-width: 36px !important;
                min-height: 36px !important;
                top: 10px !important;
                right: 10px !important;
                font-size: 1rem !important;
            }
            
            /* ç¡®ä¿æ­¥éª¤å¡ç‰‡åœ¨ç§»åŠ¨ç«¯ä¸ä¼šå¤ªé«˜ */
            .step {
                max-height: none;
            }
            
            /* ä¼˜åŒ–actionæŒ‰é’®å›¾æ ‡ */
            .action-btn i {
                font-size: 1.1rem !important;
            }
        }
        
        .whatsapp-message {
            margin-bottom: 30px;
        }
        
        .whatsapp-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
            line-height: 1.5;
        }
        
        .whatsapp-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            margin-top: 20px;
        }
        
        .click-here-text {
            font-size: 16px;
            color: #25D366;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        .arrow-container {
            display: flex;
            align-items: center;
        }
        
        .arrow {
            font-size: 32px;
            color: #25D366;
            animation: arrowBounce 1.5s infinite;
            font-weight: bold;
        }
        
        .whatsapp-icon-link {
            display: inline-block;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        
        .whatsapp-icon-link:hover {
            transform: scale(1.1);
        }
        
        .whatsapp-icon {
            font-size: 64px;
            color: #25D366;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
        }
        
        .whatsapp-icon:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 4px 8px rgba(37, 211, 102, 0.4));
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }
        
        @keyframes arrowBounce {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(10px);
            }
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        /* ç°ä»£åŒ–è¡¨å•æ§ä»¶ */
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 16px;
            background: white;
            transition: all var(--transition-fast);
            min-height: 40px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-control::placeholder {
            color: var(--gray-light);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }

        #signup-cancel-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #e5e7eb;
        }

        #signup-cancel-btn:hover {
            background: #e5e7eb;
        }

        #signup-submit-btn {
            background: #22c55e;
            border-color: #1faa52;
        }

        #signup-submit-btn:hover {
            background: #1faa52;
        }

        /* å•†å“è¯¦æƒ…é¡µæ ·å¼ */
        .product-detail {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .product-detail-content {
            display: flex;
            gap: 30px;
        }

        .product-detail-image {
            flex: 1;
            max-width: 520px;
        }

        .product-gallery {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .product-gallery-main {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fb;
            border: 1px solid var(--border-subtle);
            min-height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-gallery-slides {
            width: 100%;
            height: 100%;
        }

        .product-gallery-slide {
            display: none;
            width: 100%;
            height: 100%;
        }

        .product-gallery-slide.active {
            display: block;
        }

        /* åˆ‡æ¢å›¾ç‰‡æ»‘åŠ¨åŠ¨ç”»ï¼ˆä¸æ”¹å˜å¸ƒå±€ï¼Œåªåšè½»å¾®å¹³ç§»åŠ¨ç”»ï¼‰ */
        .product-gallery-slide.slide-from-left {
            animation: gallerySlideFromLeft 0.25s ease-out;
        }

        .product-gallery-slide.slide-from-right {
            animation: gallerySlideFromRight 0.25s ease-out;
        }

        @keyframes gallerySlideFromLeft {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes gallerySlideFromRight {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .product-gallery-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #fff;
        }

        .product-gallery-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.45);
            border: none;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            transition: background var(--transition-fast), opacity var(--transition-fast);
            opacity: 0;
            pointer-events: none;
        }

        .product-gallery-arrow:hover {
            background: rgba(0, 0, 0, 0.65);
        }

        .product-gallery-arrow[data-action="prev"] {
            left: 12px;
        }

        .product-gallery-arrow[data-action="next"] {
            right: 12px;
        }

        /* æ‚¬åœæ—¶æ˜¾ç¤ºå›¾ç‰‡åˆ‡æ¢ç®­å¤´ */
        .product-gallery-main:hover .product-gallery-arrow {
            opacity: 1;
            pointer-events: auto;
        }

        /* é¡¶éƒ¨è½®æ’­ç®­å¤´ï¼šé»˜è®¤åŠé€æ˜ï¼Œæ‚¬åœæ—¶æ›´æ¸…æ™°ï¼Œä¸Šé¢ hover å·²å¤„ç† */

        .product-gallery-thumbs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .product-gallery-thumb {
            width: 70px;
            height: 70px;
            border-radius: 6px;
            border: 2px solid transparent;
            overflow: hidden;
            padding: 0;
            background: none;
            cursor: pointer;
            transition: border var(--transition-fast), transform var(--transition-fast);
        }

        .product-gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .product-gallery-thumb:hover {
            transform: translateY(-2px);
            border-color: var(--primary-light);
        }

        .product-gallery-thumb.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 1px rgba(0, 120, 212, 0.15);
        }

        .product-detail-info {
            flex: 1;
        }

        .product-detail-title {
            font-size: 28px;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .product-detail-price {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .product-detail-description {
            line-height: 1.8;
            margin-bottom: 25px;
            color: #666;
        }

        .product-detail-actions {
            display: flex;
            gap: 15px;
        }

        .product-image-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .product-image-inputs input {
            width: 100%;
        }

        /* å®¢æœè”ç³»æŒ‰é’®ç»„ */
        .contact-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        /* ç§»åŠ¨ç«¯ä¸Šç§»ï¼Œé¿å…è¢«æµè§ˆå™¨å·¥å…·æ  & åº•éƒ¨å¯¼èˆªé®æŒ¡ */
        @media (max-width: 768px) {
            .contact-button {
                bottom: 110px; /* å†å‘ä¸ŠæŠ¬é«˜ï¼Œç¡®ä¿å®Œå…¨éœ²å‡ºåœ¨åº•éƒ¨å¯¼èˆªä¹‹ä¸Š */
                right: 20px;
            }
        }

        .main-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .main-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
        }

        .main-button.active {
            transform: rotate(45deg);
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .contact-options {
            position: absolute;
            bottom: 85px;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.4s ease;
        }

        .contact-options.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .option-button {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            position: relative;
        }

        .option-button:hover {
            transform: scale(1.15) translateX(-5px);
        }

        .option-button.messenger {
            background-color: #0084ff;
        }

        .option-button.whatsapp {
            background-color: #25D366;
        }

        .option-button.email {
            background-color: #EA4335;
        }

        .tooltip {
            position: absolute;
            right: 65px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -6px;
            transform: translateY(-50%);
            border-width: 6px 0 6px 6px;
            border-style: solid;
            border-color: transparent transparent transparent rgba(0, 0, 0, 0.8);
        }

        .option-button:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Messenger å¤åˆ¶æˆåŠŸæç¤º */
        .messenger-copy-toast {
            /* å›ºå®šåœ¨çª—å£åº•éƒ¨å±…ä¸­ï¼Œå§‹ç»ˆåœ¨æ‰€æœ‰å¼¹çª—ä¹‹ä¸Š */
            position: fixed;
            left: 50%;
            bottom: 24px;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.96);
            color: #e5e7eb;
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.55);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            z-index: 9999;
        }

        .messenger-copy-toast.show {
            opacity: 1;
            /* è½»å¾®ä¸Šç§»åŠ¨ç”»æ•ˆæœ */
            transform: translateX(-50%) translateY(-4px);
        }

        /* Messenger æ­¥éª¤æŒ‰é’®äº¤äº’æ•ˆæœ */
        .messenger-step-btn {
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease, background 0.2s ease;
        }

        .messenger-step-btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.05);
            box-shadow: 0 14px 32px rgba(15, 23, 42, 0.25);
        }

        .messenger-step-btn:active {
            transform: translateY(1px) scale(0.98);
            filter: brightness(0.97);
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.3);
        }

        /* Amazon ä¸‹å•æŒ‰é’® */
        .amazon-order-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            max-width: 260px;
            margin: 24px auto 0;
            padding: 12px 26px;
            border-radius: 999px;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 50%, #ea580c 100%);
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 12px 30px rgba(234, 88, 12, 0.45);
            transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
        }

        .amazon-order-btn i {
            font-size: 18px;
        }

        .amazon-order-btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.05);
            box-shadow: 0 16px 36px rgba(234, 88, 12, 0.55);
        }

        .amazon-order-btn:active {
            transform: translateY(1px) scale(0.98);
            filter: brightness(0.96);
            box-shadow: 0 10px 22px rgba(234, 88, 12, 0.6);
        }

        /* ç”¨æˆ·ä¸­å¿ƒæ ·å¼ */
        .user-center {
            display: none;
            margin: 30px 0;
        }
        
        .user-center.show {
            display: grid !important;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }
        
        .user-center.show.sidebar-hidden {
            grid-template-columns: 1fr;
        }

        /* ä¸ªäººä¸­å¿ƒèœœç½å¾½ç«  */
        .user-points-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(37, 99, 235, 0.06);
            color: #1f2937;
            font-size: 12px;
            border: 1px solid rgba(37, 99, 235, 0.25);
            cursor: pointer;
        }

        .user-points-badge span {
            font-weight: 600;
            color: #1d4ed8;
        }

        .honey-icon {
            width: 18px;
            height: 18px;
            object-fit: contain;
        }

        .honey-tooltip {
            position: absolute;
            top: 120%;
            right: 0;
            min-width: 260px;
            padding: 12px 14px;
            border-radius: 10px;
            background: #0f172a;
            color: #e5e7eb;
            font-size: 13px;
            line-height: 1.7;
            box-shadow: 0 14px 30px rgba(15, 23, 42, 0.35);
            opacity: 0;
            pointer-events: none;
            transform: translateY(4px);
            transition: opacity 0.18s ease-out, transform 0.18s ease-out;
            z-index: 40;
            text-align: left;
        }

        .honey-tooltip::before {
            content: "";
            position: absolute;
            top: -6px;
            right: 16px;
            border-width: 6px;
            border-style: solid;
            border-color: transparent transparent #0f172a transparent;
        }

        .user-points-badge:hover .honey-tooltip {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        .honey-highlight {
            color: #ffd700;
            font-weight: bold;
        }

        .user-sidebar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .user-details h3 {
            margin-bottom: 5px;
        }

        .user-menu {
            list-style: none;
        }

        .user-menu li {
            margin-bottom: 10px;
        }

        .user-menu a {
            display: block;
            padding: 10px;
            color: var(--dark);
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .user-menu a.active,
        .user-menu a:hover {
            background: var(--light);
            color: var(--primary);
        }

        .user-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        /* é€šç”¨ï¼šé¿å… user-content åœ¨ç§»åŠ¨ç«¯äº§ç”Ÿæ¨ªå‘æº¢å‡º */
        .user-content {
            overflow-wrap: anywhere;
            word-break: break-word;
        }
        /* å…è®¸ä½œä¸ºç½‘æ ¼/å¼¹æ€§å­é¡¹æ—¶åœ¨å°å±æ­£å¸¸æ”¶ç¼©ï¼Œé¿å…æ¨ªå‘æº¢å‡º */
        .user-content,
        .user-page {
            min-width: 0;
        }
        .user-content img,
        .user-content video,
        .user-content canvas,
        .user-content iframe {
            max-width: 100%;
            height: auto;
            display: block;
        }
        .user-content pre {
            max-width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .user-content table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
        }
        /* å°å±å¹•ä¸‹ï¼Œè¡¨æ ¼å®¹å™¨å…è®¸æ¨ªå‘æ»šåŠ¨ä»¥é˜²æˆªæ–­ */
        @media (max-width: 768px) {
            .user-content table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        .order-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            /* é»˜è®¤ä¸æ¢è¡Œï¼Œé¿å…æ ‡ç­¾è¿‡å¤šæ—¶æŒ¤å‹å˜å½¢ */
            flex-wrap: nowrap;
        }

        .order-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .order-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        /* ç§»åŠ¨ç«¯ï¼šè®¢å•çŠ¶æ€æ ‡ç­¾æ”¯æŒå·¦å³æ»‘åŠ¨ï¼Œé¿å…è¢«æˆªæ–­ */
        @media (max-width: 768px) {
            .order-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                white-space: nowrap;
                border-bottom: none;
                padding-bottom: 4px;
                gap: 8px;
                scroll-snap-type: x proximity; /* æ›´é¡ºæ»‘çš„åˆ†é¡µæ„Ÿ */
            }

            .order-tab {
                flex: 0 0 auto;
                margin-right: 8px;
                padding: 8px 14px;
                border-radius: 999px;
                border: 1px solid #e5e7eb;
                font-size: 13px;
                background-color: #f9fafb;
                border-bottom-width: 1px;
                scroll-snap-align: start;
            }

            .order-tab.active {
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                color: #ffffff;
                border-color: transparent;
            }
            /* ç”¨æˆ·ä¸­å¿ƒä¸¤æ åœ¨å°å±æ”¹ä¸ºå•åˆ—ï¼Œé¿å…æ¨ªå‘æŒ¤å‹é€ æˆæº¢å‡º */
            .user-center.show {
                grid-template-columns: 1fr;
            }
        }

        .order-list {
            display: none;
        }

        .order-list.active {
            display: block;
        }

        .order-item {
            display: flex;
            align-items: flex-start;
            padding: 14px;
            border: 1px solid #eee;
            border-radius: 10px;
            margin-bottom: 14px;
            background: #fff;
        }
        
        .order-image {
            width: 96px;
            height: 96px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin-right: 14px;
            flex-shrink: 0;
        }

        .order-details {
            flex: 1;
        }

        .order-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .order-price {
            display: flex;
            align-items: baseline;
            gap: 10px;
            margin-bottom: 5px;
        }

        .order-date {
            color: #666;
            font-size: 12px;
        }

        .order-price-old {
            text-decoration: line-through;
            color: #999;
            font-size: 0.95em;
        }

        .order-price-new {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1em;
        }

        .order-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        /* è¯„ä»·å®Œæˆåçš„æ„Ÿè°¢æç¤º */
        .review-thankyou-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 500;
            background: linear-gradient(135deg, #10b981, #059669);
            color: #ffffff;
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.25);
            border: none;
            cursor: default;
            white-space: nowrap;
        }

        .review-thankyou-badge i {
            margin-right: 8px;
        }

        .order-copy-btn {
            flex: 0;
            padding: 4px 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #6c757d;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            width: auto;
            min-width: auto;
            font-size: 12px;
            gap: 4px;
        }

        .order-copy-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
            color: #495057;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-review {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-shipping {
            background: #e7d5f5;
            color: #6a1b9a;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-cancelled {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        /* ç”¨æˆ·é¡µé¢æ ·å¼ */
        .user-page {
            display: none;
        }

        .user-page.active {
            display: block;
        }

        .address-header {
            margin-bottom: 20px;
        }

        .address-header h3 {
            font-size: 28px;
            font-weight: 400;
            margin: 0 0 20px 0;
        }

        .address-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Add Address å¡ç‰‡ */
        .add-address-card {
            background: white;
            border: 2px dashed #ddd;
            border-radius: 4px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .add-address-card:hover {
            border-color: var(--primary);
            background: #f8f9ff;
        }

        .add-address-icon {
            font-size: 48px;
            color: #999;
            margin-bottom: 10px;
        }

        .add-address-text {
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }

        /* åœ°å€å¡ç‰‡ */
        .address-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        .address-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .address-item.default {
            border-color: #e47911;
        }

        .address-default-badge {
            display: inline-block;
            background: #e47911;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .address-info {
            flex: 1;
            margin-bottom: 15px;
        }

        .address-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            color: #111;
        }

        .address-full {
            color: #111;
            line-height: 1.5;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .address-phone {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .address-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .address-actions a {
            color: #0066c0;
            text-decoration: none;
            font-size: 13px;
            cursor: pointer;
        }

        .address-actions a:hover {
            text-decoration: underline;
            color: #c45500;
        }

        .address-actions .separator {
            color: #ddd;
            margin: 0 4px;
        }

        .security-section {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .security-section h4 {
            margin-bottom: 20px;
            color: var(--dark);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .security-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .security-item:last-child {
            border-bottom: none;
        }

        .security-info h5 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .security-info p {
            color: var(--gray);
            font-size: 14px;
            margin: 0;
        }

        /* å¼€å…³æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* åå°ç®¡ç†æ ·å¼ */
        .admin-panel {
            display: none;
            margin: 30px 0;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .admin-nav-btn {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .admin-nav-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .admin-nav-btn:hover {
            color: var(--primary);
        }

        .admin-page {
            display: none;
        }

        .admin-page.active {
            display: block;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .admin-table th,
        .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .admin-table th {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            font-weight: 600;
            color: var(--dark);
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        .admin-table tbody tr {
            transition: all var(--transition-fast);
        }

        .admin-table tbody tr:hover {
            background: var(--gray-100);
            transform: scale(1.01);
        }

        /* å¯ç‚¹å‡»å¤åˆ¶çš„å•å…ƒæ ¼æ ·å¼ */
        .admin-table tbody td.copyable-cell {
            cursor: pointer;
            position: relative;
            transition: all var(--transition-fast);
        }

        .admin-table tbody td.copyable-cell:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .admin-table tbody td.copyable-cell:active {
            background-color: rgba(67, 97, 238, 0.2);
            transform: scale(0.98);
        }

        /* å¤åˆ¶æç¤ºåŠ¨ç”» */
        .copy-tooltip {
            position: absolute;
            background: var(--dark);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-fast);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateY(-10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .copy-tooltip.show {
            opacity: 1;
            transform: translate(-50%, -50%) translateY(-5px);
        }

        .users-table-container,
        .orders-table-container {
            overflow-x: auto;
        }

        /* ç”¨æˆ·è¡¨æ ¼åˆ—å®½ä¼˜åŒ– */
        #users-table th:nth-child(1),
        #users-table td:nth-child(1) {
            width: 50px;
            min-width: 50px;
            text-align: center;
        }
        .user-select-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        #users-table th:nth-child(2),
        #users-table td:nth-child(2) {
            width: 80px;
            min-width: 80px;
        }

        #users-table th:nth-child(3),
        #users-table td:nth-child(3) {
            width: 140px;
            min-width: 140px;
        }
        
        /* åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .online-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #28a745;
            border-radius: 50%;
            margin-right: 6px;
            vertical-align: middle;
            box-shadow: 0 0 3px rgba(40, 167, 69, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        #users-table th:nth-child(4),
        #users-table td:nth-child(4) {
            width: 160px;
            min-width: 160px;
        }

        #users-table th:nth-child(5),
        #users-table td:nth-child(5) {
            width: 110px;
            min-width: 110px;
        }

        #users-table th:nth-child(6),
        #users-table td:nth-child(6) {
            width: 110px;
            min-width: 110px;
            text-align: center;
        }

        #users-table th:nth-child(7),
        #users-table td:nth-child(7) {
            width: 180px;
            min-width: 180px;
        }

        #users-table th:nth-child(8),
        #users-table td:nth-child(8) {
            width: 90px;
            min-width: 90px;
            text-align: center;
        }
        
        #users-table th:nth-child(9),
        #users-table td:nth-child(9) {
            width: 110px;
            min-width: 110px;
            text-align: center;
        }
        
        #users-table th:nth-child(10),
        #users-table td:nth-child(10) {
            width: 160px;
            min-width: 160px;
            text-align: center;
        }

        #orders-table th:nth-child(1),
        #orders-table td:nth-child(1) {
            width: 50px;
            min-width: 50px;
            text-align: center;
        }

        /* è®¢å•çŠ¶æ€åˆ—å®½åº¦ä¼˜åŒ– */
        #orders-table th:nth-child(6),
        #orders-table td:nth-child(6) {
            min-width: 100px;
            width: auto;
            white-space: nowrap;
        }

        #orders-table td:nth-child(6) {
            text-align: center;
        }

        .danger-zone {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #fed3d3;
            border-radius: 10px;
            background: #fff6f6;
        }

        .danger-zone h4 {
            margin-bottom: 10px;
            color: #c0392b;
        }

        .danger-zone p {
            margin-bottom: 15px;
            color: #8f231b;
            font-size: 14px;
        }

        .order-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .order-filters .form-control {
            min-width: 200px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-card.active {
            border: 2px solid var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-info h3 {
            font-size: 32px;
            margin: 0;
            color: var(--dark);
        }

        .stat-info p {
            margin: 5px 0 0 0;
            color: var(--gray);
        }

        /* ç»Ÿè®¡è¡¨æ ¼æ ·å¼ */
        .stat-table-section {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-table-section table {
            width: 100%;
            border-collapse: collapse;
        }

        .stat-table-section table tbody tr {
            transition: background-color 0.2s ease;
        }

        .stat-table-section table tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* ç­›é€‰è¾“å…¥æ¡†æ ·å¼ */
        .filter-input {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
        }

        .orders-filter-section {
            transition: all 0.3s ease;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 400;
            display: inline-block;
            white-space: nowrap;
            text-align: center;
            min-width: 60px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-banned {
            background: #f8d7da;
            color: #721c24;
            font-weight: 600;
        }

        /* è®¢å•çŠ¶æ€é¢œè‰²ä¼˜åŒ– */
        .status-pending {
            background: #fff3cd;
            color: #856404;
            font-weight: 500;
        }

        .status-review {
            background: #cfe2ff;
            color: #084298;
            font-weight: 500;
        }

        .status-shipping {
            background: #d1ecf1;
            color: #0c5460;
            font-weight: 500;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
            font-weight: 500;
        }

        .status-shipped {
            background: #d4edda;
            color: #155724;
            font-weight: 500;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
            font-weight: 500;
        }

        /* ä¸»é¡µç®¡ç†æ ·å¼ */
        .homepage-editor {
            display: grid;
            gap: 30px;
        }

        .editor-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .editor-section h3 {
            margin-bottom: 20px;
            color: var(--dark);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .carousel-manager {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .carousel-tabs {
            display: inline-flex;
            gap: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 4px;
            background: #f9fafb;
            width: fit-content;
        }

        .carousel-tab {
            border: none;
            background: transparent;
            padding: 8px 18px;
            border-radius: 6px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .carousel-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);
        }

        .carousel-panel {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .carousel-panel.active {
            display: flex;
        }

        .carousel-list {
            display: grid;
            gap: 15px;
        }

        .carousel-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .carousel-preview {
            width: 120px;
            height: 80px;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            margin-right: 15px;
        }

        .carousel-info {
            flex: 1;
        }

        .carousel-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .carousel-desc {
            color: #666;
            font-size: 14px;
        }

        .carousel-actions {
            display: flex;
            gap: 10px;
        }

        .user-detail-grid {
            display: grid;
            gap: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item label {
            font-weight: 600;
            min-width: 100px;
            margin-right: 15px;
        }

        .password-field {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .role-badge.admin {
            background: #d4edda;
            color: #155724;
        }

        .role-badge.user {
            background: #cce5ff;
            color: #004085;
        }

        /* æŒ‰é’®é«˜äº®æ•ˆæœ */
        .btn-refreshing {
            background: var(--secondary) !important;
            color: white !important;
            transform: scale(0.95);
            transition: all 0.3s ease;
        }

        .btn-refreshing::after {
            content: " ğŸ”„";
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .btn-success {
            background: var(--secondary) !important;
            color: white !important;
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        .btn-success::after {
            content: " âœ…";
        }

        /* é€šçŸ¥åŠ¨ç”» */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* æ€§èƒ½ä¼˜åŒ– */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .lazy-load.loaded {
            opacity: 1;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .admin-table {
                font-size: 14px;
            }

            .admin-table th,
            .admin-table td {
                padding: 8px 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 15px;
            }
        }

        .admin-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: nowrap;
        }
        
        .admin-actions .btn {
            flex-shrink: 0;
            white-space: nowrap;
        }
        
        .admin-actions .spacer {
            flex: 1;
            min-width: 0;
        }
        
        .admin-actions .admin-search {
            flex-shrink: 0;
        }
        
        @media (max-width: 768px) {
            .admin-actions {
                flex-wrap: wrap;
            }
            
            .admin-actions .spacer {
                display: none;
            }
        }

        .admin-search {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            background: #fff;
            min-width: 260px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .admin-search i {
            color: var(--gray-light);
        }

        .admin-search-input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 14px;
        }

        .admin-search-input::placeholder {
            color: var(--gray-light);
        }

        .admin-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        /* ä¸»é¡µç®¡ç†ä¼˜åŒ–æ ·å¼ */
        .homepage-editor {
            max-width: 1200px;
            margin: 0 auto;
        }

        .editor-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .editor-section h3 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .editor-section h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .carousel-manager {
            background: white;
            padding: 20px;
            border-radius: 6px;
        }

        .carousel-list {
            margin-bottom: 20px;
        }

        .carousel-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .carousel-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .carousel-preview {
            width: 120px;
            height: 80px;
            border-radius: 6px;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .carousel-info {
            flex: 1;
        }

        .carousel-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .carousel-desc {
            color: var(--gray);
            font-size: 14px;
        }

        .carousel-actions {
            display: flex;
            gap: 10px;
        }

        .excel-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .excel-upload:hover {
            border-color: var(--primary);
        }

        .excel-upload i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* Excelä¸Šä¼ ç›¸å…³æ ·å¼ */
        .excel-upload.processing {
            border-color: var(--primary);
            background: #f8f9fa;
        }

        .excel-upload.success {
            border-color: var(--secondary);
            background: #f8fff9;
        }

        .excel-upload.error {
            border-color: var(--danger);
            background: #fff5f5;
        }

        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .excel-preview {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .excel-preview h4 {
            margin-bottom: 15px;
            color: var(--dark);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .preview-info {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }

        .preview-products {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .preview-product-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .preview-product-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .preview-product-image {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .preview-product-info {
            flex: 1;
        }

        .preview-product-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .preview-product-price {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 3px;
        }

        .preview-product-category {
            font-size: 12px;
            color: var(--gray);
            background: var(--light);
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .preview-product-status {
            margin-left: 15px;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .product-category {
            font-size: 12px;
            color: var(--gray);
            background: var(--light);
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 10px;
        }

        /* æ§åˆ¶é¢æ¿æŒ‰é’®æ ·å¼ï¼ˆå½“å‰æš‚ä¸ä½¿ç”¨ï¼Œæ•´ä½“éšè—æ§åˆ¶é¢æ¿ UIï¼‰ */
        #admin-control-panel {
            display: none !important;
        }

        #control-panel-btn:hover {
            background: #2980b9 !important;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        #control-panel-dropdown button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯é¡¶éƒ¨å¯¼èˆªä¸¤è¡Œå¸ƒå±€ */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                gap: 8px;
            }

            /* ç¬¬ä¸€è¡Œï¼šå·¦ä¾§ Logoï¼Œå³ä¾§ç™»å½•/æ³¨å†Œç­‰æŒ‰é’® */
            .logo {
                order: 1;
                margin-left: 0;
                min-width: auto;
            }

            .user-actions {
                order: 2;
                margin-top: 0;
                width: auto;
                justify-content: flex-end;
                flex: 1 0 auto;
            }

            /* è¯­è¨€é€‰æ‹©å™¨æ”¾åˆ°è¿™ä¸€è¡Œæœ€å³ä¾§ï¼ˆLogin / Register çš„å³è¾¹ï¼‰ */
            .language-selector {
                order: 99;
                margin-left: auto;
            }

            /* ç¬¬äºŒè¡Œï¼šå¯¼èˆªé“¾æ¥ + æœç´¢æ  */
            .nav-links {
                order: 3;
                display: flex;
                flex: 1 0 100%;
                justify-content: flex-start;
                margin: 0;
                padding: 0;
            }

            .nav-links li {
                margin-left: 0;
            }

            .nav-links a {
                padding: 8px 10px;
                font-size: 13px;
                min-height: 40px;
            }

            .search-bar {
                order: 4;
                flex: 1 0 100%;
                width: 100%;
                margin: 4px 0 0;
            }

            /* åº•éƒ¨å›ºå®šå¯¼èˆªæ  */
            .bottom-nav {
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                height: 54px;
                background: #ffffff;
                border-top: 1px solid #e5e7eb;
                box-shadow: 0 -2px 6px rgba(15, 23, 42, 0.08);
                display: flex;
                z-index: 1100;
            }

            /* é¢„ç•™ç©ºé—´é¿å…åº•éƒ¨å†…å®¹è¢«å¯¼èˆªæ é®æŒ¡ */
            body {
                padding-bottom: 64px;
            }

            .carousel {
                height: 300px;
            }

            .carousel-content {
                left: 20px;
                bottom: 20px;
                padding: 15px;
            }

            .carousel-content h2 {
                font-size: 22px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }

            .product-image {
                width: 100%;
            }

            .product-detail-content {
                flex-direction: column;
            }

            .product-detail-image {
                max-width: 100%;
            }

            .chat-window {
                width: 300px;
                height: 400px;
            }
        }

        /* å“åº”å¼æ–­ç‚¹ä¼˜åŒ– */
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 16px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
            }
            
            .carousel {
                aspect-ratio: 16 / 9;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .product-card {
                max-width: 100%;
            }
        }

        /* ========== ç§»åŠ¨ç«¯å¸ƒå±€ä¼˜åŒ– ========== */

        /* å¯¼èˆªæ ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .nav-container {
                display: flex;
                flex-wrap: nowrap;
                align-items: center;
                padding: 10px 15px;
                gap: 10px;
            }

            .logo {
                font-size: 18px;
                min-height: 40px;
                margin: 0;
                flex-shrink: 0;
                order: 1;
                display: flex;
                align-items: center;
            }
            
            .logo img {
                height: 40px;
                max-width: 150px;
            }

            /* æ±‰å ¡èœå•æŒ‰é’® */
            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
                background: none;
                border: none;
                font-size: 24px;
                color: var(--dark);
                cursor: pointer;
                padding: 8px 10px;
                margin: 0;
                flex-shrink: 0;
                order: 2;
                min-width: 44px;
                min-height: 44px;
            }

            .nav-links {
                display: none !important;
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                margin: 0;
                padding: 10px 0;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                max-height: calc(100vh - 60px);
                overflow-y: auto;
                border-top: 1px solid #eee;
            }

            .nav-links.show {
                display: flex !important;
            }

            .nav-links li {
                margin: 0;
                padding: 0;
                width: 100%;
            }

            .nav-links a {
                display: block;
                padding: 12px 20px;
                border-bottom: 1px solid #eee;
                width: 100%;
                box-sizing: border-box;
            }

            .nav-links li:last-child a {
                border-bottom: none;
            }

            .search-bar {
                flex: 1;
                min-width: 0;
                order: 3;
                margin: 0;
                display: flex;
            }

            .search-bar input {
                font-size: 16px;
                padding: 10px 12px;
                flex: 1;
                min-width: 0;
            }

            .search-bar button {
                padding: 0 15px;
                flex-shrink: 0;
            }

            .user-actions {
                display: flex;
                align-items: center;
                gap: 6px;
                margin: 0;
                flex-shrink: 0;
                order: 4;
                flex-wrap: nowrap;
            }

            .user-actions > * {
                flex-shrink: 0;
            }

            .language-selector {
                margin: 0 !important;
                margin-left: auto !important;
            }

            .language-selector select {
                padding: 6px 8px !important;
                font-size: 12px !important;
                min-width: 80px;
            }

            #admin-control-panel {
                margin: 0 !important;
            }

            #control-panel-btn {
                padding: 6px 10px !important;
                font-size: 12px !important;
            }

            #control-panel-btn span {
                display: none;
            }

            .user-actions a {
                margin: 0;
                font-size: 13px;
                padding: 10px 16px;
                background: var(--primary);
                color: white;
                border-radius: 2px;
                white-space: nowrap;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                font-weight: 400;
                box-shadow: none;
                transition: background var(--transition-fast);
                min-height: 40px;
                border: none;
            }

            .user-actions a:hover {
                background: var(--primary-hover);
            }

            .user-actions a i {
                font-size: 14px;
            }

            /* é€€å‡ºæŒ‰é’®ä¼˜åŒ– */
            #logout-link {
                padding: 6px 10px !important;
                font-size: 12px !important;
            }
        }

        /* ç§»åŠ¨ç«¯å¯¼èˆªé‡æ’ï¼šæ²¿ç”¨ä¸¤è¡Œæ–¹æ¡ˆï¼Œä½†ä¸å†å•ç‹¬æ§åˆ¶è¯­è¨€ä¸‹æ‹‰ä½ç½® */
        @media (max-width: 768px) {
            .nav-container {
                flex-wrap: wrap;
                align-items: center;
                gap: 10px;
                padding: 10px 15px;
            }

            /* ç¬¬ä¸€è¡Œï¼šå·¦ä¾§ Logoï¼Œå³ä¾§ç™»å½•/æ³¨å†Œç­‰æŒ‰é’®ï¼ˆåŒ…å«è¯­è¨€é€‰æ‹©å™¨ï¼ŒæŒ‰åŸé¡ºåºæ’åˆ—ï¼‰ */
            .logo {
                margin: 0;
                flex: 0 0 auto;
                order: 1;
                min-width: 120px;
                max-width: 150px;
            }

            .logo img {
                margin: 0;
                height: 40px;
                max-width: 100%;
            }

            .user-actions {
                order: 2;
                flex: 1 0 auto;
                flex-wrap: nowrap;
                justify-content: flex-end;
                gap: 8px;
            }

            .user-actions > * {
                margin-left: 0 !important;
            }

            /* ç¬¬äºŒè¡Œï¼šæœç´¢æ å•ç‹¬ä¸€æ•´è¡Œ */
            .search-bar {
                order: 3;
                flex: 1 0 100%;
                width: 100%;
                min-width: 0;
                margin: 4px 0 0;
            }
        }

        /* æ›´å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            /* é¡¶éƒ¨ä¸€è¡Œï¼šFAQ / ç™»å½•ç­‰ï¼ˆå æ»¡ç¬¬ä¸€è¡Œï¼‰ï¼Œç¬¬äºŒè¡Œï¼šlogo + æœç´¢æ ï¼ˆåŒè¡Œï¼Œæœç´¢æ ç½®äº logo å³ä¾§ï¼‰ */
            .nav-container {
                padding: 8px 0px; /* è¿›ä¸€æ­¥å‡å°å·¦å³å†…è¾¹è·ï¼Œä½¿ logo æ›´é å·¦ */
                gap: 6px;
                display: flex;
                flex-wrap: wrap;
                align-items: center; /* é¡¶éƒ¨å¯¹é½ï¼Œæ–¹ä¾¿æŠŠæœç´¢æ ä¸ logo é¡¶éƒ¨å¯¹é½ */
                justify-content: space-between;
            }

            /* ä½¿ FAQ èƒ½ä½¿ç”¨ç»å¯¹å®šä½ä¸‹ç§»è€Œä¸å½±å“å…¶å®ƒå…ƒç´  */
            .nav-container {
                position: relative;
            }

            /* æŠŠé¡¶éƒ¨çš„æ“ä½œç±»å…ƒç´ æ”¾åˆ°ç¬¬ä¸€è¡Œå¹¶å æ»¡å®½åº¦ï¼Œä¿è¯ logo+æœç´¢æ æ¢åˆ°ç¬¬äºŒè¡Œ */
            .user-actions {
                order: 1;
                flex: 1 1 100%;
                display: flex;
                align-items: center;
                justify-content: flex-end; /* ç™»å½•/æ³¨å†Œ é å³ */
                gap: 8px;
                margin-bottom: 6px;
            }

            /* ç§»åŠ¨ç«¯ FAQ æŒ‰é’®ä¸å æ»¡æ•´è¡Œï¼Œä¿æŒåŸå§‹å°ºå¯¸ */
            .mobile-faq-cta {
                order: 1;
                flex: 0 0 auto;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                margin-bottom: 6px;
                /* å±…ä¸­æ˜¾ç¤ºåœ¨é¡¶éƒ¨ï¼Œä½†ç¼©å°å¹¶ä¸‹ç§»ä»¥é¿å…é®æŒ¡å³ä¾§æŒ‰é’® */
                position: absolute !important;
                left: 44% !important;
                transform: translate(-50%, 0) !important; /* å®Œç¾æ°´å¹³å±…ä¸­ */
                top: 10px !important; /* ç¨å¾®ä¸‹ç§»ï¼Œé¿å…é®æŒ¡ç™»å½•/æ³¨å†ŒæŒ‰é’® */
                z-index: 100 !important; /* æ”¾åœ¨ login ä¹‹ä¸‹ï¼Œç¡®ä¿ç™»å½•æŒ‰é’®å¯ç‚¹ */
                background: rgba(255,255,255,0.95);
                padding: 5px 8px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                pointer-events: auto;
                white-space: nowrap;
                max-width: 160px !important; /* é™åˆ¶å®½åº¦ï¼Œé¿å…æ’‘å¼€è¦†ç›–å³ä¾§ */
                overflow: hidden;
                text-overflow: ellipsis;
            }
            /* About æŒ‰é’®åœ¨æçª„å±ä¸‹å±…ä¸­æ˜¾ç¤ºï¼ˆé¿å…å½±å“ç™»å½•/æ³¨å†Œï¼‰ */
            .about-cta {
                position: absolute !important;
                left: 12px !important; /* é è¿‘å·¦ä¾§ Logoï¼Œé¿å…ä¸å±…ä¸­ FAQ é‡å  */
                top: 17px !important; /* ä¸ FAQ åœ¨åŒä¸€æ°´å¹³çº¿ */
                display: flex !important;
                z-index: 90 !important;
            }
            /* ç¡®ä¿ç™»å½•/æ³¨å†Œåœ¨ FAQ ä¹‹ä¸Šå¯ä»¥è¢«ç‚¹å‡» */
            .user-actions {
                position: relative;
                z-index: 120 !important;
            }

            /* è‹¥ FAQ æ˜¯é“¾æ¥æˆ–æŒ‰é’®ï¼Œé™åˆ¶å…¶å†…è”å°ºå¯¸ */
            .mobile-faq-cta a,
            .mobile-faq-cta button {
                display: inline-flex;
                white-space: nowrap;
                padding: 6px 10px;
                font-size: 13px;
                min-width: 0;
            }

            /* ç¬¬äºŒè¡Œï¼šlogo ä¸æœç´¢æ ï¼ˆåŒè¡Œï¼‰ */
            .logo {
                font-size: 16px;
                min-height: 40px;
                flex: 0 0 auto;
                width: 56px; /* ç¼©å° logo å®½åº¦ï¼Œå‡å°‘ç©ºç™½ */
                max-width: 90px;
                margin: 0 6px 0 0; /* å³ä¾§é—´è·ï¼Œé¿å…è´´åˆæœç´¢æ  */
                order: 2;
                display: flex;
                align-items: center;
                justify-content: flex-start;
            }

            .logo img {
                height: 36px;
                max-width: 100%;
                display: block;
                object-fit: contain;
            }

            .menu-toggle {
                font-size: 20px;
                padding: 6px 8px;
                min-width: 40px;
                min-height: 40px;
            }

            /* æœç´¢æ æ”¾åœ¨ logo å³ä¾§ï¼Œé¡¶éƒ¨å¯¹é½åˆ° logo ä¸Šè¾¹ */
            .search-bar {
                order: 2; /* ä¸ .logo åŒä¸€é¡ºåºï¼Œç¡®ä¿åŒè¡Œæ’åˆ— */
                flex: 0 0 auto; /* ä¸è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ï¼Œä½¿ç”¨å›ºå®š/æœ€å¤§å®½åº¦ */
                width: 68%; /* ç¼©çŸ­æœç´¢æ åœ¨æçª„å±ä¸‹çš„å®½åº¦ */
                max-width: 320px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé¿å…å¤ªé•¿ */
                min-width: 0;
                margin: 0;
                display: flex;
                align-items: center;
                align-self: center;
                box-sizing: border-box;
                gap: 8px;
            }

            .search-bar input {
                font-size: 14px;
                padding: 8px 12px;
                height: 40px;
                border-radius: 20px;
                border: 1px solid var(--border-subtle);
                box-sizing: border-box;
                flex: 1 1 auto;
                min-width: 0;
                background: white;
            }

            .search-bar button {
                padding: 0;
                width: 40px;
                height: 40px;
                border-radius: 10px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            .user-actions a {
                font-size: 11px;
                padding: 8px 12px;
                min-height: 36px;
            }

            .user-actions a i {
                font-size: 12px;
            }

            .language-selector select {
                padding: 5px 6px !important;
                font-size: 11px !important;
                min-width: 70px;
            }

            #control-panel-btn {
                padding: 5px 8px !important;
                font-size: 11px !important;
            }

            /* ç¡®ä¿å¯¼èˆªé“¾æ¥åœ¨å°å±å¹•ä¸Šä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤º */
            .nav-links {
                max-height: 70vh;
            }

            .nav-links a {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        @media (min-width: 769px) {
            .menu-toggle {
                display: none;
            }
        }

        /* è½®æ’­å›¾ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .carousel {
                width: 100%;
                aspect-ratio: 21 / 9 !important;
                /* ç§»åŠ¨ç«¯ä½¿ç”¨21:9æ¯”ä¾‹ */
                margin: 15px 0;
                height: auto;
            }

            .carousel-content {
                left: 15px;
                bottom: 15px;
                right: 15px;
                /* æ·»åŠ å³è¾¹è· */
                max-width: none;
                padding: 15px;
            }

            .carousel-content h2 {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .carousel-content p {
                font-size: 14px;
                margin-bottom: 10px;
                line-height: 1.4;
            }

            .carousel-btn {
                padding: 8px 16px;
                font-size: 14px;
            }

            .carousel-indicators {
                display: none; /* ç§»åŠ¨ç«¯éšè—è½®æ’­ç‚¹ */
            }

            .indicator {
                display: none; /* ç§»åŠ¨ç«¯éšè—è½®æ’­ç‚¹ */
            }

            /* ç§»åŠ¨ç«¯ç®­å¤´ç¼©å° */
            .carousel-arrow {
                width: 36px !important;
                height: 36px !important;
                font-size: 18px !important;
                border: 1.5px solid rgba(255, 255, 255, 0.9) !important;
            }

            .carousel-arrow.prev {
                left: 10px !important;
            }

            .carousel-arrow.next {
                right: 10px !important;
            }
        }

        /* äº§å“ç½‘æ ¼ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .section-title {
                font-size: 18px;
                margin: 15px 0 12px;
                padding-left: 5px;
            }

            /* é¦–é¡µç²¾é€‰å±•ç¤ºä¼˜åŒ– */
            #featured-showcase {
                padding: 15px 10px;
                margin-top: 15px;
            }

            #featured-showcase .featured-head {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            #featured-showcase .featured-head h2 {
                font-size: 24px;
            }

            #featured-showcase .featured-meta {
                justify-content: center;
            }

            /* åˆ†ç±»ç­›é€‰å™¨ä¼˜åŒ– - å¯æ¨ªå‘æ»šåŠ¨ */
            .category-filter {
                overflow-x: auto;
                overflow-y: hidden;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
                /* å¹³æ»‘æ»šåŠ¨ */
                padding-bottom: 5px;
                margin: 20px 0 15px;
            }

            .category-item {
                display: inline-block;
                padding: 8px 16px;
                font-size: 13px;
                margin: 0 5px 0 0;
                white-space: nowrap;
            }

            /* äº§å“å¡ç‰‡ä¼˜åŒ– */
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
                /* å¼ºåˆ¶ä½¿ç”¨å°å°ºå¯¸ */
                gap: 15px;
                margin-bottom: 2000px;
                /* ä¿æŒåŸæœ‰çš„å·¨å¤§åº•éƒ¨é—´è· */
            }

            .product-card {
                margin: 0 !important;
                /* ç§»é™¤è‡ªåŠ¨å¤–è¾¹è· */
                min-height: auto !important;
            }

            .product-info {
                padding: 12px;
            }

            .product-title {
                font-size: 14px;
                margin-bottom: 8px;
                height: auto;
                /* æ‰‹æœºç«¯ä¸ç”µè„‘ç«¯ä¿æŒä¸€è‡´ï¼šæ ‡é¢˜æœ€å¤šæ˜¾ç¤ºä¸¤è¡Œï¼Œè¶…å‡ºéƒ¨åˆ†çœç•¥ */
                -webkit-line-clamp: 2;
                line-clamp: 2;
            }

            .product-price {
                font-size: 18px;
                margin-bottom: 12px;
            }

            .product-image {
                width: 100%;
            }

            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }

            /* é¦–é¡µç²¾é€‰å¡ç‰‡ä¼˜åŒ– - ç§»åŠ¨ç«¯2åˆ—å¸ƒå±€ */
            #products-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
                padding: 0 5px;
            }

            .home-feature-card {
                max-width: 100% !important;
                margin: 0 !important;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            .home-feature-image {
                aspect-ratio: 1 / 1;
                width: 100%;
                position: relative;
                background: #f7f8fa;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .home-feature-image img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }

            .home-feature-tag {
                top: 8px;
                left: 8px;
                padding: 3px 8px;
                font-size: 10px;
            }

            .home-feature-body {
                padding: 10px 8px 12px !important;
                gap: 6px;
            }

            .home-feature-body h3 {
                font-size: 12px;
                line-height: 1.4;
                margin: 0 0 6px 0;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                height: 32px;
                color: #333;
                font-weight: 500;
            }

            .home-feature-price {
                font-size: 14px !important;
                margin: 4px 0;
                display: flex;
                align-items: center;
                gap: 6px;
                flex-wrap: wrap;
            }

            .home-feature-price span:first-child {
                font-size: 11px;
                color: #999;
            }

            .home-feature-price span:last-child {
                font-size: 16px;
                font-weight: bold;
                color: #e74c3c;
            }

            .home-feature-stock {
                font-size: 10px;
                color: #666;
                margin-top: 4px;
            }

            .home-feature-actions {
                grid-template-columns: 1fr;
                gap: 6px;
                margin-top: 8px;
            }

            .home-feature-actions .btn {
                padding: 6px 8px;
                font-size: 11px;
                border-radius: 4px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        @media (max-width: 480px) {
            /* å°å±å¹•è¿›ä¸€æ­¥ä¼˜åŒ– */
            #products-grid {
                gap: 8px !important;
                padding: 0 3px;
            }

            .home-feature-body {
                padding: 8px 6px 10px !important;
            }

            .home-feature-body h3 {
                font-size: 11px;
                height: 28px;
            }

            .home-feature-price {
                font-size: 12px !important;
            }

            .home-feature-price span:last-child {
                font-size: 14px;
            }

            .home-feature-actions .btn {
                padding: 5px 6px;
                font-size: 10px;
            }
        }

        /* ç§»åŠ¨ç«¯æ•´ä½“ä¼˜åŒ– */
        @media (max-width: 768px) {
            /* äº§å“è¯¦æƒ…é¡µç§»åŠ¨ç«¯ä¼˜åŒ– */
            .product-detail {
                padding: 20px 15px;
                margin: 15px 0;
            }

            .product-detail-image {
                max-width: 100%;
                margin-bottom: 20px;
            }

            .product-detail-title {
                font-size: 22px;
                margin-bottom: 10px;
            }

            .product-detail-price {
                font-size: 24px;
                margin-bottom: 15px;
            }

            .product-detail-description {
                font-size: 14px;
                line-height: 1.6;
            }

            .product-detail-actions {
                flex-direction: column;
                gap: 10px;
            }

            /* ç”¨æˆ·ä¸­å¿ƒç§»åŠ¨ç«¯ä¼˜åŒ– */
            .user-center.show {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .user-center {
                margin: 15px 0;
            }

            .user-sidebar {
                margin-bottom: 15px;
            }

            .user-info {
                padding: 15px;
            }

            .user-avatar {
                width: 50px;
                height: 50px;
                font-size: 20px;
                margin-right: 10px;
            }

            .user-menu a {
                padding: 12px 15px;
                font-size: 15px;
            }

            .order-item {
                flex-direction: row;
                align-items: flex-start;
                padding: 12px;
            }
            
            .order-image {
                width: 90px;
                height: 90px;
                margin-right: 12px;
                margin-bottom: 0;
            }
            
            .order-details {
                padding-left: 0;
            }

            /* åœ°å€ç®¡ç†ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .address-item {
                padding: 15px;
            }

            .address-actions {
                flex-wrap: wrap;
                gap: 8px;
            }

            .address-actions .btn {
                flex: 1;
                min-width: 80px;
                padding: 6px 12px;
                font-size: 13px;
            }

            /* æ¨¡æ€æ¡†ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .modal-content {
                width: 95%;
                max-width: 95%;
                margin: 10px;
                border-radius: 10px;
            }

            .modal-body {
                padding: 20px 15px;
                max-height: 80vh;
            }

            .form-group {
                margin-bottom: 12px;
            }

            .form-control {
                font-size: 16px;
                /* é˜²æ­¢iOSç¼©æ”¾ */
                padding: 12px;
            }

            .form-actions {
                flex-direction: column;
                gap: 10px;
            }

            .form-actions .btn {
                width: 100%;
            }

            /* äº§å“ç¼–è¾‘æ¨¡æ€æ¡† */
            #edit-product-modal .form-control,
            #signup-modal .form-control,
            #address-modal .form-control {
                font-size: 16px;
            }

            /* åœ°å€é€‰æ‹©å™¨æ ·å¼ */
            #signup-address-container {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            #signup-address-select {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
                background-color: white;
            }

            #signup-address-btn {
                padding: 12px;
                font-size: 14px;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            #signup-address-btn:hover {
                opacity: 0.9;
            }

            /* æŠ¥åè¡¨å•å•è¡Œè¾“å…¥ */
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-row .form-group {
                width: 100%;
            }

            /* åå°ç®¡ç†ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .admin-nav {
                flex-wrap: wrap;
                gap: 5px;
            }

            .admin-nav-btn {
                padding: 8px 12px;
                font-size: 14px;
                flex: 1;
                text-align: center;
            }

            .admin-actions {
                flex-wrap: wrap;
                gap: 8px;
            }

            .admin-actions .btn {
                flex: 1;
                min-width: 120px;
                font-size: 13px;
                padding: 8px 12px;
            }

            /* Excelä¸Šä¼ åŒºåŸŸä¼˜åŒ– */
            .excel-upload {
                padding: 20px;
            }

            .excel-upload h3 {
                font-size: 18px;
            }

            .excel-upload p {
                font-size: 14px;
            }

            .excel-upload i {
                font-size: 36px;
            }

            /* è¡¨æ ¼ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .users-table-container,
            .orders-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin-bottom: 15px;
            }

            .admin-table {
                font-size: 13px;
                min-width: 800px;
                display: table;
                table-layout: auto;
                /* é˜²æ­¢è¡¨æ ¼å¤ªæŒ¤ */
            }

            .admin-table thead {
                display: table-header-group;
            }

            .admin-table tbody {
                display: table-row-group;
            }

            .admin-table th,
            .admin-table td {
                display: table-cell;
                padding: 8px 10px;
                vertical-align: middle;
            }

        .user-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .user-filters .form-control {
            min-width: 160px;
            flex: 0 0 auto;
        }

            /* ç»Ÿè®¡å¡ç‰‡ä¼˜åŒ– */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .stat-info h3 {
                font-size: 24px;
            }

            /* å®¢æœæŒ‰é’®ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼ˆæŠ¬é«˜ä»¥é¿å…è¢«åº•éƒ¨å¯¼èˆªé®æŒ¡ï¼‰ */
            .contact-button {
                bottom: 110px;
                right: 20px;
            }

            .main-button {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            .option-button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .contact-options {
                bottom: 75px;
            }

            /* WhatsAppæ¨¡æ€æ¡†ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .whatsapp-modal-content {
                max-width: 95vw !important;
                max-height: 95vh !important;
                margin: 10px auto;
            }

            .whatsapp-modal-content.whatsapp-modal-two-steps {
                max-width: 95vw !important;
                max-height: 95vh !important;
            }

        .whatsapp-modal-content.whatsapp-modal-single-step {
                max-width: 95vw !important;
                max-height: 95vh !important;
            }

            .whatsapp-modal-body {
                padding: 30px 20px !important;
                overflow-y: auto; /* ç§»åŠ¨ç«¯å…è®¸æ»šåŠ¨ */
            }

            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] {
                flex-direction: row !important;
                gap: 15px !important;
                justify-content: space-around !important;
            }
            
            /* æ‰‹æœºç«¯ä¸¤ä¸ªæ­¥éª¤çš„æ ·å¼ä¼˜åŒ– */
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div {
                flex: 1 !important;
                max-width: 45% !important;
                min-width: 0 !important;
            }
            
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div > div[style*="width: 50px"] {
                width: 40px !important;
                height: 40px !important;
                font-size: 18px !important;
                margin-bottom: 15px !important;
            }
            
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div > div[style*="width: 90px"] {
                width: 70px !important;
                height: 70px !important;
                margin-bottom: 15px !important;
            }
            
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div > div[style*="width: 90px"] img {
                width: 55px !important;
                height: 55px !important;
            }
            
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div > div[style*="width: 90px"] i {
                font-size: 45px !important;
            }
            
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div h4 {
                font-size: 14px !important;
                margin-bottom: 6px !important;
            }
            
            .whatsapp-modal-two-steps .modal-body > div[style*="display: flex"] > div p {
                font-size: 11px !important;
            }

            .whatsapp-modal-two-steps .modal-header h3 {
                font-size: 20px !important;
            }

            .whatsapp-modal-two-steps .modal-header p {
                font-size: 12px !important;
            }

            /* å•æ­¥æµç¨‹å¼¹çª—ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼ˆé…åˆå‚è€ƒæ ·å¼çª—å£ï¼‰ */
            .whatsapp-modal-single-step .window-container {
                width: 100%;
                max-width: 600px;
                border-radius: 20px;
                overflow: hidden;
            }

            .whatsapp-modal-single-step .step-container {
                padding: 30px 20px 25px;
            }
            
            /* è§¦æ‘¸ä¼˜åŒ– */
            .btn,
            .btn-primary,
            .btn-secondary,
            .btn-danger,
            .category-item,
            .indicator,
            .product-checkbox {
                min-height: 44px;
                min-width: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* é˜²æ­¢ç‚¹å‡»ç¼©æ”¾ */
            input,
            select,
            textarea,
            button {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }

            /* æ·»åŠ è§¦æ‘¸åé¦ˆ */
            .product-card:active,
            .home-feature-card:active,
            .carousel-btn:active,
            .btn:active {
                transform: scale(0.98);
            }

            /* ç®¡ç†å‘˜æ§åˆ¶é¢æ¿ç§»åŠ¨ç«¯ä¼˜åŒ– */
            #admin-control-panel {
                margin-right: 10px;
            }

            #control-panel-btn {
                font-size: 12px;
                padding: 6px 10px;
            }

            #control-panel-dropdown {
                min-width: 250px;
                max-width: 90vw;
                right: -10px;
            }

            #control-panel-dropdown button {
                font-size: 12px;
                padding: 8px;
            }
        }

        /* åŠ è½½å’Œé”™è¯¯çŠ¶æ€ä¼˜åŒ– */
        .excel-upload.processing,
        .excel-upload.success,
        .excel-upload.error {
            padding: 25px 20px;
        }

        .excel-upload.processing i,
        .excel-upload.success i,
        .excel-upload.error i {
            font-size: 36px;
        }

        /* åŠ¨ç”»ä¼˜åŒ– */
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* é€šçŸ¥æ¶ˆæ¯ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .notification {
            padding: 12px 16px;
            font-size: 14px;
            max-width: 90%;
        }

        /* ç¡®ä¿æ‰€æœ‰æ¨¡æ€æ¡†éƒ½æœ‰åˆé€‚çš„z-index */
        .modal {
            z-index: 2000;
        }

        /* å›¾è¡¨å“åº”å¼æ ·å¼ */
        .charts-section {
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .charts-section > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }

            .charts-section > div[style*="grid-template-columns"] > div {
                margin-bottom: 20px;
            }

            .charts-section canvas {
                max-width: 100%;
            }

            /* æ—¥æœŸé€‰æ‹©å™¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .charts-section > div[style*="display: flex"] {
                flex-direction: column !important;
                align-items: flex-start !important;
            }

            .charts-section input[type="date"] {
                width: 100%;
                max-width: 200px;
            }

            .charts-section button {
                width: 100%;
                max-width: 200px;
            }
        }

        /* ================================
           ç§»åŠ¨ç«¯äº¤äº’ä¸è¾“å…¥ä½“éªŒä¼˜åŒ–ï¼ˆç¬¬1ã€2ã€3éƒ¨åˆ†ï¼‰
           ä¿æŒåŸæœ‰å¸ƒå±€ä¸åŠŸèƒ½ä¸å˜ï¼Œä»…å¢å¼ºè§¦æ§ä¸è§†è§‰åé¦ˆ
        ================================= */

        /* 1. è§¦æ§äº¤äº’ä¼˜åŒ–ï¼šå¯ç‚¹å‡»åŒºåŸŸå°ºå¯¸ä¸æŒ‰ä¸‹åé¦ˆ */
        .tappable,
        .btn,
        .product-card,
        .nav-links a,
        .category-item,
        .bottom-nav-item {
            min-height: 44px;
            min-width: 44px;
        }

        .tappable:active,
        .btn:active,
        .product-card:active,
        .bottom-nav-item:active {
            opacity: 0.85;
            transform: scale(0.98);
            transition: transform 0.1s ease, opacity 0.1s ease;
        }

        /* ç§»é™¤ç‚¹å‡»é«˜äº®ï¼Œå¹¶ç¦æ­¢å…¨å±€é€‰ä¸­ï¼ˆè¾“å…¥æ¡†/æŒ‰é’®æ–‡å­—é™¤å¤–ï¼‰ */
        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .btn,
        input,
        textarea {
            user-select: text;
        }

        /* åˆ†ç±»ç­›é€‰å™¨æ°´å¹³æ»‘åŠ¨ä¼˜åŒ–ï¼ˆä¿ç•™ç°æœ‰å¸ƒå±€ï¼‰ */
        .category-filter {
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            scroll-snap-type: x mandatory;
            padding-bottom: 8px;
        }

        .category-filter::-webkit-scrollbar {
            display: none;
        }

        .category-item {
            scroll-snap-align: start;
        }

        /* äº§å“ç½‘æ ¼æ»šåŠ¨é˜»å°¼ï¼Œé˜²æ­¢æ»šåŠ¨ç©¿é€ */
        .products-grid {
            overscroll-behavior: contain;
        }


        /* 2. ç§»åŠ¨ç«¯è§†è§‰åé¦ˆå¢å¼ºï¼šéª¨æ¶å±ä¸ hover æ›¿ä»£ */
        @media (max-width: 768px) {
            /* éª¨æ¶å±æ›´ç´§å‡‘ï¼Œé€‚é…ç§»åŠ¨ç«¯ */
            .skeleton {
                min-height: 100px;
                border-radius: 8px;
            }

            .product-card.skeleton {
                height: 240px;
            }

            /* ç§»åŠ¨ç«¯ç¦ç”¨ hover æŠ¬å‡ï¼Œæ”¹ç”¨ç‚¹å‡»æ€ .tapped */
            .product-card:hover {
                transform: none;
                box-shadow: var(--shadow-md);
            }

            .product-card.tapped {
                transform: translateY(-4px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
        }

        /* åº•éƒ¨å¯¼èˆªç‚¹å‡»æ³¢çº¹ä¸é€‰ä¸­çŠ¶æ€å¢å¼º */
        .bottom-nav-item {
            position: relative;
            overflow: hidden;
        }

        .bottom-nav-item::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .bottom-nav-item:active::after {
            width: 100px;
            height: 100px;
            opacity: 0.7;
        }

        .bottom-nav-item.active {
            color: var(--primary);
            font-weight: 600;
        }

        .bottom-nav-item.active i {
            color: var(--primary);
        }


        /* 3. è¡¨å•ä¸è¾“å…¥ä½“éªŒä¼˜åŒ–ï¼ˆç§»åŠ¨ç«¯ï¼‰ */
        @media (max-width: 768px) {
            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="password"],
            select,
            textarea {
                font-size: 16px !important; /* é˜²æ­¢ iOS Safari è‡ªåŠ¨ç¼©æ”¾ */
            }

            /* æœç´¢æ¡†è¾“å…¥åŒºåŸŸæ›´æ˜“ç‚¹é€‰ */
            .search-bar input {
                font-size: 16px;
                padding: 12px 16px;
            }

            /* å¸¸è§è¡¨å•æäº¤æŒ‰é’®å¢å¤§è§¦æ§é¢ç§¯ï¼ˆå°½é‡ä¸å½±å“å¸ƒå±€ï¼‰ */
            .form-actions .btn,
            button[type="submit"] {
                padding: 14px 20px;
                font-size: 16px;
                font-weight: 600;
            }
        }

        /* é”®ç›˜å¼¹èµ·æ—¶çš„æ¨¡æ€æ»šåŠ¨ä½“éªŒä¼˜åŒ–ï¼ˆå¦‚é¡µé¢ä¸­å­˜åœ¨ .modal-bodyï¼‰ */
        @media (max-height: 600px) {
            .modal-body {
                max-height: 70vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        /* åŸç”Ÿä¸‹æ‹‰é€‰æ‹©å™¨ç®€æ˜“ç¾åŒ–ï¼ˆä¸ç ´ååŠŸèƒ½ï¼‰ */
        select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 36px;
        }

        /* ======================
           ç¬¬4éƒ¨åˆ†ï¼šæ€§èƒ½ä¸åŠ è½½ä¼˜åŒ–
        ======================= */

        /* å›¾ç‰‡æ‡’åŠ è½½å ä½ä¸åŠ¨ç”»ï¼ˆå¯ä¸ç°æœ‰ .lazy-load ååŒï¼‰ */
        .product-image.lazy-loading {
            background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%);
            background-size: 200% 100%;
            animation: shimmer 1.5s linear infinite;
        }

        @keyframes shimmer {
            to {
                background-position: -200% 0;
            }
        }

        .product-image.lazy-loaded {
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* æ»šåŠ¨æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘é‡ç»˜åŒºåŸŸ & å¯ç”¨ GPU åŠ é€Ÿ */
        .product-card,
        .carousel-slide,
        .modal-content {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .products-grid {
            contain: content;
        }

        /* ======================
           ç¬¬5éƒ¨åˆ†ï¼šæ‰‹åŠ¿ä¸æ»‘åŠ¨æç¤º
        ======================= */

        /* è½®æ’­å›¾æ»‘åŠ¨æç¤ºæ–‡æ¡ˆï¼ˆä»…ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ */
        .carousel::after {
            content: 'â† æ»‘åŠ¨ â†’';
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            pointer-events: none;
            animation: swipeHint 2s infinite;
        }

        @keyframes swipeHint {
            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        @media (min-width: 769px) {
            .carousel::after {
                display: none;
            }
        }

        /* ä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºå™¨ï¼ˆå¦‚éœ€å¯åœ¨ HTML ä¸­æ·»åŠ  #pull-to-refresh å®¹å™¨ï¼‰ */
        #pull-to-refresh {
            position: fixed;
            top: -60px;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            transition: transform 0.3s ease;
            z-index: 10000;
        }

        #pull-to-refresh.pulling {
            transform: translateY(60px);
        }

        #pull-to-refresh i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* ======================
           ç¬¬6éƒ¨åˆ†ï¼šToast ä¸ç©ºçŠ¶æ€
        ======================= */

        /* å¤ç”¨ç°æœ‰ messenger-copy-toastï¼Œç§»åŠ¨ç«¯ä½ç½®é€‚é… */
        @media (max-width: 768px) {
            .messenger-copy-toast {
                bottom: 80px;
                top: auto;
                left: 50%;
                transform: translateX(-50%);
                width: auto;
                max-width: 90%;
                border-radius: 12px;
                padding: 14px 18px;
            }
        }

        /* é€šç”¨ç©ºçŠ¶æ€ï¼ˆå¦‚æœ‰éœ€è¦å¯å¤ç”¨ç±»å .empty-state ç­‰ï¼‰ */
        @media (max-width: 768px) {
            .empty-state {
                padding: 60px 20px;
                text-align: center;
            }

            .empty-state-icon {
                font-size: 64px;
                color: var(--gray-300);
                margin-bottom: 20px;
                opacity: 0.6;
            }

            .empty-state-text {
                font-size: 16px;
                color: var(--gray-600);
                line-height: 1.6;
            }

            .empty-state-action {
                margin-top: 24px;
            }
            /* ç§»åŠ¨ç«¯ï¼šè¿›ä¸€æ­¥ç¼©å°å¯¼èˆªæ  logoï¼Œé¿å…å†…è”æ ·å¼åœ¨å°å±ä¸‹æ˜¾å¾—è¿‡å¤§ */
        @media (max-width: 480px) {
            #site-logo-img {
                height: 32px !important;
                max-width: 160px !important;
            }
			.about-cta,
			.mobile-faq-cta {
			    z-index: 2147483648 !important;
			    pointer-events: auto !important;
			    touch-action: manipulation
		
				
        }
        }

        /* Mobile bottom-nav override: hide top nav links and show fixed bottom nav */
        @media (max-width: 768px) {
            .navbar .nav-links {
                display: none !important;
            }

            .bottom-nav {
                display: flex !important;
                position: fixed !important;
                left: 0;
                right: 0;
                bottom: 0;
                height: 56px;
                background: #ffffff;
                border-top: 1px solid #e5e7eb;
                box-shadow: 0 -2px 6px rgba(15, 23, 42, 0.08);
                justify-content: space-around;
                align-items: center;
                z-index: 11000 !important;
            }

            /* Prevent page content from being covered by the bottom nav */
            body {
                padding-bottom: 72px !important;
            }
        }
    </style>
</head>

<body>
    <!-- é¡µé¢åŠ è½½é®ç½©ï¼ˆå·²éšè—ï¼‰ -->
    <div id="page-loader" style="display: none !important;">
        <div class="loader-spinner"></div>
        <div class="loader-text" data-i18n="loading">Loading data, please wait...</div>
        <div class="loader-progress" id="loader-progress">Initializing...</div>
    </div>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container nav-container" style="max-width:1100px;margin:12px auto;background:#fff;border-radius:12px;box-shadow:var(--shadow-sm);padding:8px 12px;box-sizing:border-box;">
            <div class="logo" id="home-link">
                <img id="site-logo-img" src="https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_ed7f33a7af67dcf7f114c4e3d8f22515_ProductImage_MAIN" alt="Bee freebies" style="height: 44px; max-width: 220px; width: auto; object-fit: contain; display: block;" onerror="this.style.display='none'; console.error('Logoå›¾ç‰‡åŠ è½½å¤±è´¥');">
            </div>

            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search products...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>

            <!-- ç§»åŠ¨ç«¯å¯¼èˆªæ è¡Œå†… FAQ æŒ‰é’®ï¼šæ”¾åœ¨é¡¶éƒ¨ä¸­é—´ï¼Œä»…å°å±æ˜¾ç¤º -->
            <div class="about-cta" onclick="window.open('aboutUs.html', '_blank')" title="About us">
                <span>About us</span>
            </div>
            <div class="mobile-faq-cta" onclick="window.open('faq.html', '_blank')">
                <i class="fas fa-question-circle"></i>
                <span>FAQ</span>
                <span class="mobile-faq-text-sub">Common Questions</span>
            </div>

            <ul class="nav-links">
                <li><a href="#" class="active" id="main-home-link">Home</a></li>
                <li><a href="#" id="admin-link" style="display:none">Admin Panel</a></li>
                <li><a href="#" id="user-center-link" style="display:none">Account</a></li>
                <li><a href="#" id="my-orders-link" style="display:none" data-tab="orders">My Orders</a></li>
            </ul>

            <div class="user-actions">

                <!-- ç®¡ç†å‘˜æ§åˆ¶é¢æ¿ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰ -->
                <div id="admin-control-panel" style="display:none; position:relative; margin-right:15px;">
                    <button id="control-panel-btn"
                        style="background:#3498db; color:white; border:none; padding:8px 15px; border-radius:6px; cursor:pointer; display:flex; align-items:center; gap:8px; font-size:14px; transition:all 0.3s;">
                        <i class="fas fa-cog"></i>
                        <span id="current-mode-text">â˜ï¸ äº‘ç«¯æ¨¡å¼</span>
                        <i class="fas fa-chevron-down" style="font-size:10px;"></i>
                    </button>

                    <!-- ä¸‹æ‹‰èœå• -->
                    <div id="control-panel-dropdown"
                        style="display:none; position:absolute; top:45px; right:0; background:white; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15); min-width:280px; z-index:1000;">
                        <div style="padding:15px; border-bottom:1px solid #eee;">
                            <div
                                style="font-weight:600; color:#2c3e50; margin-bottom:10px; display:flex; align-items:center; gap:8px;">
                                <i class="fas fa-database"></i>
                                æ•°æ®æºæ¨¡å¼
                            </div>
                            <div style="padding:12px; background:#e3f2fd; border:2px solid #3498db; border-radius:8px;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <i class="fas fa-cloud" style="color:#3498db; font-size:20px;"></i>
                                    <div style="flex:1;">
                                        <div style="font-weight:600; color:#3498db; font-size:14px;">â˜ï¸ äº‘ç«¯æ¨¡å¼</div>
                                        <div style="font-size:12px; color:#7f8c8d;">æ‰€æœ‰æ•°æ®å®æ—¶åŒæ­¥äº‘ç«¯</div>
                                    </div>
                                    <i class="fas fa-check-circle" style="color:#27ae60; font-size:18px;"></i>
                                </div>
                            </div>
                        </div>

                        <div style="padding:15px; border-bottom:1px solid #eee;">
                            <div
                                style="font-weight:600; color:#2c3e50; margin-bottom:10px; display:flex; align-items:center; gap:8px;">
                                <i class="fas fa-vial"></i>
                                æµ‹è¯•åŠŸèƒ½
                            </div>
                            <button id="test-cloud-connection"
                                style="width:100%; padding:10px; background:#27ae60; color:white; border:none; border-radius:6px; cursor:pointer; margin-bottom:8px; font-size:13px; transition:all 0.3s;">
                                <i class="fas fa-cloud"></i> æµ‹è¯•äº‘ç«¯è¿æ¥
                            </button>
                            <button id="force-sync"
                                style="width:100%; padding:10px; background:#e67e22; color:white; border:none; border-radius:6px; cursor:pointer; margin-bottom:8px; font-size:13px; transition:all 0.3s;">
                                <i class="fas fa-sync-alt"></i> å¼ºåˆ¶åŒæ­¥æ•°æ®
                            </button>
                            <button id="clear-cache"
                                style="width:100%; padding:10px; background:#e74c3c; color:white; border:none; border-radius:6px; cursor:pointer; font-size:13px; transition:all 0.3s;">
                                <i class="fas fa-trash"></i> æ¸…é™¤æœ¬åœ°ç¼“å­˜
                            </button>
                        </div>

                        <div style="padding:12px; background:#f8f9fa; border-radius:0 0 8px 8px;">
                            <div style="font-size:12px; color:#7f8c8d; display:flex; align-items:center; gap:6px;">
                                <i class="fas fa-info-circle"></i>
                                <span id="sync-status-text">çŠ¶æ€ï¼šå·²è¿æ¥</span>
                            </div>
                        </div>
                    </div>
                </div>

                <a href="#" id="login-link"><i class="fas fa-user"></i> Login</a>
                <a href="#" id="register-link"><i class="fas fa-user-plus"></i> Register</a>
                <a href="#" id="logout-link" style="display:none"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </nav>

    <!-- åº•éƒ¨å¯¼èˆªï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
    <div class="bottom-nav">
        <button type="button" class="bottom-nav-item" onclick="document.getElementById('main-home-link').click()">
            <span>Home</span>
        </button>
        <button type="button" class="bottom-nav-item" id="bottom-admin-btn" style="display:none" onclick="document.getElementById('admin-link').click()">
            <span>Admin Panel</span>
        </button>
        <button type="button" class="bottom-nav-item" onclick="document.getElementById('user-center-link').click()">
            <span>Account</span>
        </button>
        <button type="button" class="bottom-nav-item" onclick="document.getElementById('my-orders-link').click()">
            <span>My Orders</span>
        </button>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="container">
        <!-- é¦–é¡µå†…å®¹ -->
        <div id="home-page">

            <!-- è½®æ’­å›¾ -->
            <div class="carousel">
                <div class="carousel-arrow prev">&#10094;</div>
                <div class="carousel-slide active"
                    style="background-image: url('https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_74a4f2a269eeee0e43f867fff8416a45_ProductImage_MAIN')">
                    <div class="carousel-content">
                        <h2>New Arrivals</h2>
                        <p>Explore our latest product series and enjoy limited-time offers</p>
                        <a href="#" class="carousel-btn">Buy Now</a>
                    </div>
                </div>
                <div class="carousel-slide"
                    style="background-image: url('https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_0c7821e20b2ca904579150a5c33caa82_ProductImage_PT01')">
                    <div class="carousel-content">
                        <h2>Limited Time Offer</h2>
                        <p>Selected items up to 50% off, don't miss out</p>
                        <a href="#" class="carousel-btn">View Details</a>
                    </div>
                </div>
                <div class="carousel-arrow next">&#10095;</div>
                <div class="carousel-indicators">
                    <div class="indicator active"></div>
                    <div class="indicator"></div>
                </div>
            </div>

            <section class="featured-showcase" id="featured-showcase">
                <div class="featured-head">
                    <div>
                        <h2 data-i18n="featuredTitle">Featured Recommendations</h2>
                        <p data-i18n="featuredDesc">We select the hottest products in real-time and provide exclusive claim channels. Click to view details quickly.</p>
                    </div>
                    <div class="featured-meta" style="display: none;">
                        <!-- å·²éšè—ï¼šå®æ—¶åˆ·æ–°Â·äº‘ç«¯åŒæ­¥æŒ‰é’® -->
                    </div>
                </div>

                <div class="category-filter">
                    <div class="category-item active" data-category="all">All Products</div>
                    <div class="category-item" data-category="electronics">Electronics</div>
                    <div class="category-item" data-category="home">Home & Living</div>
                    <div class="category-item" data-category="clothing">Clothing & Shoes</div>
                    <div class="category-item" data-category="beauty">Beauty & Skincare</div>
                </div>

                <!-- äº§å“åŠ è½½ä¸­å ä½ -->
                <div id="products-loading" class="products-loading">
                    <div class="products-loading-spinner"></div>
                    <p class="products-loading-text">Loading products, please wait...</p>
                </div>

                <div id="products-grid">
                    <!-- åŠ¨æ€æ¸²æŸ“ -->
                </div>

                <div class="product-detail" id="product-detail">
                    <!-- è¯¦æƒ…å†…å®¹ -->
                </div>
            </section>
        </div>

        <!-- ç”¨æˆ·ä¸­å¿ƒ -->
        <div class="user-center" id="user-center">
            <div class="user-sidebar">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h3 id="username-display">${t('username') || 'ç”¨æˆ·å'}</h3>
                        <p id="user-member-type">${t('regularMember') || 'æ™®é€šä¼šå‘˜'}</p>
                        <div id="user-points-badge" class="user-points-badge">
                            <img src="https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_3f7009240e98f5796e6ac33338216e01_ProductImage_PT03" alt="" class="honey-icon">
                            <span data-i18n="pointsBalance">${t('pointsBalance') || 'å½“å‰èœœç½'}</span>ï¼š
                            <span id="user-points-value">2</span>
                            <div class="honey-tooltip">
                                *Claiming a product deducts 1 Honey.<br>
                                *Writing a review rewards 2 Honey.<br>
                                *Need more Honey? Contact Support.
                            </div>
                        </div>
                    </div>
                </div>
                <ul class="user-menu">
                    <li><a href="#" data-tab="profile" data-i18n="profile">${t('profile') || 'ä¸ªäººä¿¡æ¯'}</a></li>
                    <li><a href="#" data-tab="address" data-i18n="address">${t('address') || 'æ”¶è´§åœ°å€'}</a></li>
                    <li><a href="#" data-tab="my-reviews" data-i18n="myReview">${t('myReview') || 'æˆ‘çš„è¯„ä»·'}</a></li>
                    <li><a href="#" data-tab="security" data-i18n="security">${t('security') || 'è´¦æˆ·å®‰å…¨'}</a></li>
                </ul>
            </div>

            <div class="user-content">
                <!-- è¯­è¨€é€‰æ‹©å™¨ç§»åŠ¨åˆ°è´¦å·ä¸­å¿ƒé¡¶éƒ¨ -->
                <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
                    <div class="language-selector">
                        <select id="language-select" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer; font-size: 14px;">
                            <option value="zh">Chinese</option>
                            <option value="en" selected>English</option>
                        </select>
                    </div>
                </div>
                <!-- æˆ‘çš„æŠ¥åé¡µé¢ -->
                <div class="user-page active" id="user-orders">
                    <div class="order-tabs">
                        <div class="order-tab active" data-status="all">å…¨éƒ¨è®¢å•</div>
                        <div class="order-tab" data-status="review">å¾…ä¸Šä¼ </div>
                        <div class="order-tab" data-status="shipping">è¿è¾“ä¸­</div>
                        <div class="order-tab" data-status="completed">å·²å®Œæˆ</div>
                        <div class="order-tab" data-status="rejected">å·²é©³å›</div>
                        <div class="order-tab" data-status="cancelled">å·²å–æ¶ˆ</div>
                    </div>

                    <div class="order-list active" id="order-all">
                        <!-- è®¢å•é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="order-list" id="order-review">
                        <!-- å¾…ä¸Šä¼ è®¢å• -->
                    </div>

                    <div class="order-list" id="order-shipping">
                        <!-- è¿è¾“ä¸­è®¢å• -->
                    </div>

                    <div class="order-list" id="order-completed">
                        <!-- å·²å®Œæˆè®¢å• -->
                    </div>

                    <div class="order-list" id="order-rejected">
                        <!-- å·²é©³å›è®¢å• -->
                    </div>

                    <div class="order-list" id="order-cancelled">
                        <!-- å·²å–æ¶ˆè®¢å• -->
                    </div>
                </div>

                <!-- ä¸ªäººä¿¡æ¯é¡µé¢ -->
                <div class="user-page" id="user-profile">
                    <h3 data-i18n="profile">${t('profile') || 'ä¸ªäººä¿¡æ¯'}</h3>
                    <form id="profile-form">
                        <div class="form-group">
                            <label for="profile-username" data-i18n="username">${t('username') || 'ç”¨æˆ·å'}</label>
                            <input type="text" id="profile-username" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="profile-account" data-i18n="account">${t('account') || 'è´¦å·'}</label>
                            <input type="text" id="profile-account" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="profile-nickname" data-i18n="nickname">${t('nickname') || 'æ˜µç§°'}</label>
                            <input type="text" id="profile-nickname" class="form-control" data-i18n-placeholder="enterNickname" placeholder="${t('enterNickname') || 'è¯·è¾“å…¥æ˜µç§°'}">
                        </div>
                        <div class="form-group">
                            <label for="profile-phone" data-i18n="phone">${t('phone') || 'æ‰‹æœºå·'}</label>
                            <div class="phone-input-wrapper">
                                <span class="phone-prefix">+1</span>
                                <input type="tel" id="profile-phone" class="phone-input" maxlength="10" data-i18n-placeholder="enterPhone" placeholder="${t('enterPhone') || 'è¯·è¾“å…¥æ‰‹æœºå·'}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="profile-email" data-i18n="email">${t('email') || 'é‚®ç®±'}</label>
                            <input type="email" id="profile-email" class="form-control" data-i18n-placeholder="enterEmail" placeholder="${t('enterEmail') || 'è¯·è¾“å…¥é‚®ç®±'}">
                        </div>
                        <div class="form-group">
                            <label for="profile-birthday" data-i18n="birthday">${t('birthday') || 'ç”Ÿæ—¥'}</label>
                            <input type="date" id="profile-birthday" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="profile-gender" data-i18n="gender">${t('gender') || 'æ€§åˆ«'}</label>
                            <select id="profile-gender" class="form-control">
                                <option value="" data-i18n="pleaseSelect">${t('pleaseSelect') || 'è¯·é€‰æ‹©'}</option>
                                <option value="male" data-i18n="male">${t('male') || 'ç”·'}</option>
                                <option value="female" data-i18n="female">${t('female') || 'å¥³'}</option>
                                <option value="other" data-i18n="other">${t('other') || 'å…¶ä»–'}</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" data-i18n="saveChanges">${t('saveChanges') || 'ä¿å­˜ä¿®æ”¹'}</button>
                        </div>
                    </form>

                </div>

                <!-- æ”¶è´§åœ°å€é¡µé¢ -->
                <div class="user-page" id="user-address">
                    <div class="address-header">
                        <h3>Your Addresses</h3>
                    </div>
                    <div class="address-list" id="address-list">
                        <!-- åœ°å€åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button class="btn btn-primary" id="add-address-btn" style="display: none;" data-i18n="addAddress">${t('addAddress') || 'æ·»åŠ åœ°å€'}</button>
                </div>

                <!-- æˆ‘çš„è¯„ä»·é¡µé¢ -->
                <div class="user-page" id="user-my-reviews">
                    <h3>${t('myReview') || 'æˆ‘çš„è¯„ä»·'}</h3>
                    <div id="my-reviews-empty" style="display:none; padding: 30px; text-align: center; color: #777;">
                        <p>${t('noReviews') || 'æš‚æ— è¯„ä»·'}</p>
                    </div>
                    <div id="my-reviews-list" style="display:flex; flex-direction:column; gap:16px;"></div>
                </div>

                <!-- è´¦æˆ·å®‰å…¨é¡µé¢ -->
                <div class="user-page" id="user-security">
                    <h3 data-i18n="security">${t('security') || 'è´¦æˆ·å®‰å…¨'}</h3>

                    <div class="security-section">
                        <h4 data-i18n="changePassword">${t('changePassword') || 'ä¿®æ”¹å¯†ç '}</h4>
                        <form id="change-password-form">
                            <div class="form-group">
                                <label for="current-password" data-i18n="currentPassword">${t('currentPassword') || 'å½“å‰å¯†ç '}</label>
                                <input type="password" id="current-password" class="form-control" data-i18n-placeholder="enterCurrentPassword" placeholder="${t('enterCurrentPassword') || 'è¯·è¾“å…¥å½“å‰å¯†ç '}">
                            </div>
                            <div class="form-group">
                                <label for="new-password" data-i18n="newPassword">${t('newPassword') || 'æ–°å¯†ç '}</label>
                                <input type="password" id="new-password" class="form-control" data-i18n-placeholder="enterNewPassword" placeholder="${t('enterNewPassword') || 'è¯·è¾“å…¥æ–°å¯†ç '}">
                            </div>
                            <div class="form-group">
                                <label for="confirm-password" data-i18n="confirmNewPassword">${t('confirmNewPassword') || 'ç¡®è®¤æ–°å¯†ç '}</label>
                                <input type="password" id="confirm-password" class="form-control"
                                    data-i18n-placeholder="enterNewPasswordAgain" placeholder="${t('enterNewPasswordAgain') || 'è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç '}">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" data-i18n="changePassword">${t('changePassword') || 'ä¿®æ”¹å¯†ç '}</button>
                            </div>
                        </form>
                    </div>

                    <!-- å®‰å…¨è®¾ç½®éƒ¨åˆ†å·²ç§»é™¤ -->

                    <!-- äº‘ç«¯åŒæ­¥è®¾ç½® - å·²éšè—,ç”¨æˆ·æ— éœ€å…³å¿ƒæŠ€æœ¯ç»†èŠ‚ -->
                    <div class="security-section" style="display:none;">
                        <h4>äº‘ç«¯åŒæ­¥</h4>
                        <div class="security-item">
                            <div class="security-info">
                                <h5>è‡ªåŠ¨åŒæ­¥</h5>
                                <p>è‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°äº‘ç«¯ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="auto-sync" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="security-item">
                            <div class="security-info">
                                <h5>æ•°æ®åŒæ­¥çŠ¶æ€</h5>
                                <p id="sync-status-text">æœªåŒæ­¥</p>
                            </div>
                            <button class="btn btn-primary" id="manual-sync-btn">
                                <i class="fas fa-sync-alt"></i> ç«‹å³åŒæ­¥
                            </button>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                            <p style="margin: 0; color: #666; font-size: 14px;">
                                <i class="fas fa-info-circle"></i>
                                äº‘ç«¯åŒæ­¥åŠŸèƒ½å¯ä»¥å°†æ‚¨çš„è®¢å•ã€åœ°å€ç­‰æ•°æ®ä¿å­˜åˆ°äº‘ç«¯ï¼Œ
                                è®©æ‚¨åœ¨ä¸åŒè®¾å¤‡ä¸Šéƒ½èƒ½è®¿é—®ç›¸åŒçš„æ•°æ®ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åå°ç®¡ç† -->
        <div class="admin-panel" id="admin-panel">
            <h2 class="section-title">åå°ç®¡ç†ç³»ç»Ÿ</h2>

            <!-- ç®¡ç†å¯¼èˆª -->
            <div class="admin-nav">
                <button class="admin-nav-btn active" data-tab="products">äº§å“ç®¡ç†</button>
                <button class="admin-nav-btn" data-tab="users">ç”¨æˆ·ç®¡ç†</button>
                <button class="admin-nav-btn" data-tab="orders">è®¢å•ç®¡ç†</button>
                <button class="admin-nav-btn" data-tab="reviews">è¯„ä»·ç®¡ç†</button>
                <button class="admin-nav-btn" data-tab="homepage">ä¸»é¡µç®¡ç†</button>
                <button class="admin-nav-btn" data-tab="statistics">æ•°æ®ç»Ÿè®¡</button>
            </div>

            <!-- äº§å“ç®¡ç†é¡µé¢ -->
            <div class="admin-page active" id="admin-products">
                <div class="admin-actions">
                    <button class="btn btn-primary" id="add-product-btn">æ·»åŠ äº§å“</button>
                    <button class="btn btn-secondary" id="excel-upload-btn">Excelæ‰¹é‡ä¸Šä¼ </button>
                    <button class="btn btn-success" id="load-demo-btn" onclick="loadDemoProducts()"
                        style="background: #28a745;">
                        <i class="fas fa-database"></i> åŠ è½½æ¼”ç¤ºæ•°æ®
                    </button>
                    <div class="spacer"></div>
                    <div class="admin-search">
                        <i class="fas fa-search"></i>
                        <input type="text" id="admin-product-search" class="admin-search-input"
                            placeholder="æœç´¢äº§å“åç§°/åˆ†ç±»/ID">
                    </div>
                    <label style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                        <input type="checkbox" id="select-all-products"
                            style="width: 18px; height: 18px; cursor: pointer;">
                        <span>å…¨é€‰</span>
                    </label>
                    <button class="btn btn-warning" id="batch-edit-btn" style="display: none; flex-shrink: 0;">æ‰¹é‡ç¼–è¾‘</button>
                    <button class="btn btn-success" id="batch-publish-btn" style="display: none; flex-shrink: 0;">æ‰¹é‡ä¸Šæ¶</button>
                    <button class="btn btn-secondary" id="batch-hide-btn" style="display: none; flex-shrink: 0;">æ‰¹é‡ä¸‹æ¶</button>
                    <button class="btn btn-danger" id="batch-delete-btn" style="display: none; flex-shrink: 0;">æ‰¹é‡åˆ é™¤</button>
                </div>

                <div class="admin-content">
                    <div class="excel-upload" id="excel-upload-area">
                        <i class="fas fa-file-excel"></i>
                        <h3>ç‚¹å‡»ä¸Šä¼ Excelæ–‡ä»¶</h3>
                        <p>æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼ï¼Œç”¨äºæ‰¹é‡ç¼–è¾‘äº§å“ä¿¡æ¯</p>
                        <p><small>è¯·ç¡®ä¿ExcelåŒ…å«"å›¾ç‰‡URL"åˆ—</small></p>
                        <p><small>æˆ–å°†Excelæ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„</small></p>
                        <input type="file" id="excel-file" accept=".xlsx, .xls" style="display: none;">
                    </div>

                    <div class="products-grid" id="admin-products-grid">
                        <!-- äº§å“ç®¡ç†å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="admin-pagination" id="admin-products-pagination"></div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
            <div class="admin-page" id="admin-users">
                <div class="admin-actions">
                    <button class="btn btn-primary" id="refresh-users-btn">åˆ·æ–°ç”¨æˆ·åˆ—è¡¨</button>
                    <button class="btn btn-secondary" id="export-users-btn">å¯¼å‡ºç”¨æˆ·æ•°æ®</button>
                    <button class="btn btn-danger" id="delete-selected-users-btn" style="display: none;">æ‰¹é‡åˆ é™¤è´¦å·</button>
                    <div class="spacer"></div>
                    <button class="btn btn-danger" id="clear-cloud-users-btn" style="background-color: #c0392b; border-color: #c0392b;">
                        æ¸…ç†usersï¼ˆä¿ç•™ä¸allUsersä¸€è‡´ï¼‰
                    </button>
                </div>

                <div class="admin-content">
                    <!-- è®¾å¤‡æ³¨å†Œé™åˆ¶ç®¡ç†åŒºåŸŸ -->
                    <div class="device-limit-section" style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: #333;">è®¾å¤‡æ³¨å†Œé™åˆ¶ç®¡ç†</h3>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="device-limit-device-input" class="form-control" placeholder="è¾“å…¥è®¾å¤‡ID" style="flex: 1; min-width: 200px;">
                            <input type="number" id="device-limit-value-input" class="form-control" placeholder="æ³¨å†Œé™åˆ¶æ•°é‡" min="0" max="100" value="2" style="width: 150px;">
                            <button class="btn btn-primary" id="set-device-limit-btn">è®¾ç½®é™åˆ¶</button>
                            <button class="btn btn-secondary" id="view-device-limits-btn">æŸ¥çœ‹æ‰€æœ‰é™åˆ¶</button>
                            <button class="btn btn-danger" id="reset-device-limit-btn">é‡ç½®ä¸ºé»˜è®¤(2)</button>
                        </div>
                        <div id="device-limits-list" style="margin-top: 15px; display: none;">
                            <h4 style="font-size: 14px; margin-bottom: 10px;">å½“å‰è®¾å¤‡æ³¨å†Œé™åˆ¶ï¼š</h4>
                            <div id="device-limits-content" style="max-height: 200px; overflow-y: auto;"></div>
                        </div>
                    </div>

                    <div class="user-filters">
                        <select id="user-role-filter" class="form-control">
                            <option value="">å…¨éƒ¨è§’è‰²</option>
                            <option value="admin">ç®¡ç†å‘˜</option>
                            <option value="user">æ™®é€šç”¨æˆ·</option>
                        </select>
                        <select id="user-status-filter" class="form-control">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="active">æ­£å¸¸</option>
                            <option value="banned">å·²ç¦ç”¨</option>
                        </select>
                        <select id="user-online-filter" class="form-control">
                            <option value="">å…¨éƒ¨ç”¨æˆ·</option>
                            <option value="online">åœ¨çº¿ç”¨æˆ·</option>
                            <option value="offline">ç¦»çº¿ç”¨æˆ·</option>
                        </select>
                        <input type="date" id="user-register-date-start" class="form-control" placeholder="æ³¨å†Œæ—¥æœŸèµ·">
                        <input type="date" id="user-register-date-end" class="form-control" placeholder="æ³¨å†Œæ—¥æœŸæ­¢">
                        <input type="text" id="user-device-filter" class="form-control" placeholder="æŒ‰è®¾å¤‡å·/æ ‡è®°ç­›é€‰">
                        <input type="text" id="user-search-input" class="form-control" placeholder="æœç´¢ç”¨æˆ·å/è´¦å·/é‚®ç®±/ç”µè¯">
                    </div>

                    <div class="users-table-container">
                        <table class="admin-table" id="users-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="select-all-users"></th>
                                    <th>ID</th>
                                    <th id="orders-th-username" style="cursor:pointer;">ç”¨æˆ·å <span class="sort-indicator" style="margin-left:8px;"></span></th>
                                    <th>è´¦å·</th>
                                    <th>å¯†ç </th>
                                    <th>è§’è‰²</th>
                                    <th>æ³¨å†Œæ—¶é—´</th>
                                    <th>èœœç½</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- ç”¨æˆ·æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                    <div class="admin-pagination" id="admin-users-pagination"></div>
                </div>
            </div>

            <!-- è®¢å•ç®¡ç†é¡µé¢ -->
            <div class="admin-page" id="admin-orders">
                <div class="admin-actions">
                    <button class="btn btn-primary" id="refresh-orders-btn">åˆ·æ–°è®¢å•åˆ—è¡¨</button>
                    <button class="btn btn-secondary" id="export-orders-btn">å¯¼å‡ºè®¢å•æ•°æ®</button>
                    <button class="btn btn-success" id="upload-orders-btn" style="position: relative; overflow: hidden;">
                        <i class="fas fa-upload"></i> ä¸Šä¼ è®¢å•æ•°æ®
                        <input type="file" id="upload-orders-file" accept=".xlsx,.xls" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
                    </button>
                    <button class="btn btn-danger" id="delete-selected-orders-btn" style="display:none;">æ‰¹é‡åˆ é™¤è®¢å•</button>
                    <div class="spacer"></div>
                </div>

                <div class="admin-content">
                    <div class="order-filters">
                        <select id="order-status-filter" class="form-control">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="pending">å¾…ä¸Šä¼ </option>
                            <option value="review">å®¡æ ¸ä¸­</option>
                            <option value="shipping">è¿è¾“ä¸­</option>
                            <option value="rejected">å·²é©³å›</option>
                            <option value="cancelled">å·²å–æ¶ˆ</option>
                            <option value="completed">å·²å®Œæˆ</option>
                        </select>
                        <input type="date" id="order-register-date-start" class="form-control" placeholder="ç”¨æˆ·æ³¨å†Œæ—¥æœŸèµ·">
                        <input type="date" id="order-register-date-end" class="form-control" placeholder="ç”¨æˆ·æ³¨å†Œæ—¥æœŸæ­¢">
                        <select id="order-search-field" class="form-control">
                            <option value="all">å…¨éƒ¨å­—æ®µ</option>
                            <option value="id">è®¢å•ID</option>
                            <option value="productName">äº§å“åç§°</option>
                            <option value="username">ç”¨æˆ·å</option>
                        </select>
                        <input type="text" id="order-search" class="form-control" placeholder="æœç´¢è®¢å•...">
                    </div>

                    <div class="orders-table-container">
                        <table class="admin-table" id="orders-table">
                            <thead>
                                <tr>
                                    <th style="width:50px; text-align:center;"><input type="checkbox" id="select-all-orders"></th>
                                    <th>è®¢å•ID</th>
                                    <th>äº§å“åç§°</th>
                                    <th>ç”¨æˆ·å</th>
                                    <th>è®¢å•çŠ¶æ€</th>
                                    <th>å¿«é€’å•å·</th>
                                    <th id="orders-th-time">ä¸‹å•æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                <!-- è®¢å•æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                    <div class="admin-pagination" id="admin-orders-pagination"></div>
                </div>
            </div>

            <!-- è¯„ä»·ç®¡ç†é¡µé¢ -->
            <div class="admin-page" id="admin-reviews">
                <div class="admin-actions">
                    <button class="btn btn-primary" id="refresh-reviews-btn">åˆ·æ–°è¯„ä»·åˆ—è¡¨</button>
                    <div class="spacer"></div>
                    <div class="admin-search">
                        <select id="reviews-filter-category" class="admin-search-input" style="flex: 0 0 120px;">
                            <option value="all">å…¨éƒ¨å­—æ®µ</option>
                            <option value="product">æŒ‰äº§å“</option>
                            <option value="user">æŒ‰ç”¨æˆ·</option>
                            <option value="comment">æŒ‰è¯„ä»·å†…å®¹</option>
                            <option value="rating">æŒ‰è¯„åˆ†</option>
                            <option value="reply">æŒ‰ç®¡ç†å‘˜å›å¤</option>
                        </select>
                        <input
                            type="text"
                            id="reviews-search-input"
                            class="admin-search-input"
                            placeholder="æœç´¢è¯„ä»·ï¼ˆäº§å“å/ç”¨æˆ·/å†…å®¹ç­‰ï¼‰"
                        >
                    </div>
                </div>
                <div class="admin-content">
                    <div class="reviews-table-container">
                        <table class="admin-table" id="reviews-table">
                            <thead>
                                <tr>
                                    <th>è¯„ä»·ID</th>
                                    <th>äº§å“</th>
                                    <th>ç”¨æˆ·</th>
                                    <th>è¯„åˆ†</th>
                                    <th>è¯„ä»·å†…å®¹</th>
                                    <th>ç®¡ç†å‘˜å›å¤</th>
                                    <th>æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="reviews-table-body">
                                <tr><td colspan="8" style="text-align:center; padding:40px;">æš‚æ— è¯„ä»·æ•°æ®</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="admin-pagination" id="admin-reviews-pagination"></div>
                </div>
            </div>

            <!-- ä¸»é¡µç®¡ç†é¡µé¢ -->
            <div class="admin-page" id="admin-homepage">
                <div class="admin-actions">
                    <button class="btn btn-primary" id="preview-homepage-btn">é¢„è§ˆä¸»é¡µ</button>
                    <button class="btn btn-secondary" id="reset-homepage-btn">é‡ç½®ä¸»é¡µ</button>
                    <button class="btn btn-success" id="save-homepage-btn">ä¿å­˜è®¾ç½®</button>
                    <div class="spacer"></div>
                </div>

                <div class="admin-content">
                    <div class="homepage-editor">
                        <!-- è½®æ’­å›¾ç®¡ç† -->
                        <div class="editor-section">
                            <h3>è½®æ’­å›¾ç®¡ç†</h3>
                            <div class="carousel-manager">
                                <div class="carousel-tabs">
                                    <button type="button" class="carousel-tab active" data-carousel-tab="desktop">PCç«¯è½®æ’­</button>
                                    <button type="button" class="carousel-tab" data-carousel-tab="mobile">ç§»åŠ¨ç«¯è½®æ’­</button>
                                </div>
                                <div class="carousel-panel active" data-carousel-panel="desktop">
                                    <div class="carousel-list" id="carousel-list-desktop">
                                        <!-- PCè½®æ’­å›¾åˆ—è¡¨ -->
                                    </div>
                                    <button class="btn btn-primary" id="add-carousel-btn-desktop">æ·»åŠ PCè½®æ’­å›¾</button>
                                </div>
                                <div class="carousel-panel" data-carousel-panel="mobile">
                                    <div class="carousel-list" id="carousel-list-mobile">
                                        <!-- ç§»åŠ¨ç«¯è½®æ’­å›¾åˆ—è¡¨ -->
                                    </div>
                                    <button class="btn btn-primary" id="add-carousel-btn-mobile">æ·»åŠ ç§»åŠ¨ç«¯è½®æ’­å›¾</button>
                                </div>
                            </div>
                        </div>

                        <!-- ç½‘ç«™ä¿¡æ¯ç®¡ç† -->
                        <div class="editor-section">
                            <h3>ç½‘ç«™ä¿¡æ¯</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="site-title">ç½‘ç«™æ ‡é¢˜</label>
                                    <input type="text" id="site-title" class="form-control" value="ç”µå•†å¹³å°">
                                </div>
                                <div class="form-group">
                                    <label for="site-slogan">ç½‘ç«™æ ‡è¯­</label>
                                    <input type="text" id="site-slogan" class="form-control" value="ä¼˜è´¨å•†å“ï¼Œå€¼å¾—ä¿¡èµ–">
                                </div>
                                <div class="form-group">
                                    <label for="site-logo">ç½‘ç«™Logo URL</label>
                                    <input type="text" id="site-logo" class="form-control"
                                        placeholder="https://example.com/logo.png">
                                </div>
                            </div>
                        </div>

                        <!-- ä¸»é¢˜è®¾ç½® -->
                        <div class="editor-section">
                            <h3>ä¸»é¢˜è®¾ç½®</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="primary-color">ä¸»è‰²è°ƒ</label>
                                    <input type="color" id="primary-color" class="form-control" value="#3498db">
                                </div>
                                <div class="form-group">
                                    <label for="secondary-color">è¾…åŠ©è‰²</label>
                                    <input type="color" id="secondary-color" class="form-control" value="#2ecc71">
                                </div>
                                <div class="form-group">
                                    <label for="getitnow-button-color">Get it nowæŒ‰é’®é¢œè‰²</label>
                                    <input type="color" id="getitnow-button-color" class="form-control" value="#667eea">
                                </div>
                                <div class="form-group">
                                    <label for="font-family">å­—ä½“</label>
                                    <select id="font-family" class="form-control">
                                        <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">ç³»ç»Ÿé»˜è®¤</option>
                                        <option value="'Microsoft YaHei', sans-serif">å¾®è½¯é›…é»‘</option>
                                        <option value="'PingFang SC', sans-serif">è‹¹æ–¹</option>
                                        <option value="'Helvetica Neue', Arial, sans-serif">Helvetica</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- å¸ƒå±€è®¾ç½® -->
                        <div class="editor-section">
                            <h3>å¸ƒå±€è®¾ç½®</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="products-per-row">æ¯è¡Œäº§å“æ•°é‡</label>
                                    <select id="products-per-row" class="form-control">
                                        <option value="3">3ä¸ª</option>
                                        <option value="4" selected>4ä¸ª</option>
                                        <option value="5">5ä¸ª</option>
                                        <option value="6">6ä¸ª</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="show-categories">æ˜¾ç¤ºåˆ†ç±»ç­›é€‰</label>
                                    <input type="checkbox" id="show-categories" class="form-control" checked>
                                </div>
                                <div class="form-group">
                                    <label for="show-search">æ˜¾ç¤ºæœç´¢æ¡†</label>
                                    <input type="checkbox" id="show-search" class="form-control" checked>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®ç»Ÿè®¡é¡µé¢ -->
            <div class="admin-page" id="admin-statistics">
                <div class="admin-content">
                    <div class="stats-grid">
                        <div class="stat-card" data-stat-type="users" onclick="toggleStatTable('users')">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-users">0</h3>
                                <p>æ€»ç”¨æˆ·æ•°</p>
                            </div>
                        </div>
                        <div class="stat-card" data-stat-type="products" onclick="toggleStatTable('products')">
                            <div class="stat-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-products">0</h3>
                                <p>äº§å“æ€»æ•°</p>
                            </div>
                        </div>
                        <div class="stat-card" data-stat-type="orders" onclick="toggleStatTable('orders')">
                            <div class="stat-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-orders">0</h3>
                                <p>è®¢å•æ€»æ•°</p>
                            </div>
                        </div>
                        <div class="stat-card" data-stat-type="pending" onclick="toggleStatTable('pending')">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pending-orders">0</h3>
                                <p>å¾…å¤„ç†è®¢å•</p>
                            </div>
                        </div>
                    </div>

                    <!-- ç»Ÿè®¡è¡¨æ ¼åŒºåŸŸ -->
                    <!-- ç”¨æˆ·ç»Ÿè®¡è¡¨æ ¼ -->
                    <div id="stat-table-users" class="stat-table-section" style="display: none; margin-top: 30px; background: #ffffff; border-radius: 4px; padding: 32px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); border: 1px solid rgba(0, 0, 0, 0.08);">
                        <h3 style="margin: 0 0 24px 0; font-size: 24px; font-weight: 300; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-users" style="color: var(--primary);"></i>
                            ç”¨æˆ·åˆ—è¡¨
                        </h3>
                        <div style="overflow-x: auto;">
                            <table id="users-stat-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr onclick="cycleHeaderSort()" style="background: #f8f9fa; border-bottom: 2px solid #dee2e6; cursor: pointer;" title="ç‚¹å‡»åˆ‡æ¢æ’åºï¼ˆæ—¥æœŸ/è®¢å•IDï¼Œå¾ªç¯å‡é™åºï¼‰">
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">ç”¨æˆ·å</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">è´¦å·</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">è§’è‰²</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">æ³¨å†Œæ—¶é—´</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">çŠ¶æ€</th>
                                    </tr>
                                </thead>
                                <tbody id="users-stat-table-body">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- äº§å“ç»Ÿè®¡è¡¨æ ¼ï¼ˆåŒ…å«äº§å“é¢†å–æƒ…å†µï¼‰ -->
                    <div id="stat-table-products" class="stat-table-section" style="display: none; margin-top: 30px; background: #ffffff; border-radius: 4px; padding: 32px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); border: 1px solid rgba(0, 0, 0, 0.08);">
                        <h3 style="margin: 0 0 24px 0; font-size: 24px; font-weight: 300; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-box" style="color: var(--primary);"></i>
                            äº§å“é¢†å–æƒ…å†µç»Ÿè®¡
                        </h3>
                        <div style="overflow-x: auto;">
                            <table id="products-stat-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr onclick="cycleHeaderSort()" style="background: #f8f9fa; border-bottom: 2px solid #dee2e6; cursor: pointer;" title="ç‚¹å‡»åˆ‡æ¢æ’åºï¼ˆæ—¥æœŸ/è®¢å•IDï¼Œå¾ªç¯å‡é™åºï¼‰">
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">äº§å“åç§°</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">äº§å“ID</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 500; color: var(--dark);">æ€»é¢†å–æ•°</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 500; color: var(--dark);">å·²å®Œæˆè®¢å•</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 500; color: var(--dark);">å¾…å¤„ç†è®¢å•</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 500; color: var(--dark);">å·²å–æ¶ˆè®¢å•</th>
                                    </tr>
                                </thead>
                                <tbody id="products-stat-table-body">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- è®¢å•ç»Ÿè®¡è¡¨æ ¼ -->
                    <div id="stat-table-orders" class="stat-table-section" style="display: none; margin-top: 30px; background: #ffffff; border-radius: 4px; padding: 32px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); border: 1px solid rgba(0, 0, 0, 0.08);">
                        <h3 style="margin: 0 0 24px 0; font-size: 24px; font-weight: 300; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-shopping-cart" style="color: var(--primary);"></i>
                            æ‰€æœ‰è®¢å•åˆ—è¡¨
                        </h3>
                        
                        <!-- ç­›é€‰æ¡ä»¶åŒºåŸŸ -->
                        <div class="orders-filter-section" style="margin-bottom: 24px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <!-- è®¢å•çŠ¶æ€ç­›é€‰ -->
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--dark);">
                                        <i class="fas fa-filter" style="color: var(--primary); margin-right: 6px;"></i>è®¢å•çŠ¶æ€
                                    </label>
                                    <select id="filter-order-status" class="filter-input" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="pending">å¾…å¤„ç†</option>
                                        <option value="review">å®¡æ ¸ä¸­</option>
                                        <option value="shipping">é…é€ä¸­</option>
                                        <option value="completed">å·²å®Œæˆ</option>
                                        <option value="shipped">å·²å‘è´§</option>
                                        <option value="cancelled">å·²å–æ¶ˆ</option>
                                        <option value="canceled">å·²å–æ¶ˆ</option>
                                    </select>
                                </div>

                                <!-- äº§å“ç­›é€‰ -->
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--dark);">
                                        <i class="fas fa-box" style="color: var(--primary); margin-right: 6px;"></i>äº§å“åç§°
                                    </label>
                                    <select id="filter-order-product" class="filter-input" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                        <option value="">å…¨éƒ¨äº§å“</option>
                                    </select>
                                </div>

                                <!-- æ—¥æœŸèŒƒå›´ç­›é€‰ - å¼€å§‹æ—¥æœŸ -->
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--dark);">
                                        <i class="fas fa-calendar-alt" style="color: var(--primary); margin-right: 6px;"></i>å¼€å§‹æ—¥æœŸ
                                    </label>
                                    <input type="date" id="filter-order-start-date" class="filter-input" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                </div>

                                <!-- æ—¥æœŸèŒƒå›´ç­›é€‰ - ç»“æŸæ—¥æœŸ -->
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--dark);">
                                        <i class="fas fa-calendar-alt" style="color: var(--primary); margin-right: 6px;"></i>ç»“æŸæ—¥æœŸ
                                    </label>
                                    <input type="date" id="filter-order-end-date" class="filter-input" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <!-- å®¢æˆ·å§“åæœç´¢ -->
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--dark);">
                                        <i class="fas fa-user" style="color: var(--primary); margin-right: 6px;"></i>å®¢æˆ·å§“å
                                    </label>
                                    <input type="text" id="filter-order-customer" class="filter-input" placeholder="è¾“å…¥å®¢æˆ·å§“åæœç´¢" onkeypress="if(event.key==='Enter') applyOrderFilters()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                </div>

                                <!-- è®¢å•IDæœç´¢ -->
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--dark);">
                                        <i class="fas fa-hashtag" style="color: var(--primary); margin-right: 6px;"></i>è®¢å•ID
                                    </label>
                                    <input type="text" id="filter-order-id" class="filter-input" placeholder="è¾“å…¥è®¢å•IDæœç´¢" onkeypress="if(event.key==='Enter') applyOrderFilters()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: white;">
                                </div>
                            </div>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button onclick="applyOrderFilters()" class="btn btn-primary" style="padding: 10px 20px; font-size: 14px;">
                                    <i class="fas fa-search"></i> åº”ç”¨ç­›é€‰
                                </button>
                                <button onclick="resetOrderFilters()" class="btn btn-secondary" style="padding: 10px 20px; font-size: 14px;">
                                    <i class="fas fa-redo"></i> é‡ç½®ç­›é€‰
                                </button>
                                <div id="orders-filter-result" style="display: flex; align-items: center; padding: 10px 0; color: var(--gray); font-size: 14px;">
                                    <!-- æ˜¾ç¤ºç­›é€‰ç»“æœæ•°é‡ -->
                                </div>
                            </div>
                        </div>

                        <div style="overflow-x: auto;">
                            <table id="orders-stat-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">
                                            <button class="table-sort-btn" data-field="id" onclick="setOrderSort('id')" style="background:none;border:0;padding:0;font-weight:500;cursor:pointer;color:inherit;">
                                                è®¢å•ID <i class="fas fa-sort" id="sort-icon-id" style="margin-left:6px;color:var(--gray);"></i>
                                            </button>
                                        </th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">äº§å“åç§°</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">å®¢æˆ·å§“å</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">
                                            <button class="table-sort-btn" data-field="date" onclick="setOrderSort('date')" style="background:none;border:0;padding:0;font-weight:500;cursor:pointer;color:inherit;">
                                                è®¢å•æ—¥æœŸ <i class="fas fa-sort" id="sort-icon-date" style="margin-left:6px;color:var(--gray);"></i>
                                            </button>
                                        </th>
                                        <th style="padding: 12px; text-align: center; font-weight: 500; color: var(--dark);">çŠ¶æ€</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-stat-table-body">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- å¾…å¤„ç†è®¢å•è¡¨æ ¼ -->
                    <div id="stat-table-pending" class="stat-table-section" style="display: none; margin-top: 30px; background: #ffffff; border-radius: 4px; padding: 32px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); border: 1px solid rgba(0, 0, 0, 0.08);">
                        <h3 style="margin: 0 0 24px 0; font-size: 24px; font-weight: 300; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-clock" style="color: var(--primary);"></i>
                            å¾…å¤„ç†è®¢å•åˆ—è¡¨
                        </h3>
                        <div style="overflow-x: auto;">
                            <table id="pending-stat-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">è®¢å•ID</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">äº§å“åç§°</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">å®¢æˆ·å§“å</th>
                                        <th style="padding: 12px; text-align: left; font-weight: 500; color: var(--dark);">è®¢å•æ—¥æœŸ</th>
                                        <th style="padding: 12px; text-align: center; font-weight: 500; color: var(--dark);">çŠ¶æ€</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-stat-table-body">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- æ•°æ®å¯è§†åŒ–å›¾è¡¨ -->
                    <div class="charts-section" style="margin-top: 40px; background: #ffffff; border-radius: 4px; padding: 32px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); border: 1px solid rgba(0, 0, 0, 0.08);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                            <h3 style="margin: 0; font-size: 24px; font-weight: 300; color: var(--dark);">æ•°æ®è¶‹åŠ¿åˆ†æ</h3>
                            
                            <!-- æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨ -->
                            <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--dark);">
                                    <i class="fas fa-calendar-alt" style="color: var(--primary);"></i>
                                    æ—¥æœŸèŒƒå›´ï¼š
                                </label>
                                <input type="date" id="chart-start-date" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <span style="color: var(--gray);">è‡³</span>
                                <input type="date" id="chart-end-date" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <button id="apply-date-range" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">
                                    <i class="fas fa-check"></i> åº”ç”¨
                                </button>
                                <button id="reset-date-range" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                                    <i class="fas fa-redo"></i> é‡ç½®
                                </button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 24px; margin-bottom: 24px;">
                            <!-- æ¯æ—¥æ–°æ³¨å†Œç”¨æˆ·æŠ˜çº¿å›¾ -->
                            <div style="background: #f8f9fa; border-radius: 8px; padding: 20px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 500; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-user-plus" style="color: var(--primary);"></i>
                                    æ¯æ—¥æ–°æ³¨å†Œç”¨æˆ·æ•°é‡
                                </h4>
                                <div style="position: relative; height: 300px;">
                                    <canvas id="dailyUsersChart"></canvas>
                                </div>
                            </div>

                            <!-- æ¯æ—¥è®¢å•æ•°é‡æŠ˜çº¿å›¾ -->
                            <div style="background: #f8f9fa; border-radius: 8px; padding: 20px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 500; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-shopping-cart" style="color: var(--primary);"></i>
                                    æ¯æ—¥è®¢å•æ•°é‡
                                </h4>
                                <div style="position: relative; height: 300px;">
                                    <canvas id="dailyOrdersChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- ç”¨æˆ·æ³¨å†Œè¶‹åŠ¿ï¼ˆæœ€è¿‘30å¤©ï¼‰ -->
                        <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-top: 24px;">
                            <h4 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 500; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-chart-line" style="color: var(--primary);"></i>
                                ç”¨æˆ·æ³¨å†Œè¶‹åŠ¿ï¼ˆæœ€è¿‘30å¤©ï¼‰
                            </h4>
                            <div style="position: relative; height: 350px;">
                                <canvas id="userTrendChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- æ•°æ®åº“å¤‡ä»½/æ¢å¤åŠŸèƒ½ -->
                    <div class="database-backup-section" style="margin-top: 40px; background: #ffffff; border-radius: 4px; padding: 32px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); border: 1px solid rgba(0, 0, 0, 0.08);">
                        <h3 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 300; color: var(--dark);">æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</h3>
                        <p style="margin: 0 0 24px 0; color: var(--gray); font-size: 14px; line-height: 1.6;">
                            å¤‡ä»½æ‰€æœ‰ç½‘ç«™æ•°æ®ï¼ˆäº§å“ã€è®¢å•ã€ç”¨æˆ·ã€è®¾ç½®ç­‰ï¼‰åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œæˆ–ä»å¤‡ä»½æ–‡ä»¶æ¢å¤æ•°æ®ã€‚æ­¤æ“ä½œä¼šè¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œã€‚
                        </p>
                        
                        <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                            <button id="download-database-btn" class="btn btn-primary" style="flex: 0 0 auto;">
                                <i class="fas fa-download"></i> ä¸‹è½½æ•°æ®åº“å¤‡ä»½
                            </button>
                            <label for="upload-database-input" class="btn btn-secondary" style="flex: 0 0 auto; cursor: pointer; margin: 0;">
                                <i class="fas fa-upload"></i> ä¸Šä¼ æ•°æ®åº“å¤‡ä»½
                                <input type="file" id="upload-database-input" accept=".json" style="display: none;" onchange="handleDatabaseUpload(event)">
                            </label>
                        </div>

                        <div id="database-backup-info" style="margin-top: 24px; padding: 16px; background: var(--primary-light); border-radius: 2px; border-left: 4px solid var(--primary); display: none;">
                            <div style="display: flex; align-items: start; gap: 12px;">
                                <i class="fas fa-info-circle" style="color: var(--primary); font-size: 18px; margin-top: 2px;"></i>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; color: var(--dark); margin-bottom: 4px;">å¤‡ä»½ä¿¡æ¯</div>
                                    <div id="database-backup-details" style="font-size: 13px; color: var(--gray); line-height: 1.6;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Messenger å¤åˆ¶æç¤ºæ°”æ³¡ -->
    <div id="messenger-copy-toast" class="messenger-copy-toast">
        <i class="far fa-check-circle"></i>
        <span>Message copied. Please paste it in Messenger.</span>
    </div>

    <!-- Messenger è”ç³»æŒ‰é’®ï¼ˆGet Prepaidï¼‰ -->
    <!-- å®¢æœè”ç³»æŒ‰é’® -->
    <div class="contact-button">
        <button class="main-button" id="mainButton">
            <i class="fas fa-headset"></i>
        </button>
        
        <div class="contact-options" id="contactOptions">
            <a href="https://m.me/beefreebie" target="_blank" class="option-button messenger">
                <i class="fab fa-facebook-messenger"></i>
                <span class="tooltip">Messenger</span>
            </a>
            <a href="https://wa.me/12132756555" target="_blank" class="option-button whatsapp">
                <i class="fab fa-whatsapp"></i>
                <span class="tooltip">WhatsApp</span>
            </a>
            <a href="mailto:service@beefreebies.com?subject=I need more help" class="option-button email">
                <i class="fas fa-envelope"></i>
                <span class="tooltip">Email</span>
            </a>
        </div>
    </div>


    <!-- ç™»å½•/æ³¨å†Œé€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="auth-choice-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>è¯·å…ˆç™»å½•æˆ–æ³¨å†Œ</h3>
                <button class="close-modal">&times;</button>
                </div>
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <p style="margin-bottom: 30px; color: #666; font-size: 16px;">é¢†å–äº§å“éœ€è¦ç™»å½•è´¦å·ï¼Œè¯·é€‰æ‹©ï¼š</p>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button id="goto-login-btn" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px;">
                        <i class="fas fa-sign-in-alt"></i> å·²æœ‰è´¦å·ï¼Œç«‹å³ç™»å½•
                    </button>
                    <button id="goto-register-btn" class="btn btn-secondary" style="width: 100%; padding: 12px; font-size: 16px;">
                        <i class="fas fa-user-plus"></i> æ²¡æœ‰è´¦å·ï¼Œç«‹å³æ³¨å†Œ
                    </button>
                </div>
                </div>
            </div>
            </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç”¨æˆ·ç™»å½•</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-account">æ‰‹æœºå·æˆ–é‚®ç®±</label>
                        <input type="text" id="login-account" class="form-control" placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">å¯†ç </label>
                        <input type="password" id="login-password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ç™»å½•</button>
                    </div>
                    <div class="consent-note">
                        By continuing you agree to the <a href="Terms of Service.html" target="_blank" rel="noopener">Terms of Service</a> and <a href="Privacy Poilcy.html" target="_blank" rel="noopener">Privacy Policy</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç”¨æˆ·æ³¨å†Œ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-account">æ‰‹æœºå·æˆ–é‚®ç®±</label>
                        <input type="text" id="register-account" class="form-control" placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">å¯†ç </label>
                        <input type="password" id="register-password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label for="register-confirm">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="register-confirm" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                            required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
                    </div>
                    <div class="consent-note">
                        By continuing you agree to the <a href="Privacy Poilcy.html" target="_blank" rel="noopener">Terms of Service</a> and <a href="Terms of Service.html" target="_blank" rel="noopener">Privacy Policy</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æŠ¥åæ¨¡æ€æ¡† -->
    <div class="modal" id="signup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="signup-modal-title">äº§å“æŠ¥å</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ä¿®æ”¹è¿™é‡Œçš„è¡¨å• -->
                <form id="signup-form" class="signup-form" action="https://formspree.io/f/mrbobwnd" method="POST">
                    <!-- Formspree å¿…è¦å­—æ®µ -->
                    <input type="hidden" name="_subject" value="ğŸ¯ æ–°çš„äº§å“æŠ¥å - ç”µå•†å¹³å°">
                    <input type="hidden" name="_replyto" id="signup-email-input">
                    <input type="hidden" name="_next" value="https://your-domain.com/success.html"> <!-- ä¿®æ”¹ä¸ºä½ çš„æˆåŠŸé¡µé¢ -->

                    <div class="form-group">
                        <label id="signup-product-label">æŠ¥åäº§å“</label>
                        <input type="text" id="signup-product-name" name="äº§å“åç§°" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label for="signup-email" id="signup-email-label">é‚®ç®±</label>
                        <input type="email" id="signup-email" name="é‚®ç®±" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-address" id="signup-address-label">åœ°å€</label>
                        <div id="signup-address-container">
                            <!-- åœ°å€é€‰æ‹©å™¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            <select id="signup-address-select" name="åœ°å€" class="form-control" style="display: none;">
                                <option value="">è¯·é€‰æ‹©åœ°å€</option>
                            </select>
                            <button type="button" id="signup-address-btn" class="btn btn-primary" style="display: none; width: 100%; margin-top: 10px;">
                                <i class="fas fa-map-marker-alt"></i> <span id="signup-address-btn-text">å‰å¾€ç”¨æˆ·ä¸­å¿ƒæ·»åŠ åœ°å€</span>
                            </button>
                            <input type="hidden" id="signup-address-hidden" name="åœ°å€">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signup-notes" id="signup-notes-label">å¤‡æ³¨</label>
                        <textarea id="signup-notes" name="å¤‡æ³¨" class="form-control" rows="3"
                            placeholder="è¯·è¾“å…¥æ‚¨çš„ç‰¹æ®Šéœ€æ±‚æˆ–å¤‡æ³¨"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="signup-cancel-btn" onclick="closeModal('signup-modal')">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary" id="signup-submit-btn">æäº¤æŠ¥å</button>
                    </div>
                    <div class="consent-note">
                        By continuing you agree to the <a href="Terms of Service.html" target="_blank" rel="noopener">Terms of Service</a> and <a href="Privacy Poilcy.html" target="_blank" rel="noopener">Privacy Policy</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- WhatsAppæç¤ºæ¨¡æ€æ¡† - æœ‰è·³è½¬é“¾æ¥çš„äº§å“ï¼ˆä¸¤æ­¥æµç¨‹ï¼‰ -->
    <div class="modal" id="whatsapp-modal">
        <!-- ä¸¤æ­¥æµç¨‹æ ·å¼ï¼ˆæœ‰è·³è½¬é“¾æ¥ï¼‰ -->
        <div class="modal-content whatsapp-modal-content whatsapp-modal-two-steps" id="whatsapp-modal-two-steps" style="display: none;">
            <div class="close-btn" id="whatsapp-close-btn" onclick="closeWhatsAppModalWindow()" style="position: absolute; top: 20px; right: 20px; width: 36px; height: 36px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; cursor: pointer; z-index: 100; transition: all 0.3s ease; border: 2px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(5px); opacity: 0; visibility: hidden;">
                <i class="fas fa-times"></i>
            </div>
            
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px 40px 30px; text-align: center; position: relative; overflow: hidden;">
                <h1 style="font-size: 2.4rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 8px; position: relative; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">Get Your Product!</h1>
                <p style="font-size: 1.1rem; opacity: 0.9; font-weight: 300; max-width: 500px; margin: 0 auto; position: relative;">Two simple steps to get your product and cash back</p>
                
                <!-- æ‰‹æœºç«¯å‘ä¸‹æ»šåŠ¨æç¤º -->
                <div class="mobile-scroll-hint" id="whatsapp-mobile-scroll-hint">
                    <div class="mobile-scroll-hint-content">
                        <i class="fas fa-chevron-down"></i>
                        <span>Scroll down for more</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-body whatsapp-modal-body">
                <div class="steps-container">
                    <!-- Step 1: Place Your Order -->
                    <a id="whatsapp-amazon-link" href="#" target="_blank" rel="noopener" class="step">
                        <div class="step-number">1</div>
                        <div class="step-icon-container amazon-icon-container">
                            <i class="step-icon fab fa-amazon"></i>
                        </div>
                        <div class="step-text">
                            <div class="step-title">Place Your Order</div>
                            <div class="step-subtitle">Order the product on Amazon</div>
                            
                            <div class="step-action">
                                <div class="action-btn amazon-btn">
                                    <i class="fab fa-amazon"></i>
                                    Order on Amazon
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Step 2: 100% Cash back nowï¼ˆå‚è€ƒ 1.1 äºšé©¬é€Šä¸‹å•æ­¥éª¤.htmlï¼‰ -->
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-icon-container messenger-icon-container" id="step-icon-container">
                            <i class="step-icon fab fa-facebook-messenger" id="step-icon"></i>
                        </div>
                        <div class="step-text">
                            <div class="step-title">100% Cash back now</div>
                            <div class="step-subtitle">ğŸ‘‰ <span class="highlight-red">Message us now to get your cash back</span></div>
                            
                            <!-- åˆ‡æ¢å™¨ -->
                            <div class="contact-switcher">
                                <div class="switcher-label">Choose contact method:</div>
                                <div class="switcher-buttons">
                                    <button class="contact-btn messenger-btn active" data-option="messenger" id="messenger-switch-btn">
                                        <i class="fab fa-facebook-messenger"></i>
                                        Messenger
                                    </button>
                                    <button class="contact-btn whatsapp-btn" data-option="whatsapp" id="whatsapp-switch-btn">
                                        <i class="fab fa-whatsapp"></i>
                                        WhatsApp
                                    </button>
                                </div>
                            </div>
                            
                            <!-- å¤åˆ¶æ¶ˆæ¯éƒ¨åˆ† -->
                            <div class="copy-container" id="whatsapp-copy-container-two-step">
                                <div class="copy-title">Copy Message</div>
                                <div class="copy-text" id="messenger-prepay-text">
                                    Please provide prepayment for order XXX
                                </div>
                                <button class="copy-btn" id="copy-message-btn">
                                    <i class="fas fa-copy"></i> Step 1: Copy Message
                                </button>
                            </div>
                            
                            <!-- å‘é€æŒ‰é’®éƒ¨åˆ† -->
                            <div class="step-action">
                                <a href="https://m.me/beefreebie" target="_blank" class="action-btn messenger-btn" id="send-message-btn" onclick="openMessengerPrepay(); return false;">
                                    <i class="fab fa-facebook-messenger"></i>
                                    Step 2: Send via Messenger
                                </a>
                                <!-- æ–°å¢ï¼šå·²ç¡®è®¤æŒ‰é’® -->
                                <button class="confirmed-btn" id="whatsapp-confirmed-btn" onclick="closeWhatsAppModalWindow()">
                                    <i class="fas fa-check-circle"></i>
                                    Confirmed
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="progress-indicator">
                    <div class="progress-dots">
                        <div class="progress-dot active"></div>
                        <div class="progress-dot"></div>
                        <div class="progress-dot active"></div>
                    </div>
                </div>
                
                <div class="footer-note">
                    Complete both steps to receive your cash back
                </div>
            </div>
        </div>

        <!-- å•æ­¥æµç¨‹æ ·å¼ï¼ˆæ— è·³è½¬é“¾æ¥ï¼‰ -> å‚è€ƒâ€œéäºšé©¬é€Šä¸‹å•æ­¥éª¤.htmlâ€çš„å¼¹çª—æ ·å¼ -->
        <div class="modal-content whatsapp-modal-content whatsapp-modal-single-step" id="whatsapp-modal-single-step" style="display: none; max-width: 600px; border-radius: 20px; overflow: hidden; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12); background: transparent; box-sizing: border-box; position: relative;">
            <!-- å‚è€ƒæ–‡ä»¶ä¸­çš„çª—å£æ•´ä½“å®¹å™¨ -->
            <!-- å•æ­¥å¼¹çª—ï¼šå³ä¸Šè§’å…³é—­æŒ‰é’®ï¼ˆéšè—ï¼Œ15 ç§’åæ˜¾ç¤ºï¼‰ -->
            <div class="close-btn" id="whatsapp-close-btn-single" onclick="closeWhatsAppModalWindow()" style="position: absolute; top: 20px; right: 20px; width: 36px; height: 36px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; cursor: pointer; z-index: 100; transition: all 0.3s ease; border: 2px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(5px); opacity: 0; visibility: hidden;">
                <i class="fas fa-times"></i>
            </div>
            <div id="windowContainer" class="window-container">
                <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
                <div class="window-header">
                    <h1>Get Your Product!</h1>
                </div>

                <!-- ä¸»æ­¥éª¤å†…å®¹ -->
                <div class="step-container">
                    <div class="step-icon-container" id="single-step-icon-container">
                        <i class="step-icon fab fa-facebook-messenger" id="single-step-icon"></i>
                    </div>

                    <div class="step-title">Confirm your order</div>
                    <div class="step-subtitle">ğŸ‘‰ Message to confirm â€” we ship now</div>

                    <!-- è”ç³»æ–¹å¼åˆ‡æ¢å™¨ï¼ˆMessenger / WhatsAppï¼‰ -->
                    <div class="contact-switcher">
                        <div class="switcher-label"></div>
                        <div class="switcher-buttons">
                            <button class="contact-btn messenger-btn active" data-option="messenger" onclick="switchContactMethod('messenger')">
                                <i class="fab fa-facebook-messenger"></i>
                                Messenger
                            </button>
                            <button class="contact-btn whatsapp-btn" data-option="whatsapp" onclick="switchContactMethod('whatsapp')">
                                <i class="fab fa-whatsapp"></i>
                                WhatsApp
                            </button>
                        </div>
                    </div>

                    <!-- å¤åˆ¶æ¶ˆæ¯éƒ¨åˆ†ï¼šä¿æŒåŸæœ‰ id ä»¥å…¼å®¹ copySingleStepMessage() -->
                    <div class="copy-container" id="whatsapp-copy-container-single">
                        <div class="copy-title">Copy This Message</div>
                        <div class="copy-text" id="messenger-prepay-text-single">
                            Please confirm my order. The order number is XXXXX
                        </div>
                        <button class="copy-btn" type="button" onclick="copySingleStepMessage()">
                            <i class="fas fa-copy"></i> Step 1: Copy
                        </button>
                    </div>

                    <!-- å‘é€æŒ‰é’®éƒ¨åˆ†ï¼šå‚è€ƒæ–‡ä»¶é€»è¾‘ -->
                    <div class="send-action">
                        <a href="https://m.me/beefreebie" target="_blank" class="send-btn messenger-btn" id="sendBtn" onclick="handleSingleStepSend(event)">
                            <i class="fab fa-facebook-messenger"></i>
                            Step 2: Send via Messenger
                        </a>
                        <!-- æ–°å¢ï¼šå·²ç¡®è®¤æŒ‰é’® -->
                        <button class="confirmed-btn" id="single-step-confirmed-btn" onclick="handleSingleStepConfirmed()">
                            <i class="fas fa-check-circle"></i>
                            Confirmed
                        </button>
                    </div>
                </div>

                <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
                <div class="progress-indicator">
                    <div class="progress-dots">
                        <div class="progress-dot active"></div>
                        <div class="progress-dot active"></div>
                        <div class="progress-dot active"></div>
                    </div>
                </div>

                <!-- åº•éƒ¨æç¤ºæ–‡æ¡ˆ -->
                <div class="footer-note">
                    Complete the process to receive your product
                </div>
            </div>
        </div>
        <!-- æŒ‡å¼•æµ®å±‚ï¼ˆä¸¤æ­¥ / å•æ­¥å…±ç”¨ï¼‰ -->
        <div class="whatsapp-guide-overlay" id="whatsapp-guide-overlay">
            <div class="whatsapp-guide-content">
                <div class="whatsapp-guide-step" id="whatsapp-guide-step">Guide</div>
                <div class="whatsapp-guide-progress">
                    <div class="whatsapp-guide-progress-fill" id="whatsapp-guide-progress-fill"></div>
                </div>
                <h3 class="whatsapp-guide-title" id="whatsapp-guide-title">Follow these steps</h3>
                <div class="whatsapp-guide-desc" id="whatsapp-guide-desc"></div>
                <div class="whatsapp-guide-list" id="whatsapp-guide-list"></div>
                <div class="whatsapp-guide-actions">
                    <button type="button" class="whatsapp-guide-btn whatsapp-guide-btn-primary" id="whatsapp-guide-next">Next</button>
                </div>
            </div>
        </div>

        <!-- æŒ‡å¼•å¼€å¯æŒ‰é’® -->
        <button type="button" id="whatsapp-guide-toggle" class="whatsapp-guide-toggle">
            <i class="fas fa-question-circle"></i>
            <span>Guide</span>
        </button>
    </div>
    
    <!-- äº§å“ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="edit-product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¼–è¾‘äº§å“</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-product-form">
                    <input type="hidden" id="edit-product-id">
                    <div class="form-group">
                        <label for="edit-product-name">äº§å“åç§°</label>
                        <input type="text" id="edit-product-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-price">åŸä»·</label>
                        <input type="number" id="edit-product-price" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-new-price">æ–°ä»·æ ¼ï¼ˆæ˜¾ç¤ºä»·æ ¼ï¼‰</label>
                        <input type="number" id="edit-product-new-price" class="form-control" step="0.01" min="0" value="0" placeholder="é»˜è®¤ä¸º0">
                        <small style="color: #666; font-size: 12px;">æ­¤ä»·æ ¼å°†æ˜¾ç¤ºåœ¨äº§å“é¡µé¢ä¸Šï¼ŒåŸä»·ä¼šæ˜¾ç¤ºåˆ é™¤çº¿</small>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-stock">åº“å­˜</label>
                        <input type="number" id="edit-product-stock" class="form-control" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-category">åˆ†ç±»</label>
                        <select id="edit-product-category" class="form-control" required>
                            <option value="electronics">Electronics</option>
                            <option value="home">Home & Living</option>
                            <option value="clothing">Clothing & Shoes</option>
                            <option value="beauty">Beauty & Skincare</option>
                            <option value="sports">è¿åŠ¨æˆ·å¤–</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å›¾ç‰‡URLï¼ˆæœ€å¤š6å¼ ï¼‰</label>
                        <div class="product-image-inputs">
                            <input type="url" id="edit-product-image-1" class="form-control edit-product-image-url" placeholder="å›¾ç‰‡URL 1ï¼ˆå°é¢ï¼‰" required>
                            <input type="url" id="edit-product-image-2" class="form-control edit-product-image-url" placeholder="å›¾ç‰‡URL 2ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="edit-product-image-3" class="form-control edit-product-image-url" placeholder="å›¾ç‰‡URL 3ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="edit-product-image-4" class="form-control edit-product-image-url" placeholder="å›¾ç‰‡URL 4ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="edit-product-image-5" class="form-control edit-product-image-url" placeholder="å›¾ç‰‡URL 5ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="edit-product-image-6" class="form-control edit-product-image-url" placeholder="å›¾ç‰‡URL 6ï¼ˆå¯é€‰ï¼‰">
                        </div>
                        <small style="color: #666; font-size: 12px;">ç•™ç©ºçš„è¾“å…¥æ¡†ä¼šè‡ªåŠ¨å¿½ç•¥</small>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-link">è·³è½¬é“¾æ¥ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="url" id="edit-product-link" class="form-control" placeholder="è®¾ç½®åï¼Œå‰å°ä¼šæ˜¾ç¤ºâ€œå‰å¾€é“¾æ¥â€æŒ‰é’®">
                        <small style="color: #666; font-size: 12px;">ä»…å½“å¡«å†™é“¾æ¥æ—¶ï¼Œå‰å°æŒ‰é’®æ‰ä¼šå±•ç¤º</small>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-amazon-review-link">äºšé©¬é€Šæ’°å†™è¯„è®ºé“¾æ¥ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="url" id="edit-product-amazon-review-link" class="form-control" placeholder="ç”¨äº 'Write a review on Amazon' æŒ‰é’®ï¼ˆå¯é€‰ï¼‰">
                        <small style="color: #666; font-size: 12px;">ä»…å½“å¡«å†™æ­¤é“¾æ¥ä¸”ä¹°å®¶è¯„åˆ†ä¸º 5 æ˜Ÿæ—¶ï¼Œè¯„è®ºå¼¹çª—ä¼šå±•ç¤ºâ€œWrite a review on Amazonâ€æŒ‰é’®å¹¶è·³è½¬åˆ°æ­¤é“¾æ¥ã€‚</small>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-description">äº§å“æè¿°</label>
                        <textarea id="edit-product-description" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                        <button type="button" class="btn btn-secondary" id="cancel-edit-btn">å–æ¶ˆ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡ç¼–è¾‘äº§å“æ¨¡æ€æ¡† -->
    <div class="modal" id="batch-edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ‰¹é‡ç¼–è¾‘äº§å“</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="batch-edit-form">
                    <div class="alert alert-info"
                        style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 4px;">
                        <i class="fas fa-info-circle"></i>
                        å·²é€‰æ‹© <strong id="batch-edit-count">0</strong> ä¸ªäº§å“ã€‚ç•™ç©ºçš„å­—æ®µå°†ä¸ä¼šè¢«ä¿®æ”¹ã€‚
                    </div>
                    <div class="form-group">
                        <label for="batch-edit-price-action">ä»·æ ¼æ“ä½œ</label>
                        <select id="batch-edit-price-action" class="form-control">
                            <option value="">ä¸ä¿®æ”¹</option>
                            <option value="set">è®¾ç½®ä¸ºå›ºå®šå€¼</option>
                            <option value="increase">å¢åŠ é‡‘é¢</option>
                            <option value="decrease">å‡å°‘é‡‘é¢</option>
                            <option value="multiply">ä¹˜ä»¥å€æ•°</option>
                        </select>
                    </div>
                    <div class="form-group" id="batch-price-value-group" style="display: none;">
                        <label for="batch-edit-price-value">ä»·æ ¼å€¼</label>
                        <input type="number" id="batch-edit-price-value" class="form-control" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="batch-edit-stock-action">åº“å­˜æ“ä½œ</label>
                        <select id="batch-edit-stock-action" class="form-control">
                            <option value="">ä¸ä¿®æ”¹</option>
                            <option value="set">è®¾ç½®ä¸ºå›ºå®šå€¼</option>
                            <option value="increase">å¢åŠ æ•°é‡</option>
                            <option value="decrease">å‡å°‘æ•°é‡</option>
                        </select>
                    </div>
                    <div class="form-group" id="batch-stock-value-group" style="display: none;">
                        <label for="batch-edit-stock-value">åº“å­˜å€¼</label>
                        <input type="number" id="batch-edit-stock-value" class="form-control" min="0">
                    </div>
                    <div class="form-group">
                        <label for="batch-edit-category">ä¿®æ”¹åˆ†ç±»</label>
                        <select id="batch-edit-category" class="form-control">
                            <option value="">ä¸ä¿®æ”¹</option>
                            <option value="electronics">Electronics</option>
                            <option value="home">Home & Living</option>
                            <option value="clothing">Clothing & Shoes</option>
                            <option value="beauty">Beauty & Skincare</option>
                            <option value="sports">è¿åŠ¨æˆ·å¤–</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">åº”ç”¨ä¿®æ”¹</button>
                        <button type="button" class="btn btn-secondary close-modal">å–æ¶ˆ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- åœ°å€ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="address-modal">
        <div class="modal-content" style="max-width: 600px; margin: 20px auto; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="border-bottom: 1px solid #ddd; padding: 20px 30px 15px 30px;">
                <h3 id="address-modal-title" style="font-size: 24px; font-weight: 600; margin: 0;">Add a new address</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px 30px;">
                <form id="address-form">
                    <input type="hidden" id="address-id">
                    <input type="hidden" id="address-country" value="US">
                    
                    <!-- å›½å®¶/åœ°åŒºï¼ˆå›ºå®šä¸ºç¾å›½ï¼Œä¸å¯é€‰æ‹©ï¼‰ -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Country/Region</label>
                        <div style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #333;">
                            United States
                    </div>
                    </div>

                    <!-- å…¨å -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="address-name" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Full name (First and Last name)</label>
                        <input type="text" id="address-name" class="form-control" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>

                    <!-- ç”µè¯å·ç  -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="address-phone" data-i18n="phone" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Phone number</label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">+1</span>
                            <input type="tel" id="address-phone" class="phone-input" required maxlength="10" placeholder="1234567890" style="font-size: 14px;">
                        </div>
                        <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">May be used to assist delivery</small>
                    </div>

                    <!-- è¡—é“åœ°å€ -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="address-detail" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Street address</label>
                        <input type="text" id="address-detail" class="form-control" required placeholder="Street address or P.O. Box" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>

                    <!-- å•å…ƒ/å¥—æˆ¿å· -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="address-unit" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">Unit or suite number</label>
                        <input type="text" id="address-unit" class="form-control" placeholder="Apt, suite, unit, building, floor, etc." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>

                    <!-- åŸå¸‚ -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="address-city" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">City</label>
                        <input type="text" id="address-city" class="form-control" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>

                    <!-- å·å’Œé‚®ç¼–ï¼ˆåŒä¸€è¡Œï¼‰ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="form-group">
                            <label for="address-state" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">State</label>
                            <select id="address-state" class="form-control" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <option value="">Select</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                    </div>
                    <div class="form-group">
                            <label for="address-postal" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;">ZIP Code</label>
                            <input type="text" id="address-postal" class="form-control" required pattern="[0-9]{5}(-[0-9]{4})?" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                    </div>

                    <!-- è®¾ä¸ºé»˜è®¤åœ°å€ -->
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="address-default" style="margin-right: 8px; width: 18px; height: 18px;">
                            <span style="font-size: 14px;">Make this my default address</span>
                        </label>
                    </div>

                    <!-- æäº¤æŒ‰é’® -->
                    <div class="form-actions" style="margin-top: 30px; padding-bottom: 10px;">
                        <button type="submit" class="btn btn-primary" style="background: #FFD814; border: none; color: #000; padding: 12px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;">Add address</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ========== å·¥å…·å‡½æ•°åº“ ==========
        // localStorage å·¥å…·å‡½æ•° - ç»Ÿä¸€å¤„ç† JSON åºåˆ—åŒ–å’Œé”™è¯¯å¤„ç†
        const Storage = {
            get(key, defaultValue = null) {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (error) {
                    console.error(`è¯»å– localStorage[${key}] å¤±è´¥:`, error);
                    return defaultValue;
                }
            },
            set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (error) {
                    console.error(`å†™å…¥ localStorage[${key}] å¤±è´¥:`, error);
                    // å¦‚æœå­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œå°è¯•æ¸…ç†æ—§æ•°æ®
                    if (error.name === 'QuotaExceededError') {
                        console.warn('å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œå°è¯•æ¸…ç†ç¼“å­˜...');
                        this.clearCache();
                        try {
                            localStorage.setItem(key, JSON.stringify(value));
                            return true;
                        } catch (e) {
                            console.error('æ¸…ç†åä»æ— æ³•å†™å…¥:', e);
                        }
                    }
                    return false;
                }
            },
            remove(key) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (error) {
                    console.error(`åˆ é™¤ localStorage[${key}] å¤±è´¥:`, error);
                    return false;
                }
            },
            clearCache() {
                // æ¸…ç†ç¼“å­˜æ•°æ®ï¼Œä¿ç•™é‡è¦æ•°æ®
                const importantKeys = ['currentUser', 'allUsers', 'deviceRegisterLimits', 'language'];
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('cache_') && !importantKeys.includes(key)) {
                        keysToRemove.push(key);
                    }
                }
                keysToRemove.forEach(key => localStorage.removeItem(key));
            }
        };

        // DOM æŸ¥è¯¢ç¼“å­˜
        const DOMCache = {
            cache: new Map(),
            get(selector, useCache = true) {
                if (useCache && this.cache.has(selector)) {
                    const cached = this.cache.get(selector);
                    if (document.contains(cached)) {
                        return cached;
                    }
                    this.cache.delete(selector);
                }
                const element = document.querySelector(selector);
                if (element && useCache) {
                    this.cache.set(selector, element);
                }
                return element;
            },
            getAll(selector) {
                return document.querySelectorAll(selector);
            },
            clear() {
                this.cache.clear();
            }
        };

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait, immediate = false) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    timeout = null;
                    if (!immediate) func.apply(this, args);
                };
                const callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(this, args);
            };
        }

        // èŠ‚æµå‡½æ•°
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // æŒ‰é’®ç‚¹å‡»é˜²æŠ–æ˜ å°„è¡¨
        const buttonClickHandlers = new Map();

        // å®‰å…¨çš„æŒ‰é’®ç‚¹å‡»å¤„ç†åŒ…è£…å™¨ï¼ˆå¯é€‰è½»é‡é˜²æŠ–ï¼›é»˜è®¤ç«‹å³æ‰§è¡Œï¼‰
        function safeButtonClick(buttonId, handler, debounceMs = 0) {
            if (!buttonClickHandlers.has(buttonId)) {
                const debouncedHandler = debounce((e) => {
                    const button = document.getElementById(buttonId);
                    if (button && button.disabled) {
                        return; // å¦‚æœæŒ‰é’®å·²ç¦ç”¨ï¼Œå¿½ç•¥ç‚¹å‡»
                    }
                    handler(e);
                }, debounceMs);
                buttonClickHandlers.set(buttonId, debouncedHandler);
            }
            return buttonClickHandlers.get(buttonId);
        }

        // ç¡®ä¿éè¡¨å•æŒ‰é’®ä¸ä¼šè¢«å½“ä½œæäº¤æŒ‰é’®ï¼šæ˜¾å¼è®¾ç½® type="button"
        (function enforceButtonTypeForNonFormButtons() {
            document.querySelectorAll('button:not([type])').forEach(btn => {
                if (!btn.closest('form')) {
                    btn.type = 'button';
                }
            });
        })();

        // å®‰å…¨çš„ HTML è½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // å®‰å…¨çš„å±æ€§è®¾ç½®
        function setSafeAttribute(element, attr, value) {
            if (element && value != null) {
                element.setAttribute(attr, String(value));
            }
        }

        // æ‰¹é‡ DOM æ“ä½œä¼˜åŒ–
        function batchDOMUpdate(callback) {
            if (document.createDocumentFragment) {
                const fragment = document.createDocumentFragment();
                callback(fragment);
                return fragment;
            }
            return callback(null);
        }

        function resetPagination(key) {
            if (paginationState[key]) {
                paginationState[key].page = 1;
            }
        }

        function getPaginatedItems(items = [], key) {
            const state = paginationState[key];
            if (!state) {
                return { items, totalItems: items.length, totalPages: 1 };
            }

            const totalItems = items.length;
            const totalPages = totalItems === 0 ? 1 : Math.ceil(totalItems / state.pageSize);

            if (totalItems === 0) {
                state.page = 1;
                return { items: [], totalItems, totalPages };
            }

            if (state.page > totalPages) {
                state.page = totalPages;
            }
            if (state.page < 1) {
                state.page = 1;
            }

            const startIndex = (state.page - 1) * state.pageSize;
            const paginatedItems = items.slice(startIndex, startIndex + state.pageSize);
            return { items: paginatedItems, totalItems, totalPages };
        }

        function updatePaginationControls(key, totalItems, onPageChange) {
            const containerId = paginationContainers[key];
            const container = containerId ? document.getElementById(containerId) : null;
            const state = paginationState[key];

            if (!container || !state) return;

            const totalPages = totalItems === 0 ? 1 : Math.ceil(totalItems / state.pageSize);
            if (totalItems === 0) {
                state.page = 1;
            } else if (state.page > totalPages) {
                state.page = totalPages;
            }

            container.innerHTML = `
                <div class="pagination-info">
                    ${totalItems === 0 ? 'æš‚æ— æ•°æ®' : `å…± ${totalItems} æ¡ Â· ç¬¬ ${state.page} / ${totalPages} é¡µ`}
                </div>
                <div class="pagination-actions">
                    <button type="button" data-direction="prev" ${state.page <= 1 || totalItems === 0 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
                    <button type="button" data-direction="next" ${state.page >= totalPages || totalItems === 0 ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
                </div>
            `;

            container.querySelectorAll('button').forEach(btn => {
                // ä½¿ç”¨ bindFastTapï¼Œç¡®ä¿åˆ†é¡µåœ¨ç§»åŠ¨ç«¯é¦–æ¬¡ç‚¹å‡»å°±ç”Ÿæ•ˆ
                bindFastTap(btn, () => {
                    const direction = btn.getAttribute('data-direction');
                    if (direction === 'prev' && state.page > 1) {
                        state.page--;
                    } else if (direction === 'next' && state.page < totalPages) {
                        state.page++;
                    } else {
                        return;
                    }

                    if (typeof onPageChange === 'function') {
                        onPageChange();
                    }
                });
            });
        }

        // ========== æ•°æ®å­˜å‚¨ - å§‹ç»ˆä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ® ==========
        // æ³¨æ„:ä¸å†ä»localStorageåˆå§‹åŒ–æ•°æ®,è€Œæ˜¯åœ¨ç™»å½•åä»äº‘ç«¯åŒæ­¥
        // è¿™ç¡®ä¿ç”¨æˆ·å§‹ç»ˆè·å–æœ€æ–°çš„äº‘ç«¯æ•°æ®,é¿å…æœ¬åœ°ç¼“å­˜è¿‡æœŸé—®é¢˜

let products = [];  // äº§å“æ•°æ®å°†åœ¨ç™»å½•åä»äº‘ç«¯åŠ è½½
let userOrders = [];  // å½“å‰ç”¨æˆ·çš„è®¢å•æ•°æ®
let allOrders = [];  // æ‰€æœ‰ç”¨æˆ·çš„è®¢å•æ•°æ®ï¼ˆç”¨äºåå°ç®¡ç†ï¼‰
let userAddresses = [];  // åœ°å€æ•°æ®å°†åœ¨ç™»å½•åä»äº‘ç«¯åŠ è½½
let userProfile = {};  // ç”¨æˆ·èµ„æ–™å°†åœ¨ç™»å½•åä»äº‘ç«¯åŠ è½½
let allUsers = [];  // æ‰€æœ‰ç”¨æˆ·æ•°æ®(ä»…ç®¡ç†å‘˜ä½¿ç”¨,ä»äº‘ç«¯åŠ è½½)
// è®¾å¤‡æ³¨å†Œé™åˆ¶é…ç½®ï¼š{ deviceId: limit }ï¼Œé»˜è®¤é™åˆ¶ä¸º2
let deviceRegisterLimits = Storage.get('deviceRegisterLimits', {});
const DEFAULT_DEVICE_REGISTER_LIMIT = 2; // é»˜è®¤æ¯ä¸ªè®¾å¤‡æœ€å¤šæ³¨å†Œ2ä¸ªè´¦å·
let currentProduct = null;
let pendingSignupProduct = null; // è®°å½•å¾…é¢†å–çš„äº§å“ï¼ˆç”¨æˆ·ç™»å½•åéœ€è¦æ‰“å¼€æŠ¥åæ¨¡æ€æ¡†ï¼‰
let pendingSignupFormData = null; // è®°å½•ç”¨æˆ·å·²å¡«å†™çš„æŠ¥åè¡¨å•æ•°æ®
let shouldReturnToSignup = false; // æ·»åŠ åœ°å€åæ˜¯å¦éœ€è¦è¿”å›æŠ¥åè¡¨å•
let currentUser = Storage.get('currentUser', null);
const selectedUserAccounts = new Set(); // åå°ç”¨æˆ·æ‰¹é‡æ“ä½œé€‰æ‹©é›†åˆ
const selectedOrderIds = new Set(); // åå°è®¢å•æ‰¹é‡æ“ä½œé€‰æ‹©é›†åˆ
let userFilterRole = '';
let userFilterStatus = '';
let userDeviceFilter = '';
let userSearchTerm = '';
let userFilterRegisterDateStart = '';
let userFilterRegisterDateEnd = '';
let userFilterOnline = ''; // åœ¨çº¿çŠ¶æ€ç­›é€‰ï¼š'online' | 'offline' | ''
let orderFilterRegisterDateStart = '';
let orderFilterRegisterDateEnd = '';
let adminProductSearchTerm = '';
let reviewSearchTerm = '';
let userOnlineStatus = {}; // å­˜å‚¨ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼š{ account: true/false }
let reviewSearchCategory = 'all';
const paginationState = {
    products: { page: 1, pageSize: 30 },
    users: { page: 1, pageSize: 10 },
    orders: { page: 1, pageSize: 10 },
    reviews: { page: 1, pageSize: 10 }
};
const paginationContainers = {
    products: 'admin-products-pagination',
    users: 'admin-users-pagination',
    orders: 'admin-orders-pagination',
    reviews: 'admin-reviews-pagination'
};
        
        // åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
        function isCurrentUserAdmin() {
            return !!(currentUser && currentUser.role === 'admin');
        }

        function refreshCurrentUserSnapshot(targetAccount) {
            if (!currentUser || currentUser.role === 'admin') return;
            const account = targetAccount || currentUser.account;
            if (!account || !Array.isArray(allUsers) || allUsers.length === 0) return;
            const latestUser = findUserByAccount(account); // ä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æŸ¥æ‰¾
            if (!latestUser) return;
            
            // ä¿å­˜æ›´æ–°å‰çš„çŠ¶æ€ç”¨äºå¯¹æ¯”
            const previousStatus = currentUser.status;
            const previousPoints = currentUser.points;
            const previousUsername = currentUser.username;
            
            // æ›´æ–° currentUser å¯¹è±¡ï¼ˆä¿ç•™ roleï¼Œå› ä¸ºç®¡ç†å‘˜è´¦å·ä¸åœ¨ allUsers ä¸­ï¼‰
            currentUser = {
                ...currentUser,
                ...latestUser,
                role: currentUser.role || latestUser.role || 'user'
            };
            saveCurrentUser();
            
            // å¦‚æœçŠ¶æ€ã€ç§¯åˆ†æˆ–ç”¨æˆ·åå‘ç”Ÿå˜åŒ–ï¼Œè®°å½•æ—¥å¿—
            if (previousStatus !== latestUser.status) {
                console.log(`ğŸ”„ ç”¨æˆ·çŠ¶æ€å·²æ›´æ–°: ${previousStatus} -> ${latestUser.status}`);
            }
            if (previousPoints !== latestUser.points) {
                console.log(`ğŸ”„ ç”¨æˆ·ç§¯åˆ†å·²æ›´æ–°: ${previousPoints} -> ${latestUser.points}`);
            }
            if (previousUsername !== latestUser.username) {
                console.log(`ğŸ”„ ç”¨æˆ·åå·²æ›´æ–°: ${previousUsername} -> ${latestUser.username}`);
            }
        }

        // è¯­è¨€è®¾ç½®
        let currentLanguage = localStorage.getItem('language') || 'en';
        
        // è¯­è¨€åŒ…
        const translations = {
            zh: {
                // å¯¼èˆª
                'navHome': 'é¦–é¡µ',
                'admin': 'åå°ç®¡ç†',
                'userCenter': 'ç”¨æˆ·ä¸­å¿ƒ',
                'login': 'ç™»å½•',
                'register': 'æ³¨å†Œ',
                'logout': 'é€€å‡º',
                'searchPlaceholder': 'æœç´¢å•†å“...',
                // è´§å¸
                'currency': '$',
                'currencySymbol': '$',
                // é¦–é¡µ
                'featuredTitle': 'ç²¾é€‰å¥½ç‰©æ¨è',
                'featuredDesc': 'æˆ‘ä»¬å®æ—¶æŒ‘é€‰çƒ­åº¦æœ€é«˜çš„å•†å“ï¼Œå¹¶æä¾›ä¸“å±é¢†å–é€šé“ï¼Œç‚¹å‡»å³å¯å¿«é€ŸæŸ¥çœ‹è¯¦æƒ…ã€‚',
                'newArrival': 'æ–°å“ä¸Šå¸‚',
                'newArrivalDesc': 'æ¢ç´¢æˆ‘ä»¬æœ€æ–°çš„äº§å“ç³»åˆ—ï¼Œäº«å—é™æ—¶ä¼˜æƒ ',
                'limitedOffer': 'é™æ—¶ç‰¹æƒ ',
                'limitedOfferDesc': 'ç²¾é€‰å•†å“ä½è‡³5æŠ˜ï¼Œé”™è¿‡å†ç­‰ä¸€å¹´',
                'buyNow': 'ç«‹å³è´­ä¹°',
                'viewDetails': 'æŸ¥çœ‹è¯¦æƒ…',
                'viewDetail': 'ç‚¹å‡»è¯¦æƒ…',
                'claimNow': 'ç‚¹å‡»é¢†å–',
                'getItNow': 'ç«‹å³è·å–',
                'stock': 'åº“å­˜',
                'pieces': 'ä»¶',
                'noProducts': 'æš‚æ— å•†å“',
                'registerNow': 'ç«‹å³æŠ¥å',
                'returnToList': 'è¿”å›åˆ—è¡¨',
                // åˆ†ç±»
                'allProducts': 'All Products',
                'electronics': 'Electronics',
                'home': 'Home & Living',
                'clothing': 'Clothing & Shoes',
                'beauty': 'Beauty & Skincare',
                // è®¢å•çŠ¶æ€
                'orderAll': 'å…¨éƒ¨è®¢å•',
                'orderReview': 'å¾…ä¸Šä¼ ',
                'orderShipping': 'è¿è¾“ä¸­',
                'orderRejected': 'å·²é©³å›',
                'orderCancelled': 'å·²å–æ¶ˆ',
                'orderCompleted': 'å·²å®Œæˆ',
                'noOrders': 'æš‚æ— æŠ¥åè®°å½•',
                'noReviewOrders': 'æš‚æ— å¾…ä¸Šä¼ è®¢å•',
                'noShippingOrders': 'æš‚æ— è¿è¾“ä¸­è®¢å•',
                'noCompletedOrders': 'æš‚æ— å·²å®Œæˆè®¢å•',
                'noRejectedOrders': 'æš‚æ— å·²é©³å›è®¢å•',
                'noCancelledOrders': 'æš‚æ— å·²å–æ¶ˆè®¢å•',
                'cancelOrder': 'å–æ¶ˆè®¢å•',
                'confirmOrderAgain': 'å†æ¬¡ç¡®è®¤è®¢å•',
                'confirmCancelOrder': 'ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ',
                'orderCancelled': 'è®¢å•å·²å–æ¶ˆ',
                // è®¢å•è¯¦æƒ…
                'orderDetails': 'è®¢å•è¯¦æƒ…',
                'orderId': 'è®¢å•ID',
                'orderStatus': 'è®¢å•çŠ¶æ€',
                'allStatus': 'å…¨éƒ¨çŠ¶æ€',
                'orderTime': 'ä¸‹å•æ—¶é—´',
                'trackingNumber': 'å¿«é€’å•å·',
                'trackingNumberPlaceholder': 'è¯·è¾“å…¥å¿«é€’å•å·',
                'trackingNumberInfo': 'æ‚¨å¯ä»¥é€šè¿‡å¿«é€’å•å·åœ¨å¿«é€’å…¬å¸å®˜ç½‘æŸ¥è¯¢ç‰©æµä¿¡æ¯',
                'trackPackage': 'Track package',
                'notFilled': 'æœªå¡«å†™',
                'save': 'ä¿å­˜',
                'edit': 'ç¼–è¾‘',
                'copy': 'å¤åˆ¶',
                'copyOrderId': 'å¤åˆ¶è®¢å•å·',
                'orderIdCopied': 'è®¢å•å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
                'customerInfo': 'å®¢æˆ·ä¿¡æ¯',
                'expressInfo': 'å¿«é€’ä¿¡æ¯',
                'trackingNumberSaved': 'å¿«é€’å•å·å·²ä¿å­˜',
                'trackingNumberUpdated': 'å¿«é€’å•å·å·²æ›´æ–°',
                'enterTrackingNumber': 'è¯·è¾“å…¥å¿«é€’å•å·ï¼š',
                'updateOrderStatus': 'æ›´æ–°è®¢å•çŠ¶æ€',
                'noTrackingInfo': 'æš‚æ— ç‰©æµä¿¡æ¯',
                'orderInfo': 'è®¢å•ä¿¡æ¯',
                'currentStatus': 'å½“å‰çŠ¶æ€',
                'selectNewStatus': 'é€‰æ‹©æ–°çŠ¶æ€',
                'confirmStatusUpdate': 'ç¡®å®šè¦å°†è®¢å•çŠ¶æ€æ›´æ–°ä¸º',
                'statusUpdated': 'è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º',
                'price': 'ä»·æ ¼',
                'orderNotFound': 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯',
                // ç”¨æˆ·ä¸­å¿ƒ
                'myOrders': 'æˆ‘çš„æŠ¥å',
                'profile': 'ä¸ªäººä¿¡æ¯',
                'address': 'æ”¶è´§åœ°å€',
                'security': 'è´¦æˆ·å®‰å…¨',
                'regularMember': 'æ™®é€šä¼šå‘˜',
                'points': 'èœœç½',
                'pointsBalance': 'å½“å‰èœœç½',
                'pointsNotEnoughForClaim': 'æ‚¨çš„èœœç½ä¸è¶³ï¼Œæ— æ³•é¢†å–æ–°äº§å“ã€‚è¯·å®Œæˆè¯„ä»·ä»¥è·å–æ›´å¤šèœœç½ã€‚',
                'pointsNotEnoughForSubmit': 'æ‚¨çš„èœœç½ä¸è¶³ï¼Œæ— æ³•å®Œæˆæœ¬æ¬¡é¢†å–ã€‚è¯·å®Œæˆè¯„ä»·ä»¥è·å–æ›´å¤šèœœç½ã€‚',
                'pointsClaimUsed': 'æœ¬æ¬¡é¢†å–å·²æ¶ˆè€— 1 ä¸ªèœœç½',
                'pointsReviewReward': 'è¯„ä»·å¥–åŠ±ï¼šèœœç½ +2',
                'duplicateClaimNotAllowed': 'æ‚¨å·²ç»é¢†å–è¿‡è¯¥å•†å“ï¼Œä¸èƒ½é‡å¤é¢†å–ã€‚',
                'productAlreadyClaimed': 'è¿™ä¸ªäº§å“å·²ç»é¢†å–è¿‡å•¦ï¼Œå¿«å»çœ‹çœ‹å…¶å®ƒå¥½ç‰©å§ï¼',
                'deviceRegisterLimitReached': 'å·²ç»æœ‰è´¦æˆ·å•¦ï¼Œå¿«å»ç™»å½•è´¦æˆ·é¢†å–å¥½ç‰©å§ï¼',
                'username': 'ç”¨æˆ·å',
                'account': 'è´¦å·',
                'nickname': 'æ˜µç§°',
                'enterNickname': 'è¯·è¾“å…¥æ˜µç§°',
                'enterPhone': 'è¯·è¾“å…¥æ‰‹æœºå·',
                'usPhoneHint': 'è¯·è¾“å…¥ç¾å›½æ‰‹æœºå·ï¼ˆ+1å¼€å¤´çš„10ä½æ•°å­—ï¼‰',
                'email': 'é‚®ç®±',
                'enterEmail': 'è¯·è¾“å…¥é‚®ç®±',
                'birthday': 'ç”Ÿæ—¥',
                'gender': 'æ€§åˆ«',
                'pleaseSelect': 'è¯·é€‰æ‹©',
                'male': 'ç”·',
                'female': 'å¥³',
                'other': 'å…¶ä»–',
                'saveChanges': 'ä¿å­˜ä¿®æ”¹',
                'changePassword': 'ä¿®æ”¹å¯†ç ',
                'currentPassword': 'å½“å‰å¯†ç ',
                'enterCurrentPassword': 'è¯·è¾“å…¥å½“å‰å¯†ç ',
                'newPassword': 'æ–°å¯†ç ',
                'enterNewPassword': 'è¯·è¾“å…¥æ–°å¯†ç ',
                'confirmNewPassword': 'ç¡®è®¤æ–°å¯†ç ',
                'enterNewPasswordAgain': 'è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ',
                'securitySettings': 'å®‰å…¨è®¾ç½®',
                'loginProtection': 'ç™»å½•ä¿æŠ¤',
                'loginProtectionDesc': 'å¼€å¯åï¼Œç™»å½•æ—¶éœ€è¦éªŒè¯æ‰‹æœºå·',
                // åœ°å€
                'yourAddresses': 'æ”¶è´§åœ°å€',
                'addAddress': 'æ·»åŠ åœ°å€',
                'goToAddressPage': 'å‰å¾€ç”¨æˆ·ä¸­å¿ƒæ·»åŠ åœ°å€',
                'noAddresses': 'æš‚æ— æ”¶è´§åœ°å€',
                // å…¶ä»–
                'loading': 'æ­£åœ¨åŠ è½½æ•°æ®ï¼Œè¯·ç¨å€™...',
                'loadComplete': 'åŠ è½½å®Œæˆï¼',
                'syncStatus': 'å®æ—¶åˆ·æ–° Â· äº‘ç«¯åŒæ­¥',
                // äº§å“æŠ¥å
                'productRegistration': 'äº§å“æŠ¥å',
                'registeredProduct': 'æŠ¥åäº§å“',
                'name': 'å§“å',
                'phone': 'ç”µè¯',
                'email': 'é‚®ç®±',
                'address': 'åœ°å€',
                'notes': 'å¤‡æ³¨',
                'notesPlaceholder': 'è¯·è¾“å…¥æ‚¨çš„ç‰¹æ®Šéœ€æ±‚æˆ–å¤‡æ³¨',
                'submitRegistration': 'æäº¤æŠ¥å',
                'cancel': 'å–æ¶ˆ',
                // æç¤ºä¿¡æ¯
                'pleaseLogin': 'è¯·å…ˆç™»å½•',
                'passwordChangedSuccess': 'å¯†ç ä¿®æ”¹æˆåŠŸï¼è¯·ç‰¢è®°æ–°å¯†ç ',
                'currentPasswordIncorrect': 'å½“å‰å¯†ç é”™è¯¯',
                'passwordMismatch': 'ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´',
                'passwordTooShort': 'æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½',
                'pleaseFillAllFields': 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯',
                'adminPasswordCannotChange': 'ç®¡ç†å‘˜å¯†ç ä¸å…è®¸ä¿®æ”¹ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜',
                'userNotFound': 'æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯',
                'userLogin': 'ç”¨æˆ·ç™»å½•',
                'userRegister': 'ç”¨æˆ·æ³¨å†Œ',
                'phoneOrEmail': 'æ‰‹æœºå·æˆ–é‚®ç®±',
                'enterPhoneOrEmail': 'è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±',
                'password': 'å¯†ç ',
                'enterPassword': 'è¯·è¾“å…¥å¯†ç ',
                'confirmPassword': 'ç¡®è®¤å¯†ç ',
                'enterPasswordAgain': 'è¯·å†æ¬¡è¾“å…¥å¯†ç ',
                'pleaseLoginOrRegister': 'è¯·å…ˆç™»å½•æˆ–æ³¨å†Œ',
                'loginRequired': 'é¢†å–äº§å“éœ€è¦ç™»å½•è´¦å·ï¼Œè¯·é€‰æ‹©ï¼š',
                'haveAccount': 'å·²æœ‰è´¦å·ï¼Œç«‹å³ç™»å½•',
                'noAccount': 'æ²¡æœ‰è´¦å·ï¼Œç«‹å³æ³¨å†Œ',
                'insufficientPermissions': 'æƒé™ä¸è¶³ï¼Œåªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®åå°ç®¡ç†',
                'pleaseFillCompleteInfo': 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯',
                'passwordMismatch': 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼',
                'passwordTooShort': 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½',
                'registrationSuccess': 'æ³¨å†ŒæˆåŠŸï¼',
                'accountOrPasswordError': 'è´¦å·æˆ–å¯†ç é”™è¯¯ï¼',
                'productNameRequired': 'äº§å“åç§°ä¸èƒ½ä¸ºç©º',
                'productPriceRequired': 'è¯·è¾“å…¥æœ‰æ•ˆçš„äº§å“ä»·æ ¼ï¼ˆå¿…é¡»å¤§äº0ï¼‰',
                'productImageRequired': 'äº§å“å›¾ç‰‡URLä¸èƒ½ä¸ºç©º',
                'productAddFailed': 'äº§å“æ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•',
                'productNotFound': 'äº§å“ä¸å­˜åœ¨',
                'productUpdateSuccess': 'âœ… äº§å“æ›´æ–°æˆåŠŸï¼',
                'productUpdateFailed': 'âŒ æ›´æ–°å¤±è´¥ï¼šæœªæ‰¾åˆ°äº§å“',
                'systemError': 'ç³»ç»Ÿé”™è¯¯ï¼šæœªæ‰¾åˆ°äº§å“ä¿¡æ¯',
                'errorTitle': 'é”™è¯¯',
                'successTitle': 'æˆåŠŸ',
                'infoTitle': 'æç¤º',
                'confirmTitle': 'ç¡®è®¤',
                'profileSaveSuccess': 'ä¸ªäººä¿¡æ¯ä¿å­˜æˆåŠŸï¼',
                'pleaseUploadExcel': 'è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼ˆ.xlsx æˆ– .xls æ ¼å¼ï¼‰',
                'invalidPhoneFormat': 'è¯·è¾“å…¥æ­£ç¡®çš„ç¾å›½æ‰‹æœºå·ï¼ˆ+1å¼€å¤´çš„10ä½æ•°å­—ï¼‰',
                'invalidEmailFormat': 'è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼',
                'importDataSaveError': 'âŒ å¯¼å…¥å¤±è´¥ï¼šæ•°æ®ä¿å­˜å‡ºé”™',
                'confirmLoadDemo': 'ç¡®å®šè¦åŠ è½½æ¼”ç¤ºäº§å“æ•°æ®å—ï¼Ÿè¿™å°†æ·»åŠ 6ä¸ªæ¼”ç¤ºäº§å“ã€‚',
                'confirmClearCache': 'ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°ç¼“å­˜æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼',
                'confirmClearCloud': 'ç¡®å®šè¦æ¸…ç©ºäº‘ç«¯æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼',
                'cannotBeNegative': 'ä¸èƒ½ä¸ºè´Ÿæ•°',
                // è¯„ä»·
                'writeReview': 'å†™è¯„ä»·',
                'myReview': 'æˆ‘çš„è¯„ä»·',
                'reviews': 'è¯„ä»·',
                'noReviews': 'æš‚æ— è¯„ä»·',
                'rating': 'è¯„åˆ†',
                'comment': 'è¯„ä»·å†…å®¹',
                'commentPlaceholder': 'è¯·åˆ†äº«æ‚¨å¯¹äº§å“çš„ä½¿ç”¨ä½“éªŒ...',
                'submitReview': 'æäº¤è¯„ä»·',
                'reviewSubmitted': 'è¯„ä»·å·²æäº¤ï¼Œæ„Ÿè°¢æ‚¨çš„åé¦ˆï¼',
                'reviewThankYou': 'æ„Ÿè°¢æ‚¨åœ¨ BeeFreebies ç•™ä¸‹è¯„ä»·ï¼æˆ‘ä»¬éå¸¸æ„Ÿæ¿€ã€‚',
                'reply': 'å›å¤',
                'replyPlaceholder': 'è¯·è¾“å…¥æ‚¨çš„å›å¤å†…å®¹',
                'replySuccess': 'å›å¤å·²æäº¤',
                'reviewExists': 'æ‚¨å·²ç»è¯„ä»·è¿‡æ­¤è®¢å•äº†',
                'reviewTime': 'è¯„ä»·æ—¶é—´',
                'adminReply': 'ç®¡ç†å‘˜å›å¤',
                'replyReview': 'å›å¤è¯„ä»·',
                'deleteReview': 'åˆ é™¤è¯„ä»·',
                'deleteOrder': 'åˆ é™¤è®¢å•',
                'customerReplies': 'ç”¨æˆ·å›å¤',
                'purchasedProduct': 'è´­ä¹°å•†å“',
                'customerName': 'å®¢æˆ·',
                'stars': 'æ˜Ÿ',
                'reviewRequired': 'è¯·å¡«å†™è¯„ä»·å†…å®¹',
                'ratingRequired': 'è¯·é€‰æ‹©è¯„åˆ†',
                'ok': 'ç¡®å®š',
                'cancel': 'å–æ¶ˆ',
                'confirm': 'ç¡®è®¤',
                'noticeTitle': 'æç¤º',
                'outOfHoneyTitle': 'èœœç½ä¸è¶³',
                'balance': 'ä½™é¢',
                'writeReviewToEarnHoney': 'å®Œæˆè¯„ä»·å¯è·å¾—èœœç½ã€‚',
                'contactSupportForHelp': 'è”ç³»æ”¯æŒè·å–å¸®åŠ©ã€‚',
                'honey': 'èœœç½',
                // ç™»å½•/æ³¨å†Œç›¸å…³
                'accountNotExists': 'è´¦å·ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥è´¦å·æ˜¯å¦æ­£ç¡®æˆ–å…ˆæ³¨å†Œ',
                'accountExists': 'è´¦å·å·²å­˜åœ¨',
                'accountDisabled': 'è´¦å·è¢«ç¦ç”¨',
                'loginFailed': 'ç™»å½•å¤±è´¥',
                'loginFailedRetry': 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
                'registerFailed': 'æ³¨å†Œå¤±è´¥',
                'registerFailedRetry': 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
                'pleaseEnterAccount': 'è¯·è¾“å…¥è´¦å·',
                'accountMinLength': 'è´¦å·é•¿åº¦è‡³å°‘ä¸º3ä¸ªå­—ç¬¦',
                'pleaseConfirmPassword': 'è¯·ç¡®è®¤å¯†ç ',
                'passwordMinLength': 'å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä¸ªå­—ç¬¦',
                'passwordMismatchRetry': 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°è¾“å…¥',
                'passwordFormatError': 'å¯†ç åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦(@$!%*#?&)ï¼Œé•¿åº¦è‡³å°‘6ä½',
                'pleaseEnterAtLeastOneImage': 'è¯·è‡³å°‘è¾“å…¥ä¸€å¼ äº§å“å›¾ç‰‡URL',
                'deleteFailedProductNotFound': 'åˆ é™¤å¤±è´¥ï¼šæœªæ‰¾åˆ°å¯¹åº”äº§å“æ•°æ®',
                'confirmDeleteProduct': 'ç¡®å®šè¦åˆ é™¤äº§å“ "{name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼',
                'productDataError': 'äº§å“æ•°æ®é”™è¯¯',
                'noProductDataDetected': 'æœªæ£€æµ‹åˆ°å¯å¯¼å…¥çš„äº§å“æ•°æ®ï¼Œè¯·æ£€æŸ¥è¡¨å¤´æ˜¯å¦åŒ…å«"äº§å“åç§°"å’Œ"å›¾ç‰‡URL"ã€‚',
                'parseFailed': 'è§£æå¤±è´¥',
                'checkExcelFormat': 'è¯·æ£€æŸ¥Excelæ ¼å¼åé‡è¯•',
                'readFailed': 'è¯»å–å¤±è´¥',
                'fileReadError': 'æ–‡ä»¶è¯»å–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚',
                // ç”¨æˆ·ç®¡ç†ç›¸å…³
                'confirmResetUserData': 'ç¡®å®šè¦é‡ç½®æ­¤ç”¨æˆ·çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤ç”¨æˆ·çš„è®¢å•ã€åœ°å€ç­‰ä¿¡æ¯ï¼',
                'userDataReset': 'ç”¨æˆ·æ•°æ®å·²é‡ç½®',
                'confirmBanUser': 'ç¡®å®šè¦ç¦ç”¨æ­¤ç”¨æˆ·å—ï¼Ÿç¦ç”¨åè¯¥ç”¨æˆ·å°†æ— æ³•ç™»å½•ç³»ç»Ÿã€‚',
                'userBanned': 'ç”¨æˆ·å·²ç¦ç”¨',
                'confirmUnbanUser': 'ç¡®å®šè¦è§£ç¦æ­¤ç”¨æˆ·å—ï¼Ÿ',
                'userUnbanned': 'ç”¨æˆ·å·²è§£ç¦',
                'userNotExists': 'ç”¨æˆ·ä¸å­˜åœ¨',
                'confirmDeleteUser': 'âš ï¸ è­¦å‘Šï¼šæ‚¨å³å°†å½»åº•åˆ é™¤ç”¨æˆ·è´¦å·ï¼\n\nç”¨æˆ·ä¿¡æ¯ï¼š\nè´¦å·ï¼š{account}\nç”¨æˆ·åï¼š{username}\næ³¨å†Œæ—¶é—´ï¼š{registerTime}\n\næ­¤æ“ä½œå°†åˆ é™¤ï¼š\nâœ“ ç”¨æˆ·è´¦å·\nâœ“ æ‰€æœ‰è®¢å•è®°å½•\nâœ“ æ”¶è´§åœ°å€\nâœ“ ä¸ªäººèµ„æ–™\n\nâš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ',
                'finalConfirmDelete': 'æœ€åç¡®è®¤ï¼šè¯·è¾“å…¥ç”¨æˆ·è´¦å· "{account}" ä»¥ç¡®è®¤åˆ é™¤\n\nâš ï¸ è¾“å…¥é”™è¯¯å°†å–æ¶ˆåˆ é™¤æ“ä½œ',
                'accountInputMismatch': 'è´¦å·è¾“å…¥ä¸åŒ¹é…ï¼Œåˆ é™¤æ“ä½œå·²å–æ¶ˆ',
                'userDeletedSuccess': 'âœ… ç”¨æˆ·è´¦å· "{account}" åŠæ‰€æœ‰ç›¸å…³æ•°æ®å·²å½»åº•åˆ é™¤\nåˆ é™¤äº† {orders} ä¸ªè®¢å•å’Œ {addresses} ä¸ªåœ°å€',
                'deleteUserFailed': 'åˆ é™¤ç”¨æˆ·å¤±è´¥',
                'accountDeletedByAdmin': 'æ‚¨çš„è´¦å·å·²è¢«ç®¡ç†å‘˜åˆ é™¤',
                'loggedOutByOtherDevice': 'ä½ çš„è´¦å·å·²åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œæœ¬è®¾å¤‡çš„æ•°æ®å·²åŒæ­¥è‡³äº‘ç«¯å¹¶è‡ªåŠ¨é€€å‡ºã€‚',
                'pleaseSelectAccountsToDelete': 'è¯·å…ˆå‹¾é€‰è¦åˆ é™¤çš„è´¦å·',
                'confirmDeleteSelectedAccounts': 'ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ {count} ä¸ªè´¦å·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚',
                'deletingAccounts': 'æ­£åœ¨æ‰¹é‡åˆ é™¤è´¦å·ï¼Œè¯·ç¨å€™...',
                'batchDeleteComplete': 'æ‰¹é‡åˆ é™¤å®Œæˆ',
                'pleaseLoginBeforeDeletion': 'è¯·å…ˆç™»å½•åå†è¿›è¡Œè´¦å·æ³¨é”€',
                'confirmDeleteSelfAccount': 'ç¡®å®šè¦æ³¨é”€å½“å‰è´¦å·å—ï¼Ÿè¯¥æ“ä½œä¼šåˆ é™¤æ‰€æœ‰è®¢å•ã€åœ°å€ä¸ä¸ªäººèµ„æ–™ï¼Œä¸”æ— æ³•æ¢å¤ã€‚',
                'finalConfirmDeleteSelf': 'è¯·è¾“å…¥è´¦å· "{account}" ä»¥ç¡®è®¤æ³¨é”€',
                'accountInputMismatchCancel': 'è´¦å·è¾“å…¥ä¸åŒ¹é…ï¼Œæ“ä½œå·²å–æ¶ˆ',
                'accountDeletedSuccess': 'è´¦å·å·²æˆåŠŸæ³¨é”€',
                'deleteAccountFailed': 'æ³¨é”€å¤±è´¥',
                // è®¢å•ç®¡ç†ç›¸å…³
                'noOrdersToDelete': 'æœªæ‰¾åˆ°è¦åˆ é™¤çš„è®¢å•',
                'confirmDeleteSelectedOrders': 'ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ {count} ä¸ªè®¢å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚',
                'confirmDeleteOrder': 'ç¡®å®šè¦åˆ é™¤è®¢å• {orderLabel} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚',
                'confirmDeleteReview': 'ç¡®å®šè¦åˆ é™¤è¯¥æ¡è¯„ä»·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚',
                // äº§å“ç®¡ç†ç›¸å…³
                'confirmDeleteSelectedProducts': 'ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹ {count} ä¸ªäº§å“å—ï¼Ÿ\n\n{productNames}\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼',
                // è½®æ’­å›¾ç›¸å…³
                'confirmDeleteCarousel': 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ª{targetLabel}è½®æ’­å›¾å—ï¼Ÿ',
                'confirmResetHomepageSettings': 'ç¡®å®šè¦é‡ç½®æ‰€æœ‰ä¸»é¡µè®¾ç½®å—ï¼Ÿè¿™å°†æ¢å¤é»˜è®¤é…ç½®ã€‚',
                // åŠ è½½æç¤º
                'checkingURLSync': 'æ£€æŸ¥URLåŒæ­¥æ•°æ®...',
                'initializingCloudSync': 'åˆå§‹åŒ–äº‘ç«¯åŒæ­¥...',
                'connectingCloudDatabase': 'è¿æ¥äº‘ç«¯æ•°æ®åº“...',
                'loadingCloudData': 'åŠ è½½äº‘ç«¯æ•°æ®...',
                'cloudSyncTimeout': 'äº‘ç«¯åŒæ­¥è¶…æ—¶...',
                'firebaseNotLoaded': 'FirebaseæœªåŠ è½½...',
                'renderingPage': 'æ¸²æŸ“é¡µé¢å†…å®¹...',
                'loadFailed': 'åŠ è½½å¤±è´¥',
                'testing': 'æµ‹è¯•ä¸­...',
                'statusConnected': 'çŠ¶æ€ï¼šè¿æ¥æ­£å¸¸',
                'statusDisconnected': 'çŠ¶æ€ï¼šæœªè¿æ¥',
                'statusConnectionFailed': 'çŠ¶æ€ï¼šè¿æ¥å¤±è´¥',
                'testCloudConnection': 'æµ‹è¯•äº‘ç«¯è¿æ¥',
                'syncing': 'åŒæ­¥ä¸­...',
                'forceSyncData': 'å¼ºåˆ¶åŒæ­¥æ•°æ®',
                'clearingCloudUsers': 'æ­£åœ¨æ¸…ç†äº‘ç«¯ users...',
                'testingConnection': 'æ­£åœ¨æµ‹è¯•...',
                'connectionSuccess': 'è¿æ¥æˆåŠŸ',
                'cannotReadLocalData': 'æ— æ³•è¯»å–æœ¬åœ°æ•°æ®',
                'logCleared': 'æ—¥å¿—å·²æ¸…ç©º',
                'pleaseSelectAddress': 'è¯·é€‰æ‹©åœ°å€',
                'noUserData': 'æš‚æ— ç”¨æˆ·æ•°æ®',
                'noMatchingUsers': 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·',
                'noOrderData': 'æš‚æ— è®¢å•æ•°æ®',
                'noReviewData': 'æš‚æ— è¯„ä»·æ•°æ®',
                'systemDefaultPassword': 'ç³»ç»Ÿé¢„è®¾å¯†ç ',
                'hidePassword': 'éšè—å¯†ç ',
                'showPassword': 'æ˜¾ç¤ºå¯†ç ',
                'operationFailed': 'æ“ä½œå¤±è´¥',
                'noCarouselPC': 'æš‚æ— PCç«¯è½®æ’­å›¾',
                'noCarouselMobile': 'æš‚æ— ç§»åŠ¨ç«¯è½®æ’­å›¾',
                'noProductsAddOrImport': 'æš‚æ— å•†å“ï¼Œè¯·æ·»åŠ æˆ–å¯¼å…¥å•†å“',
                'batchEdit': 'æ‰¹é‡ç¼–è¾‘',
                'batchDelete': 'æ‰¹é‡åˆ é™¤',
                'lastSync': 'ä¸Šæ¬¡åŒæ­¥ï¼š{timeAgo}',
                'waitingFirstSync': 'ç­‰å¾…é¦–æ¬¡åŒæ­¥...',
                'cloudSyncNotEnabled': 'äº‘ç«¯åŒæ­¥æœªå¯ç”¨',
                'editCarouselPC': 'ç¼–è¾‘PCç«¯è½®æ’­å›¾',
                'editCarouselMobile': 'ç¼–è¾‘ç§»åŠ¨ç«¯è½®æ’­å›¾',
                'addCarouselPC': 'æ·»åŠ PCç«¯è½®æ’­å›¾',
                'addCarouselMobile': 'æ·»åŠ ç§»åŠ¨ç«¯è½®æ’­å›¾',
                'editProduct': 'ç¼–è¾‘äº§å“',
                'addProduct': 'æ·»åŠ äº§å“',
                'confirmLoadDemoData': 'ç¡®è®¤åŠ è½½ç¤ºä¾‹æ•°æ®',
                'confirmClearCache': 'ç¡®è®¤æ¸…é™¤ç¼“å­˜',
                // æ•°æ®åº“å¤‡ä»½æ¢å¤ç›¸å…³
                'databaseBackupFailed': 'æ•°æ®åº“å¤‡ä»½å¤±è´¥ï¼š{error}',
                'pleaseUploadJSONFile': 'è¯·ä¸Šä¼ JSONæ ¼å¼çš„å¤‡ä»½æ–‡ä»¶',
                'databaseRestoredSuccess': 'æ•°æ®åº“å·²æˆåŠŸæ¢å¤ï¼',
                'databaseRestoreFailed': 'æ•°æ®åº“æ¢å¤å¤±è´¥ï¼š{error}',
                'dataRestoreFailed': 'æ•°æ®æ¢å¤å¤±è´¥ï¼Œé¡µé¢å¯èƒ½éœ€è¦åˆ·æ–°',
                'readBackupFileFailed': 'è¯»å–å¤‡ä»½æ–‡ä»¶å¤±è´¥ï¼š{error}',
                'readFileFailed': 'è¯»å–æ–‡ä»¶å¤±è´¥',
                // äº‘ç«¯åŒæ­¥ç›¸å…³
                'cloudSyncNotEnabledError': 'äº‘ç«¯åŒæ­¥æœªå¯ç”¨ï¼Œæ— æ³•æ“ä½œäº‘ç«¯ç”¨æˆ·æ•°æ®',
                'onlyAdminCanOperate': 'åªæœ‰ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œ',
                'cloudAllUsersEmpty': 'äº‘ç«¯ allUsers ä¸ºç©ºï¼Œå‡ºäºå®‰å…¨è€ƒè™‘å·²è·³è¿‡ users æ¸…ç†ã€‚',
                'clearCloudUsersFailed': 'æ¸…ç†äº‘ç«¯ users å¤±è´¥ï¼š{error}',
                // ç”¨æˆ·ç®¡ç†ç›¸å…³
                'enterNewPassword': 'è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ï¼š',
                'passwordTooShortError': 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½',
                // è®¢å•çŠ¶æ€ç›¸å…³
                'confirmStatusUpdateSuffix': 'å—ï¼Ÿ',
                'updatingOrderStatus': 'æ­£åœ¨æ›´æ–°è®¢å•çŠ¶æ€å¹¶åŒæ­¥åˆ°äº‘ç«¯...',
                // äº§å“ç®¡ç†ç›¸å…³
                'pleaseFillAllRequiredFields': 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ',
                'carouselUpdated': 'è½®æ’­å›¾å·²æ›´æ–°',
                'mobileCarouselAdded': 'ç§»åŠ¨ç«¯è½®æ’­å›¾å·²æ·»åŠ ',
                'pcCarouselAdded': 'PCç«¯è½®æ’­å›¾å·²æ·»åŠ ',
                'pleaseEnterProductName': 'è¯·è¾“å…¥äº§å“åç§°',
                'pleaseEnterValidPrice': 'è¯·è¾“å…¥æœ‰æ•ˆçš„äº§å“ä»·æ ¼',
                'productUpdated': 'äº§å“å·²æ›´æ–°',
                'productUpdateFailedError': 'äº§å“æ›´æ–°å¤±è´¥',
                'productAddedSuccess': 'äº§å“æ·»åŠ æˆåŠŸï¼ID: {id}',
                'productAddFailedError': 'äº§å“æ·»åŠ å¤±è´¥',
                'replyContentCannotBeEmpty': 'å›å¤å†…å®¹ä¸èƒ½ä¸ºç©º',
                'reviewNotFound': 'æœªæ‰¾åˆ°è¯¥è®¢å•å¯¹åº”çš„è¯„ä»·',
                'passwordIncorrect': 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥',
                'importProductsSuccess': 'æˆåŠŸå¯¼å…¥ {count} ä¸ªäº§å“ï¼'
            },
            en: {
                // å¯¼èˆª
                'navHome': 'Home',
                'admin': 'Admin Panel',
                'userCenter': 'Account',
                'login': 'Login',
                'register': 'Register',
                'logout': 'Logout',
                'searchPlaceholder': 'Search products...',
                // è´§å¸
                'currency': '$',
                'currencySymbol': '$',
                // é¦–é¡µ
                'featuredTitle': 'Featured Recommendations',
                'featuredDesc': 'We select the hottest products in real-time and provide exclusive claim channels. Click to view details quickly.',
                'newArrival': 'New Arrivals',
                'newArrivalDesc': 'Explore our latest product series and enjoy limited-time offers',
                'limitedOffer': 'Limited Time Offer',
                'limitedOfferDesc': 'Selected items up to 50% off, don\'t miss out',
                'buyNow': 'Buy Now',
                'viewDetails': 'View Details',
                'viewDetail': 'View Details',
                'claimNow': 'Claim Now',
                'getItNow': 'Get it now',
                'stock': 'Stock',
                'pieces': 'pieces',
                'noProducts': 'No products available',
                'registerNow': 'Register Now',
                'returnToList': 'Return to List',
                // åˆ†ç±»
                'allProducts': 'All Products',
                'electronics': 'Electronics',
                'home': 'Home & Living',
                'clothing': 'Clothing & Shoes',
                'beauty': 'Beauty & Skincare',
                // è®¢å•çŠ¶æ€
                'orderAll': 'All Orders',
                'orderReview': 'Pending',
                'orderShipping': 'Shipping',
                'orderRejected': 'Rejected',
                'orderCancelled': 'Cancelled',
                'orderCompleted': 'Completed',
                'noOrders': 'No orders yet',
                'noReviewOrders': 'No pending orders',
                'noShippingOrders': 'No shipping orders',
                'noCompletedOrders': 'No completed orders',
                'noRejectedOrders': 'No rejected orders',
                'noCancelledOrders': 'No cancelled orders',
                'cancelOrder': 'Cancel Order',
                'confirmOrderAgain': 'Confirm the order again',
                'confirmCancelOrder': 'Are you sure you want to cancel this order?',
                'orderCancelled': 'Order cancelled',
                // è®¢å•è¯¦æƒ…
                'orderDetails': 'Order Details',
                'orderId': 'Order ID',
                'orderStatus': 'Order Status',
                'allStatus': 'All Status',
                'orderTime': 'Order Time',
                'trackingNumber': 'Tracking Number',
                'trackingNumberPlaceholder': 'Please enter tracking number',
                'trackingNumberInfo': 'You can query logistics information on the express company\'s official website using the tracking number',
                'trackPackage': 'Track package',
                'notFilled': 'Not filled',
                'save': 'Save',
                'edit': 'Edit',
                'copy': 'Copy',
                'copyOrderId': 'Copy Order ID',
                'orderIdCopied': 'Order ID copied to clipboard',
                'customerInfo': 'Customer Information',
                'expressInfo': 'Express Information',
                'trackingNumberSaved': 'Tracking number saved',
                'trackingNumberUpdated': 'Tracking number updated',
                'enterTrackingNumber': 'Please enter tracking number:',
                'updateOrderStatus': 'Update Order Status',
                'noTrackingInfo': 'No tracking information',
                'orderInfo': 'Order Information',
                'currentStatus': 'Current Status',
                'selectNewStatus': 'Select New Status',
                'confirmStatusUpdate': 'Are you sure you want to update the order status to',
                'statusUpdated': 'Order status updated to',
                'price': 'Price',
                'orderNotFound': 'Order not found',
                // ç”¨æˆ·ä¸­å¿ƒ
                'myOrders': 'My Orders',
                'profile': 'Profile',
                'address': 'Shipping Address',
                'security': 'Account Security',
                'regularMember': 'Regular Member',
                'points': 'Honey',
                'pointsBalance': 'Honey Balance',
                'pointsNotEnoughForClaim': 'You do not have enough honey to claim a new product. Please complete a review to earn more honey.',
                'pointsNotEnoughForSubmit': 'You do not have enough honey to complete this claim. Please complete a review to earn more honey.',
                'pointsClaimUsed': 'This claim has used 1 honey',
                'pointsReviewReward': 'Review reward: +2 honey',
                'duplicateClaimNotAllowed': 'You have already claimed this product. Duplicate claims are not allowed.',
                'productAlreadyClaimed': 'You have already claimed this product. Check out other great items!',
                'deviceRegisterLimitReached': 'You already have an account. Please log in to claim items!',
                'username': 'Username',
                'account': 'Account',
                'nickname': 'Nickname',
                'enterNickname': 'Please enter nickname',
                'enterPhone': 'Please enter phone number',
                'usPhoneHint': 'US number only (+1 followed by 10 digits)',
                'email': 'Email',
                'enterEmail': 'Please enter email',
                'birthday': 'Birthday',
                'gender': 'Gender',
                'pleaseSelect': 'Please select',
                'male': 'Male',
                'female': 'Female',
                'other': 'Other',
                'saveChanges': 'Save Changes',
                'changePassword': 'Change Password',
                'currentPassword': 'Current Password',
                'enterCurrentPassword': 'Please enter current password',
                'newPassword': 'New Password',
                'enterNewPassword': 'Please enter new password',
                'confirmNewPassword': 'Confirm New Password',
                'enterNewPasswordAgain': 'Please enter new password again',
                'securitySettings': 'Security Settings',
                'loginProtection': 'Login Protection',
                'loginProtectionDesc': 'When enabled, phone verification is required for login',
                // åœ°å€
                'yourAddresses': 'Your Addresses',
                'addAddress': 'Add Address',
                'goToAddressPage': 'Go to User Center to Add Address',
                'noAddresses': 'No addresses saved',
                // å…¶ä»–
                'loading': 'Loading data, please wait...',
                'loadComplete': 'Load Complete!',
                'syncStatus': 'Real-time Refresh Â· Cloud Sync',
                // äº§å“æŠ¥å
                'productRegistration': 'Product Registration',
                'registeredProduct': 'Registered Product',
                'name': 'Name',
                'phone': 'Phone',
                'email': 'Email',
                'address': 'Address',
                'notes': 'Notes',
                'notesPlaceholder': 'Please enter your special requirements or notes',
                'submitRegistration': 'Submit Registration',
                'cancel': 'Cancel',
                'ok': 'OK',
                'confirm': 'Confirm',
                // æç¤ºä¿¡æ¯
                'pleaseLogin': 'Please login first',
                'passwordChangedSuccess': 'Password changed successfully! Please remember your new password',
                'currentPasswordIncorrect': 'Current password is incorrect',
                'passwordMismatch': 'The two new passwords do not match',
                'passwordTooShort': 'New password must be at least 6 characters',
                'pleaseFillAllFields': 'Please fill in all fields',
                'adminPasswordCannotChange': 'Admin password cannot be changed. Please contact system administrator',
                'userNotFound': 'User information not found',
                'userLogin': 'User Login',
                'userRegister': 'User Registration',
                'phoneOrEmail': 'Phone number or email',
                'enterPhoneOrEmail': 'Please enter phone number or email',
                'password': 'Password',
                'enterPassword': 'Please enter password',
                'confirmPassword': 'Confirm Password',
                'enterPasswordAgain': 'Please enter password again',
                'pleaseLoginOrRegister': 'Please login or register first',
                'loginRequired': 'You need to login to claim products. Please choose:',
                'haveAccount': 'I have an account, login now',
                'noAccount': 'I don\'t have an account, register now',
                'insufficientPermissions': 'Insufficient permissions. Only administrators can access the admin panel.',
                'pleaseFillCompleteInfo': 'Please fill in complete information',
                'passwordMismatch': 'The two passwords do not match!',
                'passwordTooShort': 'Password must be at least 6 characters',
                'registrationSuccess': 'Registration successful!',
                'accountOrPasswordError': 'Incorrect account or password!',
                'productNameRequired': 'Product name cannot be empty',
                'productPriceRequired': 'Please enter a valid product price (must be greater than 0)',
                'productImageRequired': 'Product image URL cannot be empty',
                'productAddFailed': 'Failed to add product, please try again',
                'productNotFound': 'Product not found',
                'productUpdateSuccess': 'âœ… Product updated successfully!',
                'productUpdateFailed': 'âŒ Update failed: Product not found',
                'systemError': 'System error: Product information not found',
                'errorTitle': 'Error',
                'successTitle': 'Success',
                'infoTitle': 'Notice',
                'confirmTitle': 'Confirm',
                'profileSaveSuccess': 'Profile saved successfully!',
                'pleaseUploadExcel': 'Please upload an Excel file (.xlsx or .xls)',
                'invalidPhoneFormat': 'Please enter a valid US phone number (+1 followed by 10 digits)',
                'invalidEmailFormat': 'Please enter a valid email address',
                'importDataSaveError': 'âŒ Import failed: error while saving data',
                'confirmLoadDemo': 'Are you sure you want to load demo product data? This will add 6 demo products.',
                'confirmClearCache': 'Are you sure you want to clear all local cache data? This operation cannot be undone!',
                'confirmClearCloud': 'Are you sure you want to clear all cloud data? This operation cannot be undone!',
                'cannotBeNegative': 'cannot be negative',
                // è¯„ä»·
                'writeReview': 'Write Review',
                'myReview': 'My Review',
                'reviews': 'Reviews',
                'noReviews': 'No reviews yet',
                'rating': 'Rating',
                'comment': 'Review',
                'commentPlaceholder': 'Please share your experience with this product...',
                'submitReview': 'Submit Review',
                'reviewSubmitted': 'Review submitted, thank you for your feedback!',
                'reviewThankYou': 'Thanks for leaving a review on Beefreebies! We appreciate it.',
                'reply': 'Reply',
                'replyPlaceholder': 'Please enter your reply',
                'replySuccess': 'Reply submitted',
                'reviewExists': 'You have already reviewed this order',
                'reviewTime': 'Review Time',
                'adminReply': 'Admin Reply',
                'replyReview': 'Reply',
                'deleteReview': 'Delete Review',
                'deleteOrder': 'Delete Order',
                'customerReplies': 'Customer Replies',
                'purchasedProduct': 'Purchased Product',
                'customerName': 'Customer',
                'stars': 'stars',
                'reviewRequired': 'Please enter your review',
                'ratingRequired': 'Please select a rating',
                // ç™»å½•/æ³¨å†Œç›¸å…³
                'accountNotExists': 'Account does not exist. Please check if the account is correct or register first',
                'accountExists': 'Account already exists',
                'accountDisabled': 'Account disabled',
                'loginFailed': 'Login failed',
                'loginFailedRetry': 'Login failed, please try again later',
                'registerFailed': 'Registration failed',
                'registerFailedRetry': 'Registration failed, please try again later',
                'pleaseEnterAccount': 'Please enter account',
                'accountMinLength': 'Account must be at least 3 characters',
                'pleaseConfirmPassword': 'Please confirm password',
                'passwordMinLength': 'Password must be at least 6 characters',
                'passwordMismatchRetry': 'The two passwords do not match, please re-enter',
                'passwordFormatError': 'Password can only contain letters, numbers and special characters (@$!%*#?&), at least 6 characters',
                'pleaseEnterAtLeastOneImage': 'Please enter at least one product image URL',
                'deleteFailedProductNotFound': 'Delete failed: Product data not found',
                'confirmDeleteProduct': 'Are you sure you want to delete product "{name}"? This operation cannot be undone!',
                'productDataError': 'Product data error',
                'noProductDataDetected': 'No product data detected. Please check if the header contains "Product Name" and "Image URL".',
                'parseFailed': 'Parse failed',
                'checkExcelFormat': 'Please check Excel format and try again',
                'readFailed': 'Read failed',
                'fileReadError': 'An error occurred while reading the file. Please try again.',
                // ç”¨æˆ·ç®¡ç†ç›¸å…³
                'confirmResetUserData': 'Are you sure you want to reset all data for this user? This will delete the user\'s orders, addresses and other information!',
                'userDataReset': 'User data has been reset',
                'confirmBanUser': 'Are you sure you want to ban this user? Banned users will not be able to log in to the system.',
                'userBanned': 'User has been banned',
                'confirmUnbanUser': 'Are you sure you want to unban this user?',
                'userUnbanned': 'User has been unbanned',
                'userNotExists': 'User does not exist',
                'confirmDeleteUser': 'âš ï¸ Warning: You are about to permanently delete a user account!\n\nUser Information:\nAccount: {account}\nUsername: {username}\nRegistration Time: {registerTime}\n\nThis operation will delete:\nâœ“ User account\nâœ“ All order records\nâœ“ Shipping addresses\nâœ“ Personal information\n\nâš ï¸ This operation cannot be undone! Are you sure you want to continue?',
                'finalConfirmDelete': 'Final confirmation: Please enter user account "{account}" to confirm deletion\n\nâš ï¸ Entering incorrectly will cancel the deletion operation',
                'accountInputMismatch': 'Account input does not match, deletion operation cancelled',
                'userDeletedSuccess': 'âœ… User account "{account}" and all related data have been permanently deleted\nDeleted {orders} orders and {addresses} addresses',
                'deleteUserFailed': 'Failed to delete user',
                'accountDeletedByAdmin': 'Your account has been deleted by the administrator',
                'loggedOutByOtherDevice': 'Your account has been logged in on another device. This device has synced data to the cloud and logged out automatically.',
                'pleaseSelectAccountsToDelete': 'Please select accounts to delete first',
                'confirmDeleteSelectedAccounts': 'Are you sure you want to delete the selected {count} accounts? This operation cannot be undone.',
                'deletingAccounts': 'Deleting accounts in batch, please wait...',
                'batchDeleteComplete': 'Batch deletion completed',
                'pleaseLoginBeforeDeletion': 'Please login before account deletion',
                'confirmDeleteSelfAccount': 'Are you sure you want to delete your current account? This operation will delete all orders, addresses and personal information, and cannot be recovered.',
                'finalConfirmDeleteSelf': 'Please enter account "{account}" to confirm deletion',
                'accountInputMismatchCancel': 'Account input does not match, operation cancelled',
                'accountDeletedSuccess': 'Account successfully deleted',
                'deleteAccountFailed': 'Account deletion failed',
                // è®¢å•ç®¡ç†ç›¸å…³
                'noOrdersToDelete': 'No orders found to delete',
                'confirmDeleteSelectedOrders': 'Are you sure you want to delete the selected {count} orders? This operation cannot be undone.',
                'confirmDeleteOrder': 'Are you sure you want to delete order {orderLabel}? This operation cannot be undone.',
                'confirmDeleteReview': 'Are you sure you want to delete this review? This operation cannot be undone.',
                // äº§å“ç®¡ç†ç›¸å…³
                'confirmDeleteSelectedProducts': 'Are you sure you want to delete the following {count} products?\n\n{productNames}\n\nThis operation cannot be undone!',
                // è½®æ’­å›¾ç›¸å…³
                'confirmDeleteCarousel': 'Are you sure you want to delete this {targetLabel} carousel?',
                'confirmResetHomepageSettings': 'Are you sure you want to reset all homepage settings? This will restore default configuration.',
                // åŠ è½½æç¤º
                'checkingURLSync': 'Checking URL sync data...',
                'initializingCloudSync': 'Initializing cloud sync...',
                'connectingCloudDatabase': 'Connecting to cloud database...',
                'loadingCloudData': 'Loading cloud data...',
                'cloudSyncTimeout': 'Cloud sync timeout...',
                'firebaseNotLoaded': 'Firebase not loaded...',
                'renderingPage': 'Rendering page content...',
                'loadFailed': 'Load failed',
                'testing': 'Testing...',
                'statusConnected': 'Status: Connected',
                'statusDisconnected': 'Status: Disconnected',
                'statusConnectionFailed': 'Status: Connection failed',
                'testCloudConnection': 'Test cloud connection',
                'syncing': 'Syncing...',
                'forceSyncData': 'Force sync data',
                'clearingCloudUsers': 'Clearing cloud users...',
                'testingConnection': 'Testing connection...',
                'connectionSuccess': 'Connection successful',
                'cannotReadLocalData': 'Cannot read local data',
                'logCleared': 'Log cleared',
                'pleaseSelectAddress': 'Please select address',
                'noUserData': 'No user data',
                'noMatchingUsers': 'No matching users found',
                'noOrderData': 'No order data',
                'noReviewData': 'No review data',
                'systemDefaultPassword': 'System default password',
                'hidePassword': 'Hide password',
                'showPassword': 'Show password',
                'operationFailed': 'Operation failed',
                'noCarouselPC': 'No PC carousel',
                'noCarouselMobile': 'No mobile carousel',
                'noProductsAddOrImport': 'No products, please add or import products',
                'batchEdit': 'Batch edit',
                'batchDelete': 'Batch delete',
                'lastSync': 'Last sync: {timeAgo}',
                'waitingFirstSync': 'Waiting for first sync...',
                'cloudSyncNotEnabled': 'Cloud sync not enabled',
                'editCarouselPC': 'Edit PC carousel',
                'editCarouselMobile': 'Edit mobile carousel',
                'addCarouselPC': 'Add PC carousel',
                'addCarouselMobile': 'Add mobile carousel',
                'editProduct': 'Edit product',
                'addProduct': 'Add product',
                'confirmLoadDemoData': 'Confirm load demo data',
                'confirmClearCache': 'Confirm clear cache',
                // æ•°æ®åº“å¤‡ä»½æ¢å¤ç›¸å…³
                'databaseBackupFailed': 'Database backup failed: {error}',
                'pleaseUploadJSONFile': 'Please upload a JSON format backup file',
                'databaseRestoredSuccess': 'Database restored successfully!',
                'databaseRestoreFailed': 'Database restore failed: {error}',
                'dataRestoreFailed': 'Data restore failed, page may need to be refreshed',
                'readBackupFileFailed': 'Failed to read backup file: {error}',
                'readFileFailed': 'Failed to read file',
                // äº‘ç«¯åŒæ­¥ç›¸å…³
                'cloudSyncNotEnabledError': 'Cloud sync not enabled, cannot operate cloud user data',
                'onlyAdminCanOperate': 'Only administrators can perform this operation',
                'cloudAllUsersEmpty': 'Cloud allUsers is empty, skipped users cleanup for security reasons.',
                'clearCloudUsersFailed': 'Failed to clear cloud users: {error}',
                // ç”¨æˆ·ç®¡ç†ç›¸å…³
                'enterNewPassword': 'Please enter new password (at least 6 characters):',
                'passwordTooShortError': 'Password must be at least 6 characters',
                // è®¢å•çŠ¶æ€ç›¸å…³
                'confirmStatusUpdateSuffix': '?',
                'updatingOrderStatus': 'Updating order status and syncing to cloud...',
                // äº§å“ç®¡ç†ç›¸å…³
                'pleaseFillAllRequiredFields': 'Please fill in all required fields',
                'carouselUpdated': 'Carousel updated',
                'mobileCarouselAdded': 'Mobile carousel added',
                'pcCarouselAdded': 'PC carousel added',
                'pleaseEnterProductName': 'Please enter product name',
                'pleaseEnterValidPrice': 'Please enter a valid product price',
                'productUpdated': 'Product updated',
                'productUpdateFailedError': 'Product update failed',
                'productAddedSuccess': 'Product added successfully! ID: {id}',
                'productAddFailedError': 'Product add failed',
                'replyContentCannotBeEmpty': 'Reply content cannot be empty',
                'reviewNotFound': 'Review not found for this order',
                'passwordIncorrect': 'Password incorrect, please re-enter',
                'importProductsSuccess': 'Successfully imported {count} products!'
            }
        };
        
        // è·å–ç¿»è¯‘æ–‡æœ¬
        function t(key) {
            if (!translations || !key) return key;
            const lang = translations[currentLanguage];
            if (lang && lang[key]) return lang[key];
            const zhLang = translations['zh'];
            if (zhLang && zhLang[key]) return zhLang[key];
            return key;
        }
        
        // æ ¼å¼åŒ–è´§å¸
        function formatCurrency(amount) {
            return `$${parseFloat(amount || 0).toFixed(2)}`;
        }

        const PRODUCT_IMAGE_PLACEHOLDER = 'https://via.placeholder.com/600x600?text=No+Image';

        function getProductImageUrls(product) {
            if (!product) return [];
            const urls = [];

            // 1) æ–°ç»“æ„ï¼šimageUrls æ•°ç»„ï¼ˆæŒ‰é¡ºåºä¿ç•™ï¼Œä¸å»é‡ï¼‰
            if (Array.isArray(product.imageUrls)) {
                product.imageUrls.forEach(url => {
                    const normalized = (url || '').trim();
                    if (normalized) {
                        urls.push(normalized);
                    }
                });
            }

            // 2) å…¼å®¹æ—§ç»“æ„ï¼šimageUrl1 ~ imageUrl6ï¼ˆå¦‚æœæ•°ç»„é‡Œæ²¡å¡«æ»¡ï¼Œå°±ç»§ç»­è¡¥ï¼‰
            for (let i = 1; i <= 6 && urls.length < 6; i++) {
                const key = `imageUrl${i}`;
                if (product[key]) {
                    const normalized = (product[key] || '').trim();
                    if (normalized) {
                        urls.push(normalized);
                    }
                }
            }

            // 3) å†å…¼å®¹æœ€è€çš„ image å­—æ®µï¼ˆåªåœ¨å‰é¢éƒ½æ²¡å†…å®¹æ—¶æ‰ç”¨å°é¢å›¾ï¼‰
            if (!urls.length) {
                const legacyImage = (product.image || '').trim();
                if (legacyImage) {
                    urls.push(legacyImage);
                }
            }

            const sanitized = urls.slice(0, 6);
            if (sanitized.length === 0) {
                sanitized.push(PRODUCT_IMAGE_PLACEHOLDER);
            }
            return sanitized;
        }

        function getPrimaryProductImage(product) {
            const urls = getProductImageUrls(product);
            if (urls.length > 0) {
                return urls[0];
            }
            return PRODUCT_IMAGE_PLACEHOLDER;
        }
        
        // åˆ‡æ¢è¯­è¨€
        function switchLanguage(lang) {
            currentLanguage = lang;
            Storage.set('language', lang);
            applyLanguage();
        }
        
        // åº”ç”¨è¯­è¨€è®¾ç½®
        function applyLanguage() {
            // æ›´æ–°å¯¼èˆªæ 
            const homeLink = document.getElementById('main-home-link');
            const adminLink = document.getElementById('admin-link');
            const userCenterLink = document.getElementById('user-center-link');
            const myOrdersLink = document.getElementById('my-orders-link');
            const loginLink = document.getElementById('login-link');
            const registerLink = document.getElementById('register-link');
            const logoutLink = document.getElementById('logout-link');
            const searchInput = document.getElementById('search-input');
            
            if (homeLink) homeLink.textContent = t('navHome');
            if (adminLink) adminLink.textContent = t('admin');
            if (userCenterLink) userCenterLink.textContent = t('userCenter');
            if (myOrdersLink) myOrdersLink.textContent = t('myOrders');
            if (loginLink) loginLink.innerHTML = `<i class="fas fa-user"></i> ${t('login')}`;
            if (registerLink) registerLink.innerHTML = `<i class="fas fa-user-plus"></i> ${t('register')}`;
            if (logoutLink) logoutLink.innerHTML = `<i class="fas fa-sign-out-alt"></i> ${t('logout')}`;
            if (searchInput) searchInput.placeholder = t('searchPlaceholder');
            
            // æ›´æ–°åŠ è½½å™¨æ–‡æœ¬
            const loaderText = document.querySelector('.loader-text');
            if (loaderText) loaderText.textContent = t('loading');
            
            // æ›´æ–°é¦–é¡µæ ‡é¢˜å’Œæè¿°
            const featuredTitle = document.querySelector('#featured-showcase .featured-head h2');
            const featuredDesc = document.querySelector('#featured-showcase .featured-head p');
            const featuredMeta = document.querySelector('#featured-showcase .featured-meta');
            if (featuredTitle) featuredTitle.textContent = t('featuredTitle');
            if (featuredDesc) featuredDesc.textContent = t('featuredDesc');
            // å·²éšè—ï¼šå®æ—¶åˆ·æ–°Â·äº‘ç«¯åŒæ­¥æŒ‰é’®
            // if (featuredMeta) featuredMeta.innerHTML = `<i class="fas fa-sync-alt"></i> ${t('syncStatus')}`;
            
            // æ›´æ–°è½®æ’­å›¾
            const carouselSlides = document.querySelectorAll('.carousel-slide');
            if (carouselSlides.length >= 2) {
                const slide1 = carouselSlides[0];
                const slide2 = carouselSlides[1];
                const slide1H2 = slide1.querySelector('h2');
                const slide1P = slide1.querySelector('p');
                const slide1Btn = slide1.querySelector('.carousel-btn');
                const slide2H2 = slide2.querySelector('h2');
                const slide2P = slide2.querySelector('p');
                const slide2Btn = slide2.querySelector('.carousel-btn');
                if (slide1H2) slide1H2.textContent = t('newArrival');
                if (slide1P) slide1P.textContent = t('newArrivalDesc');
                if (slide1Btn) slide1Btn.textContent = t('buyNow');
                if (slide2H2) slide2H2.textContent = t('limitedOffer');
                if (slide2P) slide2P.textContent = t('limitedOfferDesc');
                if (slide2Btn) slide2Btn.textContent = t('viewDetails');
            }
            
            // æ›´æ–°åˆ†ç±»æ ‡ç­¾
            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach(item => {
                const category = item.getAttribute('data-category');
                if (category === 'all') item.textContent = t('allProducts');
                else if (category === 'electronics') item.textContent = t('electronics');
                else if (category === 'home') item.textContent = t('home');
                else if (category === 'clothing') item.textContent = t('clothing');
                else if (category === 'beauty') item.textContent = t('beauty');
            });
            
            // æ›´æ–°è®¢å•æ ‡ç­¾
            const orderTabs = document.querySelectorAll('.order-tab');
            orderTabs.forEach(tab => {
                const status = tab.getAttribute('data-status');
                if (status === 'all') tab.textContent = t('orderAll');
                else if (status === 'review') tab.textContent = t('orderReview');
                else if (status === 'shipping') tab.textContent = t('orderShipping');
                else if (status === 'completed') tab.textContent = t('orderCompleted');
                else if (status === 'rejected') tab.textContent = t('orderRejected');
                else if (status === 'cancelled') tab.textContent = t('orderCancelled');
            });
            
            // æ›´æ–°è®¢å•çŠ¶æ€ç­›é€‰ä¸‹æ‹‰æ¡†
            const statusFilter = document.getElementById('order-status-filter');
            if (statusFilter) {
                const selectedValue = statusFilter.value; // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
                statusFilter.innerHTML = '';
                const allStatusOption = document.createElement('option');
                allStatusOption.value = '';
                allStatusOption.textContent = t('allStatus') || 'å…¨éƒ¨çŠ¶æ€';
                statusFilter.appendChild(allStatusOption);
                
                const statusOptions = [
                    { value: 'pending', key: 'orderReview' },
                    { value: 'review', key: 'orderReview' },
                    { value: 'shipping', key: 'orderShipping' },
                    { value: 'rejected', key: 'orderRejected' },
                    { value: 'cancelled', key: 'orderCancelled' },
                    { value: 'completed', key: 'orderCompleted' }
                ];
                
                statusOptions.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt.value;
                    option.textContent = t(opt.key);
                    statusFilter.appendChild(option);
                });
                
                statusFilter.value = selectedValue; // æ¢å¤é€‰ä¸­çš„å€¼
            }
            
            // æ›´æ–°ç”¨æˆ·ä¸­å¿ƒèœå•
            const userMenuItems = document.querySelectorAll('.user-menu a');
            userMenuItems.forEach(item => {
                const tab = item.getAttribute('data-tab');
                if (tab === 'orders') item.textContent = t('myOrders');
                else if (tab === 'profile') item.textContent = t('profile');
                else if (tab === 'address') item.textContent = t('address');
                else if (tab === 'my-reviews') item.textContent = t('myReview');
                else if (tab === 'security') item.textContent = t('security');
            });
            
            // æ›´æ–°ç”¨æˆ·ä¸­å¿ƒä¼šå‘˜ç­‰çº§å’Œç”¨æˆ·å
            const usernameDisplay = document.getElementById('username-display');
            const userMemberType = document.getElementById('user-member-type');
            const userPointsBadge = document.getElementById('user-points-badge');
            if (usernameDisplay) usernameDisplay.textContent = t('username') || 'ç”¨æˆ·å';
            if (userMemberType) userMemberType.textContent = t('regularMember') || 'æ™®é€šä¼šå‘˜';
            if (userPointsBadge) {
                const label = userPointsBadge.querySelector('[data-i18n="pointsBalance"]');
                if (label) label.textContent = t('pointsBalance') || 'å½“å‰èœœç½';
            }
            
            // æ›´æ–°ä¸ªäººä¿¡æ¯é¡µé¢
            const profilePage = document.getElementById('user-profile');
            if (profilePage) {
                const profileH3 = profilePage.querySelector('h3');
                if (profileH3) profileH3.textContent = t('profile');
                
                const profileLabels = profilePage.querySelectorAll('label');
                profileLabels.forEach(label => {
                    const forAttr = label.getAttribute('for');
                    if (forAttr === 'profile-username') label.textContent = t('username');
                    else if (forAttr === 'profile-account') label.textContent = t('account');
                    else if (forAttr === 'profile-nickname') label.textContent = t('nickname');
                    else if (forAttr === 'profile-phone') label.textContent = t('phone');
                    else if (forAttr === 'profile-email') label.textContent = t('email');
                    else if (forAttr === 'profile-birthday') label.textContent = t('birthday');
                    else if (forAttr === 'profile-gender') label.textContent = t('gender');
                });

                const profileInputs = profilePage.querySelectorAll('input[data-i18n-placeholder]');
                profileInputs.forEach(input => {
                    const key = input.getAttribute('data-i18n-placeholder');
                    if (key) input.placeholder = t(key);
                });

                const profileSelect = profilePage.querySelector('#profile-gender');
                if (profileSelect) {
                    const options = profileSelect.querySelectorAll('option');
                    options.forEach(option => {
                        const key = option.getAttribute('data-i18n');
                        if (key) option.textContent = t(key);
                    });
                }

                const saveBtn = profilePage.querySelector('button[type="submit"]');
                if (saveBtn) saveBtn.textContent = t('saveChanges');
            }
            
            // æ›´æ–°åœ°å€é¡µé¢æ ‡é¢˜
            const addressHeader = document.querySelector('#user-address .address-header h3');
            if (addressHeader) addressHeader.textContent = t('yourAddresses');
            
            const addAddressBtn = document.getElementById('add-address-btn');
            if (addAddressBtn) addAddressBtn.textContent = t('addAddress');
            
            // æ›´æ–°è´¦æˆ·å®‰å…¨é¡µé¢
            const securityPage = document.getElementById('user-security');
            if (securityPage) {
                const securityH3 = securityPage.querySelector('h3');
                if (securityH3) securityH3.textContent = t('security');

                const changePasswordH4 = securityPage.querySelector('.security-section h4');
                if (changePasswordH4) changePasswordH4.textContent = t('changePassword');

                const securityLabels = securityPage.querySelectorAll('label');
                securityLabels.forEach(label => {
                    const forAttr = label.getAttribute('for');
                    if (forAttr === 'current-password') label.textContent = t('currentPassword');
                    else if (forAttr === 'new-password') label.textContent = t('newPassword');
                    else if (forAttr === 'confirm-password') label.textContent = t('confirmNewPassword');
                });

                const securityInputs = securityPage.querySelectorAll('input[data-i18n-placeholder]');
                securityInputs.forEach(input => {
                    const key = input.getAttribute('data-i18n-placeholder');
                    if (key) input.placeholder = t(key);
                });

                const changePasswordBtn = securityPage.querySelector('#change-password-form button[type="submit"]');
                if (changePasswordBtn) changePasswordBtn.textContent = t('changePassword');

                const securitySettingsH4 = securityPage.querySelectorAll('.security-section h4');
                if (securitySettingsH4.length > 1) securitySettingsH4[1].textContent = t('securitySettings');

                // ç™»å½•ä¿æŠ¤åŠŸèƒ½å·²åˆ é™¤
            }
            
            // æ›´æ–°ç™»å½•/æ³¨å†Œé€‰æ‹©æ¨¡æ€æ¡†
            const authChoiceModal = document.getElementById('auth-choice-modal');
            if (authChoiceModal) {
                const authChoiceTitle = authChoiceModal.querySelector('.modal-header h3');
                const authChoiceDesc = authChoiceModal.querySelector('.modal-body p');
                const gotoLoginBtn = document.getElementById('goto-login-btn');
                const gotoRegisterBtn = document.getElementById('goto-register-btn');
                
                if (authChoiceTitle) authChoiceTitle.textContent = t('pleaseLoginOrRegister');
                if (authChoiceDesc) authChoiceDesc.textContent = t('loginRequired');
                if (gotoLoginBtn) {
                    gotoLoginBtn.innerHTML = `<i class="fas fa-sign-in-alt"></i> ${t('haveAccount')}`;
                }
                if (gotoRegisterBtn) {
                    gotoRegisterBtn.innerHTML = `<i class="fas fa-user-plus"></i> ${t('noAccount')}`;
                }
            }
            
            // æ›´æ–°ç™»å½•æ¨¡æ€æ¡†
            const loginModal = document.getElementById('login-modal');
            if (loginModal) {
                const loginTitle = loginModal.querySelector('.modal-header h3');
                const loginAccountLabel = loginModal.querySelector('label[for="login-account"]');
                const loginAccountInput = document.getElementById('login-account');
                const loginPasswordLabel = loginModal.querySelector('label[for="login-password"]');
                const loginPasswordInput = document.getElementById('login-password');
                const loginSubmitBtn = loginModal.querySelector('button[type="submit"]');
                
                if (loginTitle) loginTitle.textContent = t('userLogin');
                if (loginAccountLabel) loginAccountLabel.textContent = t('phoneOrEmail');
                if (loginAccountInput) loginAccountInput.placeholder = t('enterPhoneOrEmail');
                if (loginPasswordLabel) loginPasswordLabel.textContent = t('password');
                if (loginPasswordInput) loginPasswordInput.placeholder = t('enterPassword');
                if (loginSubmitBtn) loginSubmitBtn.textContent = t('login');
            }
            
            // æ›´æ–°æ³¨å†Œæ¨¡æ€æ¡†
            const registerModal = document.getElementById('register-modal');
            if (registerModal) {
                const registerTitle = registerModal.querySelector('.modal-header h3');
                const registerAccountLabel = registerModal.querySelector('label[for="register-account"]');
                const registerAccountInput = document.getElementById('register-account');
                const registerPasswordLabel = registerModal.querySelector('label[for="register-password"]');
                const registerPasswordInput = document.getElementById('register-password');
                const registerConfirmLabel = registerModal.querySelector('label[for="register-confirm"]');
                const registerConfirmInput = document.getElementById('register-confirm');
                const registerSubmitBtn = registerModal.querySelector('button[type="submit"]');
                
                if (registerTitle) registerTitle.textContent = t('userRegister');
                if (registerAccountLabel) registerAccountLabel.textContent = t('phoneOrEmail');
                if (registerAccountInput) registerAccountInput.placeholder = t('enterPhoneOrEmail');
                if (registerPasswordLabel) registerPasswordLabel.textContent = t('password');
                if (registerPasswordInput) registerPasswordInput.placeholder = t('enterPassword');
                if (registerConfirmLabel) registerConfirmLabel.textContent = t('confirmPassword');
                if (registerConfirmInput) registerConfirmInput.placeholder = t('enterPasswordAgain');
                if (registerSubmitBtn) registerSubmitBtn.textContent = t('register');
            }

            attachUSPhoneInputBehavior('profile-phone');
            attachUSPhoneInputBehavior('address-phone');
            
            // æ›´æ–°äº§å“æŠ¥åæ¨¡æ€æ¡†
            const signupModalTitle = document.getElementById('signup-modal-title');
            const signupProductLabel = document.getElementById('signup-product-label');
            const signupNameLabel = document.getElementById('signup-name-label');
            const signupPhoneLabel = document.getElementById('signup-phone-label');
            const signupEmailLabel = document.getElementById('signup-email-label');
            const signupAddressLabel = document.getElementById('signup-address-label');
            const signupNotesLabel = document.getElementById('signup-notes-label');
            const signupNotes = document.getElementById('signup-notes');
            const signupSubmitBtn = document.getElementById('signup-submit-btn');
            const signupCancelBtn = document.getElementById('signup-cancel-btn');
            
            if (signupModalTitle) signupModalTitle.textContent = t('productRegistration');
            if (signupProductLabel) signupProductLabel.textContent = t('registeredProduct');
            if (signupNameLabel) signupNameLabel.textContent = t('name');
            if (signupPhoneLabel) signupPhoneLabel.textContent = t('phone');
            if (signupEmailLabel) signupEmailLabel.textContent = t('email');
            if (signupAddressLabel) signupAddressLabel.textContent = t('address');
            if (signupNotesLabel) signupNotesLabel.textContent = t('notes');
            if (signupNotes) signupNotes.placeholder = t('notesPlaceholder');
            if (signupSubmitBtn) signupSubmitBtn.textContent = t('submitRegistration');
            if (signupCancelBtn) signupCancelBtn.textContent = t('cancel');
            
            // é‡æ–°æ¸²æŸ“è®¢å•å’Œåœ°å€ï¼ˆä¼šä½¿ç”¨æ–°çš„è´§å¸æ ¼å¼ï¼‰
            renderUserOrders();
            renderAddressList();
            renderProducts(products);
        }

        // æ¸…é™¤æœ¬åœ°æ‰€æœ‰ç¼“å­˜æ•°æ®,ç¡®ä¿ä»äº‘ç«¯è·å–æœ€æ–°æ•°æ®
        // æ³¨æ„:åªæœ‰åœ¨é¦–æ¬¡åŠ è½½æ—¶æ¸…ç†,ç™»å½•çŠ¶æ€ä¿ç•™
        console.log('ğŸ”„ æ¸…ç†æœ¬åœ°ç¼“å­˜,å‡†å¤‡ä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ®...');

        // é¢„å®šä¹‰ç®¡ç†å‘˜è´¦å·
        const ADMIN_ACCOUNTS = {
            'Udream':  { password: 'Aa123123', role: 'admin', username: 'ç³»ç»Ÿç®¡ç†å‘˜' },
            'Udream1': { password: 'Aa123123', role: 'admin', username: 'ç³»ç»Ÿç®¡ç†å‘˜1' },
            'Udream2': { password: 'Aa123123', role: 'admin', username: 'ç³»ç»Ÿç®¡ç†å‘˜2' },
            'Udream3': { password: 'Aa123123', role: 'admin', username: 'ç³»ç»Ÿç®¡ç†å‘˜3' }
        };

        // äº‘ç«¯æ•°æ®åŒæ­¥é…ç½® - ä½¿ç”¨ç®€å•çš„å…±äº«å­˜å‚¨æ–¹æ¡ˆ
        const CLOUD_STORAGE = {
            enabled: true,
            // ä½¿ç”¨ GitHub Gist ä½œä¸ºå…è´¹çš„æ•°æ®å­˜å‚¨
            baseUrl: 'https://api.github.com/gists',
            gistId: 'your-gist-id-here', // éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„ Gist ID
            accessToken: 'your-github-token-here' // éœ€è¦æ›¿æ¢ä¸º GitHub Token
        };

        // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ localStorage çš„è·¨è®¾å¤‡åŒæ­¥
        const CROSS_DEVICE_SYNC = {
            enabled: true,
            syncKey: 'ecommerce_sync_data',
            lastSyncTime: 'ecommerce_last_sync'
        };

        // å…¨å±€äº‘ç«¯åŒæ­¥ç®¡ç†å™¨å®ä¾‹ï¼ˆå°†åœ¨é¡µé¢åŠ è½½ååˆå§‹åŒ–ï¼‰
        let cloudSync = null;

        // ========== Firebase äº‘ç«¯åŒæ­¥ç®¡ç†å™¨ ==========
        class CloudSyncManager {
            constructor() {
                this.db = null;
                this.isInitialized = false;
                // å…¼å®¹æ—§ä»£ç ï¼Œä½†å®é™…ä½¿ç”¨ _syncState.inProgress
                Object.defineProperty(this, 'syncInProgress', {
                    get: () => this._syncState?.inProgress || false,
                    set: (value) => {
                        if (!this._syncState) this._syncState = { inProgress: false, queue: [], lastSyncTime: null, errorCount: 0 };
                        this._syncState.inProgress = value;
                    }
                });
                this.lastSyncTime = null;
                this.syncInterval = null;
                this.listeners = [];
                this.userOrdersRef = null;
                this.pendingOrderUpdate = null;
                this.orderUpdateTimer = null;
                this.userAddressesRef = null;
                this.pendingAddressUpdate = null;
                this.addressUpdateTimer = null;
                this.allOrdersRef = null;
                this.sessionRef = null;
                this.currentSessionId = null;

                // ========== Firebase é…ç½® ==========
                // 
                // âš ï¸ é‡è¦æç¤ºï¼šè·¨è®¾å¤‡åŒæ­¥åŠŸèƒ½éœ€è¦Firebaseé…ç½®
                // 
                // ğŸ”§ å¿«é€Ÿè®¾ç½®æ­¥éª¤ï¼ˆçº¦3åˆ†é’Ÿï¼‰ï¼š
                // 
                // 1ï¸âƒ£ è®¿é—® Firebase æ§åˆ¶å°
                //    https://console.firebase.google.com/
                // 
                // 2ï¸âƒ£ åˆ›å»ºæ–°é¡¹ç›®
                //    - ç‚¹å‡»"æ·»åŠ é¡¹ç›®"
                //    - è¾“å…¥é¡¹ç›®åç§°ï¼ˆå¦‚ï¼šmy-ecommerceï¼‰
                //    - ç¦ç”¨Google Analyticsï¼ˆå¯é€‰ï¼‰
                //    - ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"
                // 
                // 3ï¸âƒ£ æ³¨å†ŒWebåº”ç”¨
                //    - åœ¨é¡¹ç›®æ¦‚è§ˆé¡µï¼Œç‚¹å‡» Web å›¾æ ‡ (</>)
                //    - è¾“å…¥åº”ç”¨æ˜µç§°
                //    - ç‚¹å‡»"æ³¨å†Œåº”ç”¨"
                //    - å¤åˆ¶æ˜¾ç¤ºçš„ firebaseConfig å¯¹è±¡
                // 
                // 4ï¸âƒ£ å¯ç”¨ Realtime Database
                //    - å·¦ä¾§èœå• -> æ„å»º -> Realtime Database
                //    - ç‚¹å‡»"åˆ›å»ºæ•°æ®åº“"
                //    - é€‰æ‹©ä½ç½®ï¼ˆå»ºè®®ï¼šasia-southeast1ï¼‰
                //    - âš ï¸ é‡è¦ï¼šé€‰æ‹©"æµ‹è¯•æ¨¡å¼"ï¼ˆå…è®¸è¯»å†™ï¼‰
                //    - ç‚¹å‡»"å¯ç”¨"
                // 
                // 5ï¸âƒ£ æ›¿æ¢é…ç½®
                //    - å°†ç¬¬3æ­¥å¤åˆ¶çš„ firebaseConfig æ›¿æ¢ä¸‹é¢çš„å†…å®¹
                // 
                // ğŸ“ ç¤ºä¾‹é…ç½®ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ï¼‰ï¼š
                this.firebaseConfig = {
                    apiKey: "AIzaSyAKHHBPa0LmDjAdFj6vngjH0DuBbTzr7Cg",
                    authDomain: "my-ecommerce-app-2e824.firebaseapp.com",
                    databaseURL: "https://my-ecommerce-app-2e824-default-rtdb.asia-southeast1.firebasedatabase.app",  // âš ï¸ ç§»é™¤äº†æœ«å°¾çš„æ–œæ 
                    projectId: "my-ecommerce-app-2e824",
                    storageBucket: "my-ecommerce-app-2e824.firebasestorage.app",
                    messagingSenderId: "334875308809",
                    appId: "1:334875308809:web:b48e4dac8e6ca2470219d8",
                    measurementId: "G-6454KB4569"
                };

                // ğŸ’¡ æç¤ºï¼š
                // - å¦‚æœä¸é…ç½®Firebaseï¼Œåº”ç”¨ä»å¯æ­£å¸¸ä½¿ç”¨ï¼Œåªæ˜¯æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°
                // - é…ç½®åï¼Œæ•°æ®å°†è‡ªåŠ¨åœ¨æ‰€æœ‰è®¾å¤‡é—´å®æ—¶åŒæ­¥
                // - æµ‹è¯•æ¨¡å¼çš„æ•°æ®åº“è§„åˆ™ä¼šåœ¨30å¤©åè¿‡æœŸï¼Œå±Šæ—¶éœ€è¦æ›´æ–°è§„åˆ™

                // ä¸åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ init()ï¼Œè€Œæ˜¯è¿”å›åç«‹å³è°ƒç”¨
                // this.init(); // ç§»é™¤è¿™ä¸€è¡Œ
            }

            // ç­‰å¾… Firebase SDK åŠ è½½å®Œæˆ
            async waitForFirebaseSDK(timeout = 45000) {
                console.log('â³ ç­‰å¾… Firebase SDK åŠ è½½...');

                const startTime = Date.now();
                const checkInterval = 500; // æ¯500msæ£€æŸ¥ä¸€æ¬¡

                return new Promise((resolve) => {
                    const check = () => {
                        // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½æˆåŠŸ
                        if (typeof firebase !== 'undefined') {
                            console.log('âœ… Firebase SDK æ£€æµ‹æˆåŠŸ');
                            resolve(true);
                            return;
                        }

                        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æºéƒ½å¤±è´¥äº†
                        if (window.firebaseLoadFailed) {
                            console.log('âŒ Firebase SDK åŠ è½½å·²ç¡®è®¤å¤±è´¥');
                            resolve(false);
                            return;
                        }

                        // æ£€æŸ¥æ˜¯å¦è¶…æ—¶
                        if (Date.now() - startTime > timeout) {
                            console.log('â±ï¸ Firebase SDK åŠ è½½ç­‰å¾…è¶…æ—¶');
                            resolve(false);
                            return;
                        }

                        // ç»§ç»­ç­‰å¾…
                        setTimeout(check, checkInterval);
                    };

                    check();
                });
            }

            // åˆå§‹åŒ– Firebase
            async init() {
                console.log('ğŸ”§ CloudSyncManager.init() å¼€å§‹æ‰§è¡Œ...');
                console.log('â° åˆå§‹åŒ–æ—¶é—´:', new Date().toLocaleString());

                try {
                    // ç­‰å¾… Firebase SDK åŠ è½½ï¼ˆæœ€å¤šç­‰å¾…5ç§’ï¼ŒåŠ å¿«é€Ÿåº¦ï¼‰
                    console.log('â³ ç­‰å¾… Firebase SDK åŠ è½½...');
                    const sdkLoaded = await this.waitForFirebaseSDK(5000);

                    if (!sdkLoaded) {
                        console.warn('âš ï¸ Firebase SDK åŠ è½½è¶…æ—¶æˆ–å¤±è´¥ï¼Œäº‘ç«¯åŒæ­¥åŠŸèƒ½ä¸å¯ç”¨');
                        console.log('ğŸ’¡ åº”ç”¨å°†ä»¥æœ¬åœ°æ¨¡å¼è¿è¡Œï¼Œæ•°æ®ä»…ä¿å­˜åœ¨å½“å‰è®¾å¤‡');
                        console.log('ğŸ“Œ å¯èƒ½åŸå› ï¼š');
                        console.log('   1. ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ— æ³•åŠ è½½ Firebase CDN');
                        console.log('   2. æµè§ˆå™¨æ‰©å±•é˜»æ­¢äº†è„šæœ¬åŠ è½½');
                        console.log('   3. é˜²ç«å¢™æˆ–ä»£ç†è®¾ç½®');
                        console.log('   4. æ‰€æœ‰ CDN æºå‡ä¸å¯ç”¨');
                        this.updateSyncStatusUI(false);
                        return;
                    }

                    console.log('âœ… Firebase SDK å·²æˆåŠŸåŠ è½½');
                    console.log('ğŸ“¦ Firebase ç‰ˆæœ¬:', firebase.SDK_VERSION || 'unknown');
                    console.log('ğŸ“¦ Firebase å¯ç”¨æœåŠ¡:', Object.keys(firebase).filter(k => typeof firebase[k] === 'function').join(', '));

                    // å¿«é€Ÿæ£€æŸ¥é…ç½®ï¼ˆè·³è¿‡è¯¦ç»†è¯Šæ–­ä»¥åŠ å¿«é€Ÿåº¦ï¼‰
                    const isDefaultConfig = this.firebaseConfig.apiKey === 'YOUR_API_KEY_HERE' ||
                        this.firebaseConfig.projectId === 'your-project';

                    if (isDefaultConfig) {
                        console.warn('âš ï¸ Firebase é…ç½®æ— æ•ˆï¼Œäº‘ç«¯åŒæ­¥åŠŸèƒ½ä¸å¯ç”¨');
                        this.updateSyncStatusUI(false);
                        return;
                    }

                    console.log('ğŸ”§ æ­£åœ¨åˆå§‹åŒ– Firebase...');
                    console.log('ğŸ“ é…ç½®ä¿¡æ¯:');
                    console.log('   - é¡¹ç›® ID:', this.firebaseConfig.projectId);
                    console.log('   - è®¤è¯åŸŸ:', this.firebaseConfig.authDomain);
                    console.log('   - æ•°æ®åº“ URL:', this.firebaseConfig.databaseURL);
                    console.log('   - å­˜å‚¨æ¡¶:', this.firebaseConfig.storageBucket);

                    // åˆå§‹åŒ– Firebase
                    if (!firebase.apps.length) {
                        console.log('ğŸ”„ æ‰§è¡Œ firebase.initializeApp()...');
                        try {
                            firebase.initializeApp(this.firebaseConfig);
                            console.log('âœ… Firebase App åˆå§‹åŒ–æˆåŠŸ');
                            console.log('ğŸ“± App åç§°:', firebase.app().name);
                            console.log('ğŸ“± App é€‰é¡¹:', JSON.stringify(firebase.app().options, null, 2));
                        } catch (initError) {
                            console.error('âŒ Firebase App åˆå§‹åŒ–å¤±è´¥:', initError);
                            throw initError;
                        }
                    } else {
                        console.log('â„¹ï¸ Firebase App å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–');
                        console.log('ğŸ“± ç°æœ‰ App:', firebase.apps.map(app => app.name).join(', '));
                    }

                    console.log('ğŸ”„ è·å– Database å®ä¾‹...');
                    try {
                        this.db = firebase.database();
                        console.log('âœ… Database å®ä¾‹è·å–æˆåŠŸ');
                        console.log('ğŸ”— Database URL:', this.db.ref().toString());
                    } catch (dbError) {
                        console.error('âŒ Database å®ä¾‹è·å–å¤±è´¥:', dbError);
                        throw dbError;
                    }

                    // è·³è¿‡è¿æ¥æµ‹è¯•ä»¥åŠ å¿«é€Ÿåº¦ï¼Œç›´æ¥å°è¯•è¯»å–æ•°æ®éªŒè¯è¿æ¥
                    console.log('ğŸ”„ å¿«é€ŸéªŒè¯æ•°æ®åº“è¿æ¥...');
                    let connectionSuccess = false;
                    
                    try {
                        // å¿«é€Ÿæµ‹è¯•ï¼šå°è¯•è¯»å–ä¸€ä¸ªç®€å•çš„è·¯å¾„ï¼ˆè¶…æ—¶2ç§’ï¼‰
                        await Promise.race([
                            this.db.ref('.info/connected').once('value'),
                            new Promise((_, reject) => setTimeout(() => reject(new Error('è¶…æ—¶')), 2000))
                        ]);
                        connectionSuccess = true;
                        console.log('âœ… æ•°æ®åº“è¿æ¥éªŒè¯æˆåŠŸ');
                    } catch (error) {
                        console.warn('âš ï¸ è¿æ¥éªŒè¯å¤±è´¥ï¼Œä½†ç»§ç»­å°è¯•:', error.message);
                        // å³ä½¿éªŒè¯å¤±è´¥ä¹Ÿç»§ç»­ï¼Œè®©å®é™…æ•°æ®åŠ è½½æ¥éªŒè¯
                        connectionSuccess = true;
                    }

                    if (!connectionSuccess) {
                        console.error('âŒ è¿æ¥æµ‹è¯•æœ€ç»ˆå¤±è´¥');
                        throw lastError || new Error('Database connection test failed after 3 attempts');
                    }

                    this.isInitialized = true;
                    console.log('âœ…âœ…âœ… Firebase äº‘ç«¯åŒæ­¥å·²å®Œå…¨å¯ç”¨ï¼');

                    // æ•°æ®åŠ è½½ç­–ç•¥ï¼šç®¡ç†å‘˜ä¼˜å…ˆä½¿ç”¨æœ¬åœ°æ•°æ®ï¼Œæ™®é€šç”¨æˆ·ä»äº‘ç«¯åŠ è½½
                    console.log('ğŸ“¥ æ­£åœ¨å¤„ç†æ•°æ®åŒæ­¥...');
                    try {
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
                        const isAdmin = isCurrentUserAdmin();
                        
                        if (isAdmin) {
                            // ç®¡ç†å‘˜ï¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ°æ•°æ®ï¼Œå…ˆä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°äº‘ç«¯
                            console.log('ğŸ‘‘ ç®¡ç†å‘˜æ¨¡å¼ï¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ°æ•°æ®');
                            
                            // å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰äº§å“æ•°æ®
                            const localProducts = JSON.parse(localStorage.getItem('products') || '[]');
                            if (localProducts && localProducts.length > 0) {
                                console.log(`ğŸ“¤ æ£€æµ‹åˆ°æœ¬åœ°æœ‰ ${localProducts.length} ä¸ªäº§å“ï¼Œå…ˆä¸Šä¼ åˆ°äº‘ç«¯...`);
                                // æ›´æ–°å…¨å±€productså˜é‡
                                products = localProducts;
                                // å…ˆä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°äº‘ç«¯
                                try {
                                    await this.syncProducts();
                                    console.log('âœ… æœ¬åœ°äº§å“æ•°æ®å·²ä¸Šä¼ åˆ°äº‘ç«¯');
                                } catch (syncError) {
                                    console.warn('âš ï¸ ä¸Šä¼ æœ¬åœ°äº§å“æ•°æ®å¤±è´¥:', syncError.message);
                                }
                            } else {
                                // æœ¬åœ°æ²¡æœ‰æ•°æ®ï¼Œä»äº‘ç«¯åŠ è½½ï¼ˆä¸ä¸Šä¼ ç©ºæ•°æ®ï¼Œé¿å…è¦†ç›–äº‘ç«¯ï¼‰
                                console.log('â„¹ï¸ æœ¬åœ°æ— äº§å“æ•°æ®ï¼Œä»äº‘ç«¯åŠ è½½ï¼ˆä¸ä¼šä¸Šä¼ ç©ºæ•°æ®è¦†ç›–äº‘ç«¯ï¼‰...');
                                await this.loadProducts().then(() => console.log('âœ… äº§å“æ•°æ®åŠ è½½å®Œæˆ'));
                            }
                            
                            // ç”¨æˆ·æ•°æ®ï¼šç®¡ç†å‘˜ä¹Ÿä¼˜å…ˆä½¿ç”¨æœ¬åœ°
                            const localUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
                            if (localUsers && localUsers.length > 0) {
                                console.log(`ğŸ“¤ æ£€æµ‹åˆ°æœ¬åœ°æœ‰ ${localUsers.length} ä¸ªç”¨æˆ·ï¼Œå…ˆä¸Šä¼ åˆ°äº‘ç«¯...`);
                                allUsers = localUsers;
                                try {
                                    await this.syncAllUsers();
                                    console.log('âœ… æœ¬åœ°ç”¨æˆ·æ•°æ®å·²ä¸Šä¼ åˆ°äº‘ç«¯');
                                } catch (syncError) {
                                    console.warn('âš ï¸ ä¸Šä¼ æœ¬åœ°ç”¨æˆ·æ•°æ®å¤±è´¥:', syncError.message);
                                }
                            } else {
                                await this.loadAllUsers().then(() => console.log('âœ… ç”¨æˆ·æ•°æ®åŠ è½½å®Œæˆ'));
                            }
                            
                            // ä¸»é¡µè®¾ç½®ï¼šæ€»æ˜¯ä»äº‘ç«¯åŠ è½½ï¼ˆè®¾ç½®æ˜¯å…±äº«çš„ï¼‰
                            await this.loadHomepageSettings().then(() => console.log('âœ… ä¸»é¡µè®¾ç½®åŠ è½½å®Œæˆ'));
                            
                        } else {
                            // æ™®é€šç”¨æˆ·ï¼šä»äº‘ç«¯åŠ è½½æ•°æ®
                            console.log('ğŸ‘¤ æ™®é€šç”¨æˆ·æ¨¡å¼ï¼šä»äº‘ç«¯åŠ è½½æ•°æ®');
                            await Promise.all([
                                this.loadProducts().then(() => console.log('âœ… äº§å“æ•°æ®åŠ è½½å®Œæˆ')),
                                this.loadAllUsers().then(() => console.log('âœ… ç”¨æˆ·æ•°æ®åŠ è½½å®Œæˆ')),
                                this.loadHomepageSettings().then(() => console.log('âœ… ä¸»é¡µè®¾ç½®åŠ è½½å®Œæˆ'))
                            ]);
                        }
                        
                        console.log('âœ… æ‰€æœ‰æ•°æ®åŒæ­¥å®Œæˆ');
                    } catch (loadError) {
                        console.warn('âš ï¸ æ•°æ®åŒæ­¥å¤±è´¥:', loadError.message);
                    }

                    // è®¾ç½®å®æ—¶ç›‘å¬
                    console.log('ğŸ”„ è®¾ç½®å®æ—¶ç›‘å¬å™¨...');
                    try {
                        this.setupRealtimeListeners();
                        console.log('âœ… å®æ—¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
                    } catch (listenerError) {
                        console.warn('âš ï¸ å®æ—¶ç›‘å¬å™¨è®¾ç½®å¤±è´¥:', listenerError.message);
                    }

                    // è·³è¿‡é¦–æ¬¡åŒæ­¥ä»¥åŠ å¿«é€Ÿåº¦ï¼ˆæ•°æ®å·²ä»äº‘ç«¯åŠ è½½ï¼‰
                    console.log('â„¹ï¸ è·³è¿‡é¦–æ¬¡åŒæ­¥ï¼ˆæ•°æ®å·²ä»äº‘ç«¯åŠ è½½ï¼‰');

                    // å®šæœŸåŒæ­¥ï¼ˆæ¯2ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
                    this.syncInterval = setInterval(() => {
                        // åªåœ¨ç”¨æˆ·ä¸åœ¨æ“ä½œæ—¶åŒæ­¥
                        if (!this._syncState.inProgress && document.visibilityState === 'visible') {
                            this.syncAllData().catch(err => {
                                console.warn('âš ï¸ å®šæœŸåŒæ­¥å¤±è´¥:', err.message);
                            });
                        }
                    }, 2000); 
                    console.log('â° å·²è®¾ç½®å®šæœŸåŒæ­¥ (æ¯2ç§’)');

                    // æ›´æ–°UIçŠ¶æ€æŒ‡ç¤ºå™¨
                    this.updateSyncStatusUI(true);

                    console.log('ğŸ‰ğŸ‰ğŸ‰ äº‘ç«¯åŒæ­¥ç³»ç»Ÿå®Œå…¨å°±ç»ªï¼');
                    console.log('â° å®Œæˆæ—¶é—´:', new Date().toLocaleString());
                    // ç§»é™¤å¯åŠ¨æç¤ºï¼Œé¿å…å¹²æ‰°ç”¨æˆ·

                } catch (error) {
                    console.error('âŒâŒâŒ Firebase åˆå§‹åŒ–å¤±è´¥:', error);
                    console.error('é”™è¯¯åç§°:', error.name);
                    console.error('é”™è¯¯ä»£ç :', error.code);
                    console.error('é”™è¯¯æ¶ˆæ¯:', error.message);
                    console.error('é”™è¯¯å †æ ˆ:', error.stack);
                    this.isInitialized = false;

                    // æ ¹æ®é”™è¯¯ç±»å‹ç»™å‡ºä¸åŒçš„æç¤º
                    let errorMessage = '';
                    let troubleshootingSteps = [];

                    if (error.code === 'auth/invalid-api-key' || error.message?.includes('API key')) {
                        errorMessage = 'API Key æ— æ•ˆæˆ–ä¸æ­£ç¡®';
                        troubleshootingSteps = [
                            'æ£€æŸ¥ firebaseConfig ä¸­çš„ apiKey æ˜¯å¦æ­£ç¡®',
                            'ç¡®è®¤ API Key æœªè¢«é™åˆ¶æˆ–ç¦ç”¨',
                            'åœ¨ Firebase æ§åˆ¶å°é‡æ–°ç”Ÿæˆ API Key'
                        ];
                    } else if (error.message?.includes('Permission denied') || error.code === 'PERMISSION_DENIED') {
                        errorMessage = 'æ•°æ®åº“æƒé™è¢«æ‹’ç»';
                        troubleshootingSteps = [
                            'è®¿é—® Firebase æ§åˆ¶å° > Realtime Database > è§„åˆ™',
                            'ç¡®ä¿è§„åˆ™è®¾ç½®ä¸ºæµ‹è¯•æ¨¡å¼ (å…è®¸è¯»å†™)',
                            'å‘å¸ƒè§„åˆ™åç­‰å¾…å‡ ç§’é’Ÿç”Ÿæ•ˆ'
                        ];
                    } else if (error.code === 'app/invalid-credential') {
                        errorMessage = 'Firebase é…ç½®ä¿¡æ¯æ— æ•ˆ';
                        troubleshootingSteps = [
                            'æ£€æŸ¥æ‰€æœ‰é…ç½®é¡¹æ˜¯å¦å®Œæ•´',
                            'ç¡®è®¤é¡¹ç›® ID å’Œæ•°æ®åº“ URL åŒ¹é…',
                            'é‡æ–°å¤åˆ¶ Firebase é…ç½®'
                        ];
                    } else if (error.message?.includes('network') || error.message?.includes('fetch')) {
                        errorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯';
                        troubleshootingSteps = [
                            'æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸',
                            'ç¡®è®¤é˜²ç«å¢™æœªé˜»æ­¢ Firebase åŸŸå',
                            'å°è¯•ç¦ç”¨æµè§ˆå™¨æ‰©å±•'
                        ];
                    } else if (error.message?.includes('databaseURL')) {
                        errorMessage = 'æ•°æ®åº“ URL é…ç½®é”™è¯¯';
                        troubleshootingSteps = [
                            'ç¡®è®¤ databaseURL æ ¼å¼æ­£ç¡®',
                            'ç¡®ä¿ URL æœ«å°¾æ²¡æœ‰æ–œæ ',
                            'æ£€æŸ¥æ•°æ®åº“åŒºåŸŸæ˜¯å¦æ­£ç¡®'
                        ];
                    } else {
                        errorMessage = error.message || 'æœªçŸ¥é”™è¯¯';
                        troubleshootingSteps = [
                            'æŸ¥çœ‹å®Œæ•´é”™è¯¯å †æ ˆä¿¡æ¯',
                            'æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—',
                            'å°è¯•åœ¨ Firebase æ§åˆ¶å°æµ‹è¯•æ•°æ®åº“è®¿é—®'
                        ];
                    }

                    console.log('');
                    console.log('ğŸ’¡ é”™è¯¯è¯Šæ–­ï¼š');
                    console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                    console.log(`âš ï¸ ${errorMessage}`);
                    console.log('');
                    console.log('ğŸ”§ å»ºè®®çš„è§£å†³æ­¥éª¤ï¼š');
                    troubleshootingSteps.forEach((step, index) => {
                        console.log(`   ${index + 1}. ${step}`);
                    });
                    console.log('');
                    console.log('ğŸ“š é€šç”¨è§£å†³æ–¹æ³•ï¼š');
                    console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                    console.log('1. è®¿é—® Firebase æ§åˆ¶å°ï¼š');
                    console.log('   https://console.firebase.google.com/');
                    console.log('');
                    console.log('2. é€‰æ‹©é¡¹ç›®: my-ecommerce-app-2e824');
                    console.log('');
                    console.log('3. ç¡®è®¤ Realtime Database å·²åˆ›å»ºä¸”å¯è®¿é—®');
                    console.log('');
                    console.log('4. åœ¨ Database è§„åˆ™ä¸­è®¾ç½®ä¸ºæµ‹è¯•æ¨¡å¼ï¼š');
                    console.log('   {');
                    console.log('     "rules": {');
                    console.log('       ".read": true,');
                    console.log('       ".write": true');
                    console.log('     }');
                    console.log('   }');
                    console.log('');
                    console.log('5. ç¡®ä¿æ•°æ®åº“ URL æ­£ç¡®ï¼š');
                    console.log('   ' + this.firebaseConfig.databaseURL);
                    console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                    console.log('');
                    console.log('ğŸ’¡ åº”ç”¨å°†ä»¥æœ¬åœ°æ¨¡å¼ç»§ç»­è¿è¡Œ');
                    console.log('ğŸ“ æ‰€æœ‰æ•°æ®å°†ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­');

                    // æ›´æ–°UIçŠ¶æ€æŒ‡ç¤ºå™¨ä¸ºé”™è¯¯çŠ¶æ€
                    this.updateSyncStatusUI(false);

                    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºï¼ˆå·²æ³¨é‡Šï¼Œä¸æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼‰
                    // showNotification(`âš ï¸ äº‘ç«¯åŒæ­¥åˆå§‹åŒ–å¤±è´¥: ${errorMessage}`, 'error');
                }
            }

            // æ›´æ–°åŒæ­¥çŠ¶æ€UIæŒ‡ç¤ºå™¨
            updateSyncStatusUI(isEnabled) {
                const syncIcon = document.getElementById('sync-icon');
                const syncText = document.getElementById('sync-text');

                if (syncIcon && syncText) {
                    if (isEnabled) {
                        syncIcon.style.color = '#28a745'; // ç»¿è‰²
                        syncText.textContent = 'äº‘ç«¯å·²åŒæ­¥';
                        syncText.style.color = '#28a745';
                    } else {
                        syncIcon.style.color = '#6c757d'; // ç°è‰²
                        syncText.textContent = 'æœ¬åœ°æ¨¡å¼';
                        syncText.style.color = '#6c757d';
                    }
                }
            }

            // æµ‹è¯•Firebaseè¿æ¥
            async testConnection() {
                console.log('');
                console.log('ğŸ” ========== Firebase è¿æ¥æµ‹è¯•å¼€å§‹ ==========');
                const testStartTime = Date.now();

                try {
                    // æµ‹è¯•æ–¹æ³• 1: æ£€æŸ¥ .info/connected
                    console.log('ğŸ“¡ [æµ‹è¯• 1/3] æ£€æŸ¥ Firebase è¿æ¥çŠ¶æ€...');
                    console.log('   - ç›®æ ‡: .info/connected');

                    const connectedRef = this.db.ref('.info/connected');
                    console.log('   - Reference åˆ›å»ºæˆåŠŸ');

                    const connectedSnapshot = await Promise.race([
                        connectedRef.once('value'),
                        new Promise((_, reject) => setTimeout(() => reject(new Error('è¿æ¥çŠ¶æ€æ£€æŸ¥è¶…æ—¶ (15ç§’)')), 15000))
                    ]);

                    const isConnected = connectedSnapshot.val();
                    console.log('   - è¿æ¥çŠ¶æ€è¿”å›å€¼:', isConnected);
                    console.log('   - æ•°æ®ç±»å‹:', typeof isConnected);

                    if (isConnected === true) {
                        console.log('   âœ… Firebase å®æ—¶è¿æ¥å·²å»ºç«‹');
                        console.log('');

                        // é¢å¤–éªŒè¯ï¼šå°è¯•è¯»å–æ ¹èŠ‚ç‚¹
                        console.log('ğŸ“– [æµ‹è¯• 2/3] éªŒè¯è¯»å–æƒé™...');
                        try {
                            const rootRef = this.db.ref('/');
                            await Promise.race([
                                rootRef.once('value'),
                                new Promise((_, reject) => setTimeout(() => reject(new Error('è¯»å–æµ‹è¯•è¶…æ—¶ (10ç§’)')), 10000))
                            ]);
                            console.log('   âœ… è¯»å–æƒé™éªŒè¯æˆåŠŸ');
                        } catch (readError) {
                            console.warn('   âš ï¸ è¯»å–æƒé™éªŒè¯å¤±è´¥:', readError.message);
                            throw readError;
                        }

                        console.log('');
                        const testDuration = Date.now() - testStartTime;
                        console.log(`âœ… ========== è¿æ¥æµ‹è¯•æˆåŠŸ (è€—æ—¶: ${testDuration}ms) ==========`);
                        console.log('');
                        return true;
                    }

                    // å¦‚æœ .info/connected è¿”å› falseï¼Œç»§ç»­å…¶ä»–æµ‹è¯•
                    console.log('   âš ï¸ è¿æ¥çŠ¶æ€æ˜¾ç¤ºæœªè¿æ¥ï¼Œç»§ç»­æ·±åº¦æµ‹è¯•...');
                    console.log('');

                    // æµ‹è¯•æ–¹æ³• 2: å°è¯•å†™å…¥å’Œè¯»å–æµ‹è¯•æ•°æ®
                    console.log('âœï¸ [æµ‹è¯• 3/3] æµ‹è¯•è¯»å†™æƒé™...');
                    const testDataRef = this.db.ref('_connection_test');
                    const testData = {
                        timestamp: Date.now(),
                        status: 'testing',
                        random: Math.random().toString(36).substring(7)
                    };

                    console.log('   - å†™å…¥æµ‹è¯•æ•°æ®...');
                    console.log('   - æµ‹è¯•è·¯å¾„:', testDataRef.toString());
                    console.log('   - æµ‹è¯•æ•°æ®:', JSON.stringify(testData));

                    await Promise.race([
                        testDataRef.set(testData),
                        new Promise((_, reject) => setTimeout(() => reject(new Error('å†™å…¥æµ‹è¯•è¶…æ—¶ (10ç§’)')), 10000))
                    ]);
                    console.log('   âœ… å†™å…¥æˆåŠŸ');

                    console.log('   - è¯»å–éªŒè¯...');
                    const readSnapshot = await Promise.race([
                        testDataRef.once('value'),
                        new Promise((_, reject) => setTimeout(() => reject(new Error('è¯»å–æµ‹è¯•è¶…æ—¶ (10ç§’)')), 10000))
                    ]);

                    const readData = readSnapshot.val();
                    console.log('   - è¯»å–æ•°æ®:', JSON.stringify(readData));

                    if (readData && readData.random === testData.random) {
                        console.log('   âœ… è¯»å–éªŒè¯æˆåŠŸ (æ•°æ®åŒ¹é…)');
                    } else {
                        console.warn('   âš ï¸ è¯»å–æ•°æ®ä¸åŒ¹é…');
                    }

                    // æ¸…ç†æµ‹è¯•æ•°æ®
                    console.log('   - æ¸…ç†æµ‹è¯•æ•°æ®...');
                    await Promise.race([
                        testDataRef.remove(),
                        new Promise((_, reject) => setTimeout(() => reject(new Error('æ¸…ç†è¶…æ—¶ (5ç§’)')), 5000))
                    ]);
                    console.log('   âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç†');

                    console.log('');
                    const testDuration = Date.now() - testStartTime;
                    console.log(`âœ… ========== è¿æ¥æµ‹è¯•æˆåŠŸ (è€—æ—¶: ${testDuration}ms) ==========`);
                    console.log('ğŸ“ å¤‡æ³¨: .info/connected æ˜¾ç¤ºæœªè¿æ¥ï¼Œä½†è¯»å†™æµ‹è¯•é€šè¿‡');
                    console.log('');

                    return true;

                } catch (error) {
                    console.log('');
                    console.error('âŒ ========== Firebase è¿æ¥æµ‹è¯•å¤±è´¥ ==========');
                    console.error('é”™è¯¯ç±»å‹:', error.name);
                    console.error('é”™è¯¯ä»£ç :', error.code);
                    console.error('é”™è¯¯æ¶ˆæ¯:', error.message);

                    // è¯¦ç»†çš„é”™è¯¯è¯Šæ–­
                    if (error.message?.includes('Permission denied') || error.code === 'PERMISSION_DENIED') {
                        console.error('');
                        console.error('ğŸš« æƒé™è¢«æ‹’ç» - æ•°æ®åº“è§„åˆ™é…ç½®é—®é¢˜');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                        console.error('è¿™æ˜¯æœ€å¸¸è§çš„é”™è¯¯ï¼Œé€šå¸¸æ˜¯å› ä¸ºæ•°æ®åº“è§„åˆ™é™åˆ¶äº†è®¿é—®ã€‚');
                        console.error('');
                        console.error('ğŸ“‹ è§£å†³æ–¹æ³•ï¼š');
                        console.error('1. è®¿é—® Firebase æ§åˆ¶å°');
                        console.error('   https://console.firebase.google.com/project/my-ecommerce-app-2e824/database/rules');
                        console.error('');
                        console.error('2. å°†è§„åˆ™è®¾ç½®ä¸ºæµ‹è¯•æ¨¡å¼ï¼ˆå…è®¸æ‰€æœ‰è¯»å†™ï¼‰ï¼š');
                        console.error('   {');
                        console.error('     "rules": {');
                        console.error('       ".read": true,');
                        console.error('       ".write": true');
                        console.error('     }');
                        console.error('   }');
                        console.error('');
                        console.error('3. ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®');
                        console.error('4. ç­‰å¾…10-30ç§’è®©è§„åˆ™ç”Ÿæ•ˆ');
                        console.error('5. åˆ·æ–°æ­¤é¡µé¢é‡è¯•');
                        console.error('');
                        console.error('âš ï¸ æ³¨æ„: æµ‹è¯•æ¨¡å¼è§„åˆ™ä¼šåœ¨30å¤©åè¿‡æœŸ');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');

                    } else if (error.message?.includes('timeout') || error.message?.includes('è¶…æ—¶')) {
                        console.error('');
                        console.error('â±ï¸ è¿æ¥è¶…æ—¶ - ç½‘ç»œæˆ–æœåŠ¡å™¨é—®é¢˜');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                        console.error('ğŸ“‹ å¯èƒ½çš„åŸå› ï¼š');
                        console.error('1. ç½‘ç»œè¿æ¥ä¸ç¨³å®š');
                        console.error('2. Firebase æœåŠ¡å™¨å“åº”ç¼“æ…¢');
                        console.error('3. é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢è¿æ¥');
                        console.error('4. æ•°æ®åº“åŒºåŸŸè®¾ç½®ä¸æ­£ç¡®');
                        console.error('');
                        console.error('ğŸ“‹ è§£å†³æ–¹æ³•ï¼š');
                        console.error('1. æ£€æŸ¥ç½‘ç»œè¿æ¥');
                        console.error('2. ç¡®è®¤ databaseURL æ­£ç¡®');
                        console.error('3. å°è¯•åˆ·æ–°é¡µé¢é‡è¯•');
                        console.error('4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');

                    } else if (error.message?.includes('network') || error.message?.includes('fetch')) {
                        console.error('');
                        console.error('ğŸŒ ç½‘ç»œé”™è¯¯ - æ— æ³•è¿æ¥åˆ° Firebase');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                        console.error('ğŸ“‹ è§£å†³æ–¹æ³•ï¼š');
                        console.error('1. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸');
                        console.error('2. ç¡®è®¤å¯ä»¥è®¿é—® Firebase åŸŸå');
                        console.error('3. ç¦ç”¨VPNæˆ–ä»£ç†åé‡è¯•');
                        console.error('4. æ£€æŸ¥æµè§ˆå™¨æ‰©å±•æ˜¯å¦é˜»æ­¢äº†è¯·æ±‚');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');

                    } else {
                        console.error('');
                        console.error('â“ æœªçŸ¥é”™è¯¯');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                        console.error('å®Œæ•´é”™è¯¯å¯¹è±¡:', error);
                        console.error('é”™è¯¯å †æ ˆ:', error.stack);
                        console.error('');
                        console.error('ğŸ“‹ å»ºè®®ï¼š');
                        console.error('1. æŸ¥çœ‹ä¸Šé¢çš„å®Œæ•´é”™è¯¯ä¿¡æ¯');
                        console.error('2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œæ ‡ç­¾');
                        console.error('3. ç¡®è®¤ Firebase é…ç½®æ­£ç¡®');
                        console.error('4. åœ¨ Firebase æ§åˆ¶å°æµ‹è¯•æ•°æ®åº“è®¿é—®');
                        console.error('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                    }

                    console.error('');
                    console.error('ğŸ”— å¿«é€Ÿé“¾æ¥ï¼š');
                    console.error('Firebase æ§åˆ¶å°: https://console.firebase.google.com/');
                    console.error('é¡¹ç›®é“¾æ¥: https://console.firebase.google.com/project/my-ecommerce-app-2e824');
                    console.error('æ•°æ®åº“è§„åˆ™: https://console.firebase.google.com/project/my-ecommerce-app-2e824/database/rules');
                    console.error('');

                    const testDuration = Date.now() - testStartTime;
                    console.error(`âŒ ========== æµ‹è¯•å¤±è´¥ (è€—æ—¶: ${testDuration}ms) ==========`);
                    console.error('');

                    throw error;
                }
            }

            // è¯Šæ–­Firebaseé…ç½®
            diagnoseConfiguration() {
                console.log('');
                console.log('ğŸ” ========== Firebase é…ç½®è¯Šæ–­ ==========');
                console.log('');

                const checks = [];

                // æ£€æŸ¥ apiKey
                if (!this.firebaseConfig.apiKey) {
                    checks.push({ item: 'API Key', status: 'âŒ ç¼ºå¤±', severity: 'error' });
                } else if (this.firebaseConfig.apiKey === 'YOUR_API_KEY_HERE') {
                    checks.push({ item: 'API Key', status: 'âŒ æœªè®¾ç½® (é»˜è®¤å€¼)', severity: 'error' });
                } else if (this.firebaseConfig.apiKey.length < 30) {
                    checks.push({ item: 'API Key', status: 'âš ï¸ å¯èƒ½æ— æ•ˆ (é•¿åº¦ä¸è¶³)', severity: 'warning' });
                } else {
                    checks.push({ item: 'API Key', status: 'âœ… å·²è®¾ç½®', severity: 'ok' });
                }

                // æ£€æŸ¥ projectId
                if (!this.firebaseConfig.projectId) {
                    checks.push({ item: 'Project ID', status: 'âŒ ç¼ºå¤±', severity: 'error' });
                } else if (this.firebaseConfig.projectId === 'your-project') {
                    checks.push({ item: 'Project ID', status: 'âŒ æœªè®¾ç½® (é»˜è®¤å€¼)', severity: 'error' });
                } else {
                    checks.push({ item: 'Project ID', status: `âœ… ${this.firebaseConfig.projectId}`, severity: 'ok' });
                }

                // æ£€æŸ¥ databaseURL
                if (!this.firebaseConfig.databaseURL) {
                    checks.push({ item: 'Database URL', status: 'âŒ ç¼ºå¤±', severity: 'error' });
                } else if (!this.firebaseConfig.databaseURL.startsWith('https://')) {
                    checks.push({ item: 'Database URL', status: 'âŒ æ ¼å¼é”™è¯¯ (å¿…é¡»ä»¥ https:// å¼€å¤´)', severity: 'error' });
                } else if (this.firebaseConfig.databaseURL.endsWith('/')) {
                    checks.push({ item: 'Database URL', status: 'âš ï¸ URL æœ«å°¾æœ‰æ–œæ  (å»ºè®®ç§»é™¤)', severity: 'warning' });
                } else if (!this.firebaseConfig.databaseURL.includes('firebasedatabase.app')) {
                    checks.push({ item: 'Database URL', status: 'âš ï¸ URLæ ¼å¼å¯èƒ½ä¸æ­£ç¡®', severity: 'warning' });
                } else {
                    checks.push({ item: 'Database URL', status: 'âœ… æ ¼å¼æ­£ç¡®', severity: 'ok' });
                }

                // æ£€æŸ¥ authDomain
                if (!this.firebaseConfig.authDomain) {
                    checks.push({ item: 'Auth Domain', status: 'âš ï¸ ç¼ºå¤±', severity: 'warning' });
                } else {
                    checks.push({ item: 'Auth Domain', status: 'âœ… å·²è®¾ç½®', severity: 'ok' });
                }

                // æ£€æŸ¥ storageBucket
                if (!this.firebaseConfig.storageBucket) {
                    checks.push({ item: 'Storage Bucket', status: 'âš ï¸ ç¼ºå¤±', severity: 'warning' });
                } else {
                    checks.push({ item: 'Storage Bucket', status: 'âœ… å·²è®¾ç½®', severity: 'ok' });
                }

                // æ˜¾ç¤ºè¯Šæ–­ç»“æœ
                console.log('ğŸ“‹ é…ç½®é¡¹æ£€æŸ¥ï¼š');
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                checks.forEach(check => {
                    console.log(`${check.item.padEnd(20)} : ${check.status}`);
                });
                console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                console.log('');

                // ç»Ÿè®¡
                const errors = checks.filter(c => c.severity === 'error').length;
                const warnings = checks.filter(c => c.severity === 'warning').length;
                const oks = checks.filter(c => c.severity === 'ok').length;

                console.log('ğŸ“Š ç»Ÿè®¡ï¼š');
                console.log(`   âœ… æ­£å¸¸: ${oks} é¡¹`);
                console.log(`   âš ï¸ è­¦å‘Š: ${warnings} é¡¹`);
                console.log(`   âŒ é”™è¯¯: ${errors} é¡¹`);
                console.log('');

                if (errors > 0) {
                    console.log('âŒ é…ç½®å­˜åœ¨ä¸¥é‡é”™è¯¯ï¼Œäº‘ç«¯åŒæ­¥æ— æ³•å¯ç”¨');
                    console.log('ğŸ’¡ è¯·ä¿®å¤ä¸Šè¿°é”™è¯¯åé‡è¯•');
                } else if (warnings > 0) {
                    console.log('âš ï¸ é…ç½®å­˜åœ¨è­¦å‘Šï¼Œå»ºè®®ä¿®å¤ä»¥ç¡®ä¿æœ€ä½³ä½“éªŒ');
                } else {
                    console.log('âœ… é…ç½®çœ‹èµ·æ¥æ­£å¸¸');
                }

                console.log('');
                console.log('ğŸ”— è·å–æ­£ç¡®é…ç½®ï¼š');
                console.log('   1. è®¿é—® https://console.firebase.google.com/');
                console.log('   2. é€‰æ‹©ä½ çš„é¡¹ç›®');
                console.log('   3. ç‚¹å‡»é¡¹ç›®è®¾ç½® > å¸¸è§„');
                console.log('   4. åœ¨"æ‚¨çš„åº”ç”¨"éƒ¨åˆ†æ‰¾åˆ° Web åº”ç”¨');
                console.log('   5. å¤åˆ¶ firebaseConfig å¯¹è±¡');
                console.log('');
                console.log('========================================');
                console.log('');

                return { errors, warnings, oks, checks };
            }

            // è·å–ç”¨æˆ·ä¸“å±è·¯å¾„
            getUserPath(targetAccount) {
                const accountValue = targetAccount || (currentUser ? (currentUser.account || currentUser.email) : null);
                if (!accountValue) return 'users/guest';
                const userId = accountValue;
                return `users/${userId.replace(/[.@]/g, '_')}`;
            }

            async deleteUserAccount(account) {
                if (!this.isInitialized || !account) return;
                const userPath = this.getUserPath(account);
                try {
                    await this.db.ref(userPath).remove();
                    console.log(`âœ… å·²ä»äº‘ç«¯åˆ é™¤è´¦å· ${account}`);
                } catch (error) {
                    console.error(`äº‘ç«¯åˆ é™¤è´¦å· ${account} å¤±è´¥:`, error);
                    throw error;
                }
            }

            // ========== ç»Ÿä¸€æ•°æ®åŒæ­¥ç®¡ç†å™¨ ==========
            // åŒæ­¥çŠ¶æ€ç®¡ç†
            _syncState = {
                inProgress: false,
                queue: [],
                lastSyncTime: null,
                errorCount: 0,
                // æ·»åŠ ä¿æŠ¤æœºåˆ¶ï¼šè·Ÿè¸ªè‡ªå·±è§¦å‘çš„æ›´æ–°ï¼Œé¿å…ç›‘å¬å™¨è¦†ç›–
                lastLocalUpdate: {
                    products: null,  // æœ€åæœ¬åœ°æ›´æ–°çš„äº§å“æ•°æ®æ—¶é—´æˆ³
                    timestamp: 0     // æœ€åæœ¬åœ°æ›´æ–°çš„æ—¶é—´æˆ³
                },
                protectionPeriod: 3000  // ä¿æŠ¤æœŸï¼šåŒæ­¥å®Œæˆå3ç§’å†…å¿½ç•¥ç›‘å¬å™¨æ›´æ–°
            };

            // ç»Ÿä¸€åŒæ­¥å…¥å£ï¼šè‡ªåŠ¨ç®¡ç†åŒæ­¥çŠ¶æ€ï¼Œé¿å…é‡å¤åŒæ­¥
            async syncAllData() {
                if (!this.isInitialized) {
                    console.warn('âš ï¸ äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–ï¼Œè·³è¿‡åŒæ­¥');
                    return;
                }

                // å¦‚æœæ­£åœ¨åŒæ­¥ï¼Œå°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—
                if (this._syncState.inProgress) {
                    console.log('â³ åŒæ­¥è¿›è¡Œä¸­ï¼Œè¯·æ±‚å·²åŠ å…¥é˜Ÿåˆ—');
                    return new Promise((resolve) => {
                        this._syncState.queue.push(resolve);
                    });
                }

                return this._executeSync();
            }

            // æ‰§è¡ŒåŒæ­¥ï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰
            async _executeSync() {
                this._syncState.inProgress = true;
                this._syncState.errorCount = 0;

                try {
                    console.log('ğŸ”„ å¼€å§‹äº‘ç«¯åŒæ­¥...');

                    // åŒæ­¥å…¨å±€å…±äº«æ•°æ®
                    if (isCurrentUserAdmin()) {
                        // ç®¡ç†å‘˜ï¼šä»¥ä¸Šä¼ æœ¬åœ°ä¸ºå‡†ï¼Œè¦†ç›–äº‘ç«¯
                        await this._safeSync('products', () => this.syncProducts());
                        await this._safeSync('users', () => this.syncAllUsers());
                    } else {
                        // æ™®é€šç”¨æˆ·ï¼šåªä»äº‘ç«¯æ‹‰å–æœ€æ–°æ•°æ®ï¼Œä¸ä¸Šä¼ è¦†ç›–
                        await this._safeSync('products', () => this.loadProducts());
                        await this._safeSync('users', () => this.loadAllUsers());
                        await this._safeSync('settings', () => this.loadHomepageSettings());
                    }

                    // åŒæ­¥ç”¨æˆ·è®¢å•å’Œåœ°å€
                    if (currentUser) {
                        await this._safeSync('profile', () => this.syncUserData());
                        await this._safeSync('orders', () => this.syncOrders());
                        await this._safeSync('addresses', () => this.syncAddresses());
                    }

                    this._syncState.lastSyncTime = new Date();
                    this._syncState.errorCount = 0;
                    console.log('âœ… äº‘ç«¯åŒæ­¥å®Œæˆ');

                } catch (error) {
                    this._syncState.errorCount++;
                    console.error('äº‘ç«¯åŒæ­¥å¤±è´¥:', error);
                    if (this._syncState.errorCount <= 3) {
                        showNotification('äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œå°†è‡ªåŠ¨é‡è¯•', 'warning');
                    } else {
                        showNotification('äº‘ç«¯åŒæ­¥å¤šæ¬¡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                    }
                } finally {
                    this._syncState.inProgress = false;
                    // å¤„ç†é˜Ÿåˆ—ä¸­çš„ç­‰å¾…è¯·æ±‚
                    if (this._syncState.queue.length > 0) {
                        const nextResolve = this._syncState.queue.shift();
                        this._executeSync().then(() => nextResolve()).catch(() => nextResolve());
                    }
                }
            }

            // å®‰å…¨åŒæ­¥åŒ…è£…å™¨ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
            async _safeSync(type, syncFn) {
                const maxRetries = 2;
                let lastError = null;

                for (let attempt = 0; attempt <= maxRetries; attempt++) {
                    try {
                        await syncFn();
                        return;
                    } catch (error) {
                        lastError = error;
                        if (attempt < maxRetries) {
                            console.warn(`âš ï¸ ${type} åŒæ­¥å¤±è´¥ï¼Œ${1000 * (attempt + 1)}ms åé‡è¯•...`, error.message);
                            await new Promise(resolve => setTimeout(resolve, 1000 * (attempt + 1)));
                        }
                    }
                }

                console.error(`âŒ ${type} åŒæ­¥æœ€ç»ˆå¤±è´¥:`, lastError);
                throw lastError;
            }

            // åŒæ­¥äº§å“æ•°æ®
            async syncProducts() {
                // åªæœ‰ç®¡ç†å‘˜æ‰å…è®¸æŠŠæœ¬åœ°äº§å“åˆ—è¡¨å†™å›äº‘ç«¯ï¼Œé˜²æ­¢æ™®é€šç”¨æˆ·è¦†ç›–ç®¡ç†å‘˜æ”¹åŠ¨
                if (!isCurrentUserAdmin()) {
                    console.log('â„¹ï¸ å½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œè·³è¿‡äº§å“ä¸Šä¼ åŒæ­¥');
                    return;
                }
                
                // é˜²æ­¢ç©ºæ•°æ®è¦†ç›–äº‘ç«¯ï¼šå¦‚æœæœ¬åœ°äº§å“æ•°ç»„ä¸ºç©ºï¼Œä¸æ‰§è¡Œä¸Šä¼ æ“ä½œ
                // è¿™å¯ä»¥é¿å…é€€å‡ºåæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼Œä¸‹æ¬¡ç™»å½•æ—¶æŠŠç©ºæ•°æ®ä¸Šä¼ åˆ°äº‘ç«¯çš„é—®é¢˜
                if (!products || products.length === 0) {
                    console.log('âš ï¸ æœ¬åœ°äº§å“æ•°æ®ä¸ºç©ºï¼Œè·³è¿‡ä¸Šä¼ ï¼ˆé¿å…è¦†ç›–äº‘ç«¯æ•°æ®ï¼‰');
                    return;
                }
                
                // è®°å½•æœ¬åœ°æ›´æ–°çš„æ—¶é—´æˆ³å’Œäº§å“æ•°æ®å¿«ç…§ï¼Œç”¨äºç›‘å¬å™¨åˆ¤æ–­æ˜¯å¦å¿½ç•¥æ›´æ–°
                const now = Date.now();
                this._syncState.lastLocalUpdate.products = JSON.stringify(products);
                this._syncState.lastLocalUpdate.timestamp = now;
                
                console.log('ğŸ”„ å¼€å§‹ä¸Šä¼ äº§å“æ•°æ®åˆ°äº‘ç«¯ï¼Œè®¾ç½®ä¿æŠ¤æœŸ...');
                
                const productsRef = this.db.ref('products');
                // ä¸Šä¼ æœ¬åœ°äº§å“åˆ°äº‘ç«¯
                await productsRef.set(products);
                console.log('âœ… äº§å“æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼Œæ•°é‡:', products.length);
                
                // è®¾ç½®ä¿æŠ¤æœŸï¼šåœ¨ä¿æŠ¤æœŸå†…ï¼Œç›‘å¬å™¨ä¼šå¿½ç•¥æ¥è‡ªäº‘ç«¯çš„æ›´æ–°ï¼ˆå› ä¸ºæ˜¯è‡ªå·±è§¦å‘çš„ï¼‰
                // ä¿æŠ¤æœŸç»“æŸåï¼Œå¦‚æœäº‘ç«¯æ•°æ®è¢«å…¶ä»–è®¾å¤‡ä¿®æ”¹ï¼Œç›‘å¬å™¨æ‰ä¼šåº”ç”¨æ›´æ–°
                setTimeout(() => {
                    const elapsed = Date.now() - this._syncState.lastLocalUpdate.timestamp;
                    if (elapsed >= this._syncState.protectionPeriod) {
                        console.log('âœ… ä¿æŠ¤æœŸå·²ç»“æŸï¼Œç›‘å¬å™¨ç°åœ¨å¯ä»¥æ¥æ”¶äº‘ç«¯æ›´æ–°');
                    }
                }, this._syncState.protectionPeriod);
            }

            // ä»äº‘ç«¯åŠ è½½äº§å“æ•°æ®ï¼ˆä»…äº‘ç«¯ï¼Œå¤šæ¬¡é‡è¯•ï¼‰
            async loadProducts(maxAttempts = 3, retryDelay = 800) {
                if (!this.isInitialized) {
                    console.warn('âš ï¸ Firebaseæœªåˆå§‹åŒ–ï¼Œæ— æ³•åŠ è½½äº§å“');
                    return false;
                }

                let lastError = null;
                for (let attempt = 1; attempt <= maxAttempts; attempt++) {
                    try {
                        console.log(`ğŸ”„ [äº§å“åŠ è½½] ç¬¬ ${attempt}/${maxAttempts} æ¬¡å°è¯•ä»äº‘ç«¯æ‹‰å–...`);
                        const snapshot = await this.db.ref('products').once('value');
                        const cloudProducts = snapshot.val();

                        console.log('ğŸ“¥ äº‘ç«¯åŸå§‹æ•°æ®:', cloudProducts ? (Array.isArray(cloudProducts) ? `æ•°ç»„ï¼Œé•¿åº¦: ${cloudProducts.length}` : `å¯¹è±¡ç±»å‹: ${typeof cloudProducts}`) : 'null/undefined');

                        if (cloudProducts && Array.isArray(cloudProducts) && cloudProducts.length > 0) {
                            // è¿‡æ»¤æ‰æ— æ•ˆçš„äº§å“ï¼ˆnullã€undefined æˆ–ç¼ºå°‘å¿…è¦å±æ€§ï¼‰
                            const beforeFilter = cloudProducts.length;
                            products = cloudProducts.filter(p => {
                                const isValid = p && typeof p === 'object' && p.id && p.name;
                                if (!isValid && p) {
                                    console.warn('âš ï¸ å‘ç°æ— æ•ˆäº§å“:', p);
                                }
                                return isValid;
                            });
                            
                            const filteredOut = beforeFilter - products.length;
                            if (filteredOut > 0) {
                                console.warn(`âš ï¸ è¿‡æ»¤æ‰äº† ${filteredOut} ä¸ªæ— æ•ˆäº§å“`);
                            }
                            
                            localStorage.setItem('products', JSON.stringify(products));
                            console.log(`âœ… å·²ä»äº‘ç«¯åŠ è½½äº§å“æ•°æ®ï¼Œæœ‰æ•ˆäº§å“æ•°é‡: ${products.length}`);
                            
                            // éªŒè¯æ•°æ®æ˜¯å¦çœŸçš„ä¿å­˜æˆåŠŸ
                            const savedProducts = JSON.parse(localStorage.getItem('products') || '[]');
                            if (savedProducts.length !== products.length) {
                                console.error('âŒ äº§å“æ•°æ®ä¿å­˜åˆ°localStorageåæ•°é‡ä¸åŒ¹é…ï¼');
                                console.log(`   å†…å­˜ä¸­: ${products.length}, localStorageä¸­: ${savedProducts.length}`);
                            }
                            
                            return true;
                        } else {
                            if (!cloudProducts) {
                                console.warn('âš ï¸ äº‘ç«¯äº§å“æ•°æ®ä¸ºç©ºï¼ˆnull/undefinedï¼‰');
                            } else if (!Array.isArray(cloudProducts)) {
                                console.warn(`âš ï¸ äº‘ç«¯äº§å“æ•°æ®æ ¼å¼é”™è¯¯ï¼ŒæœŸæœ›æ•°ç»„ï¼Œå®é™…: ${typeof cloudProducts}`);
                            } else if (cloudProducts.length === 0) {
                                console.warn('âš ï¸ äº‘ç«¯äº§å“æ•°ç»„ä¸ºç©º');
                            }
                        }
                    } catch (error) {
                        lastError = error;
                        console.error(`âŒ ç¬¬ ${attempt} æ¬¡åŠ è½½äº‘ç«¯äº§å“å¤±è´¥:`, error);
                        console.error('   é”™è¯¯è¯¦æƒ…:', error.message);
                    }

                    if (attempt < maxAttempts) {
                        console.log(`â³ ç­‰å¾… ${retryDelay}ms åé‡è¯•...`);
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                    }
                }

                console.error('âŒ å¤šæ¬¡å°è¯•åä»æ— æ³•ä»äº‘ç«¯è·å–äº§å“æ•°æ®', lastError);
                return false;
            }

            // åŒæ­¥ç”¨æˆ·æ•°æ®
            async syncUserData() {
                if (!currentUser) return;

                // è®¿å®¢ç”¨æˆ·ä¸åŒæ­¥ä¸ªäººæ•°æ®
                if (currentUser.username === 'guest') {
                    console.log('â„¹ï¸ è®¿å®¢ç”¨æˆ·è·³è¿‡ä¸ªäººæ•°æ®åŒæ­¥');
                    return;
                }

                try {
                    const userPath = this.getUserPath();
                    const userRef = this.db.ref(`${userPath}/profile`);

                    await userRef.set({
                        email: currentUser.email || '',
                        username: currentUser.username,
                        phone: currentUser.phone || '',
                        avatar: currentUser.avatar || '',
                        updatedAt: Date.now()
                    });

                    console.log('âœ… ç”¨æˆ·æ•°æ®å·²åŒæ­¥');
                } catch (error) {
                    console.error('ç”¨æˆ·æ•°æ®åŒæ­¥å¤±è´¥:', error);
                    throw error;
                }
            }

            // åŒæ­¥è®¢å•æ•°æ®
            async syncOrders() {
                if (!currentUser) return;

                // è®¿å®¢ç”¨æˆ·ä¸åŒæ­¥è®¢å•æ•°æ®
                if (currentUser.username === 'guest') {
                    console.log('â„¹ï¸ è®¿å®¢ç”¨æˆ·è·³è¿‡è®¢å•æ•°æ®åŒæ­¥');
                    return;
                }

                const userPath = this.getUserPath();
                const ordersRef = this.db.ref(`${userPath}/orders`);

                // ä¸ºæ¯ä¸ªè®¢å•æ·»åŠ æ›´æ–°æ—¶é—´æˆ³
                const ordersToSync = userOrders.map(order => ({
                    ...order,
                    updatedAt: order.updatedAt || Date.now(),
                    account: order.account || currentUser.account
                }));

                await ordersRef.set(ordersToSync);
                console.log('âœ… è®¢å•æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼Œæ•°é‡:', ordersToSync.length);
            }

            // ä»äº‘ç«¯åŠ è½½è®¢å•æ•°æ®ï¼ˆæ›´å®‰å…¨ï¼šä¼˜å…ˆä¿æŠ¤æœ¬åœ°æ•°æ®ï¼Œä¸è½»æ˜“æ¸…ç©ºï¼‰
            async loadOrders() {
                if (!this.isInitialized || !currentUser) {
                    // æœªç™»å½•æ—¶æ¸…ç©ºè®¢å•ï¼ˆè¿™æ˜¯ç”¨æˆ·ä¸»åŠ¨é€€å‡º/æœªç™»å½•åœºæ™¯ï¼Œå±äºæ­£å¸¸æ¸…ç©ºï¼‰
                    userOrders = [];
                    localStorage.setItem('userOrders', JSON.stringify(userOrders));
                    return false;
                }

                // åœ¨å°è¯•åŠ è½½å‰ï¼Œå…ˆå¤‡ä»½ä¸€ä»½å½“å‰æœ¬åœ°è®¢å•æ•°æ®ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤±
                try {
                    const backupKey = `userOrders_backup_${currentUser.account || 'guest'}`;
                    localStorage.setItem(backupKey, JSON.stringify(userOrders || []));
                } catch (backupError) {
                    console.warn('å¤‡ä»½æœ¬åœ°è®¢å•å¤±è´¥ï¼ˆä¸å½±å“æ­£å¸¸æµç¨‹ï¼‰:', backupError);
                }

                try {
                    const userPath = this.getUserPath();
                    const snapshot = await this.db.ref(`${userPath}/orders`).once('value');
                    const cloudOrders = snapshot.val();

                    if (cloudOrders && Array.isArray(cloudOrders) && cloudOrders.length > 0) {
                        // âœ… äº‘ç«¯æœ‰è®¢å•ï¼šä¸æœ¬åœ°è®¢å•è¿›è¡Œåˆå¹¶ï¼Œé¿å…æœ¬åœ°æˆ–äº‘ç«¯å•æ–¹é¢è¦†ç›–
                        console.log('âœ… æ£€æµ‹åˆ°äº‘ç«¯è®¢å•æ•°æ®ï¼Œå¼€å§‹åˆå¹¶æœ¬åœ°ä¸äº‘ç«¯è®¢å•...');
                        try {
                            mergeOrdersData(cloudOrders, currentUser.account || 'guest');
                        } catch (mergeError) {
                            console.warn('åˆå¹¶è®¢å•æ•°æ®å¤±è´¥ï¼Œæ”¹ä¸ºç›´æ¥ä½¿ç”¨äº‘ç«¯è®¢å•:', mergeError);
                            userOrders = cloudOrders;
                        }

                        const userOrdersKey = `userOrders_${currentUser.account || 'guest'}`;
                        localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                        localStorage.setItem('userOrders', JSON.stringify(userOrders));

                        console.log('âœ… å·²ä»äº‘ç«¯åŠ è½½å¹¶åˆå¹¶è®¢å•æ•°æ®:', userOrders.length, 'ä¸ªè®¢å•');
                        return true;
                    } else {
                        // â„¹ï¸ äº‘ç«¯æ²¡æœ‰è®¢å•
                        if (Array.isArray(userOrders) && userOrders.length > 0) {
                            // âœ… æœ¬åœ°æœ‰è®¢å•ï¼Œä½†äº‘ç«¯ä¸ºç©ºï¼šæ£€æŸ¥æ˜¯å¦æ˜¯æœ€è¿‘åˆ›å»ºçš„è®¢å•
                            // æ—¶é—´é˜ˆå€¼ï¼šåªä¿ç•™æœ€è¿‘30å¤©å†…åˆ›å»ºçš„è®¢å•
                            const RECENT_ORDER_THRESHOLD = 30 * 24 * 60 * 60 * 1000; // 30å¤©
                            const now = Date.now();
                            const recentOrders = userOrders.filter(order => {
                                if (!order || !order.id) return false;
                                const orderTime = order.date || order.updatedAt || 0;
                                return (now - orderTime) < RECENT_ORDER_THRESHOLD;
                            });
                            
                            if (recentOrders.length > 0) {
                                // åªä¿ç•™æœ€è¿‘åˆ›å»ºçš„è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                                userOrders = recentOrders;
                                const userOrdersKey = `userOrders_${currentUser.account || 'guest'}`;
                                localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                                localStorage.setItem('userOrders', JSON.stringify(userOrders));
                                
                                console.warn(`âš ï¸ äº‘ç«¯æš‚æ— è®¢å•æ•°æ®ï¼Œä½†æœ¬åœ°å­˜åœ¨ ${userOrders.length} ä¸ªæœ€è¿‘è®¢å•ï¼Œå°†ä¿ç•™å¹¶å°è¯•åŒæ­¥åˆ°äº‘ç«¯`);
                                if (typeof showNotification === 'function') {
                                    showNotification('æ£€æµ‹åˆ°æœ¬åœ°æœ‰æœªåŒæ­¥çš„è®¢å•ï¼Œæ­£åœ¨å°è¯•åŒæ­¥åˆ°äº‘ç«¯â€¦', 'warning');
                                }

                                // å°è¯•æŠŠæœ¬åœ°è®¢å•åŒæ­¥åˆ°äº‘ç«¯
                                try {
                                    if (typeof this.syncOrders === 'function') {
                                        await this.syncOrders();
                                    }
                                } catch (syncError) {
                                    console.error('å°è¯•å°†æœ¬åœ°è®¢å•åŒæ­¥åˆ°äº‘ç«¯å¤±è´¥:', syncError);
                                }

                                return true;
                            } else {
                                // æœ¬åœ°è®¢å•éƒ½æ˜¯æ—§çš„ï¼Œæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                                console.log('â„¹ï¸ æœ¬åœ°è®¢å•éƒ½æ˜¯æ—§çš„ï¼ˆè¶…è¿‡30å¤©ï¼‰ï¼Œæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼Œé¿å…å†å²æ•°æ®é‡ç°');
                                userOrders = [];
                                const userOrdersKey = `userOrders_${currentUser.account || 'guest'}`;
                                localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                                localStorage.setItem('userOrders', JSON.stringify(userOrders));
                                return false;
                            }
                        } else {
                            // äº‘ç«¯å’Œæœ¬åœ°éƒ½æ²¡æœ‰è®¢å•ï¼Œç¡®ä¿æœ¬åœ°æ˜¯ç©ºæ•°ç»„å³å¯
                            userOrders = [];
                            const userOrdersKey = `userOrders_${currentUser.account || 'guest'}`;
                            localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                            localStorage.setItem('userOrders', JSON.stringify(userOrders));
                            console.log('â„¹ï¸ äº‘ç«¯å’Œæœ¬åœ°å‡æ— è®¢å•æ•°æ®');
                            return false;
                        }
                    }
                } catch (error) {
                    console.error('åŠ è½½äº‘ç«¯è®¢å•å¤±è´¥ï¼ˆæœ¬åœ°æ•°æ®å°†è¢«ä¿ç•™ï¼‰:', error);
                    // â— åŠ è½½å¤±è´¥æ—¶ä¸å†æ¸…ç©ºæœ¬åœ°è®¢å•ï¼Œé¿å…æŠŠç”¨æˆ·è®¢å•â€œè¯¯åˆ â€
                    if (typeof showNotification === 'function') {
                        showNotification('åŠ è½½äº‘ç«¯è®¢å•å¤±è´¥ï¼Œå·²æš‚æ—¶ä¿ç•™æœ¬åœ°è®¢å•æ•°æ®', 'warning');
                    }
                    return false;
                }
            }
            
            // åŠ è½½æ‰€æœ‰ç”¨æˆ·çš„è®¢å•ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
            async loadAllOrders() {
                if (!this.isInitialized || !currentUser || currentUser.role !== 'admin') {
                    return false;
                }

                try {
                    const usersRef = this.db.ref('users');
                    const snapshot = await usersRef.once('value');
                    const usersData = snapshot.val();
                    
                    if (!usersData) {
                        console.log('â„¹ï¸ äº‘ç«¯æš‚æ— ç”¨æˆ·æ•°æ®');
                        return false;
                    }
                    
                    // æ”¶é›†æ‰€æœ‰ç”¨æˆ·çš„è®¢å•
                    const collectedOrders = [];
                    for (const userId in usersData) {
                        const userData = usersData[userId];
                        if (userData.orders && Array.isArray(userData.orders)) {
                            userData.orders.forEach(order => {
                                if (!order.account) {
                                    order.account = userId;
                                }
                                collectedOrders.push(order);
                            });
                        }
                    }
                    
                    if (collectedOrders.length > 0) {
                        // åˆå¹¶å‰å…ˆæ¸…ç©ºæœ¬åœ°æ—§æ•°æ®ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                        // ä»¥äº‘ç«¯æ•°æ®ä¸ºå‡†ï¼Œé¿å…æœ¬åœ°æ—§æ•°æ®å¹²æ‰°
                        mergeAllOrdersData(collectedOrders);
                        console.log('âœ… å·²ä»äº‘ç«¯åŠ è½½æ‰€æœ‰è®¢å•æ•°æ®:', allOrders.length, 'ä¸ªè®¢å•');
                        return true;
                    } else {
                        // äº‘ç«¯æ²¡æœ‰è®¢å•æ•°æ®ï¼Œæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                        console.log('â„¹ï¸ äº‘ç«¯æš‚æ— è®¢å•æ•°æ®ï¼Œæ¸…ç©ºæœ¬åœ°æ•°æ®');
                        allOrders = [];
                        localStorage.setItem('allOrders', JSON.stringify(allOrders));
                        return false;
                    }
                } catch (error) {
                    console.error('åŠ è½½æ‰€æœ‰è®¢å•å¤±è´¥:', error);
                    return false;
                }
            }

            // åŒæ­¥åœ°å€æ•°æ®
            async syncAddresses() {
                if (!currentUser) return;

                // è®¿å®¢ç”¨æˆ·ä¸åŒæ­¥åœ°å€æ•°æ®
                if (currentUser.username === 'guest') {
                    console.log('â„¹ï¸ è®¿å®¢ç”¨æˆ·è·³è¿‡åœ°å€æ•°æ®åŒæ­¥');
                    return;
                }

                const userPath = this.getUserPath();
                const addressesRef = this.db.ref(`${userPath}/addresses`);
                await addressesRef.set(userAddresses);
                console.log('âœ… åœ°å€æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼Œæ•°é‡:', userAddresses.length);
            }

            // ä»äº‘ç«¯åŠ è½½åœ°å€æ•°æ®ï¼ˆæ›´å®‰å…¨ï¼šä¼˜å…ˆä¿æŠ¤æœ¬åœ°æ•°æ®ï¼Œä¸è½»æ˜“æ¸…ç©ºï¼‰
            async loadAddresses() {
                if (!this.isInitialized || !currentUser) {
                    // æœªç™»å½•æ—¶æ¸…ç©ºåœ°å€ï¼ˆè¿™æ˜¯ç”¨æˆ·ä¸»åŠ¨é€€å‡º/æœªç™»å½•åœºæ™¯ï¼Œå±äºæ­£å¸¸æ¸…ç©ºï¼‰
                    userAddresses = [];
                    localStorage.setItem('userAddresses', JSON.stringify(userAddresses));
                    return false;
                }

                // åœ¨å°è¯•åŠ è½½å‰ï¼Œå…ˆå¤‡ä»½ä¸€ä»½å½“å‰æœ¬åœ°åœ°å€æ•°æ®ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤±
                try {
                    const backupKey = `userAddresses_backup_${currentUser.account || 'guest'}`;
                    localStorage.setItem(backupKey, JSON.stringify(userAddresses || []));
                } catch (backupError) {
                    console.warn('å¤‡ä»½æœ¬åœ°åœ°å€å¤±è´¥ï¼ˆä¸å½±å“æ­£å¸¸æµç¨‹ï¼‰:', backupError);
                }

                try {
                    const userPath = this.getUserPath();
                    const snapshot = await this.db.ref(`${userPath}/addresses`).once('value');
                    const cloudAddresses = snapshot.val();

                    if (cloudAddresses && Array.isArray(cloudAddresses) && cloudAddresses.length > 0) {
                        // âœ… äº‘ç«¯æœ‰åœ°å€ï¼šç›´æ¥ä»¥äº‘ç«¯ä¸ºå‡†è¦†ç›–æœ¬åœ°ï¼ˆåœ°å€ä¸€èˆ¬ä¸éœ€è¦å¤æ‚åˆå¹¶ï¼‰
                        userAddresses = cloudAddresses;
                        const userAddressesKey = `userAddresses_${currentUser.account || 'guest'}`;
                        localStorage.setItem(userAddressesKey, JSON.stringify(userAddresses));
                        localStorage.setItem('userAddresses', JSON.stringify(userAddresses)); // å…¼å®¹æ—§ä»£ç 
                        console.log('âœ… å·²ä»äº‘ç«¯åŠ è½½åœ°å€æ•°æ®:', userAddresses.length, 'ä¸ªåœ°å€');
                        return true;
                    } else {
                        // â„¹ï¸ äº‘ç«¯æ²¡æœ‰åœ°å€
                        if (Array.isArray(userAddresses) && userAddresses.length > 0) {
                            // âœ… æœ¬åœ°æœ‰åœ°å€ä½†äº‘ç«¯ä¸ºç©ºï¼šä¿æŠ¤æœ¬åœ°æ•°æ®ï¼Œæç¤ºå¹¶å°è¯•åŒæ­¥åˆ°äº‘ç«¯
                            console.warn('âš ï¸ äº‘ç«¯æš‚æ— åœ°å€æ•°æ®ï¼Œä½†æœ¬åœ°å­˜åœ¨', userAddresses.length, 'ä¸ªåœ°å€ï¼Œå°†ä¿ç•™æœ¬åœ°æ•°æ®å¹¶å°è¯•åŒæ­¥åˆ°äº‘ç«¯');
                            if (typeof showNotification === 'function') {
                                showNotification('æ£€æµ‹åˆ°æœ¬åœ°æœ‰æœªåŒæ­¥çš„åœ°å€ï¼Œæ­£åœ¨å°è¯•åŒæ­¥åˆ°äº‘ç«¯â€¦', 'warning');
                            }

                            try {
                                if (typeof this.syncAddresses === 'function') {
                                    await this.syncAddresses();
                                }
                            } catch (syncError) {
                                console.error('å°è¯•å°†æœ¬åœ°åœ°å€åŒæ­¥åˆ°äº‘ç«¯å¤±è´¥:', syncError);
                            }

                            // ä¸æ¸…ç©ºæœ¬åœ°åœ°å€ï¼Œåªæ˜¯è®°å½•æ—¥å¿—
                            return true;
                        } else {
                            // äº‘ç«¯å’Œæœ¬åœ°éƒ½æ²¡æœ‰åœ°å€ï¼Œç¡®ä¿æœ¬åœ°æ˜¯ç©ºæ•°ç»„å³å¯
                            userAddresses = [];
                            const userAddressesKey = `userAddresses_${currentUser.account || 'guest'}`;
                            localStorage.setItem(userAddressesKey, JSON.stringify(userAddresses));
                            localStorage.setItem('userAddresses', JSON.stringify(userAddresses));
                            console.log('â„¹ï¸ äº‘ç«¯å’Œæœ¬åœ°å‡æ— åœ°å€æ•°æ®');
                            return false;
                        }
                    }
                } catch (error) {
                    console.error('åŠ è½½äº‘ç«¯åœ°å€å¤±è´¥ï¼ˆæœ¬åœ°æ•°æ®å°†è¢«ä¿ç•™ï¼‰:', error);
                    // â— åŠ è½½å¤±è´¥æ—¶ä¸å†æ¸…ç©ºæœ¬åœ°åœ°å€ï¼Œé¿å…æŠŠç”¨æˆ·åœ°å€â€œè¯¯åˆ â€
                    if (typeof showNotification === 'function') {
                        showNotification('åŠ è½½äº‘ç«¯åœ°å€å¤±è´¥ï¼Œå·²æš‚æ—¶ä¿ç•™æœ¬åœ°åœ°å€æ•°æ®', 'warning');
                    }
                    return false;
                }
            }

            // åŒæ­¥æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆå…¨å±€å…±äº«ï¼‰
            async syncAllUsers() {
                const usersRef = this.db.ref('allUsers');

                if (isCurrentUserAdmin()) {
                    // ç®¡ç†å‘˜ï¼šä»äº‘ç«¯æ‹‰å–å¹¶ä¸æœ¬åœ°åˆå¹¶ï¼Œç„¶åå°†åˆå¹¶åçš„ç»“æœå†™å›äº‘ç«¯
                    console.log('ğŸ”„ ç®¡ç†å‘˜æ­£åœ¨åŒæ­¥æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆæ‹‰å– + åˆå¹¶ + å†™å›äº‘ç«¯ï¼‰...');
                    const snapshot = await usersRef.once('value');
                    const cloudUsers = Array.isArray(snapshot.val()) ? snapshot.val() : [];

                    const mergedUsers = mergeUsersData(cloudUsers, allUsers, { allowUnban: true });
                    allUsers = mergedUsers;
                    localStorage.setItem('allUsers', JSON.stringify(allUsers));

                    await usersRef.set(allUsers);
                    console.log('âœ… æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆå«ç¦ç”¨çŠ¶æ€ï¼‰å·²å†™å›äº‘ç«¯');
                } else {
                    // éç®¡ç†å‘˜ï¼šåªå°†è‡ªå·±æ·»åŠ åˆ°äº‘ç«¯çš„ allUsers æ•°ç»„
                    let targetAccount = null;
                    let targetUserData = null;
                    
                    if (currentUser && currentUser.account) {
                        targetAccount = currentUser.account;
                        targetUserData = findUserByAccount(targetAccount);
                    } else if (allUsers.length > 0) {
                        const sortedUsers = [...allUsers].sort((a, b) => {
                            const aId = a.id || (a.registerTime ? new Date(a.registerTime).getTime() : 0);
                            const bId = b.id || (b.registerTime ? new Date(b.registerTime).getTime() : 0);
                            return bId - aId;
                        });
                        targetUserData = sortedUsers[0];
                        targetAccount = targetUserData.account;
                    }
                    
                    if (targetAccount && targetUserData) {
                        // ä½¿ç”¨äº‹åŠ¡åŸå­åœ°æ›´æ–° allUsersï¼Œé¿å…å¹¶å‘å†™å¯¼è‡´çš„ä¸¢å¤±
                        await usersRef.transaction((current) => {
                            let list = Array.isArray(current) ? current.slice() : [];
                            const normalizedTargetAccount = normalizeAccount(targetAccount);
                            const idx = list.findIndex(u => {
                                if (!u) return false;
                                if (u.accountCanonical) {
                                    return u.accountCanonical === normalizedTargetAccount;
                                }
                                return normalizeAccount(u.account) === normalizedTargetAccount;
                            });
                            if (idx >= 0) {
                                const existing = list[idx];
                                // å®‰å…¨è§„åˆ™ï¼šå¦‚æœäº‘ç«¯è¯¥è´¦å·å·²è¢«ç¦ç”¨ï¼Œåˆ™æ™®é€šç”¨æˆ·ä¸èƒ½å†æŠŠå®ƒæ”¹å›æ­£å¸¸
                                if (existing && existing.status === 'banned' && targetUserData.status !== 'banned') {
                                    return list;
                                }
                                list[idx] = {
                                    ...existing,
                                    ...targetUserData,
                                    status: existing.status === 'banned' ? 'banned' : (targetUserData.status || existing.status),
                                };
                            } else {
                                list.push(targetUserData);
                            }
                            return list;
                        });
                        console.log('âœ… é€šè¿‡äº‹åŠ¡å·²å†™å…¥äº‘ç«¯ allUsers:', targetAccount);
                    }
                }
            }

            // æ¸…ç†äº‘ç«¯ users èŠ‚ç‚¹ï¼šä»…åˆ é™¤åœ¨ allUsers ä¸­ä¸å­˜åœ¨çš„è´¦å·
            async clearCloudUsers() {
                // åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œ
                if (!isCurrentUserAdmin()) {
                    console.warn('â„¹ï¸ å½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œç¦æ­¢æ¸…ç†äº‘ç«¯ users èŠ‚ç‚¹');
                    throw new Error('åªæœ‰ç®¡ç†å‘˜å¯ä»¥æ¸…ç†äº‘ç«¯ users èŠ‚ç‚¹');
                }

                if (!this.isInitialized || !this.db) {
                    throw new Error('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–ï¼Œæ— æ³•æ“ä½œäº‘ç«¯ç”¨æˆ·æ•°æ®');
                }

                try {
                    const allUsersSnap = await this.db.ref('allUsers').once('value');
                    const cloudAllUsers = Array.isArray(allUsersSnap.val()) ? allUsersSnap.val() : [];
                    // å®‰å…¨ä¿æŠ¤ï¼šå½“ allUsers ä¸ºç©ºæ—¶ï¼Œä¸æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œé¿å…è¯¯åˆ 
                    if (cloudAllUsers.length === 0) {
                        console.warn('âš ï¸ äº‘ç«¯ allUsers ä¸ºç©ºï¼Œå‡ºäºå®‰å…¨è€ƒè™‘è·³è¿‡ users æ¸…ç†');
                        return { removed: 0, skipped: true, reason: 'empty_allUsers' };
                    }
                    const keepAccounts = new Set(cloudAllUsers.map(u => u && u.account).filter(Boolean));

                    const usersRef = this.db.ref('users');
                    const usersSnap = await usersRef.once('value');
                    const usersData = usersSnap.val() || {};

                    const updates = {};
                    let removeCount = 0;
                    Object.keys(usersData).forEach(accountKey => {
                        if (!keepAccounts.has(accountKey)) {
                            updates[accountKey] = null; // ç½®ä¸º null å³åˆ é™¤è¯¥å­èŠ‚ç‚¹
                            removeCount++;
                        }
                    });

                    if (removeCount === 0) {
                        console.log('â„¹ï¸ users èŠ‚ç‚¹æ— éœ€æ¸…ç†ï¼ˆæ‰€æœ‰è´¦å·å‡åœ¨ allUsers ä¸­å­˜åœ¨ï¼‰');
                        return { removed: 0 };
                    }

                    await usersRef.update(updates);
                    console.log(`âœ… å·²æ¸…ç† users èŠ‚ç‚¹ï¼šåˆ é™¤ ${removeCount} ä¸ªè´¦å·ï¼ˆä»…ä¿ç•™åœ¨ allUsers ä¸­å­˜åœ¨çš„è´¦å·ï¼‰`);
                    return { removed: removeCount };
                } catch (error) {
                    console.error('æ¸…ç†äº‘ç«¯ users èŠ‚ç‚¹å¤±è´¥:', error);
                    throw error;
                }
            }

            // ä»äº‘ç«¯åŠ è½½æ‰€æœ‰ç”¨æˆ·æ•°æ®
            async loadAllUsers() {
                if (!this.isInitialized) return;

                try {
                    const snapshot = await this.db.ref('allUsers').once('value');
                    const cloudUsers = snapshot.val();

                    if (cloudUsers && Array.isArray(cloudUsers) && cloudUsers.length > 0) {
                        // ä»¥äº‘ç«¯æ•°æ®ä¸ºå‡†ï¼Œç›´æ¥æ›¿æ¢æœ¬åœ°æ•°æ®ï¼Œé¿å…å†å²ç”¨æˆ·é‡ç°
                        allUsers = cloudUsers;
                        
                        // æ•°æ®è¿ç§»ï¼šä¸ºç°æœ‰ç”¨æˆ·æ•°æ®æ·»åŠ è§„èŒƒåŒ–å­—æ®µ
                        migrateUserDataToCanonical();
                        
                        localStorage.setItem('allUsers', JSON.stringify(allUsers));
                        
                        console.log(`ğŸ”„ ç”¨æˆ·æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°: ${cloudUsers.length} ä¸ªç”¨æˆ·ï¼ˆå·²æ›¿æ¢æœ¬åœ°æ•°æ®ï¼‰`);

                        // å¦‚æœå½“å‰ç”¨æˆ·å·²ç™»å½•ï¼Œåˆ·æ–°currentUserå¯¹è±¡
                        if (currentUser && currentUser.account) {
                            refreshCurrentUserSnapshot(currentUser.account);
                            console.log('âœ… å·²åˆ·æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯å¿«ç…§');
                        }

                        console.log('âœ… å·²ä»äº‘ç«¯åŠ è½½æ‰€æœ‰ç”¨æˆ·æ•°æ®');
                        return true;
                    }
                } catch (error) {
                    console.error('åŠ è½½äº‘ç«¯ç”¨æˆ·å¤±è´¥:', error);
                }
                return false;
            }

            // é€šç”¨ä¸‹è½½æ¥å£ï¼šæ ¹æ®ç±»å‹ä»äº‘ç«¯è¯»å–æ•°æ®ï¼Œç»™ç™»å½•æµç¨‹ & æµ‹è¯•å·¥å…·å¤ç”¨
            async downloadData(type) {
                if (!this.isInitialized) {
                    throw new Error('CloudSyncManager æœªåˆå§‹åŒ–ï¼Œæ— æ³•ä¸‹è½½æ•°æ®');
                }

                let path = null;
                switch (type) {
                    case 'products':
                        path = 'products';
                        break;
                    case 'users':
                        // ç”¨æˆ·åˆ—è¡¨ç»Ÿä¸€ä½¿ç”¨ allUsers èŠ‚ç‚¹
                        path = 'allUsers';
                        break;
                    case 'orders':
                        // è®¢å•åœ¨ users èŠ‚ç‚¹ä¸‹æŒ‰ç”¨æˆ·åˆ†æ•£å­˜å‚¨ï¼Œè¿™é‡Œå¤ç”¨ loadAllOrders çš„é€»è¾‘
                        // ä¸ºä¿æŒè¿”å›ç»“æ„ç®€å•ï¼Œç›´æ¥èšåˆæˆæ•°ç»„è¿”å›
                        const usersRef = this.db.ref('users');
                        const snapshot = await usersRef.once('value');
                        const usersData = snapshot.val();
                        if (!usersData) return [];

                        const collectedOrders = [];
                        for (const userId in usersData) {
                            const userData = usersData[userId];
                            if (userData && Array.isArray(userData.orders)) {
                                userData.orders.forEach(order => {
                                    if (!order.account) {
                                        order.account = userId;
                                    }
                                    collectedOrders.push(order);
                                });
                            }
                        }
                        return collectedOrders;
                    default:
                        throw new Error(`ä¸æ”¯æŒçš„ä¸‹è½½ç±»å‹: ${type}`);
                }

                const ref = this.db.ref(path);
                const snapshot = await ref.once('value');
                const data = snapshot.val();

                // products / allUsers éƒ½æ˜¯æ•°ç»„å½¢å¼ï¼Œä¿æŒä¸€è‡´
                if (Array.isArray(data)) {
                    return data;
                }
                // å…¶å®ƒæƒ…å†µç›´æ¥è¿”å›åŸå§‹å¯¹è±¡ï¼ˆè°ƒç”¨æ–¹è‡ªå·±å¤„ç†ï¼‰
                return data || [];
            }

            // åŒæ­¥ä¸»é¡µè®¾ç½®
            async syncHomepageSettings() {
                // ä¸»é¡µè®¾ç½®ä»…ç®¡ç†å‘˜å¯ä¸Šä¼ 
                if (!isCurrentUserAdmin()) {
                    console.log('â„¹ï¸ å½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œè·³è¿‡ä¸»é¡µè®¾ç½®ä¸Šä¼ ');
                    return;
                }
                try {
                    const settingsRef = this.db.ref('homepageSettings');
                    const settings = JSON.parse(localStorage.getItem('homepageSettings') || '{}');
                    
                    // ä¸Šä¼ ä¸»é¡µè®¾ç½®åˆ°äº‘ç«¯
                    await settingsRef.set(settings);
                    
                    console.log('âœ… ä¸»é¡µè®¾ç½®å·²åŒæ­¥');
                } catch (error) {
                    console.error('ä¸»é¡µè®¾ç½®åŒæ­¥å¤±è´¥:', error);
                    throw error;
                }
            }

            // ä»äº‘ç«¯åŠ è½½ä¸»é¡µè®¾ç½®
            async loadHomepageSettings() {
                if (!this.isInitialized) return;

                try {
                    const snapshot = await this.db.ref('homepageSettings').once('value');
                    const cloudSettings = snapshot.val();

                    if (cloudSettings && typeof cloudSettings === 'object') {
                        // åˆå¹¶äº‘ç«¯è®¾ç½®å’Œæœ¬åœ°è®¾ç½®
                        const localSettings = JSON.parse(localStorage.getItem('homepageSettings') || '{}');
                        const mergedSettings = { ...localSettings, ...cloudSettings };
                        
                        localStorage.setItem('homepageSettings', JSON.stringify(mergedSettings));
                        
                        // å¦‚æœå®šä¹‰äº†å…¨å±€å˜é‡ï¼Œæ›´æ–°å®ƒ
                        if (typeof homepageSettings !== 'undefined') {
                            Object.assign(homepageSettings, mergedSettings);
                        }
                        
                        console.log('âœ… å·²ä»äº‘ç«¯åŠ è½½ä¸»é¡µè®¾ç½®');
                        return true;
                    }
                } catch (error) {
                    console.error('åŠ è½½äº‘ç«¯ä¸»é¡µè®¾ç½®å¤±è´¥:', error);
                }
                return false;
            }

            // è®¾ç½®å®æ—¶ç›‘å¬
            setupRealtimeListeners() {
                if (!this.isInitialized) return;

                // ç›‘å¬äº§å“æ•°æ®å˜åŒ–ï¼ˆå…¬å…±æ•°æ®ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°ï¼‰
                const productsRef = this.db.ref('products');
                productsRef.on('value', (snapshot) => {
                    const cloudProducts = snapshot.val();
                    if (cloudProducts && Array.isArray(cloudProducts) && !this._syncState.inProgress) {
                        // è¿‡æ»¤æ‰æ— æ•ˆçš„äº§å“ï¼ˆnullã€undefined æˆ–ç¼ºå°‘å¿…è¦å±æ€§ï¼‰
                        const validProducts = cloudProducts.filter(p => p && typeof p === 'object' && p.id && p.name);
                        
                        // ğŸ”’ ä¿æŠ¤æœºåˆ¶ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯è‡ªå·±çš„æ›´æ–°
                        const now = Date.now();
                        const timeSinceLastUpdate = now - (this._syncState.lastLocalUpdate.timestamp || 0);
                        const isInProtectionPeriod = timeSinceLastUpdate < this._syncState.protectionPeriod;
                        
                        // æ£€æŸ¥äº‘ç«¯æ•°æ®æ˜¯å¦ä¸æœ¬åœ°æœ€åæ›´æ–°çš„æ•°æ®ç›¸åŒ
                        const cloudProductsStr = JSON.stringify(validProducts);
                        const isOwnUpdate = isInProtectionPeriod && 
                            this._syncState.lastLocalUpdate.products === cloudProductsStr;
                        
                        if (isOwnUpdate) {
                            console.log('ğŸ›¡ï¸ æ£€æµ‹åˆ°è‡ªå·±çš„æ›´æ–°ï¼Œå¿½ç•¥ç›‘å¬å™¨è§¦å‘ï¼ˆä¿æŠ¤æœŸå†…ï¼‰');
                            return; // å¿½ç•¥è‡ªå·±çš„æ›´æ–°
                        }
                        
                        // æ•°æ®æ¯”è¾ƒï¼šæ£€æŸ¥æœ¬åœ°å’Œäº‘ç«¯æ•°æ®æ˜¯å¦çœŸçš„ä¸åŒ
                        const localProductsStr = JSON.stringify(products);
                        if (cloudProductsStr === localProductsStr) {
                            console.log('â„¹ï¸ äº‘ç«¯æ•°æ®ä¸æœ¬åœ°æ•°æ®ç›¸åŒï¼Œæ— éœ€æ›´æ–°');
                            return; // æ•°æ®ç›¸åŒï¼Œæ— éœ€æ›´æ–°
                        }
                        
                        // åªæœ‰åœ¨ä¿æŠ¤æœŸå¤–ä¸”æ•°æ®ç¡®å®ä¸åŒæ—¶ï¼Œæ‰åº”ç”¨äº‘ç«¯æ›´æ–°
                        if (isInProtectionPeriod) {
                            console.log('ğŸ›¡ï¸ ä¿æŠ¤æœŸå†…æ£€æµ‹åˆ°äº‘ç«¯æ•°æ®å˜åŒ–ï¼Œä½†å¯èƒ½æ˜¯è‡ªå·±çš„æ›´æ–°ï¼Œå»¶è¿Ÿå¤„ç†...');
                            // ä¿å­˜å½“å‰äº‘ç«¯æ•°æ®ï¼Œç”¨äºå»¶è¿Ÿå¤„ç†
                            const savedCloudProducts = validProducts;
                            // å»¶è¿Ÿå¤„ç†ï¼Œç­‰å¾…ä¿æŠ¤æœŸç»“æŸ
                            setTimeout(() => {
                                // ä¿æŠ¤æœŸç»“æŸåï¼Œé‡æ–°ä» Firebase è¯»å–æœ€æ–°æ•°æ®è¿›è¡Œæ¯”è¾ƒ
                                productsRef.once('value').then((latestSnapshot) => {
                                    const latestCloudProducts = latestSnapshot.val();
                                    if (latestCloudProducts && Array.isArray(latestCloudProducts)) {
                                        const latestValidProducts = latestCloudProducts.filter(p => p && typeof p === 'object' && p.id && p.name);
                                        const latestCloudStr = JSON.stringify(latestValidProducts);
                                        const currentLocalStr = JSON.stringify(products);
                                        
                                        // æ£€æŸ¥ä¿æŠ¤æœŸæ˜¯å¦å·²è¿‡
                                        const elapsed = Date.now() - (this._syncState.lastLocalUpdate.timestamp || 0);
                                        if (elapsed >= this._syncState.protectionPeriod && latestCloudStr !== currentLocalStr) {
                                            console.log('âœ… ä¿æŠ¤æœŸç»“æŸï¼Œåº”ç”¨äº‘ç«¯æ›´æ–°');
                                            applyCloudProductsUpdate(latestCloudProducts);
                                        } else if (latestCloudStr === currentLocalStr) {
                                            console.log('â„¹ï¸ ä¿æŠ¤æœŸç»“æŸåï¼Œäº‘ç«¯æ•°æ®ä¸æœ¬åœ°æ•°æ®ç›¸åŒï¼Œæ— éœ€æ›´æ–°');
                                        }
                                    }
                                }).catch((error) => {
                                    console.error('å»¶è¿Ÿå¤„ç†æ—¶è¯»å–äº‘ç«¯æ•°æ®å¤±è´¥:', error);
                                });
                            }, this._syncState.protectionPeriod - timeSinceLastUpdate + 100);
                            return;
                        }
                        
                        // åº”ç”¨äº‘ç«¯æ›´æ–°
                        applyCloudProductsUpdate(cloudProducts);
                        
                    } else if (cloudProducts === null) {
                        // åªæœ‰åœ¨ä¿æŠ¤æœŸå¤–æ‰æ¸…ç©ºæœ¬åœ°æ•°æ®
                        const now = Date.now();
                        const timeSinceLastUpdate = now - (this._syncState.lastLocalUpdate.timestamp || 0);
                        if (timeSinceLastUpdate >= this._syncState.protectionPeriod) {
                            console.log('â„¹ï¸ äº‘ç«¯äº§å“æ•°æ®ä¸ºç©º');
                            products = [];
                            localStorage.setItem('products', JSON.stringify(products));
                            renderProducts(products);
                        } else {
                            console.log('ğŸ›¡ï¸ ä¿æŠ¤æœŸå†…æ£€æµ‹åˆ°äº‘ç«¯æ•°æ®ä¸ºç©ºï¼Œå¿½ç•¥ï¼ˆå¯èƒ½æ˜¯è‡ªå·±çš„æ“ä½œï¼‰');
                        }
                    }
                    
                    // åº”ç”¨äº‘ç«¯äº§å“æ›´æ–°çš„è¾…åŠ©å‡½æ•°
                    function applyCloudProductsUpdate(cloudProducts) {
                        const validProducts = cloudProducts.filter(p => p && typeof p === 'object' && p.id && p.name);
                        
                        // æ£€æµ‹äº§å“æ•°é‡å˜åŒ–
                        const productCountChanged = products.length !== validProducts.length;
                        const productIdsChanged = products.length === validProducts.length && 
                            products.some((p, i) => p.id !== validProducts[i]?.id);
                        
                        products = validProducts;
                        localStorage.setItem('products', JSON.stringify(products));

                        // åˆ·æ–°äº§å“æ˜¾ç¤º
                        const homePage = document.getElementById('home-page');
                        const adminPanel = document.getElementById('admin-panel');

                        if (homePage && homePage.style.display !== 'none') {
                            renderProducts(products);
                            if (productCountChanged || productIdsChanged) {
                                showNotification('äº§å“åˆ—è¡¨å·²æ›´æ–°', 'info');
                            }
                        }
                        if (adminPanel && adminPanel.style.display !== 'none') {
                            renderAdminProducts();
                        }

                        console.log(`ğŸ”„ äº§å“æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°: ${validProducts.length} ä¸ªäº§å“`);
                    }
                }, (error) => {
                    console.error('âŒ äº§å“ç›‘å¬å™¨é”™è¯¯:', error);
                });

                // ç›‘å¬æ‰€æœ‰ç”¨æˆ·æ•°æ®å˜åŒ–ï¼ˆå…¬å…±æ•°æ®ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°ï¼‰
                const allUsersRef = this.db.ref('allUsers');
                allUsersRef.on('value', (snapshot) => {
                    const cloudUsers = snapshot.val();
                    if (cloudUsers && Array.isArray(cloudUsers) && !this._syncState.inProgress) {
                        const previousAllUsers = JSON.parse(JSON.stringify(allUsers)); // ä¿å­˜ä¹‹å‰çš„æ•°æ®ç”¨äºå¯¹æ¯”
                        allUsers = cloudUsers;
                        
                        // æ•°æ®è¿ç§»ï¼šä¸ºç°æœ‰ç”¨æˆ·æ•°æ®æ·»åŠ è§„èŒƒåŒ–å­—æ®µ
                        migrateUserDataToCanonical();
                        
                        localStorage.setItem('allUsers', JSON.stringify(allUsers));
                        
                        console.log(`ğŸ”„ ç”¨æˆ·æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°: ${cloudUsers.length} ä¸ªç”¨æˆ·`);

                        // å¦‚æœå½“å‰ç”¨æˆ·å·²ç™»å½•ï¼Œåˆ·æ–°currentUserå¯¹è±¡
                        if (currentUser && currentUser.account) {
                            const normalizedCurrentAccount = normalizeAccount(currentUser.account);
                            const previousUser = previousAllUsers.find(u => {
                                if (u.accountCanonical) {
                                    return u.accountCanonical === normalizedCurrentAccount;
                                }
                                return normalizeAccount(u.account) === normalizedCurrentAccount;
                            });
                            const currentUserData = findUserByAccount(currentUser.account);
                            
                            // æ£€æŸ¥ç”¨æˆ·æ•°æ®æ˜¯å¦æœ‰å˜åŒ–
                            const hasChanges = !previousUser || 
                                previousUser.status !== currentUserData?.status ||
                                previousUser.points !== currentUserData?.points ||
                                previousUser.username !== currentUserData?.username ||
                                previousUser.password !== currentUserData?.password;
                            
                            if (hasChanges && currentUserData) {
                                refreshCurrentUserSnapshot(currentUser.account);
                                
                                // ç«‹å³æ›´æ–°ç”¨æˆ·ç•Œé¢æ˜¾ç¤º
                                updateUserInterface();
                                
                                // å¦‚æœç”¨æˆ·è¢«ç¦ç”¨ï¼ŒupdateUserInterface ä¼šå¤„ç†ç™»å‡ºé€»è¾‘
                                if (currentUserData.status === 'banned') {
                                    console.log('âš ï¸ ç”¨æˆ·å·²è¢«ç¦ç”¨ï¼Œå·²è‡ªåŠ¨é€€å‡ºç™»å½•');
                                    return; // updateUserInterface å·²å¤„ç†ç™»å‡ºï¼Œç›´æ¥è¿”å›
                                }
                                
                                // æ›´æ–°ç”¨æˆ·ä¸ªäººä¿¡æ¯æ˜¾ç¤ºï¼ˆå¦‚æœç”¨æˆ·ä¸­å¿ƒå·²æ‰“å¼€ï¼‰
                                if (document.getElementById('user-profile')?.classList.contains('active')) {
                                    if (typeof loadUserProfile === 'function') {
                                        loadUserProfile();
                                    }
                                }
                                
                                // å¦‚æœç§¯åˆ†å‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºæç¤º
                                if (previousUser && previousUser.points !== currentUserData.points) {
                                    showNotification(`æ‚¨çš„ç§¯åˆ†å·²æ›´æ–°ï¼š${currentUserData.points}`, 'info');
                                }
                                
                                console.log('âœ… ç”¨æˆ·æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°å¹¶åˆ·æ–°ç•Œé¢');
                            }
                        }

                        // åˆ·æ–°ç”¨æˆ·ç®¡ç†æ˜¾ç¤ºï¼ˆç®¡ç†å‘˜ç•Œé¢ï¼‰
                        const adminPanel = document.getElementById('admin-panel');
                        if (adminPanel && adminPanel.style.display !== 'none') {
                            const activeTab = document.querySelector('.admin-tab.active')?.dataset.tab;
                            if (activeTab === 'users') {
                                if (typeof renderUserManagement === 'function') {
                                    renderUserManagement();
                                }
                            }
                        }

                        console.log('ğŸ”„ ç”¨æˆ·æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°');
                    }
                });

                // ç›‘å¬å½“å‰ç”¨æˆ·è®¢å•å˜åŒ–ï¼ˆè‹¥å½“å‰å·²ç™»å½•ï¼‰
                this.attachUserOrdersListener();
                
                // ç›‘å¬æ‰€æœ‰ç”¨æˆ·è®¢å•å˜åŒ–ï¼ˆç”¨äºåå°ç®¡ç†ï¼‰
                if (currentUser && currentUser.role === 'admin') {
                    this.setupAllOrdersListener();
                    // åˆå§‹åŒ–æ—¶åŠ è½½æ‰€æœ‰è®¢å•
                    this.loadAllOrders().then(() => {
                        // å¦‚æœåå°ç®¡ç†é¡µé¢å·²æ‰“å¼€ï¼Œåˆ·æ–°æ˜¾ç¤º
                        const adminPanel = document.getElementById('admin-panel');
                        if (adminPanel && adminPanel.style.display !== 'none') {
                            const adminOrders = document.getElementById('admin-orders');
                            if (adminOrders && adminOrders.classList.contains('active')) {
                                renderOrdersTable();
                            }
                        }
                    });
                }

                console.log('âœ… å®æ—¶ç›‘å¬å·²è®¾ç½®');
            }

            // åˆ·æ–°è®¢å•è¯¦æƒ…æ¨¡æ€æ¡†å†…å®¹ï¼ˆå¦‚æœå·²æ‰“å¼€ï¼‰
            refreshOrderDetailModal() {
                const orderDetailModal = document.getElementById('order-details-modal');
                if (orderDetailModal) {
                    const orderIdAttr = orderDetailModal.querySelector('[data-order-id]');
                    if (orderIdAttr) {
                        // ä½¿ç”¨normalizeOrderIdç¡®ä¿å…¼å®¹æ–°æ—§è®¢å•IDæ ¼å¼ï¼ˆæ•°å­—æˆ–å­—ç¬¦ä¸²ï¼‰
                        const orderId = normalizeOrderId(orderIdAttr.getAttribute('data-order-id'));
                        const updatedOrder = userOrders.find(o => normalizeOrderId(o.id) === orderId);
                        if (updatedOrder) {
                            setTimeout(() => {
                                showOrderDetailsModal(orderId);
                            }, 100);
                        }
                    }
                }
            }

            // æ ¹æ®å®æ—¶æ•°æ®åˆ·æ–°ç”¨æˆ·è®¢å•UI
            refreshOrderUI(immediate = false) {
                if (immediate) {
                    renderUserOrders();
                    this.refreshOrderDetailModal();
                } else {
                    clearTimeout(window.orderUpdateTimer);
                    window.orderUpdateTimer = setTimeout(() => {
                        renderUserOrders();
                        this.refreshOrderDetailModal();
                    }, 300);
                }
            }

            // å¤„ç†äº‘ç«¯è®¢å•æ›´æ–°ï¼ˆä¼˜åŒ–ç‰ˆï¼šç¡®ä¿æ•°æ®åˆå¹¶æ­£ç¡®ä¸”ä¸äº’ç›¸è¦†ç›–ï¼‰
            processUserOrderUpdate(cloudOrders, immediate = false) {
                if (!currentUser || !Array.isArray(cloudOrders)) {
                    console.warn('âš ï¸ processUserOrderUpdate: å‚æ•°æ— æ•ˆ');
                    return;
                }

                // è®°å½•æ›´æ–°å‰çš„è®¢å•çŠ¶æ€ï¼Œç”¨äºæ£€æµ‹å˜åŒ–
                const orderStatusMap = new Map();
                userOrders.forEach(order => {
                    if (order && order.id) {
                        orderStatusMap.set(String(order.id), order.status);
                    }
                });

                // æ™ºèƒ½åˆå¹¶è®¢å•æ•°æ®ï¼ˆç¡®ä¿æ•°æ®éš”ç¦»ï¼šåªåˆå¹¶å±äºå½“å‰ç”¨æˆ·çš„è®¢å•ï¼‰
                const validCloudOrders = cloudOrders.filter(order => {
                    if (!order || !order.id) return false;
                    // ç¡®ä¿è®¢å•å±äºå½“å‰ç”¨æˆ·
                    const orderAccount = order.account || '';
                    const currentAccount = currentUser.account || '';
                    if (orderAccount !== currentAccount) {
                        console.warn(`âš ï¸ æ£€æµ‹åˆ°ä¸å±äºå½“å‰ç”¨æˆ·çš„è®¢å•ï¼Œå·²è¿‡æ»¤: ${order.id} (è®¢å•è´¦æˆ·: ${orderAccount}, å½“å‰è´¦æˆ·: ${currentAccount})`);
                        return false;
                    }
                    return true;
                });

                if (validCloudOrders.length === 0 && cloudOrders.length > 0) {
                    console.warn('âš ï¸ æ‰€æœ‰äº‘ç«¯è®¢å•éƒ½ä¸å±äºå½“å‰ç”¨æˆ·ï¼Œè·³è¿‡æ›´æ–°');
                    return;
                }

                // æ‰§è¡Œåˆå¹¶ï¼ˆmergeOrdersDataä¼šç¡®ä¿æ•°æ®æ­£ç¡®åˆå¹¶ï¼‰
                mergeOrdersData(validCloudOrders, currentUser.account);

                // æ£€æµ‹è®¢å•çŠ¶æ€å˜åŒ–
                let hasStatusChange = false;
                userOrders.forEach(order => {
                    if (order && order.id) {
                        const oldStatus = orderStatusMap.get(String(order.id));
                        if (oldStatus && oldStatus !== order.status) {
                            hasStatusChange = true;
                            console.log(`ğŸ”„ è®¢å• ${order.id} çŠ¶æ€å˜åŒ–: ${oldStatus} -> ${order.status}`);
                        }
                    }
                });

                if (hasStatusChange) {
                    console.log('ğŸ”„ æ£€æµ‹åˆ°è®¢å•çŠ¶æ€å˜åŒ–ï¼Œåˆ·æ–°æ˜¾ç¤º');
                    // æ˜¾ç¤ºé€šçŸ¥ï¼ˆä»…åœ¨ç”¨æˆ·ä¸­å¿ƒé¡µé¢æ—¶ï¼‰
                    const userCenter = document.getElementById('user-center');
                    if (userCenter && userCenter.style.display !== 'none') {
                        showNotification('æ‚¨çš„è®¢å•çŠ¶æ€å·²æ›´æ–°', 'info');
                    }
                }

                // åˆ·æ–°UI
                this.refreshOrderUI(immediate);
            }

            // ç§»é™¤ç”¨æˆ·è®¢å•ç›‘å¬å™¨
            detachUserOrdersListener() {
                if (this.userOrdersRef) {
                    this.userOrdersRef.off();
                    this.userOrdersRef = null;
                }
                if (this.orderUpdateTimer) {
                    clearTimeout(this.orderUpdateTimer);
                    this.orderUpdateTimer = null;
                }
                this.pendingOrderUpdate = null;
            }

            // ç§»é™¤ç”¨æˆ·åœ°å€ç›‘å¬å™¨
            detachUserAddressesListener() {
                if (this.userAddressesRef) {
                    this.userAddressesRef.off();
                    this.userAddressesRef = null;
                }
                if (this.addressUpdateTimer) {
                    clearTimeout(this.addressUpdateTimer);
                    this.addressUpdateTimer = null;
                }
                this.pendingAddressUpdate = null;
            }

            // ç›‘å¬ç”¨æˆ·è®¢å•å˜åŒ–ï¼ˆä¼˜åŒ–ç‰ˆï¼šç¡®ä¿å®æ—¶åŒæ­¥ä¸”æ•°æ®éš”ç¦»ï¼‰
            attachUserOrdersListener() {
                if (!this.isInitialized || !currentUser) {
                    console.warn('âš ï¸ æ— æ³•è®¾ç½®è®¢å•ç›‘å¬å™¨ï¼šäº‘ç«¯æœªåˆå§‹åŒ–æˆ–ç”¨æˆ·æœªç™»å½•');
                    return;
                }

                // å…ˆç§»é™¤æ—§çš„ç›‘å¬å™¨ï¼Œé¿å…é‡å¤ç›‘å¬
                this.detachUserOrdersListener();

                const userPath = this.getUserPath();
                if (!userPath || userPath === 'users/guest') {
                    console.warn('âš ï¸ æ— æ³•è®¾ç½®è®¢å•ç›‘å¬å™¨ï¼šç”¨æˆ·è·¯å¾„æ— æ•ˆ');
                    return;
                }

                const ordersRef = this.db.ref(`${userPath}/orders`);
                this.userOrdersRef = ordersRef;

                console.log(`ğŸ”” å¼€å§‹ç›‘å¬ç”¨æˆ·è®¢å•å˜åŒ–: ${userPath}/orders`);

                ordersRef.on('value', (snapshot) => {
                    const cloudOrders = snapshot.val();
                    
                    // å¤„ç†ç©ºæ•°æ®æƒ…å†µï¼ˆäº‘ç«¯è®¢å•è¢«æ¸…ç©ºï¼‰
                    if (cloudOrders === null) {
                        console.log('â„¹ï¸ äº‘ç«¯è®¢å•æ•°æ®ä¸ºç©ºï¼Œæ¸…ç©ºæœ¬åœ°è®¢å•');
                        if (currentUser && currentUser.account) {
                            userOrders = [];
                            const userOrdersKey = `userOrders_${currentUser.account}`;
                            localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                            localStorage.setItem('userOrders', JSON.stringify(userOrders));
                            this.refreshOrderUI(true);
                        }
                        return;
                    }

                    if (cloudOrders && Array.isArray(cloudOrders)) {
                        // ç¡®ä¿è®¢å•æ•°æ®å±äºå½“å‰ç”¨æˆ·ï¼ˆæ•°æ®éš”ç¦»ä¿æŠ¤ï¼‰
                        const filteredOrders = cloudOrders.filter(order => {
                            if (!order) return false;
                            // ç¡®ä¿è®¢å•å±äºå½“å‰ç”¨æˆ·
                            const orderAccount = order.account || '';
                            const currentAccount = currentUser.account || '';
                            return orderAccount === currentAccount;
                        });

                        if (this._syncState.inProgress) {
                            console.log('â³ åŒæ­¥è¿›è¡Œä¸­ï¼Œå»¶è¿Ÿå¤„ç†äº‘ç«¯è®¢å•æ›´æ–°...');
                            this.pendingOrderUpdate = filteredOrders;
                            if (this.orderUpdateTimer) clearTimeout(this.orderUpdateTimer);
                            this.orderUpdateTimer = setTimeout(() => {
                                if (this.pendingOrderUpdate) {
                                    console.log('ğŸ”„ å»¶è¿Ÿå¤„ç†äº‘ç«¯è®¢å•æ›´æ–°');
                                    this.processUserOrderUpdate(this.pendingOrderUpdate, true);
                                    this.pendingOrderUpdate = null;
                                }
                            }, 1500);
                        } else {
                            console.log(`âœ… æ”¶åˆ°äº‘ç«¯è®¢å•æ›´æ–°: ${filteredOrders.length} ä¸ªè®¢å•`);
                            this.processUserOrderUpdate(filteredOrders, false);
                        }
                    } else {
                        console.warn('âš ï¸ äº‘ç«¯è®¢å•æ•°æ®æ ¼å¼å¼‚å¸¸:', typeof cloudOrders);
                    }
                }, (error) => {
                    console.error('âŒ è®¢å•ç›‘å¬å™¨é”™è¯¯:', error);
                });
            }

            // ç›‘å¬ç”¨æˆ·åœ°å€å˜åŒ–
            attachUserAddressesListener() {
                if (!this.isInitialized || !currentUser) return;

                this.detachUserAddressesListener();

                const userPath = this.getUserPath();
                const addressesRef = this.db.ref(`${userPath}/addresses`);
                this.userAddressesRef = addressesRef;

                addressesRef.on('value', (snapshot) => {
                    const cloudAddresses = snapshot.val();
                    if (cloudAddresses && Array.isArray(cloudAddresses)) {
                        if (this._syncState.inProgress) {
                            console.log('â³ åŒæ­¥è¿›è¡Œä¸­ï¼Œå»¶è¿Ÿå¤„ç†äº‘ç«¯åœ°å€æ›´æ–°...');
                            this.pendingAddressUpdate = cloudAddresses;
                            if (this.addressUpdateTimer) clearTimeout(this.addressUpdateTimer);
                            this.addressUpdateTimer = setTimeout(() => {
                                if (this.pendingAddressUpdate) {
                                    console.log('ğŸ”„ å»¶è¿Ÿå¤„ç†äº‘ç«¯åœ°å€æ›´æ–°');
                                    this.processUserAddressUpdate(this.pendingAddressUpdate, true);
                                    this.pendingAddressUpdate = null;
                                }
                            }, 1500);
                        } else {
                            this.processUserAddressUpdate(cloudAddresses, false);
                        }
                    } else if (cloudAddresses === null) {
                        // äº‘ç«¯åœ°å€è¢«æ¸…ç©º
                        userAddresses = [];
                        const userAddressesKey = `userAddresses_${currentUser.account || 'guest'}`;
                        localStorage.setItem(userAddressesKey, JSON.stringify(userAddresses));
                        localStorage.setItem('userAddresses', JSON.stringify(userAddresses));
                        if (typeof renderAddressList === 'function') {
                            renderAddressList();
                        }
                    }
                });
            }

            // å¤„ç†äº‘ç«¯åœ°å€æ›´æ–°
            processUserAddressUpdate(cloudAddresses, immediate = false) {
                if (!currentUser || !Array.isArray(cloudAddresses)) return;

                // æ›´æ–°å…¨å±€å˜é‡å’ŒlocalStorage
                userAddresses = cloudAddresses;
                const userAddressesKey = `userAddresses_${currentUser.account || 'guest'}`;
                localStorage.setItem(userAddressesKey, JSON.stringify(userAddresses));
                localStorage.setItem('userAddresses', JSON.stringify(userAddresses));
                
                console.log('âœ… åœ°å€æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°:', userAddresses.length, 'ä¸ªåœ°å€');

                // åˆ·æ–°åœ°å€åˆ—è¡¨æ˜¾ç¤º
                if (immediate) {
                    if (typeof renderAddressList === 'function') {
                        renderAddressList();
                    }
                } else {
                    clearTimeout(window.addressUpdateTimer);
                    window.addressUpdateTimer = setTimeout(() => {
                        if (typeof renderAddressList === 'function') {
                            renderAddressList();
                        }
                    }, 300);
                }
            }

            // ç§»é™¤ç®¡ç†å‘˜è®¢å•ç›‘å¬å™¨
            detachAllOrdersListener() {
                if (this.allOrdersRef) {
                    this.allOrdersRef.off();
                    this.allOrdersRef = null;
                }
            }

            // ç§»é™¤ä¼šè¯ç›‘å¬å™¨
            detachSessionListener() {
                if (this.sessionRef) {
                    this.sessionRef.off();
                    this.sessionRef = null;
                }
            }

            // å¤„ç†ç”¨æˆ·ç™»å½•/é€€å‡ºåçš„æ•°æ®å’Œç›‘å¬å™¨
            async handleUserSessionChange() {
                if (!this.isInitialized) return;

                // æ¸…ç†æ—§ç›‘å¬å™¨
                this.detachUserOrdersListener();
                this.detachUserAddressesListener();
                this.detachAllOrdersListener();
                this.detachSessionListener();

                if (!currentUser) {
                    userOrders = [];
                    userAddresses = [];
                    localStorage.removeItem('userOrders');
                    localStorage.removeItem('userAddresses');
                    this.currentSessionId = null;
                    return;
                }

                // å…ˆåŠ è½½è¯¥ç”¨æˆ·çš„æ•°æ®
                await Promise.all([
                    this.loadOrders(),
                    this.loadAddresses()
                ]);

                refreshCurrentUserSnapshot();

                // ç¡®ä¿å…¨å±€å˜é‡å·²æ›´æ–°ï¼ˆä»localStorageé‡æ–°åŠ è½½ï¼‰
                if (currentUser && currentUser.account) {
                    const userOrdersKey = `userOrders_${currentUser.account}`;
                    const userAddressesKey = `userAddresses_${currentUser.account}`;
                    userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || JSON.parse(localStorage.getItem('userOrders')) || [];
                    userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || JSON.parse(localStorage.getItem('userAddresses')) || [];
                    console.log('âœ… handleUserSessionChange - æ•°æ®å·²åŠ è½½ - è®¢å•æ•°:', userOrders.length, 'åœ°å€æ•°:', userAddresses.length);
                    
                    // ç«‹å³åˆ·æ–°ç•Œé¢æ˜¾ç¤ºï¼ˆåŒæ­¥æ‰§è¡Œï¼Œä¸ç­‰å¾…ï¼‰
                    if (typeof renderUserOrders === 'function') {
                        renderUserOrders();
                    }
                    if (typeof renderAddressList === 'function') {
                        renderAddressList();
                    }
                }

                // é‡æ–°ç›‘å¬è¯¥ç”¨æˆ·çš„è®¢å•å’Œåœ°å€ï¼ˆå®æ—¶åŒæ­¥ï¼‰
                this.attachUserOrdersListener();
                this.attachUserAddressesListener();

                // ç®¡ç†å‘˜éœ€è¦åŒæ­¥æ‰€æœ‰è®¢å•
                if (currentUser.role === 'admin') {
                    await this.loadAllOrders();
                    this.setupAllOrdersListener();
                }

                // è®¾ç½®å½“å‰è´¦å·çš„ä¼šè¯è·Ÿè¸ªï¼ˆå¤šè®¾å¤‡ç™»å½•æ§åˆ¶ï¼‰
                await this.setupSessionTracking();
            }

            // ä¸ºå½“å‰ç™»å½•è´¦å·ç”Ÿæˆä¼šè¯IDï¼Œå¹¶ç›‘å¬æ˜¯å¦è¢«å…¶ä»–è®¾å¤‡æŠ¢ç™»
            async setupSessionTracking() {
                if (!this.isInitialized || !currentUser || !currentUser.account) return;

                try {
                    // å…ˆç§»é™¤æ—§ç›‘å¬
                    this.detachSessionListener();

                    const userPath = this.getUserPath(currentUser.account);
                    this.sessionRef = this.db.ref(`${userPath}/activeSessionId`);

                    // ä¸ºæœ¬è®¾å¤‡ç”Ÿæˆæ–°çš„ä¼šè¯ID
                    this.currentSessionId = `${Date.now()}_${Math.random().toString(36).slice(2, 10)}`;

                    // å†™å…¥äº‘ç«¯ï¼Œå£°æ˜â€œå½“å‰ä¼šè¯â€
                    await this.sessionRef.set({
                        id: this.currentSessionId,
                        updatedAt: Date.now(),
                        ua: navigator.userAgent || ''
                    });

                    // ç›‘å¬ä¼šè¯å˜åŒ–ï¼šå¦‚æœ activeSessionId.id è¢«æ”¹æˆåˆ«çš„å€¼ï¼Œè¯´æ˜æœ‰å…¶ä»–è®¾å¤‡ç™»å½•
                    this.sessionRef.on('value', async (snapshot) => {
                        const data = snapshot.val();
                        if (!data || !data.id || !this.currentSessionId) return;

                        if (data.id !== this.currentSessionId) {
                            console.warn('æ£€æµ‹åˆ°åŒä¸€è´¦å·åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œå‡†å¤‡åŒæ­¥å¹¶è‡ªåŠ¨ç™»å‡ºæœ¬è®¾å¤‡');

                            try {
                                // å°½é‡åœ¨é€€å‡ºå‰æŠŠæœ¬åœ°æœ€æ–°æ•°æ®åŒæ­¥åˆ°äº‘ç«¯
                                await this.syncAllData();
                            } catch (syncError) {
                                console.error('è¿œç¨‹ç™»å‡ºå‰åŒæ­¥æ•°æ®å¤±è´¥:', syncError);
                            }

                            // æ‰§è¡Œè¿œç¨‹ç™»å‡ºï¼ˆå¦‚æœå…¨å±€æœ‰ä¸“é—¨å‡½æ•°åˆ™è°ƒç”¨ï¼Œæ²¡æœ‰å°±ç”¨å…œåº•é€»è¾‘ï¼‰
                            if (typeof handleRemoteLogout === 'function') {
                                handleRemoteLogout();
                            } else {
                                try {
                                    currentUser = null;
                                    localStorage.removeItem('currentUser');

                                    if (typeof clearAllLocalDataOnLogout === 'function') {
                                        clearAllLocalDataOnLogout();
                                    } else {
                                        // å…œåº•æ¸…ç†å…³é”®ä¿¡æ¯
                                        localStorage.removeItem('userOrders');
                                        localStorage.removeItem('userAddresses');
                                    }

                                    if (typeof updateUserInterface === 'function') {
                                        updateUserInterface();
                                    }
                                    if (typeof showHomePage === 'function') {
                                        showHomePage();
                                    }
                                    if (typeof showNotification === 'function') {
                                        showNotification(t('loggedOutByOtherDevice'), 'warning');
                                    }
                                } catch (e) {
                                    console.error('å¤„ç†è¿œç¨‹ç™»å‡ºè¿‡ç¨‹ä¸­çš„é”™è¯¯:', e);
                                }
                            }

                            // é¿å…é‡å¤è§¦å‘
                            this.detachSessionListener();
                            this.currentSessionId = null;
                        }
                    });
                } catch (error) {
                    console.error('è®¾ç½®ä¼šè¯è·Ÿè¸ªå¤±è´¥:', error);
                }
            }

            // è®¾ç½®æ‰€æœ‰è®¢å•ç›‘å¬å™¨ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
            setupAllOrdersListener() {
                if (!this.isInitialized || !currentUser || currentUser.role !== 'admin') return;

                this.detachAllOrdersListener();
                
                try {
                    // ç›‘å¬æ‰€æœ‰ç”¨æˆ·çš„è®¢å•
                    this.allOrdersRef = this.db.ref('users');
                    this.allOrdersRef.on('value', async (snapshot) => {
                        if (this._syncState.inProgress) {
                            console.log('â³ åŒæ­¥è¿›è¡Œä¸­ï¼Œè·³è¿‡ç®¡ç†å‘˜è®¢å•ç›‘å¬æ›´æ–°');
                            return;
                        }
                        
                        const usersData = snapshot.val();
                        if (!usersData) {
                            console.log('â„¹ï¸ äº‘ç«¯ç”¨æˆ·æ•°æ®ä¸ºç©º');
                            return;
                        }
                        
                        // æ”¶é›†æ‰€æœ‰ç”¨æˆ·çš„è®¢å•ï¼ˆç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼‰
                        const collectedOrders = [];
                        for (const userId in usersData) {
                            const userData = usersData[userId];
                            if (userData && userData.orders && Array.isArray(userData.orders)) {
                                userData.orders.forEach(order => {
                                    if (order && order.id) {
                                        // ç¡®ä¿è®¢å•æœ‰accountå­—æ®µï¼ˆç”¨äºæ•°æ®éš”ç¦»ï¼‰
                                        if (!order.account) {
                                            order.account = userId.replace(/_/g, '.'); // è¿˜åŸè´¦å·æ ¼å¼
                                        }
                                        // ç¡®ä¿è®¢å•æœ‰updatedAtå­—æ®µï¼ˆç”¨äºåˆå¹¶é€»è¾‘ï¼‰
                                        if (!order.updatedAt && order.date) {
                                            order.updatedAt = typeof order.date === 'number' ? order.date : Date.now();
                                        }
                                        collectedOrders.push(order);
                                    }
                                });
                            }
                        }
                        
                        if (collectedOrders.length > 0) {
                            // æ™ºèƒ½åˆå¹¶æ‰€æœ‰è®¢å•ï¼ˆç¡®ä¿æ•°æ®æ­£ç¡®ï¼‰
                            mergeAllOrdersData(collectedOrders);
                            
                            // åˆ·æ–°åå°ç®¡ç†è®¢å•è¡¨æ ¼
                            const adminPanel = document.getElementById('admin-panel');
                            if (adminPanel && adminPanel.style.display !== 'none') {
                                const adminOrders = document.getElementById('admin-orders');
                                if (adminOrders && adminOrders.classList.contains('active')) {
                                    renderOrdersTable();
                                }
                            }
                            
                            console.log(`ğŸ”„ æ‰€æœ‰è®¢å•æ•°æ®å·²ä»äº‘ç«¯æ›´æ–°ï¼ˆåå°ç®¡ç†ï¼‰: ${collectedOrders.length} ä¸ªè®¢å•`);
                        } else {
                            console.log('â„¹ï¸ äº‘ç«¯æš‚æ— è®¢å•æ•°æ®');
                        }
                    }, (error) => {
                        console.error('âŒ ç®¡ç†å‘˜è®¢å•ç›‘å¬å™¨é”™è¯¯:', error);
                    });
                } catch (error) {
                    console.error('è®¾ç½®æ‰€æœ‰è®¢å•ç›‘å¬å™¨å¤±è´¥:', error);
                }
            }

            // æ‰‹åŠ¨è§¦å‘åŒæ­¥
            async manualSync() {
                showNotification('æ­£åœ¨åŒæ­¥æ•°æ®...', 'info');
                await this.syncAllData();
            }

            // æ¸…ç†
            destroy() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                }

                // ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
                this.detachUserOrdersListener();
                this.detachUserAddressesListener();
                this.detachAllOrdersListener();
                
                if (this.db) {
                    this.db.ref('products').off();
                    if (currentUser) {
                        const userPath = this.getUserPath();
                        this.db.ref(`${userPath}/orders`).off();
                        this.db.ref(`${userPath}/addresses`).off();
                    }
                }
            }
        }

        // åˆå§‹åŒ–äº‘ç«¯åŒæ­¥ï¼ˆå¼‚æ­¥ï¼‰
        async function initCloudSync() {
            try {
                console.log('ğŸ”„ åˆ›å»º CloudSyncManager å®ä¾‹...');
                cloudSync = new CloudSyncManager();

                console.log('ğŸ”„ è°ƒç”¨ init() æ–¹æ³•...');
                await cloudSync.init();

                console.log('âœ… CloudSync å®Œå…¨åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ äº‘ç«¯åŒæ­¥åˆå§‹åŒ–å¤±è´¥:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–äº‘ç«¯åŒæ­¥ï¼ˆå·²åœ¨DOMContentLoadedä¸­å¤„ç†ï¼Œè¿™é‡Œä¸å†é‡å¤åˆå§‹åŒ–ï¼‰
        // window.addEventListener('load', () => {
        //     console.log('ğŸš€ é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡åˆå§‹åŒ–äº‘åŒæ­¥...');
        //     // å·²åœ¨DOMContentLoadedä¸­åˆå§‹åŒ–ï¼Œé¿å…é‡å¤
        // });

        // ========== ç¦»çº¿ç¼“å­˜ç®¡ç†å™¨ ==========
        class OfflineCacheManager {
            constructor() {
                this.cacheName = 'ecommerce-cache-v1';
                this.offlineQueue = [];
                this.isOnline = navigator.onLine;

                this.init();
            }

            // åˆå§‹åŒ–ç¦»çº¿ç¼“å­˜
            init() {
                // ç›‘å¬ç½‘ç»œçŠ¶æ€
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    console.log('âœ… ç½‘ç»œå·²è¿æ¥');
                    showNotification('ç½‘ç»œå·²è¿æ¥', 'success');
                    this.syncOfflineQueue();
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    console.log('âš ï¸ ç½‘ç»œå·²æ–­å¼€');
                    showNotification('æ‚¨å·²ç¦»çº¿ï¼Œæ•°æ®å°†è¢«ç¼“å­˜', 'warning');
                });

                // æ³¨å†Œ Service Worker
                if ('serviceWorker' in navigator) {
                    this.registerServiceWorker();
                }

                // ä»æœ¬åœ°å­˜å‚¨æ¢å¤ç¦»çº¿é˜Ÿåˆ—
                this.loadOfflineQueue();

                console.log('âœ… ç¦»çº¿ç¼“å­˜ç®¡ç†å™¨å·²åˆå§‹åŒ–');
            }

            // æ³¨å†Œ Service Worker
            async registerServiceWorker() {
                try {
                    // åˆ›å»ºä¸€ä¸ªå†…è”çš„ Service Worker
                    const swCode = `
                        const CACHE_NAME = 'ecommerce-cache-v1';
                        const urlsToCache = [
                            '/',
                            '/main.html'
                        ];
                        
                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(urlsToCache))
                            );
                        });
                        
                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => {
                                        if (response) {
                                            return response;
                                        }
                                        return fetch(event.request).then((response) => {
                                            if (!response || response.status !== 200) {
                                                return response;
                                            }
                                            const responseToCache = response.clone();
                                            caches.open(CACHE_NAME)
                                                .then((cache) => {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            return response;
                                        });
                                    })
                            );
                        });
                        
                        self.addEventListener('activate', (event) => {
                            event.waitUntil(
                                caches.keys().then((cacheNames) => {
                                    return Promise.all(
                                        cacheNames.map((cacheName) => {
                                            if (cacheName !== CACHE_NAME) {
                                                return caches.delete(cacheName);
                                            }
                                        })
                                    );
                                })
                            );
                        });
                    `;

                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);

                    const registration = await navigator.serviceWorker.register(swUrl);
                    console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ:', registration);
                } catch (error) {
                    console.warn('Service Worker æ³¨å†Œå¤±è´¥:', error);
                }
            }

            // æ·»åŠ åˆ°ç¦»çº¿é˜Ÿåˆ—
            addToOfflineQueue(action, data) {
                const queueItem = {
                    id: Date.now() + Math.random(),
                    action,
                    data,
                    timestamp: Date.now()
                };

                this.offlineQueue.push(queueItem);
                this.saveOfflineQueue();

                console.log('ğŸ“¦ å·²æ·»åŠ åˆ°ç¦»çº¿é˜Ÿåˆ—:', queueItem);
                return queueItem;
            }

            // ä¿å­˜ç¦»çº¿é˜Ÿåˆ—åˆ°æœ¬åœ°å­˜å‚¨
            saveOfflineQueue() {
                localStorage.setItem('offlineQueue', JSON.stringify(this.offlineQueue));
            }

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç¦»çº¿é˜Ÿåˆ—
            loadOfflineQueue() {
                const stored = localStorage.getItem('offlineQueue');
                if (stored) {
                    try {
                        this.offlineQueue = JSON.parse(stored);
                        console.log('ğŸ“¦ å·²åŠ è½½ç¦»çº¿é˜Ÿåˆ—:', this.offlineQueue.length, 'é¡¹');
                    } catch (error) {
                        console.error('åŠ è½½ç¦»çº¿é˜Ÿåˆ—å¤±è´¥:', error);
                        this.offlineQueue = [];
                    }
                }
            }

            // åŒæ­¥ç¦»çº¿é˜Ÿåˆ—
            async syncOfflineQueue() {
                if (this.offlineQueue.length === 0) {
                    return;
                }

                console.log('ğŸ”„ å¼€å§‹åŒæ­¥ç¦»çº¿é˜Ÿåˆ—...');
                showNotification('æ­£åœ¨åŒæ­¥ç¦»çº¿æ•°æ®...', 'info');

                const successItems = [];
                const failedItems = [];

                for (const item of this.offlineQueue) {
                    try {
                        await this.processQueueItem(item);
                        successItems.push(item);
                    } catch (error) {
                        console.error('å¤„ç†ç¦»çº¿é˜Ÿåˆ—é¡¹å¤±è´¥:', error);
                        failedItems.push(item);
                    }
                }

                // ç§»é™¤æˆåŠŸçš„é¡¹
                this.offlineQueue = this.offlineQueue.filter(item =>
                    !successItems.includes(item)
                );
                this.saveOfflineQueue();

                if (successItems.length > 0) {
                    showNotification(`æˆåŠŸåŒæ­¥ ${successItems.length} é¡¹æ•°æ®`, 'success');
                }

                if (failedItems.length > 0) {
                    showNotification(`${failedItems.length} é¡¹æ•°æ®åŒæ­¥å¤±è´¥`, 'error');
                }

                console.log('âœ… ç¦»çº¿é˜Ÿåˆ—åŒæ­¥å®Œæˆ');
            }

            // å¤„ç†å•ä¸ªé˜Ÿåˆ—é¡¹
            async processQueueItem(item) {
                switch (item.action) {
                    case 'addProduct':
                        // åªæœ‰ç®¡ç†å‘˜æ‰å…è®¸é€šè¿‡ç¦»çº¿é˜Ÿåˆ—ä¿®æ”¹äº§å“
                        if (!isCurrentUserAdmin()) {
                            console.log('â„¹ï¸ éç®¡ç†å‘˜ç¦»çº¿æ“ä½œ addProduct å·²å¿½ç•¥');
                            break;
                        }
                        products.push(item.data);
                        localStorage.setItem('products', JSON.stringify(products));
                        if (cloudSync && cloudSync.isInitialized) {
                            await cloudSync.syncProducts();
                        }
                        break;

                    case 'updateProduct':
                        if (!isCurrentUserAdmin()) {
                            console.log('â„¹ï¸ éç®¡ç†å‘˜ç¦»çº¿æ“ä½œ updateProduct å·²å¿½ç•¥');
                            break;
                        }
                        const productIndex = products.findIndex(p => p.id === item.data.id);
                        if (productIndex !== -1) {
                            products[productIndex] = item.data;
                            localStorage.setItem('products', JSON.stringify(products));
                            if (cloudSync && cloudSync.isInitialized) {
                                await cloudSync.syncProducts();
                            }
                        }
                        break;

                    case 'deleteProduct':
                        if (!isCurrentUserAdmin()) {
                            console.log('â„¹ï¸ éç®¡ç†å‘˜ç¦»çº¿æ“ä½œ deleteProduct å·²å¿½ç•¥');
                            break;
                        }
                        products = products.filter(p => p.id !== item.data.id);
                        localStorage.setItem('products', JSON.stringify(products));
                        if (cloudSync && cloudSync.isInitialized) {
                            await cloudSync.syncProducts();
                        }
                        break;

                    case 'addOrder':
                        userOrders.push(item.data);
                        localStorage.setItem('userOrders', JSON.stringify(userOrders));
                        if (cloudSync && cloudSync.isInitialized) {
                            await cloudSync.syncOrders();
                        }
                        break;

                    case 'updateOrder':
                        // ä½¿ç”¨è§„èŒƒåŒ–IDï¼Œé˜²æ­¢å­—ç¬¦ä¸²/æ•°å­—ä¸ä¸€è‡´å¯¼è‡´æ›´æ–°å¤±è´¥
                        {
                            const targetId = normalizeOrderId(item.data.id);
                            const orderIndex = userOrders.findIndex(o => normalizeOrderId(o.id) === targetId);
                            if (orderIndex !== -1) {
                                userOrders[orderIndex] = item.data;
                                localStorage.setItem('userOrders', JSON.stringify(userOrders));
                                if (cloudSync && cloudSync.isInitialized) {
                                    await cloudSync.syncOrders();
                                }
                            }
                        }
                        break;

                    default:
                        console.warn('æœªçŸ¥çš„ç¦»çº¿æ“ä½œ:', item.action);
                }
            }

            // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
            checkOnlineStatus() {
                return this.isOnline;
            }

            // ç¼“å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
            cacheData(key, data) {
                try {
                    localStorage.setItem(`cache_${key}`, JSON.stringify({
                        data,
                        timestamp: Date.now()
                    }));
                    console.log('âœ… æ•°æ®å·²ç¼“å­˜:', key);
                } catch (error) {
                    console.error('ç¼“å­˜æ•°æ®å¤±è´¥:', error);
                }
            }

            // ä»ç¼“å­˜è·å–æ•°æ®
            getCachedData(key, maxAge = 24 * 60 * 60 * 1000) {
                try {
                    const cached = localStorage.getItem(`cache_${key}`);
                    if (!cached) return null;

                    const { data, timestamp } = JSON.parse(cached);
                    const age = Date.now() - timestamp;

                    if (age > maxAge) {
                        // ç¼“å­˜å·²è¿‡æœŸ
                        localStorage.removeItem(`cache_${key}`);
                        return null;
                    }

                    console.log('âœ… ä»ç¼“å­˜åŠ è½½æ•°æ®:', key);
                    return data;
                } catch (error) {
                    console.error('è¯»å–ç¼“å­˜å¤±è´¥:', error);
                    return null;
                }
            }

            // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
            clearAllCache() {
                // æ¸…é™¤ localStorage ç¼“å­˜
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('cache_')) {
                        localStorage.removeItem(key);
                    }
                });

                // æ¸…é™¤ Service Worker ç¼“å­˜
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }

                console.log('âœ… å·²æ¸…é™¤æ‰€æœ‰ç¼“å­˜');
                showNotification('ç¼“å­˜å·²æ¸…é™¤', 'success');
            }

            // è·å–ç¼“å­˜å¤§å°ä¼°ç®—
            async getCacheSize() {
                if ('storage' in navigator && 'estimate' in navigator.storage) {
                    const estimate = await navigator.storage.estimate();
                    const usage = estimate.usage || 0;
                    const quota = estimate.quota || 0;

                    return {
                        usage: (usage / 1024 / 1024).toFixed(2) + ' MB',
                        quota: (quota / 1024 / 1024).toFixed(2) + ' MB',
                        percentage: ((usage / quota) * 100).toFixed(2) + '%'
                    };
                }
                return null;
            }
        }

        // åˆ›å»ºç¦»çº¿ç¼“å­˜ç®¡ç†å™¨å®ä¾‹
        const offlineCache = new OfflineCacheManager();

        // å¯¼å‡ºåˆ°å…¨å±€ä½œç”¨åŸŸ
        window.offlineCache = offlineCache;

        // å°å·¥å…·ï¼šé˜²æŠ–
        function debounce(fn, delay) {
            let timerId = null;
            return function (...args) {
                clearTimeout(timerId);
                timerId = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        // å°å·¥å…·ï¼šèŠ‚æµ
        function throttle(fn, delay) {
            let lastCall = 0;
            return function (...args) {
                const now = Date.now();
                if (now - lastCall >= delay) {
                    lastCall = now;
                    return fn.apply(this, args);
                }
            };
        }

        // å°å·¥å…·ï¼šæ·±æ‹·è´
        function deepClone(obj) {
            if (obj === null || typeof obj !== 'object') return obj;
            if (obj instanceof Date) return new Date(obj.getTime());
            if (obj instanceof Array) return obj.map(item => deepClone(item));
            if (typeof obj === 'object') {
                const clonedObj = {};
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        clonedObj[key] = deepClone(obj[key]);
                    }
                }
                return clonedObj;
            }
        }

        // å°å·¥å…·ï¼šæ ¼å¼åŒ–æ—¥æœŸï¼ˆåŒ…å«æ—¶åˆ†ç§’ï¼‰
        function formatDate(date) {
            if (!date) return '';
            
            // å¤„ç†æ—¶é—´æˆ³ï¼ˆæ•°å­—ï¼‰æˆ–æ—¥æœŸå­—ç¬¦ä¸²
            let dateObj;
            if (typeof date === 'number') {
                // ç›´æ¥ä½¿ç”¨æ—¶é—´æˆ³åˆ›å»ºæ—¥æœŸå¯¹è±¡ï¼Œç¡®ä¿ä½¿ç”¨å®é™…ä¸‹å•æ—¶é—´
                dateObj = new Date(date);
            } else if (typeof date === 'string') {
                // å¦‚æœæ˜¯æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆå¦‚ "2025-11-30"ï¼‰ï¼Œå°è¯•è§£æ
                if (date.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    // çº¯æ—¥æœŸæ ¼å¼ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´ä¿¡æ¯ï¼Œä½¿ç”¨00:00:00è€Œä¸æ˜¯å½“å‰æ—¶é—´
                    dateObj = new Date(date + 'T00:00:00');
                } else {
                    dateObj = new Date(date);
                }
            } else {
                dateObj = new Date(date);
            }
            
            // æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
            if (isNaN(dateObj.getTime())) {
                return '';
            }
            
            // æ ¹æ®å½“å‰è¯­è¨€é€‰æ‹©æ ¼å¼
            const locale = currentLanguage === 'en' ? 'en-US' : 'zh-CN';
            return dateObj.toLocaleString(locale, {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        }

        // å°å·¥å…·ï¼šæ˜¾ç¤ºé€šçŸ¥ï¼ˆå·²æ”¹ä¸ºä»…è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸å†åœ¨å³ä¸Šè§’å¼¹å‡ºæç¤ºæ°”æ³¡ï¼‰
        function showNotification(message, type = 'info') {
            try {
                console.log('[Notification]', type, message);
            } catch (e) {
                // å¿½ç•¥æ§åˆ¶å°é”™è¯¯
            }
            // æŒ‰ä½ çš„è¦æ±‚ï¼Œæ‰€æœ‰å³ä¸Šè§’çš„è§†è§‰æç¤ºå·²å…³é—­ï¼Œè¿™é‡Œä¸å†åˆ›å»ºä»»ä½• DOMã€‚
        }

        // ========== åˆå§‹åŒ–æ•°æ® - å®Œå…¨ç§»é™¤æœ¬åœ°æ¼”ç¤ºæ•°æ® ==========
        // æ–°ç­–ç•¥:ä¸å†ä½¿ç”¨ä»»ä½•é¢„è®¾æ¼”ç¤ºæ•°æ®,æ‰€æœ‰æ•°æ®ä»äº‘ç«¯è·å–
        // è¿™ç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œå®æ—¶æ€§
        function initData() {
            // âœ… å·²ç§»é™¤æ‰€æœ‰æ¼”ç¤ºäº§å“çš„è‡ªåŠ¨åŠ è½½
            // âœ… æ•°æ®ä»…åœ¨ç™»å½•æˆåŠŸåä»äº‘ç«¯åŠ è½½
            // âœ… å¦‚éœ€æ·»åŠ äº§å“,è¯·ç®¡ç†å‘˜ç™»å½•åé€šè¿‡åå°ç®¡ç†æ·»åŠ 

            // ä»localStorageåŠ è½½æ‰€æœ‰è®¢å•ï¼ˆç®¡ç†å‘˜ç”¨ï¼‰
            try {
                const savedAllOrders = localStorage.getItem('allOrders');
                if (savedAllOrders) {
                    allOrders = JSON.parse(savedAllOrders);
                    console.log('ğŸ“¦ å·²ä»æœ¬åœ°åŠ è½½æ‰€æœ‰è®¢å•:', allOrders.length, 'ä¸ª');
                }
            } catch (e) {
                // è§£ææœ¬åœ°æ‰€æœ‰è®¢å•å¤±è´¥æ—¶ï¼Œä¸å†å¼ºåˆ¶æ¸…ç©ºå†…å­˜ä¸­çš„ allOrdersï¼Œé¿å…è¦†ç›–å·²æœ‰æœ‰æ•ˆæ•°æ®
                console.error('åŠ è½½æœ¬åœ°æ‰€æœ‰è®¢å•å¤±è´¥ï¼ˆä¿ç•™å½“å‰å†…å­˜æ•°æ®ï¼‰:', e);
            }

            console.log('ğŸ“‹ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            console.log('â„¹ï¸ äº§å“æ•°æ®:', products.length, 'ä¸ª');
            console.log('â„¹ï¸ è®¢å•æ•°æ®:', userOrders.length, 'ä¸ª');
            console.log('â„¹ï¸ æ‰€æœ‰è®¢å•æ•°æ®:', allOrders.length, 'ä¸ªï¼ˆç®¡ç†å‘˜ï¼‰');
            console.log('â„¹ï¸ ç”¨æˆ·æ•°æ®:', allUsers.length, 'ä¸ª');

            updateUserInterface();
        }

        // åŠ è½½æ¼”ç¤ºäº§å“æ•°æ®ï¼ˆä»…åœ¨ç®¡ç†å‘˜æ‰‹åŠ¨è§¦å‘æ—¶ä½¿ç”¨ï¼‰
        function loadDemoProducts() {
            customConfirm(t('confirmLoadDemo'), t('confirmLoadDemoData')).then(confirmed => {
                if (!confirmed) return;
                const demoProducts = [
                    {
                        id: Date.now() + 1,
                        name: 'æ— çº¿è“ç‰™è€³æœº',
                        price: 299,
                        image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: 'electronics',
                        description: 'é«˜å“è´¨æ— çº¿è“ç‰™è€³æœºï¼Œé‡‡ç”¨æœ€æ–°è“ç‰™5.0æŠ€æœ¯ï¼Œæä¾›æ¸…æ™°éŸ³è´¨å’Œé•¿è¾¾20å°æ—¶çš„ç”µæ± ç»­èˆªã€‚è½»å·§è®¾è®¡ï¼Œèˆ’é€‚ä½©æˆ´ã€‚',
                        stock: 50
                    },
                    {
                        id: Date.now() + 2,
                        name: 'æ™ºèƒ½æ‰‹è¡¨',
                        price: 899,
                        image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: 'electronics',
                        description: 'å¤šåŠŸèƒ½æ™ºèƒ½æ‰‹è¡¨ï¼Œæ”¯æŒå¿ƒç‡ç›‘æµ‹ã€è¿åŠ¨è¿½è¸ªã€æ¶ˆæ¯é€šçŸ¥ç­‰åŠŸèƒ½ã€‚é˜²æ°´è®¾è®¡ï¼Œé€‚åˆå„ç§è¿åŠ¨åœºæ™¯ã€‚',
                        stock: 30
                    },
                    {
                        id: Date.now() + 3,
                        name: 'ä¾¿æºå¼éŸ³ç®±',
                        price: 459,
                        image: 'https://images.unsplash.com/photo-1546868871-7041f2a55e12?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: 'electronics',
                        description: 'ä¾¿æºå¼è“ç‰™éŸ³ç®±ï¼Œ360åº¦ç¯ç»•éŸ³æ•ˆï¼ŒIP67é˜²æ°´ç­‰çº§ï¼Œé€‚åˆæˆ·å¤–ä½¿ç”¨ã€‚ç”µæ± ç»­èˆªè¾¾15å°æ—¶ã€‚',
                        stock: 25
                    },
                    {
                        id: Date.now() + 4,
                        name: 'è¿åŠ¨è·‘é‹',
                        price: 599,
                        image: 'https://images.unsplash.com/photo-1491553895911-0055eca6402d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: 'clothing',
                        description: 'ä¸“ä¸šè¿åŠ¨è·‘é‹ï¼Œé‡‡ç”¨é€æ°”ç½‘é¢æè´¨ï¼Œç¼“éœ‡ä¸­åº•è®¾è®¡ï¼Œæä¾›å‡ºè‰²çš„æ”¯æ’‘å’Œèˆ’é€‚æ€§ã€‚',
                        stock: 40
                    },
                    {
                        id: Date.now() + 5,
                        name: 'ç”·å£«é¦™æ°´',
                        price: 429,
                        image: 'https://images.unsplash.com/photo-1585386959984-a4155224a1ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: 'beauty',
                        description: 'ä¼˜é›…ç”·å£«é¦™æ°´ï¼ŒæŒä¹…ç•™é¦™ï¼Œé€‚åˆå„ç§åœºåˆã€‚å‰è°ƒæ¸…æ–°ï¼Œä¸­è°ƒæ¸©æš–ï¼Œåè°ƒæ²‰ç¨³ã€‚',
                        stock: 60
                    },
                    {
                        id: Date.now() + 6,
                        name: 'æ™ºèƒ½å°ç¯',
                        price: 199,
                        image: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
                        category: 'home',
                        description: 'æ™ºèƒ½è°ƒå…‰å°ç¯ï¼Œæ”¯æŒæ‰‹æœºAPPæ§åˆ¶ï¼Œå¤šç§ç¯å…‰æ¨¡å¼ï¼ŒæŠ¤çœ¼è®¾è®¡ï¼Œé€‚åˆé˜…è¯»å’Œå·¥ä½œã€‚',
                        stock: 35
                    }
                ];

                products.push(...demoProducts);
                saveProducts();
                renderAdminProducts();
                showNotification('æ¼”ç¤ºäº§å“å·²åŠ è½½', 'success');
            });
        }


        async function saveProducts() {
            try {
                console.log('ğŸ’¾ å¼€å§‹ä¿å­˜äº§å“æ•°æ®...');
                localStorage.setItem('products', JSON.stringify(products));
                console.log('ğŸ’¾ ä¿å­˜æˆåŠŸï¼Œäº§å“æ•°é‡:', products.length);
                console.log('ğŸ’¾ CLOUD_STORAGE.enabled =', CLOUD_STORAGE.enabled);
                if (CLOUD_STORAGE.enabled) {
                    console.log('ğŸŒ å‡†å¤‡è°ƒç”¨ syncToCloud...');
                    syncToCloud('products', products);
                }
                // åŒæ­¥åˆ°Firebaseäº‘ç«¯
                if (cloudSync && cloudSync.isInitialized) {
                    const isAdmin = isCurrentUserAdmin();
                    if (isAdmin) {
                        // ç®¡ç†å‘˜ï¼šç­‰å¾…åŒæ­¥å®Œæˆï¼Œç¡®ä¿æ•°æ®å·²ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œé¿å…è¢«åç»­çš„loadProductsè¦†ç›–
                        try {
                            console.log('ğŸ‘‘ ç®¡ç†å‘˜æ¨¡å¼ï¼šç­‰å¾…äº§å“æ•°æ®åŒæ­¥å®Œæˆ...');
                            await cloudSync.syncProducts();
                            console.log('âœ… äº§å“æ•°æ®å·²æˆåŠŸåŒæ­¥åˆ°äº‘ç«¯');
                        } catch (err) {
                            console.error('âŒ äº§å“æ•°æ®äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                            // åŒæ­¥å¤±è´¥æ—¶ï¼Œè®°å½•é”™è¯¯ä½†ä¸é˜»æ­¢ä¿å­˜æ“ä½œ
                            showNotification('äº§å“å·²ä¿å­˜ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'warning');
                        }
                    } else {
                        // æ™®é€šç”¨æˆ·ï¼šå¼‚æ­¥åŒæ­¥ï¼Œä¸ç­‰å¾…ï¼ˆæ™®é€šç”¨æˆ·ä¸åº”è¯¥ä¿®æ”¹äº§å“ï¼‰
                        cloudSync.syncProducts().catch(err => {
                            console.warn('äº§å“æ•°æ®äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                        });
                    }
                }
                return true;
            } catch (error) {
                console.error('ğŸ’¾ ä¿å­˜å¤±è´¥:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                return false;
            }
        }

        // æ™ºèƒ½åˆå¹¶è®¢å•æ•°æ®ï¼ˆé¿å…æ•°æ®ä¸¢å¤±ï¼‰- ä¼˜åŒ–ç‰ˆæœ¬ï¼Œæå‡å‡†ç¡®åº¦
        // å…³é”®è§„åˆ™ï¼š
        //   - ä½¿ç”¨ updatedAt åˆ¤æ–­æ–°æ—§ï¼šè°çš„æ—¶é—´æˆ³å¤§ï¼Œè°ä¸ºå‡†
        //   - ç®¡ç†å‘˜é€šè¿‡åå°ä¿®æ”¹è®¢å•çŠ¶æ€æ—¶ï¼Œä¼šä¸º allOrders / userOrders å†™å…¥æ–°çš„ updatedAtï¼Œ
        //     å› æ­¤äº‘ç«¯æ”¶åˆ°çš„ä¹Ÿæ˜¯â€œæœ€æ–°ç‰ˆæœ¬â€ï¼Œå®¢æˆ·ç«¯æœ¬åœ°æ—§æ•°æ®ä¸ä¼šå†æŠŠç®¡ç†å‘˜æ”¹åŠ¨é¡¶å›å»
        function mergeOrdersData(cloudOrders, userAccount) {
            if (!cloudOrders || !Array.isArray(cloudOrders)) {
                console.warn('âš ï¸ äº‘ç«¯è®¢å•æ•°æ®æ— æ•ˆï¼Œä¿ç•™æœ¬åœ°æ•°æ®');
                return;
            }
            
            // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨Mapè¿›è¡ŒO(1)æŸ¥æ‰¾
            const cloudOrdersMap = new Map();
            const validCloudOrders = [];
            
            // é¢„å¤„ç†ï¼šè¿‡æ»¤æ— æ•ˆè®¢å•å¹¶å»ºç«‹æ˜ å°„ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
            cloudOrders.forEach(order => {
                if (order && order.id) {
                    // ç¡®ä¿è®¢å•æœ‰å¿…è¦çš„å­—æ®µ
                    if (!order.updatedAt && order.date) {
                        order.updatedAt = typeof order.date === 'number' ? order.date : Date.now();
                    }
                    if (!order.date && order.updatedAt) {
                        order.date = order.updatedAt;
                    }
                    // ç¡®ä¿accountå­—æ®µå­˜åœ¨
                    if (!order.account && userAccount) {
                        order.account = userAccount;
                    }
                    cloudOrdersMap.set(order.id, order);
                    validCloudOrders.push(order);
                }
            });
            
            // åˆå¹¶ç­–ç•¥ï¼šä¿ç•™æœ¬åœ°æœªåŒæ­¥çš„ä¿®æ”¹ï¼Œä½¿ç”¨äº‘ç«¯æœ€æ–°æ•°æ®
            const mergedOrders = [];
            const processedIds = new Set();
            const localOrdersMap = new Map();
            
            // é¢„å¤„ç†æœ¬åœ°è®¢å•
            userOrders.forEach(order => {
                if (order && order.id) {
                    // ç¡®ä¿æœ¬åœ°è®¢å•ä¹Ÿæœ‰å¿…è¦å­—æ®µ
                    if (!order.updatedAt && order.date) {
                        order.updatedAt = typeof order.date === 'number' ? order.date : Date.now();
                    }
                    if (!order.account && userAccount) {
                        order.account = userAccount;
                    }
                    localOrdersMap.set(order.id, order);
                }
            });
            
            // åˆå¹¶ï¼šä¼˜å…ˆä½¿ç”¨äº‘ç«¯æ•°æ®ï¼ˆæ›´å‡†ç¡®ï¼‰ï¼Œä½†ä¿ç•™æœ¬åœ°æœªåŒæ­¥çš„ä¿®æ”¹
            validCloudOrders.forEach(cloudOrder => {
                const localOrder = localOrdersMap.get(cloudOrder.id);
                if (localOrder) {
                    // æ¯”è¾ƒæ—¶é—´æˆ³ï¼Œä¿ç•™æœ€æ–°çš„
                    const localTime = localOrder.updatedAt || localOrder.date || 0;
                    const cloudTime = cloudOrder.updatedAt || cloudOrder.date || 0;
                    
                    // å¯¹äºç®¡ç†å‘˜å·²ç»åœ¨äº‘ç«¯æ›´æ–°è¿‡çš„è®¢å•ï¼ˆupdatedAt æ˜æ˜¾æ›´å¤§ï¼‰ï¼Œå¿…é¡»ä»¥äº‘ç«¯ä¸ºå‡†ï¼Œå¼ºåˆ¶è¦†ç›–æœ¬åœ°
                    let mergedOrder;
                    if (cloudTime > localTime) {
                        mergedOrder = { ...cloudOrder };
                    } else {
                        mergedOrder = { ...localOrder };
                    }
                    
                    // ç¡®ä¿dateå­—æ®µå­˜åœ¨ï¼ˆè®¢å•åˆ›å»ºæ—¶é—´ï¼Œä¸èƒ½ä¸¢å¤±ï¼‰
                    if (!mergedOrder.date) {
                        mergedOrder.date = localOrder.date || cloudOrder.date || Date.now();
                    }
                    
                    // ç¡®ä¿updatedAtå­—æ®µå­˜åœ¨
                    if (!mergedOrder.updatedAt) {
                        mergedOrder.updatedAt = mergedOrder.date || Date.now();
                    }
                    
                    // ç¡®ä¿accountå­—æ®µå­˜åœ¨
                    if (!mergedOrder.account) {
                        mergedOrder.account = localOrder.account || cloudOrder.account || userAccount;
                    }
                    
                    // ç¡®ä¿customerInfoå­—æ®µå®Œæ•´
                    if (!mergedOrder.customerInfo) {
                        mergedOrder.customerInfo = localOrder.customerInfo || cloudOrder.customerInfo || {};
                    }
                    
                    // ç¡®ä¿productNameå­—æ®µå­˜åœ¨
                    if (!mergedOrder.productName) {
                        mergedOrder.productName = localOrder.productName || cloudOrder.productName || '';
                    }
                    
                    mergedOrders.push(mergedOrder);
                    processedIds.add(cloudOrder.id);
                } else {
                    // äº‘ç«¯æœ‰ä½†æœ¬åœ°æ²¡æœ‰ï¼Œç›´æ¥æ·»åŠ 
                    mergedOrders.push(cloudOrder);
                    processedIds.add(cloudOrder.id);
                }
            });
            
            // æ·»åŠ æœ¬åœ°æœ‰ä½†äº‘ç«¯æ²¡æœ‰çš„è®¢å•ï¼ˆåªä¿ç•™æœ€è¿‘åˆ›å»ºçš„è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°ï¼‰
            // æ—¶é—´é˜ˆå€¼ï¼šåªä¿ç•™æœ€è¿‘30å¤©å†…åˆ›å»ºçš„è®¢å•ï¼Œé¿å…æ—§æ•°æ®é‡ç°
            const RECENT_ORDER_THRESHOLD = 30 * 24 * 60 * 60 * 1000; // 30å¤©
            const now = Date.now();
            
            localOrdersMap.forEach((localOrder, id) => {
                if (!processedIds.has(id)) {
                    // åªä¿ç•™å±äºå½“å‰ç”¨æˆ·çš„è®¢å•
                    if (localOrder.account === userAccount || !localOrder.account) {
                        // æ£€æŸ¥è®¢å•æ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„ï¼ˆæœ€è¿‘30å¤©å†…ï¼‰
                        const orderTime = localOrder.date || localOrder.updatedAt || 0;
                        const isRecentOrder = (now - orderTime) < RECENT_ORDER_THRESHOLD;
                        
                        if (isRecentOrder) {
                            // åªæ·»åŠ æœ€è¿‘åˆ›å»ºçš„è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                            mergedOrders.push(localOrder);
                            console.log(`âœ… ä¿ç•™æœ¬åœ°æ–°è®¢å•: ${id} (åˆ›å»ºæ—¶é—´: ${new Date(orderTime).toLocaleString()})`);
                        } else {
                            // å¿½ç•¥æ—§è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                            console.log(`âš ï¸ å¿½ç•¥æœ¬åœ°æ—§è®¢å•: ${id} (åˆ›å»ºæ—¶é—´: ${new Date(orderTime).toLocaleString()}, å·²è¶…è¿‡30å¤©)`);
                        }
                    }
                }
            });
            
            // æŒ‰æ›´æ–°æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            mergedOrders.sort((a, b) => {
                const timeA = a.updatedAt || a.date || 0;
                const timeB = b.updatedAt || b.date || 0;
                return timeB - timeA;
            });
            
            // æ›´æ–°æœ¬åœ°æ•°æ®
            const beforeCount = userOrders.length;
            userOrders = mergedOrders;
            
            // ä¿å­˜åˆ°localStorageï¼ˆåªä¿å­˜ä¸€æ¬¡ï¼Œé¿å…è¿‡å¤šå¤‡ä»½å½±å“æ€§èƒ½ï¼‰
            if (currentUser && currentUser.account) {
                const userOrdersKey = `userOrders_${currentUser.account}`;
                localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
            }
            localStorage.setItem('userOrders', JSON.stringify(userOrders));
        }
        
        // åˆå¹¶æ‰€æœ‰è®¢å•æ•°æ®ï¼ˆç”¨äºåå°ç®¡ç†ï¼‰- ä¼˜åŒ–ç‰ˆæœ¬
        function mergeAllOrdersData(cloudOrders) {
            if (!cloudOrders || !Array.isArray(cloudOrders)) return;
            
            // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨Mapè¿›è¡ŒO(1)æŸ¥æ‰¾
            const cloudOrdersMap = new Map();
            const validCloudOrders = [];
            
            // é¢„å¤„ç†ï¼šè¿‡æ»¤æ— æ•ˆè®¢å•å¹¶å»ºç«‹æ˜ å°„
            cloudOrders.forEach(order => {
                if (order && order.id) {
                    // ç¡®ä¿è®¢å•æœ‰å¿…è¦çš„å­—æ®µ
                    if (!order.updatedAt && order.date) {
                        order.updatedAt = typeof order.date === 'number' ? order.date : Date.now();
                    }
                    cloudOrdersMap.set(order.id, order);
                    validCloudOrders.push(order);
                }
            });
            
            // åˆå¹¶ç­–ç•¥ï¼šä¿ç•™æœ¬åœ°æœªåŒæ­¥çš„ä¿®æ”¹ï¼Œä½¿ç”¨äº‘ç«¯æœ€æ–°æ•°æ®
            const mergedOrders = [];
            const processedIds = new Set();
            const localOrdersMap = new Map();
            
            // é¢„å¤„ç†æœ¬åœ°è®¢å•
            allOrders.forEach(order => {
                if (order && order.id) {
                    localOrdersMap.set(order.id, order);
                }
            });
            
            // åˆå¹¶ï¼šä¼˜å…ˆä½¿ç”¨äº‘ç«¯æ•°æ®ï¼ˆæ›´å‡†ç¡®ï¼‰ï¼Œä½†ä¿ç•™æœ¬åœ°æœªåŒæ­¥çš„ä¿®æ”¹
            validCloudOrders.forEach(cloudOrder => {
                const localOrder = localOrdersMap.get(cloudOrder.id);
                if (localOrder) {
                    // æ¯”è¾ƒæ—¶é—´æˆ³ï¼Œä¿ç•™æœ€æ–°çš„
                    const localTime = localOrder.updatedAt || localOrder.date || 0;
                    const cloudTime = cloudOrder.updatedAt || cloudOrder.date || 0;
                    
                    // å¯¹äºç®¡ç†å‘˜å·²ç»åœ¨äº‘ç«¯æ›´æ–°è¿‡çš„è®¢å•ï¼ˆupdatedAt æ˜æ˜¾æ›´å¤§ï¼‰ï¼Œå¿…é¡»ä»¥äº‘ç«¯ä¸ºå‡†ï¼Œå¼ºåˆ¶è¦†ç›–æœ¬åœ°
                    let mergedOrder;
                    if (cloudTime > localTime) {
                        mergedOrder = { ...cloudOrder };
                    } else {
                        mergedOrder = { ...localOrder };
                    }
                    
                    // ç¡®ä¿dateå­—æ®µå­˜åœ¨ï¼ˆè®¢å•åˆ›å»ºæ—¶é—´ï¼‰
                    if (!mergedOrder.date) {
                        mergedOrder.date = localOrder.date || cloudOrder.date || Date.now();
                    }
                    
                    // ç¡®ä¿updatedAtå­—æ®µå­˜åœ¨
                    if (!mergedOrder.updatedAt) {
                        mergedOrder.updatedAt = mergedOrder.date || Date.now();
                    }
                    
                    // ç¡®ä¿accountå­—æ®µå­˜åœ¨
                    if (!mergedOrder.account && localOrder.account) {
                        mergedOrder.account = localOrder.account;
                    }
                    if (!mergedOrder.account && cloudOrder.account) {
                        mergedOrder.account = cloudOrder.account;
                    }
                    
                    mergedOrders.push(mergedOrder);
                    processedIds.add(cloudOrder.id);
                } else {
                    // äº‘ç«¯æœ‰ä½†æœ¬åœ°æ²¡æœ‰ï¼Œç›´æ¥æ·»åŠ 
                    mergedOrders.push(cloudOrder);
                    processedIds.add(cloudOrder.id);
                }
            });
            
            // æ·»åŠ æœ¬åœ°æœ‰ä½†äº‘ç«¯æ²¡æœ‰çš„è®¢å•ï¼ˆåªä¿ç•™æœ€è¿‘åˆ›å»ºçš„è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°ï¼‰
            // æ—¶é—´é˜ˆå€¼ï¼šåªä¿ç•™æœ€è¿‘30å¤©å†…åˆ›å»ºçš„è®¢å•ï¼Œé¿å…æ—§æ•°æ®é‡ç°
            const RECENT_ORDER_THRESHOLD = 30 * 24 * 60 * 60 * 1000; // 30å¤©
            const now = Date.now();
            
            localOrdersMap.forEach((localOrder, id) => {
                if (!processedIds.has(id)) {
                    // æ£€æŸ¥è®¢å•æ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„ï¼ˆæœ€è¿‘30å¤©å†…ï¼‰
                    const orderTime = localOrder.date || localOrder.updatedAt || 0;
                    const isRecentOrder = (now - orderTime) < RECENT_ORDER_THRESHOLD;
                    
                    if (isRecentOrder) {
                        // åªæ·»åŠ æœ€è¿‘åˆ›å»ºçš„è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                        mergedOrders.push(localOrder);
                        console.log(`âœ… ä¿ç•™æœ¬åœ°æ–°è®¢å•: ${id} (åˆ›å»ºæ—¶é—´: ${new Date(orderTime).toLocaleString()})`);
                    } else {
                        // å¿½ç•¥æ—§è®¢å•ï¼Œé¿å…å†å²æ•°æ®é‡ç°
                        console.log(`âš ï¸ å¿½ç•¥æœ¬åœ°æ—§è®¢å•: ${id} (åˆ›å»ºæ—¶é—´: ${new Date(orderTime).toLocaleString()}, å·²è¶…è¿‡30å¤©)`);
                    }
                }
            });
            
            // æŒ‰æ›´æ–°æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            mergedOrders.sort((a, b) => {
                const timeA = a.updatedAt || a.date || 0;
                const timeB = b.updatedAt || b.date || 0;
                return timeB - timeA;
            });
            
            // æ›´æ–°å…¨å±€è®¢å•æ•°æ®
            allOrders = mergedOrders;
            localStorage.setItem('allOrders', JSON.stringify(allOrders));
            
            console.log(`âœ… æ‰€æœ‰è®¢å•æ•°æ®å·²æ™ºèƒ½åˆå¹¶: ${mergedOrders.length} ä¸ªè®¢å•`);
        }

        // ========== ç»Ÿä¸€çš„æ•°æ®ä¿å­˜å’ŒåŒæ­¥æ¥å£ ==========
        function saveUserOrders() {
            // ä¸ºæ¯ä¸ªè®¢å•æ·»åŠ æ›´æ–°æ—¶é—´æˆ³å’Œè´¦æˆ·ä¿¡æ¯
            const now = Date.now();
            userOrders.forEach(order => {
                if (!order.updatedAt) {
                    order.updatedAt = now;
                }
                // ç¡®ä¿è®¢å•æœ‰accountå­—æ®µ
                if (!order.account && currentUser && currentUser.account) {
                    order.account = currentUser.account;
                }
            });
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            if (currentUser && currentUser.account) {
                const userOrdersKey = `userOrders_${currentUser.account}`;
                Storage.set(userOrdersKey, userOrders);
            }
            Storage.set('userOrders', userOrders); // å…¼å®¹æ—§ä»£ç 
            
            // æ›´æ–°å…¨å±€è®¢å•æ•°ç»„ï¼ˆå¦‚æœå½“å‰ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼‰
            if (currentUser && currentUser.role === 'admin') {
                updateAllOrdersFromUserOrders();
            }
            
            // åŒæ­¥åˆ°äº‘ç«¯ï¼ˆä½¿ç”¨ç»Ÿä¸€åŒæ­¥æ¥å£ï¼‰
            if (cloudSync && cloudSync.isInitialized) {
                cloudSync.syncOrders().catch(err => {
                    console.error('è®¢å•äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                });
            }
        }
        
        // ä»ç”¨æˆ·è®¢å•æ›´æ–°å…¨å±€è®¢å•æ•°ç»„
        function updateAllOrdersFromUserOrders() {
            if (!currentUser || currentUser.role !== 'admin') return;
            
            // åˆ›å»ºè®¢å•IDæ˜ å°„
            const allOrdersMap = new Map();
            allOrders.forEach(order => {
                allOrdersMap.set(order.id, order);
            });
            
            // æ›´æ–°æˆ–æ·»åŠ å½“å‰ç”¨æˆ·çš„è®¢å•
            userOrders.forEach(userOrder => {
                // ç¡®ä¿è®¢å•æœ‰accountå­—æ®µ
                if (!userOrder.account && currentUser.account) {
                    userOrder.account = currentUser.account;
                }
                allOrdersMap.set(userOrder.id, userOrder);
            });
            
            // æ›´æ–°å…¨å±€æ•°ç»„
            allOrders = Array.from(allOrdersMap.values());
            localStorage.setItem('allOrders', JSON.stringify(allOrders));
            console.log('âœ… å…¨å±€è®¢å•æ•°ç»„å·²æ›´æ–°:', allOrders.length, 'ä¸ªè®¢å•');
        }

        // æ™ºèƒ½åˆå¹¶ç”¨æˆ·æ•°æ®åˆ—è¡¨ï¼šæŒ‰ account å»é‡ï¼Œå°½é‡ä»¥äº‘ç«¯ä¸ºå‡†ï¼ŒåŒæ—¶ä¿ç•™æœ¬åœ°æ–°å¢ç”¨æˆ·
        // ç‰¹åˆ«è§„åˆ™ï¼š
        //   - æ™®é€šåŒæ­¥ï¼šä¸€æ—¦è´¦å·åœ¨äº‘ç«¯è¢«æ ‡è®°ä¸º bannedï¼Œæœ¬åœ°ä¸èƒ½è‡ªåŠ¨â€œæ´—ç™½â€
        //   - ç®¡ç†å‘˜åŒæ­¥ï¼šå…è®¸æ˜¾å¼è§£ç¦ï¼ˆæœ¬åœ°ä» banned æ”¹ä¸º activeï¼‰ï¼Œä»¥ç®¡ç†å‘˜æ“ä½œä¸ºå‡†
        function mergeUsersData(cloudUsers, localUsers, options = {}) {
            const allowUnban = !!options.allowUnban;
            const resultMap = new Map();

            // å…ˆæŠŠäº‘ç«¯ç”¨æˆ·æ”¾è¿›å»ï¼ˆé»˜è®¤ä»¥äº‘ç«¯ä¸ºå‡†ï¼‰
            if (Array.isArray(cloudUsers)) {
                cloudUsers.forEach(user => {
                    if (user && user.account) {
                        resultMap.set(user.account, user);
                    }
                });
            }

            // å†åˆå¹¶æœ¬åœ°ç”¨æˆ·ï¼šäº‘ç«¯ä¸å­˜åœ¨çš„è´¦å·ç›´æ¥åŠ å…¥ï¼›äº‘ç«¯å­˜åœ¨çš„ï¼Œä»…åœ¨æœ¬åœ°æ˜æ˜¾æ›´æ–°æ—¶è¦†ç›–
            if (Array.isArray(localUsers)) {
                localUsers.forEach(user => {
                    if (!user || !user.account) return;
                    const account = user.account;
                    const cloudUser = resultMap.get(account);

                    if (!cloudUser) {
                        // äº‘ç«¯æ²¡æœ‰è¿™ä¸ªè´¦å·ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·ï¼ˆé¿å…å†å²ç”¨æˆ·é‡ç°ï¼‰
                        // æ—¶é—´é˜ˆå€¼ï¼šåªä¿ç•™æœ€è¿‘90å¤©å†…æ³¨å†Œçš„ç”¨æˆ·ï¼Œé¿å…æ—§æ•°æ®é‡ç°
                        const RECENT_USER_THRESHOLD = 90 * 24 * 60 * 60 * 1000; // 90å¤©
                        const now = Date.now();
                        const registerTime = user.registerTime 
                            ? (typeof user.registerTime === 'string' ? new Date(user.registerTime).getTime() : user.registerTime)
                            : (user.updatedAt || 0);
                        const isRecentUser = (now - registerTime) < RECENT_USER_THRESHOLD;
                        
                        if (isRecentUser) {
                            // åªæ·»åŠ æœ€è¿‘æ³¨å†Œçš„ç”¨æˆ·ï¼Œé¿å…å†å²ç”¨æˆ·é‡ç°
                            resultMap.set(account, user);
                            console.log(`âœ… ä¿ç•™æœ¬åœ°æ–°ç”¨æˆ·: ${account} (æ³¨å†Œæ—¶é—´: ${new Date(registerTime).toLocaleString()})`);
                        } else {
                            // å¿½ç•¥æ—§ç”¨æˆ·ï¼Œé¿å…å†å²ç”¨æˆ·é‡ç°
                            console.log(`âš ï¸ å¿½ç•¥æœ¬åœ°æ—§ç”¨æˆ·: ${account} (æ³¨å†Œæ—¶é—´: ${new Date(registerTime).toLocaleString()}, å·²è¶…è¿‡90å¤©)`);
                        }
                    } else {
                        // åŒä¸€è´¦å·åŒæ—¶å­˜åœ¨äºäº‘ç«¯å’Œæœ¬åœ°ï¼ŒæŒ‰æ—¶é—´æˆ³/æ³¨å†Œæ—¶é—´å†³å®šæ˜¯å¦è¦†ç›–
                        const cloudTime = cloudUser.updatedAt
                            || (cloudUser.registerTime ? new Date(cloudUser.registerTime).getTime() : 0);
                        const localTime = user.updatedAt
                            || (user.registerTime ? new Date(user.registerTime).getTime() : 0);

                        const cloudBanned = cloudUser.status === 'banned';
                        const localBanned = user.status === 'banned';

                        // 1ï¸âƒ£ äº‘ç«¯å·²ç¦ç”¨ï¼Œæœ¬åœ°æœªç¦ç”¨
                        if (cloudBanned && !localBanned) {
                            if (allowUnban) {
                                // ç®¡ç†å‘˜åŒæ­¥åœºæ™¯ï¼šå…è®¸æœ¬åœ°â€œè§£ç¦â€ï¼Œä½†ä»æŒ‰æ—¶é—´æˆ³åˆ¤æ–­è°æ›´æ–°å¾—æ›´æ™š
                                if (localTime > cloudTime) {
                                    resultMap.set(account, user);
                                } else {
                                    resultMap.set(account, cloudUser);
                                }
                            } else {
                                // æ™®é€šåŒæ­¥ï¼šä¿æŒäº‘ç«¯ç¦ç”¨çŠ¶æ€
                                resultMap.set(account, cloudUser);
                            }
                        }
                        // 2ï¸âƒ£ æœ¬åœ°æ˜¯ç¦ç”¨çŠ¶æ€ï¼Œè€Œäº‘ç«¯ä¸æ˜¯ï¼Œåˆ™ä»¥æœ¬åœ°ä¸ºå‡†ï¼ˆé€šå¸¸æ¥è‡ªç®¡ç†å‘˜ç¦ç”¨ï¼‰
                        else if (localBanned && !cloudBanned) {
                            resultMap.set(account, user);
                        }
                        // 3ï¸âƒ£ å…¶ä½™æƒ…å†µæŒ‰æ—¶é—´æˆ³å†³å®š
                        else if (localTime > cloudTime) {
                            // æœ¬åœ°çœ‹èµ·æ¥æ›´æ–°æ›´æ™šï¼Œç”¨æœ¬åœ°è¦†ç›–äº‘ç«¯ç‰ˆæœ¬
                            resultMap.set(account, user);
                        } else {
                            resultMap.set(account, cloudUser);
                        }
                    }
                });
            }

            return Array.from(resultMap.values());
        }

        function saveCurrentUser() {
            Storage.set('currentUser', currentUser);
        }

        function saveUserAddresses() {
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            if (currentUser && currentUser.account) {
                const userAddressesKey = `userAddresses_${currentUser.account}`;
                Storage.set(userAddressesKey, userAddresses);
            }
            Storage.set('userAddresses', userAddresses); // å…¼å®¹æ—§ä»£ç 
            
            // åŒæ­¥åˆ°äº‘ç«¯ï¼ˆä½¿ç”¨ç»Ÿä¸€åŒæ­¥æ¥å£ï¼‰
            if (cloudSync && cloudSync.isInitialized) {
                cloudSync.syncAddresses().catch(err => {
                    console.error('åœ°å€æ•°æ®äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                });
            }
        }

        function saveUserProfile() {
            Storage.set('userProfile', userProfile);
        }

        // ä¿å­˜è®¾å¤‡æ³¨å†Œé™åˆ¶
        function saveDeviceRegisterLimits() {
            Storage.set('deviceRegisterLimits', deviceRegisterLimits);
        }

        // è·å–è®¾å¤‡çš„æ³¨å†Œé™åˆ¶
        function getDeviceRegisterLimit(deviceId) {
            return deviceRegisterLimits[deviceId] !== undefined 
                ? deviceRegisterLimits[deviceId] 
                : DEFAULT_DEVICE_REGISTER_LIMIT;
        }

        // æ›´æ–°è®¾å¤‡é™åˆ¶åˆ—è¡¨æ˜¾ç¤º
        function updateDeviceLimitsList() {
            const contentDiv = DOMCache.get('#device-limits-content');
            if (!contentDiv) return;

            const devices = Object.keys(deviceRegisterLimits);
            if (devices.length === 0) {
                contentDiv.innerHTML = `<p style="color: #666; margin: 0;">æš‚æ— è‡ªå®šä¹‰é™åˆ¶ï¼Œæ‰€æœ‰è®¾å¤‡ä½¿ç”¨é»˜è®¤é™åˆ¶(${DEFAULT_DEVICE_REGISTER_LIMIT})</p>`;
                return;
            }

            // ç»Ÿè®¡æ¯ä¸ªè®¾å¤‡çš„å®é™…æ³¨å†Œæ•°é‡
            const deviceUserCountMap = {};
            allUsers.forEach(user => {
                if (user.role !== 'admin' && user.deviceId) {
                    deviceUserCountMap[user.deviceId] = (deviceUserCountMap[user.deviceId] || 0) + 1;
                }
            });

            // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ä¼˜åŒ–æ€§èƒ½
            const rows = devices.map(deviceId => {
                const limit = deviceRegisterLimits[deviceId];
                const currentCount = deviceUserCountMap[deviceId] || 0;
                const statusColor = currentCount >= limit ? '#dc3545' : (currentCount >= limit * 0.8 ? '#ffc107' : '#28a745');
                const escapedDeviceId = escapeHtml(deviceId);
                return `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 8px; border: 1px solid #dee2e6;">${escapeHtml(formatDeviceLabel(deviceId))}<br><small style="color: #666;">${escapedDeviceId}</small></td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #dee2e6;">${limit}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #dee2e6; color: ${statusColor}; font-weight: bold;">${currentCount}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #dee2e6;">
                            <button class="btn btn-sm btn-danger" onclick="removeDeviceLimit('${escapedDeviceId.replace(/'/g, "\\'")}')" style="padding: 4px 8px; font-size: 12px;">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');

            contentDiv.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #e9ecef;">
                            <th style="padding: 8px; text-align: left; border: 1px solid #dee2e6;">è®¾å¤‡ID</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #dee2e6;">é™åˆ¶æ•°é‡</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #dee2e6;">å·²æ³¨å†Œ</th>
                            <th style="padding: 8px; text-align: center; border: 1px solid #dee2e6;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
        }

        // åˆ é™¤è®¾å¤‡é™åˆ¶
        function removeDeviceLimit(deviceId) {
            if (!deviceId) {
                console.error('removeDeviceLimit: deviceId ä¸èƒ½ä¸ºç©º');
                return;
            }
            const deviceLabel = formatDeviceLabel(deviceId);
            if (confirm(`ç¡®å®šè¦åˆ é™¤è®¾å¤‡ ${deviceLabel} çš„è‡ªå®šä¹‰æ³¨å†Œé™åˆ¶å—ï¼Ÿåˆ é™¤åå°†ä½¿ç”¨é»˜è®¤é™åˆ¶(${DEFAULT_DEVICE_REGISTER_LIMIT})ã€‚`)) {
                try {
                    delete deviceRegisterLimits[deviceId];
                    saveDeviceRegisterLimits();
                    updateDeviceLimitsList();
                    showMessageModal('æˆåŠŸ', 'è®¾å¤‡é™åˆ¶å·²åˆ é™¤', 'success');
                } catch (error) {
                    console.error('åˆ é™¤è®¾å¤‡é™åˆ¶å¤±è´¥:', error);
                    showMessageModal('é”™è¯¯', 'åˆ é™¤è®¾å¤‡é™åˆ¶å¤±è´¥', 'alert');
                }
            }
        }

        // é€šç”¨çš„ç®¡ç†å‘˜æ›´æ–°åŒ…è£…å™¨ï¼šä¼˜å…ˆåœ¨äº‘ç«¯æ‰§è¡Œå†™å…¥ + é‡æ–°åŠ è½½ï¼Œé¿å…æœ¬åœ°æ—§æ•°æ®è¦†ç›–äº‘ç«¯
        async function runAdminUpdate(writeFn, reloadFn) {
            const isAdminUser = currentUser && currentUser.role === 'admin';
            const canUseCloud = cloudSync && cloudSync.isInitialized;

            // å¦‚æœæ— æ³•ä½¿ç”¨äº‘ç«¯æˆ–å½“å‰ä¸æ˜¯ç®¡ç†å‘˜ï¼Œåˆ™ç›´æ¥æ‰§è¡Œæœ¬åœ°é€»è¾‘
            if (!isAdminUser || !canUseCloud) {
                try {
                    if (typeof writeFn === 'function') {
                        await writeFn();
                    }
                    if (typeof reloadFn === 'function') {
                        await reloadFn();
                    }
                } catch (e) {
                    console.error('runAdminUpdate æœ¬åœ°æ‰§è¡Œå‡ºé”™:', e);
                }
                return;
            }

            // ç®¡ç†å‘˜ + äº‘ç«¯å¯ç”¨ï¼šä½¿ç”¨å®‰å…¨æ¨¡å¼ï¼Œé˜²æ­¢ç›‘å¬å™¨ç”¨æ—§æ•°æ®è¦†ç›–
            try {
                cloudSync._syncState.inProgress = true;

                if (typeof writeFn === 'function') {
                    await writeFn();
                }
                if (typeof reloadFn === 'function') {
                    await reloadFn();
                }
            } catch (e) {
                console.error('runAdminUpdate äº‘ç«¯æ‰§è¡Œå‡ºé”™:', e);
            } finally {
                setTimeout(() => {
                    if (cloudSync) {
                        cloudSync._syncState.inProgress = false;
                    }
                }, 500);
            }
        }

        async function saveAllUsers() {
            // æœ¬åœ°æŒä¹…åŒ–ä¸€ä»½æœ€æ–°çš„ allUsers ä½œä¸ºç¼“å­˜
            try {
                Storage.set('allUsers', allUsers);
            } catch (e) {
                console.warn('ä¿å­˜æœ¬åœ° allUsers å¤±è´¥:', e);
            }
            
            // ä½¿ç”¨ç»Ÿä¸€çš„ç®¡ç†å‘˜æ›´æ–°æµç¨‹åŒæ­¥åˆ°äº‘ç«¯
            if (cloudSync && cloudSync.isInitialized && typeof cloudSync.syncAllUsers === 'function') {
                await runAdminUpdate(
                    () => cloudSync.syncAllUsers(),
                    null
                );
            } else if (CLOUD_STORAGE.enabled) {
                // å¦‚æœCloudSyncManageræœªåˆå§‹åŒ–ï¼Œä½¿ç”¨æ—§çš„åŒæ­¥æ–¹å¼
                syncToCloud('users', allUsers);
            }
        }

        // ç®€åŒ–çš„æ•°æ®åŒæ­¥åŠŸèƒ½ - ä½¿ç”¨ localStorage è·¨è®¾å¤‡åŒæ­¥
        function syncToCloud(dataType, data) {
            console.log(`ğŸ”„ å¼€å§‹åŒæ­¥ ${dataType} æ•°æ®...`);
            console.log(`ğŸ“Š CROSS_DEVICE_SYNC.enabled = ${CROSS_DEVICE_SYNC.enabled}`);

            if (!CROSS_DEVICE_SYNC.enabled) {
                console.warn(`âš ï¸ ${dataType} åŒæ­¥å·²ç¦ç”¨`);
                return;
            }

            try {
                // åˆ›å»ºåŒæ­¥æ•°æ®åŒ…
                const syncData = {
                    type: dataType,
                    data: data,
                    timestamp: Date.now(),
                    deviceId: getDeviceId()
                };

                console.log(`ğŸ“¦ åŒæ­¥æ•°æ®åŒ…:`, syncData);

                // ä¿å­˜åˆ° localStorage
                const existingSync = JSON.parse(localStorage.getItem(CROSS_DEVICE_SYNC.syncKey) || '{}');
                existingSync[dataType] = syncData;
                localStorage.setItem(CROSS_DEVICE_SYNC.syncKey, JSON.stringify(existingSync));
                localStorage.setItem(CROSS_DEVICE_SYNC.lastSyncTime, Date.now().toString());

                console.log(`âœ… ${dataType} æ•°æ®å·²åŒæ­¥åˆ°æœ¬åœ°å­˜å‚¨`);

                // å°è¯•åŒæ­¥åˆ°å…¶ä»–è®¾å¤‡ï¼ˆé€šè¿‡ URL å‚æ•°ï¼‰
                syncViaURL(dataType, data);

            } catch (error) {
                console.error(`âŒ ${dataType} åŒæ­¥é”™è¯¯:`, error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
            }
        }

        function syncFromCloud(dataType) {
            if (!CROSS_DEVICE_SYNC.enabled) return null;

            try {
                const syncData = JSON.parse(localStorage.getItem(CROSS_DEVICE_SYNC.syncKey) || '{}');
                const data = syncData[dataType];

                if (data && data.data) {
                    console.log(`âœ… ${dataType} æ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨åŒæ­¥`);
                    return data.data;
                }

                return null;
            } catch (error) {
                console.error(`âŒ ${dataType} åŒæ­¥é”™è¯¯:`, error);
                return null;
            }
        }

        // ç”Ÿæˆè®¾å¤‡ID
        function getDeviceId() {
            let deviceId = localStorage.getItem('device_id');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('device_id', deviceId);
            }
            return deviceId;
        }

        // é€šè¿‡URLå‚æ•°åŒæ­¥æ•°æ®ï¼ˆç®€å•æ–¹æ¡ˆï¼‰
        function syncViaURL(dataType, data) {
            try {
                // ä½¿ç”¨ encodeURIComponent æ›¿ä»£ btoaï¼Œæ”¯æŒä¸­æ–‡å­—ç¬¦
                const jsonData = JSON.stringify({ type: dataType, data: data });
                const encodedData = encodeURIComponent(jsonData);
                const syncURL = `${window.location.origin}${window.location.pathname}?sync=${encodedData}`;

                // åœ¨æ§åˆ¶å°æ˜¾ç¤ºåŒæ­¥é“¾æ¥ï¼Œç”¨æˆ·å¯ä»¥å¤åˆ¶åˆ°å…¶ä»–è®¾å¤‡
                console.log(`ğŸ“‹ è·¨è®¾å¤‡åŒæ­¥é“¾æ¥ (${dataType}):`, syncURL);

                // å¯ä»¥æ˜¾ç¤ºç»™ç”¨æˆ·ï¼ˆå·²ç¦ç”¨ï¼Œé¿å…å¼¹çª—å¹²æ‰°ï¼‰
                // if (isAdmin()) {
                //     showNotification(`æ•°æ®åŒæ­¥é“¾æ¥å·²ç”Ÿæˆï¼Œè¯·å¤åˆ¶åˆ°å…¶ä»–è®¾å¤‡: ${syncURL}`, 'info');
                // }
            } catch (error) {
                console.error('URLåŒæ­¥å¤±è´¥:', error);
            }
        }

        // ä»URLå‚æ•°è¯»å–åŒæ­¥æ•°æ®
        function loadSyncFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const syncData = urlParams.get('sync');

                if (syncData) {
                    const decoded = JSON.parse(decodeURIComponent(syncData));
                    console.log('ğŸ“¥ ä»URLæ¥æ”¶åˆ°åŒæ­¥æ•°æ®:', decoded);

                    // æ ¹æ®æ•°æ®ç±»å‹æ›´æ–°æœ¬åœ°æ•°æ®
                    switch (decoded.type) {
                        case 'products':
                            products = decoded.data;
                            saveProducts();
                            renderProducts(products);
                            showNotification('äº§å“æ•°æ®å·²åŒæ­¥', 'success');
                            break;
                        case 'users':
                            allUsers = decoded.data;
                            saveAllUsers();
                            showNotification('ç”¨æˆ·æ•°æ®å·²åŒæ­¥', 'success');
                            break;
                        case 'orders':
                            userOrders = decoded.data;
                            saveUserOrders();
                            showNotification('è®¢å•æ•°æ®å·²åŒæ­¥', 'success');
                            break;
                    }

                    // æ¸…é™¤URLå‚æ•°
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            } catch (error) {
                console.error('URLåŒæ­¥æ•°æ®è§£æå¤±è´¥:', error);
            }
        }

        // åˆå§‹åŒ–æ—¶ä»äº‘ç«¯åŒæ­¥æ•°æ®
        // æ—§çš„initCloudSyncå‡½æ•°ï¼ˆå·²åºŸå¼ƒï¼Œä½¿ç”¨Firebase CloudSyncManagerç‰ˆæœ¬ï¼‰
        // æ­¤å‡½æ•°å·²è¢«ä¸Šæ–¹çš„Firebaseç‰ˆæœ¬æ›¿ä»£ï¼Œä¿ç•™ä»…ä¸ºå…¼å®¹æ€§
        // async function initCloudSync() { ... }

        // æƒé™æ£€æŸ¥å‡½æ•°
        function isAdmin() {
            return currentUser && currentUser.role === 'admin';
        }

        function isLoggedIn() {
            return currentUser !== null;
        }

        // ========== è´¦æˆ·è§„èŒƒåŒ–å·¥å…·å‡½æ•° ==========
        /**
         * å°†è´¦æˆ·åè½¬æ¢ä¸ºè§„èŒƒæ ¼å¼ï¼ˆå…¨å°å†™ï¼‰ï¼Œç”¨äºå”¯ä¸€æ€§æ£€æŸ¥å’ŒæŸ¥æ‰¾
         * ä¾‹å¦‚ï¼šGoo@qq.com -> goo@qq.com
         */
        function normalizeAccount(account) {
            if (!account || typeof account !== 'string') return '';
            return account.toLowerCase().trim();
        }

        /**
         * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨çº¿ï¼ˆé€šè¿‡æ£€æŸ¥ Firebase ä¸­çš„ activeSessionIdï¼‰
         * @param {string} account - ç”¨æˆ·è´¦å·
         * @returns {Promise<boolean>} - ç”¨æˆ·æ˜¯å¦åœ¨çº¿
         */
        async function checkUserOnlineStatus(account) {
            if (!account || !cloudSync || !cloudSync.isInitialized) {
                return false;
            }
            
            try {
                const userPath = cloudSync.getUserPath(account);
                const sessionRef = cloudSync.db.ref(`${userPath}/activeSessionId`);
                const snapshot = await sessionRef.once('value');
                const sessionData = snapshot.val();
                
                // å¦‚æœ activeSessionId å­˜åœ¨ä¸”æœ‰ id å­—æ®µï¼Œä¸”æ›´æ–°æ—¶é—´åœ¨æœ€è¿‘5åˆ†é’Ÿå†…ï¼Œè®¤ä¸ºç”¨æˆ·åœ¨çº¿
                if (sessionData && sessionData.id) {
                    const updatedAt = sessionData.updatedAt || 0;
                    const now = Date.now();
                    const fiveMinutes = 5 * 60 * 1000; // 5åˆ†é’Ÿ
                    return (now - updatedAt) < fiveMinutes;
                }
                return false;
            } catch (error) {
                console.warn(`æ£€æŸ¥ç”¨æˆ· ${account} åœ¨çº¿çŠ¶æ€å¤±è´¥:`, error);
                return false;
            }
        }

        /**
         * æ‰¹é‡æ£€æŸ¥æ‰€æœ‰ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€
         */
        async function updateAllUsersOnlineStatus() {
            if (!cloudSync || !cloudSync.isInitialized) {
                userOnlineStatus = {};
                return;
            }

            try {
                const statusPromises = allUsers.map(async (user) => {
                    const isOnline = await checkUserOnlineStatus(user.account);
                    return { account: user.account, isOnline };
                });
                
                const results = await Promise.all(statusPromises);
                userOnlineStatus = {};
                results.forEach(({ account, isOnline }) => {
                    userOnlineStatus[account] = isOnline;
                });
                
                console.log('âœ… ç”¨æˆ·åœ¨çº¿çŠ¶æ€å·²æ›´æ–°:', Object.keys(userOnlineStatus).filter(acc => userOnlineStatus[acc]).length, 'ä¸ªç”¨æˆ·åœ¨çº¿');
            } catch (error) {
                console.error('æ›´æ–°ç”¨æˆ·åœ¨çº¿çŠ¶æ€å¤±è´¥:', error);
                userOnlineStatus = {};
            }
        }

        /**
         * æ ¹æ®è§„èŒƒåŒ–çš„è´¦æˆ·åæŸ¥æ‰¾ç”¨æˆ·ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
         */
        function findUserByAccount(account) {
            if (!account) return null;
            const normalizedAccount = normalizeAccount(account);
            return allUsers.find(u => {
                // å¦‚æœç”¨æˆ·å·²æœ‰è§„èŒƒåŒ–å­—æ®µï¼Œä½¿ç”¨è§„èŒƒåŒ–å­—æ®µæ¯”è¾ƒ
                if (u.accountCanonical) {
                    return u.accountCanonical === normalizedAccount;
                }
                // å…¼å®¹æ—§æ•°æ®ï¼šå¦‚æœæ²¡æœ‰è§„èŒƒåŒ–å­—æ®µï¼Œä½¿ç”¨åŸè´¦æˆ·åè§„èŒƒåŒ–åæ¯”è¾ƒ
                return normalizeAccount(u.account) === normalizedAccount;
            });
        }

        /**
         * æ£€æŸ¥ç®¡ç†å‘˜è´¦å·ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
         */
        function findAdminAccount(account) {
            if (!account) return null;
            const normalizedAccount = normalizeAccount(account);
            // éå†ç®¡ç†å‘˜è´¦å·ï¼Œä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æ¯”è¾ƒ
            for (const [adminAccount, adminData] of Object.entries(ADMIN_ACCOUNTS)) {
                if (normalizeAccount(adminAccount) === normalizedAccount) {
                    return { account: adminAccount, data: adminData };
                }
            }
            return null;
        }

        /**
         * æ•°æ®è¿ç§»ï¼šä¸ºç°æœ‰ç”¨æˆ·æ•°æ®æ·»åŠ è§„èŒƒåŒ–å­—æ®µ
         */
        function migrateUserDataToCanonical() {
            let migrated = false;
            allUsers.forEach(user => {
                if (!user.accountCanonical && user.account) {
                    user.accountCanonical = normalizeAccount(user.account);
                    migrated = true;
                }
            });
            if (migrated) {
                console.log('ğŸ”„ å·²ä¸ºç°æœ‰ç”¨æˆ·æ•°æ®æ·»åŠ è§„èŒƒåŒ–å­—æ®µ');
                saveAllUsers();
            }
        }

        // ç”¨æˆ·è®¤è¯
        function authenticateUser(account, password) {
            // æ£€æŸ¥ç®¡ç†å‘˜è´¦å·ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼ï¼‰
            const adminAccount = findAdminAccount(account);
            if (adminAccount) {
                if (adminAccount.data.password === password) {
                    return {
                        account: adminAccount.account, // è¿”å›åŸå§‹æ ¼å¼ç”¨äºæ˜¾ç¤º
                        username: adminAccount.data.username,
                        role: 'admin',
                        status: 'active'
                    };
                } else {
                    // ç®¡ç†å‘˜è´¦å·å­˜åœ¨ä½†å¯†ç é”™è¯¯
                    return {
                        success: false,
                        error: 'password',
                        message: 'Password incorrect, please re-enter'
                    };
                }
            }

            // æ£€æŸ¥æ™®é€šç”¨æˆ·ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æŸ¥æ‰¾ï¼‰
            const user = findUserByAccount(account);
            if (user) {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨
                if (user.status === 'banned') {
                    return {
                        banned: true,
                        message: 'Your account has been disabled. Please contact the administrator'
                    };
                }
                
                // æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®
                if (user.password === password) {
                    return {
                        account: user.account, // è¿”å›åŸå§‹æ ¼å¼ç”¨äºæ˜¾ç¤º
                        username: user.username,
                        role: 'user',
                        status: user.status || 'active',
                        points: typeof user.points === 'number' ? user.points : 1
                    };
                } else {
                    // è´¦å·å­˜åœ¨ä½†å¯†ç é”™è¯¯
                    return {
                        success: false,
                        error: 'password',
                        message: t('passwordIncorrect')
                    };
                }
            }

            // è´¦å·ä¸å­˜åœ¨
            return {
                success: false,
                error: 'account',
                message: t('accountNotExists')
            };
        }

        // æ³¨å†Œç”¨æˆ·
        function registerUser(account, password, username) {
            // è§„èŒƒåŒ–è´¦æˆ·åç”¨äºå”¯ä¸€æ€§æ£€æŸ¥
            const normalizedAccount = normalizeAccount(account);
            
            // æ£€æŸ¥ç®¡ç†å‘˜è´¦å·æ˜¯å¦å·²å­˜åœ¨ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼ï¼‰
            if (findAdminAccount(account)) {
                return { success: false, message: t('accountExists') || 'Account already exists' };
            }
            
            // æ£€æŸ¥æ™®é€šç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼ï¼‰
            if (findUserByAccount(account)) {
                return { success: false, message: t('accountExists') || 'Account already exists' };
            }

            // æ£€æŸ¥è®¾å¤‡æ³¨å†Œé™åˆ¶ï¼ˆå¯é…ç½®ï¼‰
            const deviceId = getDeviceId();
            const sameDeviceUsers = allUsers.filter(u => u.deviceId === deviceId);
            // è·å–è¯¥è®¾å¤‡çš„æ³¨å†Œé™åˆ¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼
            const deviceLimit = deviceRegisterLimits[deviceId] !== undefined 
                ? deviceRegisterLimits[deviceId] 
                : DEFAULT_DEVICE_REGISTER_LIMIT;
            if (sameDeviceUsers.length >= deviceLimit) {
                return {
                    success: false,
                    message: t('deviceRegisterLimitReached') || 'You already have an account. Please log in to claim items!'
                };
            }

            const now = Date.now();
            const newUser = {
                id: now,
                account: account, // ä¿å­˜åŸå§‹æ ¼å¼ç”¨äºæ˜¾ç¤º
                accountCanonical: normalizedAccount, // ä¿å­˜è§„èŒƒåŒ–æ ¼å¼ç”¨äºæŸ¥æ‰¾å’Œå”¯ä¸€æ€§æ£€æŸ¥
                password: password,
                username: username,
                role: 'user',
                registerTime: new Date(now).toISOString(),
                status: 'active',
                // ğŸ¯ æ–°å¢ï¼šç”¨æˆ·ç§¯åˆ†ï¼ˆèœœç½ï¼‰ï¼Œé»˜è®¤ 1
                points: 1,
                // è®°å½•æ³¨å†Œè®¾å¤‡IDï¼Œç”¨äºæ£€æµ‹åŒè®¾å¤‡å¤šè´¦å·
                deviceId: deviceId,
                // è®°å½•æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼Œä¾¿äºäº‘ç«¯/æœ¬åœ°åˆå¹¶æ—¶ä»¥æœ€æ–°ä¸ºå‡†
                updatedAt: now
            };

            allUsers.push(newUser);
            saveAllUsers();

            return { success: true, message: 'Registration successful' };
        }

        // ç«‹å³åˆå§‹åŒ–Logoæ˜¾ç¤ºï¼ˆä¸ç­‰å¾…DOMContentLoadedï¼‰
        (function initLogo() {
            const logoImg = document.getElementById('site-logo-img');
            if (logoImg) {
                // ç¡®ä¿logoå›¾ç‰‡å¯è§
                logoImg.style.display = 'block';
                logoImg.style.visibility = 'visible';
                logoImg.style.opacity = '1';
                const logoContainer = document.getElementById('home-link');
                if (logoContainer) {
                    logoContainer.style.display = 'flex';
                    logoContainer.style.visibility = 'visible';
                }
                // å¦‚æœsrcä¸ºç©ºï¼Œè®¾ç½®é»˜è®¤logo
                if (!logoImg.src || logoImg.src === window.location.href) {
                    logoImg.src = 'https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_ed7f33a7af67dcf7f114c4e3d8f22515_ProductImage_MAIN';
                }
            }
        })();

        // ========== å…¨å±€å¼¹çª—å·¥å…·ï¼šcustomAlert ==========
        // ç»Ÿä¸€çš„æç¤ºå¼¹çª—ï¼Œå…¼å®¹ Promise è°ƒç”¨ï¼šcustomAlert(msg, title).then(...)
        // å¦‚æœæœªæ¥éœ€è¦æ›´æ¼‚äº®çš„ UIï¼Œå¯ä»¥åœ¨è¿™é‡Œæ”¹æˆè‡ªå®šä¹‰æ¨¡æ€æ¡†ï¼Œè€Œä¸å½±å“å…¶å®ƒä¸šåŠ¡ä»£ç 
        window.customAlert = function (message, title) {
            return new Promise((resolve) => {
                try {
                    const msg = String(message == null ? '' : message);
                    const ttl = title ? String(title) : '';

                    // å°†ç®€å•çš„ HTML æ¢è¡Œè½¬æ¢ä¸ºæ™®é€šæ¢è¡Œï¼Œé¿å…åœ¨ alert é‡Œå‡ºç°æ ‡ç­¾
                    const normalized = msg
                        .replace(/<br\s*\/?>/gi, '\n')
                        .replace(/<\/p>/gi, '\n')
                        .replace(/<[^>]+>/g, '');

                    const finalText = ttl ? `${ttl}\n\n${normalized}` : normalized;
                    alert(finalText || '');
                } catch (e) {
                    // å…œåº•ï¼šå³ä½¿è§£æå‡ºé”™ï¼Œä¹Ÿä¿è¯æœ‰æç¤º
                    alert(message || '');
                } finally {
                    resolve();
                }
            });
        };

        // ========== å½©è›‹å‡½æ•°å®šä¹‰ï¼ˆå¿…é¡»åœ¨DOMContentLoadedä¹‹å‰å®šä¹‰ï¼Œç¡®ä¿ç™»å½•è¡¨å•äº‹ä»¶ç»‘å®šæ—¶å¯è®¿é—®ï¼‰ ==========
        // å½©è›‹ç™»å½•ç›¸å…³å˜é‡ - ä½¿ç”¨windowå¯¹è±¡ç¡®ä¿å…¨å±€è®¿é—®
        window.romanticLoginAccount = null;
        window.romanticLoginPassword = null;
        window.romanticLoginTimeout = null;

        // æµªæ¼«å½©è›‹åŠŸèƒ½ - ç¡®ä¿åœ¨å…¨å±€ä½œç”¨åŸŸä¸­
        window.showRomanticEasterEgg = function(account = null, password = null) {
            console.log('ğŸ¯ showRomanticEasterEgg è¢«è°ƒç”¨ï¼Œå‚æ•°:', { account, password });
            
            // ä¿å­˜ç™»å½•ä¿¡æ¯
            if (account && password) {
                window.romanticLoginAccount = account;
                window.romanticLoginPassword = password;
            }
            
            // æŸ¥æ‰¾å½©è›‹å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç­‰å¾…
            const showEggElement = () => {
                let egg = document.getElementById('romantic-easter-egg');
                
                if (!egg) {
                    console.warn('âš ï¸ å½©è›‹å…ƒç´ æœªæ‰¾åˆ°ï¼Œå°è¯•ç­‰å¾…DOMåŠ è½½...');
                    // å°è¯•å¤šæ¬¡æŸ¥æ‰¾
                    let attempts = 0;
                    const maxAttempts = 50;
                    const checkInterval = setInterval(() => {
                        attempts++;
                        egg = document.getElementById('romantic-easter-egg');
                        if (egg) {
                            clearInterval(checkInterval);
                            console.log('âœ… å½©è›‹å…ƒç´ å·²æ‰¾åˆ°');
                            displayEgg(egg);
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            console.error('âŒ å½©è›‹å…ƒç´ ä¸å­˜åœ¨ï¼è¯·æ£€æŸ¥HTMLä¸­æ˜¯å¦æœ‰ id="romantic-easter-egg" çš„å…ƒç´ ');
                            customAlert('å½©è›‹åŠŸèƒ½åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'é”™è¯¯');
                        }
                    }, 100);
                    return;
                }
                
                displayEgg(egg);
            };
            
            // æ˜¾ç¤ºå½©è›‹çš„å‡½æ•°
            const displayEgg = (egg) => {
                if (!egg) {
                    console.error('âŒ å½©è›‹å…ƒç´ ä¸ºç©ºï¼');
                    return;
                }
                
                console.log('ğŸ¯ è®¾ç½®å½©è›‹æ˜¾ç¤º...');
                // å¼ºåˆ¶è®¾ç½®æ ·å¼ï¼Œç¡®ä¿æ˜¾ç¤º
                egg.style.display = 'flex';
                egg.style.visibility = 'visible';
                egg.style.opacity = '1';
                egg.style.zIndex = '99999';
                egg.style.position = 'fixed';
                egg.style.top = '0';
                egg.style.left = '0';
                egg.style.width = '100vw';
                egg.style.height = '100vh';
                document.body.style.overflow = 'hidden';
                console.log('âœ… å½©è›‹åº”è¯¥å·²æ˜¾ç¤ºï¼Œdisplay:', egg.style.display, 'z-index:', egg.style.zIndex);
                
                // é‡ç½®çŠ¶æ€
                const arrow = document.getElementById('arrow-flying');
                const heart = document.getElementById('heart-3d');
                const explosionContainer = document.getElementById('explosion-particles');
                
                if (arrow) {
                    arrow.classList.remove('flying');
                    arrow.style.opacity = '0';
                }
                if (heart) {
                    heart.classList.remove('exploding');
                }
                if (explosionContainer) {
                    explosionContainer.innerHTML = '';
                }
                
                // åˆå§‹åŒ–èƒŒæ™¯ç²’å­ç³»ç»Ÿï¼ˆéœ€è¦ç­‰å¾…DOMåŠ è½½å®Œæˆï¼‰
                setTimeout(() => {
                    const initParticles = window.initParticles;
                    if (typeof initParticles === 'function') {
                        initParticles();
                    }
                }, 100);
                
            // å»¶è¿Ÿåå¼€å§‹ä¸€ç®­ç©¿å¿ƒåŠ¨ç”»ï¼ˆæå‰å¯åŠ¨ï¼ŒåŠ é€Ÿè¿›å…¥ï¼‰
            setTimeout(() => {
                if (arrow) {
                    arrow.classList.add('flying');
                }
            }, 300);
            
            // ç®­ç©¿é€çˆ±å¿ƒåçˆ†ç‚¸ï¼ˆä¸åŠ¨ç”» 65% ä½ç½®å¯¹é½ï¼Œçº¦ 1.6sï¼‰
            setTimeout(() => {
                if (heart) {
                    heart.classList.add('exploding');
                }
                // åˆ›å»ºçˆ†ç‚¸ç²’å­
                const createExplosionParticles = window.createExplosionParticles;
                if (typeof createExplosionParticles === 'function') {
                    createExplosionParticles();
                }
            }, 1600);
                
                // å¼€å§‹å€’è®¡æ—¶
                const startCountdown = window.startCountdown;
                if (typeof startCountdown === 'function') {
                    startCountdown();
                }
            };
            
            // ç«‹å³å°è¯•æ˜¾ç¤º
            showEggElement();
        };

        window.closeRomanticEasterEgg = function() {
            const egg = document.getElementById('romantic-easter-egg');
            if (egg) {
                egg.style.display = 'none';
                document.body.style.overflow = '';
                
                // æ¸…ç†åŠ¨ç”»
                if (window.animationId) {
                    cancelAnimationFrame(window.animationId);
                    window.animationId = null;
                }
                
                if (window.explosionAnimationId) {
                    cancelAnimationFrame(window.explosionAnimationId);
                    window.explosionAnimationId = null;
                }
                
                if (window.countdownInterval) {
                    clearInterval(window.countdownInterval);
                    window.countdownInterval = null;
                }
                
                // æ¸…é™¤ç™»å½•è¶…æ—¶å®šæ—¶å™¨
                if (window.romanticLoginTimeout) {
                    clearTimeout(window.romanticLoginTimeout);
                    window.romanticLoginTimeout = null;
                }
                
                if (window.particles) {
                    window.particles = [];
                }
                if (window.explosionParticles) {
                    window.explosionParticles = [];
                }
                
                // é‡ç½®å…ƒç´ çŠ¶æ€
                const arrow = document.getElementById('arrow-flying');
                const heart = document.getElementById('heart-3d');
                const explosionContainer = document.getElementById('explosion-particles');
                
                if (arrow) {
                    arrow.classList.remove('flying');
                    arrow.style.opacity = '0';
                }
                if (heart) {
                    heart.classList.remove('exploding');
                }
                if (explosionContainer) {
                    explosionContainer.innerHTML = '';
                }
            }
        };
        // ========== å½©è›‹å‡½æ•°å®šä¹‰ç»“æŸ ==========

        document.addEventListener('DOMContentLoaded', async function () {
            const loader = DOMCache.get('#page-loader');
            const loaderProgress = DOMCache.get('#loader-progress');

            // ç¡®ä¿é¡µé¢æœ¬èº«å§‹ç»ˆå¯ä»¥æ»šåŠ¨ï¼ˆé˜²æ­¢æŸäº›æƒ…å†µä¸‹ overflow è¢«é”™è¯¯é”å®šï¼‰
            try {
                document.documentElement.style.overflowY = 'auto';
                document.body.style.overflow = '';
            } catch (e) {
                console.warn('é‡ç½®é¡µé¢æ»šåŠ¨çŠ¶æ€æ—¶å‡ºé”™:', e);
            }
            
            try {
                // æ›´æ–°åŠ è½½è¿›åº¦
                loaderProgress.textContent = 'æ£€æŸ¥URLåŒæ­¥æ•°æ®...';
                
            // å…ˆæ£€æŸ¥URLåŒæ­¥æ•°æ®
            loadSyncFromURL();

                // æ›´æ–°åŠ è½½è¿›åº¦
                loaderProgress.textContent = currentLanguage === 'zh' ? 'åˆå§‹åŒ–äº‘ç«¯åŒæ­¥...' : 'Initializing cloud sync...';
                
                // ç­‰å¾…Firebase SDKåŠ è½½ï¼ˆæœ€å¤šç­‰å¾…3ç§’ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼‰
                let firebaseReady = false;
                for (let i = 0; i < 6; i++) {
                    if (typeof firebase !== 'undefined') {
                        firebaseReady = true;
                        break;
                    }
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                if (firebaseReady) {
                    // åˆå§‹åŒ–äº‘ç«¯åŒæ­¥ï¼ˆè¿™ä¼šåŠ è½½äº§å“ã€ç”¨æˆ·å’Œä¸»é¡µè®¾ç½®ï¼‰
                    loaderProgress.textContent = currentLanguage === 'zh' ? 'è¿æ¥äº‘ç«¯æ•°æ®åº“...' : 'Connecting to cloud database...';
            await initCloudSync();

                    // ç­‰å¾…äº‘ç«¯åŒæ­¥åˆå§‹åŒ–å®Œæˆï¼ˆæœ€å¤šç­‰å¾…5ç§’ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼‰
                    let syncReady = false;
                    for (let i = 0; i < 10; i++) {
                        if (cloudSync && cloudSync.isInitialized) {
                            syncReady = true;
                            break;
                        }
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    if (syncReady) {
                        // å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®ï¼Œæé«˜é€Ÿåº¦
                        loaderProgress.textContent = currentLanguage === 'zh' ? 'åŠ è½½äº‘ç«¯æ•°æ®...' : 'Loading cloud data...';
                        
                        // å¹¶è¡ŒåŠ è½½äº§å“ã€ç”¨æˆ·è®¢å•å’Œåœ°å€ï¼ˆå¦‚æœå·²ç™»å½•ï¼‰
                        const loadPromises = [
                            cloudSync.loadProducts(),
                            cloudSync.loadHomepageSettings()
                        ];
                        
                        if (currentUser) {
                            loadPromises.push(cloudSync.loadOrders());
                            loadPromises.push(cloudSync.loadAddresses());
                        }
                        
                        await Promise.all(loadPromises);
                        
                        // ä»localStorageè¯»å–æ›´æ–°åçš„æ•°æ®ï¼ˆäº‘ç«¯å·²åŠ è½½ï¼‰
                        products = JSON.parse(localStorage.getItem('products')) || [];
                        homepageSettings = JSON.parse(localStorage.getItem('homepageSettings')) || homepageSettings;
                        
                        // éªŒè¯äº§å“æ•°æ®æ˜¯å¦çœŸçš„åŠ è½½æˆåŠŸ
                        console.log('ğŸ” éªŒè¯äº§å“æ•°æ®åŠ è½½ç»“æœ...');
                        const loadedProducts = JSON.parse(localStorage.getItem('products') || '[]');
                        const validLoaded = Array.isArray(loadedProducts) 
                            ? loadedProducts.filter(p => p && typeof p === 'object' && p.id && p.name)
                            : [];
                        
                        if (validLoaded.length > 0) {
                            products = validLoaded;
                            console.log(`âœ… äº§å“æ•°æ®éªŒè¯é€šè¿‡ï¼Œå…± ${products.length} ä¸ªæœ‰æ•ˆäº§å“`);
                        } else {
                            console.warn('âš ï¸ äº§å“æ•°æ®åŠ è½½åéªŒè¯å¤±è´¥ï¼Œäº§å“æ•°ç»„ä¸ºç©º');
                            // å°è¯•é‡æ–°åŠ è½½ä¸€æ¬¡
                            setTimeout(async () => {
                                const reloaded = await cloudSync.loadProducts();
                                if (reloaded) {
                                    const retryProducts = JSON.parse(localStorage.getItem('products') || '[]');
                                    const validRetry = Array.isArray(retryProducts)
                                        ? retryProducts.filter(p => p && typeof p === 'object' && p.id && p.name)
                                        : [];
                                    if (validRetry.length > 0) {
                                        products = validRetry;
                                        console.log(`âœ… é‡æ–°åŠ è½½æˆåŠŸï¼Œè·å¾— ${products.length} ä¸ªäº§å“`);
                                        if (typeof renderProducts === 'function') {
                                            renderProducts(products);
                                        }
                                    }
                                }
                            }, 1000);
                        }
                        if (currentUser) {
                            // ä½¿ç”¨ç”¨æˆ·ç‰¹å®šçš„localStorage key
                            const userOrdersKey = `userOrders_${currentUser.account}`;
                            const userAddressesKey = `userAddresses_${currentUser.account}`;
                            userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || JSON.parse(localStorage.getItem('userOrders')) || [];
                            userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || JSON.parse(localStorage.getItem('userAddresses')) || [];
                            
                            // è¿‡æ»¤æ‰ä¸å±äºå½“å‰ç”¨æˆ·çš„è®¢å•å’Œåœ°å€ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰
                            const normalizedCurrentAccount = normalizeAccount(currentUser.account);
                            userOrders = userOrders.filter(order => !order.account || normalizeAccount(order.account) === normalizedCurrentAccount);
                            userAddresses = userAddresses.filter(addr => !addr.account || normalizeAccount(addr.account) === normalizedCurrentAccount);
                            
                            // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼ŒåŠ è½½æ‰€æœ‰è®¢å•
                            if (currentUser.role === 'admin') {
                                cloudSync.loadAllOrders().catch(err => {
                                    console.error('åŠ è½½æ‰€æœ‰è®¢å•å¤±è´¥:', err);
                                });
                            }
                        } else {
                            userOrders = [];
                            userAddresses = [];
                        }
                        
                        // ä»localStorageåŠ è½½æ‰€æœ‰è®¢å•ï¼ˆç®¡ç†å‘˜ç”¨ï¼‰
                        try {
                            const savedAllOrders = localStorage.getItem('allOrders');
                            if (savedAllOrders) {
                                allOrders = JSON.parse(savedAllOrders);
                                console.log('ğŸ“¦ å·²ä»æœ¬åœ°åŠ è½½æ‰€æœ‰è®¢å•:', allOrders.length, 'ä¸ª');
                            }
                        } catch (e) {
                            // è§£ææœ¬åœ°æ‰€æœ‰è®¢å•å¤±è´¥æ—¶ï¼Œä¸å†å¼ºåˆ¶æ¸…ç©ºå†…å­˜ä¸­çš„ allOrdersï¼Œé¿å…è¦†ç›–å·²æœ‰æœ‰æ•ˆæ•°æ®
                            console.error('åŠ è½½æœ¬åœ°æ‰€æœ‰è®¢å•å¤±è´¥ï¼ˆä¿ç•™å½“å‰å†…å­˜æ•°æ®ï¼‰:', e);
                        }
                    } else {
                        loaderProgress.textContent = currentLanguage === 'zh' ? 'äº‘ç«¯åŒæ­¥è¶…æ—¶...' : 'Cloud sync timeout...';
                        // è¶…æ—¶åä»å°è¯•ä»äº‘ç«¯åŠ è½½ä¸€æ¬¡
                        products = [];
                    }
                } else {
                    loaderProgress.textContent = 'FirebaseæœªåŠ è½½...';
                    products = [];
                }

                // æ›´æ–°åŠ è½½è¿›åº¦
                loaderProgress.textContent = 'æ¸²æŸ“é¡µé¢å†…å®¹...';
                
                // éªŒè¯äº§å“æ•°æ®åå†æ¸²æŸ“
                const productsToRender = Array.isArray(products) 
                    ? products.filter(p => p && typeof p === 'object' && p.id && p.name)
                    : [];
                
                if (productsToRender.length === 0 && products.length > 0) {
                    console.warn('âš ï¸ äº§å“æ•°æ®æ— æ•ˆï¼Œå·²è¿‡æ»¤æ‰æ‰€æœ‰æ— æ•ˆäº§å“');
                    products = [];
                    localStorage.setItem('products', JSON.stringify(products));
                } else if (productsToRender.length !== products.length) {
                    console.warn(`âš ï¸ äº§å“æ•°æ®éªŒè¯ï¼š${products.length} -> ${productsToRender.length} ä¸ªæœ‰æ•ˆäº§å“`);
                    products = productsToRender;
                    localStorage.setItem('products', JSON.stringify(products));
                }
                
                console.log(`ğŸ“¦ å‡†å¤‡æ¸²æŸ“ ${productsToRender.length} ä¸ªäº§å“`);
                
                // ç«‹å³æ¸²æŸ“é¡µé¢å†…å®¹ï¼ˆä¸ç­‰å¾…ï¼‰
            renderProducts(productsToRender);
            renderUserOrders();

                // å¦‚æœåå°ç®¡ç†é¡µé¢å·²æ‰“å¼€ï¼Œæ›´æ–°è¡¨å•
                if (cloudSync && cloudSync.isInitialized) {
                    const adminHomepage = document.getElementById('admin-homepage');
                    if (adminHomepage && adminHomepage.classList.contains('active')) {
                        loadHomepageSettings();
                    }
                }

            // åº”ç”¨ä¸»é¡µè®¾ç½®
            applyHomepageSettings();
                
                // åˆå§‹åŒ–è¯­è¨€é€‰æ‹©å™¨
                const languageSelect = document.getElementById('language-select');
                if (languageSelect) {
                    // è®¾ç½®å½“å‰è¯­è¨€
                    languageSelect.value = currentLanguage;
                    
                    // ç»‘å®šè¯­è¨€åˆ‡æ¢äº‹ä»¶
                    languageSelect.addEventListener('change', function() {
                        switchLanguage(this.value);
                    });
                }
                
                // åº”ç”¨è¯­è¨€è®¾ç½®ï¼ˆåœ¨é¡µé¢æ¸²æŸ“åï¼‰
                applyLanguage();
                
                // æ›´æ–°ç”¨æˆ·ç•Œé¢ä»¥åæ˜ æœ¬åœ°å­˜å‚¨çš„ç™»å½•çŠ¶æ€ï¼ˆç¡®ä¿åˆ·æ–°åæ˜¾ç¤ºæ­£ç¡®çš„ç™»å½•/ç”¨æˆ·åï¼‰
                try {
                    if (typeof updateUserInterface === 'function') updateUserInterface();
                } catch (e) {
                    console.warn('æ›´æ–°ç”¨æˆ·ç•Œé¢å¤±è´¥:', e);
                }
                
            } catch (error) {
                console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                loaderProgress.textContent = 'åŠ è½½å¤±è´¥';
                // å³ä½¿å¤±è´¥ä¹Ÿæ˜¾ç¤ºç©ºé¡µé¢
                renderProducts(products || []);
                renderUserOrders();
                applyHomepageSettings();
                
                // åˆå§‹åŒ–è¯­è¨€é€‰æ‹©å™¨ï¼ˆå³ä½¿å¤±è´¥ä¹Ÿè¦åˆå§‹åŒ–ï¼‰
                const languageSelect = document.getElementById('language-select');
                if (languageSelect) {
                    languageSelect.value = currentLanguage;
                    languageSelect.addEventListener('change', function() {
                        switchLanguage(this.value);
                    });
                }
                
                // åº”ç”¨è¯­è¨€è®¾ç½®
                applyLanguage();
            } finally {
                // ç«‹å³éšè—åŠ è½½é®ç½©ï¼Œæ˜¾ç¤ºé¡µé¢å†…å®¹ï¼ˆä¸å»¶è¿Ÿï¼‰
                loader.classList.add('hidden');
                document.body.classList.remove('loading');
                loader.remove();
            }

            // è½®æ’­å›¾åŠŸèƒ½ - ä½¿ç”¨ç»Ÿä¸€çš„åˆå§‹åŒ–å‡½æ•°
            initCarousel();

            // æœç´¢åŠŸèƒ½
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');

            bindFastTap(searchBtn, performSearch);
            // è¾“å…¥å³æ—¶æœç´¢ï¼ˆé˜²æŠ–ï¼‰
            searchInput.addEventListener('input', debounce(performSearch, 300));

            function performSearch() {
                const keyword = searchInput.value.trim().toLowerCase();
                if (keyword) {
                    const filteredProducts = products.filter(product =>
                        product.name.toLowerCase().includes(keyword) ||
                        product.description.toLowerCase().includes(keyword)
                    );
                    renderProducts(filteredProducts);
                } else {
                    renderProducts(products);
                }
            }

            // åˆ†ç±»ç­›é€‰
            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach(item => {
                bindFastTap(item, function () {
                    categoryItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');

                    const category = item.getAttribute('data-category');
                    if (category === 'all') {
                        renderProducts(products);
                    } else {
                        const filteredProducts = products.filter(product => product.category === category);
                        renderProducts(filteredProducts);
                    }
                });
            });

            // é¡µé¢å¯¼èˆª
            const homeLink = document.getElementById('home-link');
            const mainHomeLink = document.getElementById('main-home-link');
            const adminLink = document.getElementById('admin-link');
            const userCenterLink = document.getElementById('user-center-link');
            const searchBar = document.querySelector('.search-bar');
            const homePage = document.getElementById('home-page');
            const userCenter = document.getElementById('user-center');
            const adminPanel = document.getElementById('admin-panel');
            const topCarousel = document.querySelector('.carousel');

            function showHomePage() {
                homePage.style.display = 'block';
                userCenter.classList.remove('show');
                userCenter.style.display = 'none';
                adminPanel.style.display = 'none';
                if (topCarousel) topCarousel.style.display = 'block';
                // åªåœ¨é¦–é¡µæ˜¾ç¤ºæœç´¢æ 
                if (searchBar) searchBar.style.display = 'flex';
                // æ›´æ–°å¯¼èˆªæ activeçŠ¶æ€
                document.querySelectorAll('.nav-links a').forEach(link => {
                    link.classList.remove('active');
                });
                if (mainHomeLink) mainHomeLink.classList.add('active');
                renderProducts(products);
            }

            function showUserCenter() {
                // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
                updateUserInterface();

                if (!currentUser) {
                    // å¦‚æœç”¨æˆ·è¢«ç¦ç”¨ï¼ŒupdateUserInterfaceä¼šæ¸…é™¤currentUser
                    return;
                }

                homePage.style.display = 'none';
                adminPanel.style.display = 'none';
                if (topCarousel) topCarousel.style.display = 'none';
                
                // éé¦–é¡µéšè—æœç´¢æ 
                if (searchBar) searchBar.style.display = 'none';
                
                // æ›´æ–°å¯¼èˆªæ activeçŠ¶æ€
                document.querySelectorAll('.nav-links a').forEach(link => {
                    link.classList.remove('active');
                });
                if (userCenterLink) userCenterLink.classList.add('active');
                
                // æ˜¾ç¤ºç”¨æˆ·ä¸­å¿ƒ
                userCenter.classList.add('show');
                userCenter.style.display = '';
                
                // æ˜¾ç¤ºä¾§è¾¹æ ï¼ˆå¦‚æœè¢«éšè—ï¼‰
                const userSidebar = document.querySelector('.user-sidebar');
                if (userSidebar) {
                    userSidebar.style.display = 'block';
                }
                userCenter.classList.remove('sidebar-hidden');
                
                // é»˜è®¤æ˜¾ç¤ºä¸ªäººä¿¡æ¯é¡µé¢ï¼Œä¸æ˜¾ç¤ºè®¢å•
                showUserPage('profile');
            }

            function showAdminPanel() {
                homePage.style.display = 'none';
                userCenter.classList.remove('show');
                userCenter.style.display = 'none';
                adminPanel.style.display = 'block';
                if (topCarousel) topCarousel.style.display = 'none';
                // éé¦–é¡µéšè—æœç´¢æ 
                if (searchBar) searchBar.style.display = 'none';
                // æ›´æ–°å¯¼èˆªæ activeçŠ¶æ€
                document.querySelectorAll('.nav-links a').forEach(link => {
                    link.classList.remove('active');
                });
                if (adminLink) adminLink.classList.add('active');
                renderAdminProducts();
            }

            bindFastTap(homeLink, function () {
                showHomePage();
            });

            bindFastTap(mainHomeLink, function () {
                showHomePage();
            });

            bindFastTap(adminLink, function () {
                if (!isLoggedIn()) {
                    customAlert(t('pleaseLogin'), t('infoTitle')).then(() => {
                        document.getElementById('login-modal').style.display = 'flex';
                    });
                    return;
                }

                if (!isAdmin()) {
                    customAlert(t('insufficientPermissions'), t('insufficientPermissionsTitle'));
                    return;
                }

                showAdminPanel();
            });

            bindFastTap(userCenterLink, function () {
                if (currentUser) {
                    showUserCenter();
                } else {
                    customAlert(t('pleaseLogin'), t('infoTitle')).then(() => {
                        document.getElementById('login-modal').style.display = 'flex';
                    });
                }
            });

            // æˆ‘çš„æŠ¥åé“¾æ¥ç‚¹å‡»äº‹ä»¶
            const myOrdersLink = document.getElementById('my-orders-link');
            if (myOrdersLink) {
                bindFastTap(myOrdersLink, function () {
                    if (currentUser) {
                        homePage.style.display = 'none';
                        adminPanel.style.display = 'none';
                        
                        const userCenter = document.getElementById('user-center');
                        // æ˜¾ç¤ºç”¨æˆ·ä¸­å¿ƒ
                        userCenter.classList.add('show');
                        userCenter.style.display = '';
                        
                        // éšè—ä¾§è¾¹æ ï¼Œåªæ˜¾ç¤ºè®¢å•
                        const userSidebar = document.querySelector('.user-sidebar');
                        if (userSidebar) {
                            userSidebar.style.display = 'none';
                        }
                        userCenter.classList.add('sidebar-hidden');
                        
                        // æ›´æ–°å¯¼èˆªæ activeçŠ¶æ€
                        document.querySelectorAll('.nav-links a').forEach(link => {
                            link.classList.remove('active');
                        });
                        if (myOrdersLink) myOrdersLink.classList.add('active');
                        
                        // ç›´æ¥æ˜¾ç¤ºè®¢å•é¡µé¢
                        showUserPage('orders');
                    } else {
                        alert(t('pleaseLogin'));
                        document.getElementById('login-modal').style.display = 'flex';
                    }
                });
            }

            // æ¨¡æ€æ¡†åŠŸèƒ½
            const modals = document.querySelectorAll('.modal');
            const loginModal = document.getElementById('login-modal');
            const registerModal = document.getElementById('register-modal');
            const signupModal = document.getElementById('signup-modal');
            const loginLink = document.getElementById('login-link');
            const registerLink = document.getElementById('register-link');
            const logoutLink = document.getElementById('logout-link');
            const closeButtons = document.querySelectorAll('.close-modal');

            bindFastTap(loginLink, function () {
                loginModal.style.display = 'flex';
                document.body.classList.add('modal-open');
            });

            // å·²ç§»é™¤æ•°æ®æºé€‰æ‹©åŠŸèƒ½ï¼Œå¼ºåˆ¶ä½¿ç”¨äº‘ç«¯æ¨¡å¼

            bindFastTap(registerLink, function () {
                registerModal.style.display = 'flex';
                document.body.classList.add('modal-open');
            });

            // ç™»å½•/æ³¨å†Œé€‰æ‹©æ¨¡æ€æ¡†æŒ‰é’®äº‹ä»¶
            const authChoiceModal = document.getElementById('auth-choice-modal');
            const gotoLoginBtn = document.getElementById('goto-login-btn');
            const gotoRegisterBtn = document.getElementById('goto-register-btn');

            if (gotoLoginBtn) {
                bindFastTap(gotoLoginBtn, function () {
                    if (authChoiceModal) authChoiceModal.style.display = 'none';
                    if (loginModal) {
                        loginModal.style.display = 'flex';
                        document.body.classList.add('modal-open');
                    }
                });
            }

            if (gotoRegisterBtn) {
                bindFastTap(gotoRegisterBtn, function () {
                    if (authChoiceModal) authChoiceModal.style.display = 'none';
                    if (registerModal) {
                        registerModal.style.display = 'flex';
                        document.body.classList.add('modal-open');
                    }
                });
            }

            // ä½¿ç”¨ bindFastTap ç»Ÿä¸€å¤„ç†å…³é—­æŒ‰é’®ï¼Œä¿è¯ç§»åŠ¨ç«¯ç¬¬ä¸€æ¬¡ç‚¹å‡»å°±ç”Ÿæ•ˆ
            closeButtons.forEach(button => {
                bindFastTap(button, () => {
                    modals.forEach(modal => modal.style.display = 'none');
                    // åŒæ—¶å…³é—­ç™»å½•/æ³¨å†Œé€‰æ‹©æ¨¡æ€æ¡†
                    if (authChoiceModal) authChoiceModal.style.display = 'none';
                    document.body.classList.remove('modal-open');
                });
            });

            // ç»Ÿä¸€çš„ç‚¹å‡»å¤–éƒ¨å…³é—­é€»è¾‘åœ¨åº•éƒ¨æ³¨å†Œ

            // ç™»å½•è¡¨å• - ä¼˜åŒ–:ç™»å½•å‰å…ˆæ¸…ç†æœ¬åœ°ç¼“å­˜ï¼Œç™»å½•åä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ®
            const loginForm = document.getElementById('login-form');
            if (!loginForm) {
                console.error('âŒ ç™»å½•è¡¨å•å…ƒç´ æœªæ‰¾åˆ°ï¼');
            } else {
                console.log('âœ… ç™»å½•è¡¨å•å…ƒç´ å·²æ‰¾åˆ°ï¼Œå‡†å¤‡ç»‘å®šæäº¤äº‹ä»¶');
                
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ğŸ” ç™»å½•è¡¨å•æäº¤äº‹ä»¶è§¦å‘');
                    
                    const accountInput = document.getElementById('login-account');
                    const passwordInput = document.getElementById('login-password');
                    
                    if (!accountInput || !passwordInput) {
                        console.error('âŒ ç™»å½•è¾“å…¥æ¡†æœªæ‰¾åˆ°ï¼');
                        customAlert('ç™»å½•è¡¨å•å…ƒç´ æœªæ‰¾åˆ°ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'é”™è¯¯');
                        return;
                    }
                    
                    // å»é™¤å‰åç©ºæ ¼ï¼Œé¿å…å› ç©ºæ ¼å¯¼è‡´åŒ¹é…å¤±è´¥
                    const account = (accountInput.value || '').trim();
                    const password = (passwordInput.value || '').trim();

                    console.log('ğŸ” è¾“å…¥çš„è´¦å·:', account, 'å¯†ç é•¿åº¦:', password.length);

                    if (!account || !password) {
                        customAlert(t('pleaseFillCompleteInfo'), t('infoTitle'));
                        return;
                    }

                    // ========== æµªæ¼«å½©è›‹ ==========
                    // ä½¿ç”¨trim()å»é™¤ç©ºæ ¼ï¼Œç¡®ä¿åŒ¹é…å‡†ç¡®
                    const easterAccount = 'qiqxjq';
                    const easterPassword = 'aa123123';
                    
                    // ç¡®ä¿è´¦å·å¯†ç éƒ½æ˜¯å­—ç¬¦ä¸²å¹¶å»é™¤ç©ºæ ¼
                    const cleanAccount = String(account || '').trim();
                    const cleanPassword = String(password || '').trim();
                    const cleanEasterAccount = String(easterAccount || '').trim();
                    const cleanEasterPassword = String(easterPassword || '').trim();
                    
                    console.log('ğŸ” æ£€æŸ¥å½©è›‹è´¦å·:', {
                        'è¾“å…¥çš„è´¦å·': cleanAccount,
                        'è´¦å·é•¿åº¦': cleanAccount.length,
                        'æœŸæœ›çš„è´¦å·': cleanEasterAccount,
                        'æœŸæœ›è´¦å·é•¿åº¦': cleanEasterAccount.length,
                        'è´¦å·åŒ¹é…': cleanAccount === cleanEasterAccount,
                        'è¾“å…¥çš„å¯†ç ': cleanPassword,
                        'å¯†ç é•¿åº¦': cleanPassword.length,
                        'æœŸæœ›çš„å¯†ç ': cleanEasterPassword,
                        'æœŸæœ›å¯†ç é•¿åº¦': cleanEasterPassword.length,
                        'å¯†ç åŒ¹é…': cleanPassword === cleanEasterPassword,
                        'å®Œå…¨åŒ¹é…': cleanAccount === cleanEasterAccount && cleanPassword === cleanEasterPassword
                    });
                    
                    // ä¸¥æ ¼åŒ¹é…è´¦å·å’Œå¯†ç 
                    if (cleanAccount === cleanEasterAccount && cleanPassword === cleanEasterPassword) {
                        console.log('âœ…âœ…âœ… æ£€æµ‹åˆ°å½©è›‹è´¦å·ï¼Œå‡†å¤‡æ˜¾ç¤ºå½©è›‹...');
                        
                        // ç«‹å³å…³é—­ç™»å½•æ¨¡æ€æ¡†
                        const loginModalEl = document.getElementById('login-modal');
                        if (loginModalEl) {
                            loginModalEl.style.display = 'none';
                            console.log('âœ… ç™»å½•æ¨¡æ€æ¡†å·²å…³é—­');
                        } else {
                            console.warn('âš ï¸ ç™»å½•æ¨¡æ€æ¡†å…ƒç´ æœªæ‰¾åˆ°');
                        }
                        
                        // å…³é—­å…¶ä»–å¯èƒ½çš„æ¨¡æ€æ¡†
                        const authChoiceModal = document.getElementById('auth-choice-modal');
                        if (authChoiceModal) {
                            authChoiceModal.style.display = 'none';
                        }
                        
                        // æ˜¾ç¤ºæµªæ¼«ç©¿å¿ƒé¡µé¢ï¼ˆä¼ é€’è´¦å·å¯†ç ï¼‰
                        // ä½¿ç”¨setTimeoutç¡®ä¿DOMå·²æ›´æ–°ï¼Œä½†ç¼©çŸ­å»¶è¿Ÿæ—¶é—´
                        setTimeout(() => {
                            console.log('ğŸ¯ è°ƒç”¨ showRomanticEasterEgg å‡½æ•°...');
                            console.log('ğŸ” æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨:', typeof window.showRomanticEasterEgg);
                            
                            const showEgg = window.showRomanticEasterEgg;
                            if (typeof showEgg === 'function') {
                                console.log('âœ… showRomanticEasterEgg å‡½æ•°å­˜åœ¨ï¼Œæ­£åœ¨è°ƒç”¨...');
                                try {
                                    showEgg(cleanAccount, cleanPassword);
                                    console.log('âœ… showRomanticEasterEgg å‡½æ•°è°ƒç”¨å®Œæˆ');
                                } catch (error) {
                                    console.error('âŒ showRomanticEasterEgg å‡½æ•°è°ƒç”¨å‡ºé”™:', error);
                                    // å¤‡ç”¨æ–¹æ¡ˆï¼šç›´æ¥æ˜¾ç¤ºå…ƒç´ 
                                    const egg = document.getElementById('romantic-easter-egg');
                                    if (egg) {
                                        egg.style.display = 'flex';
                                        egg.style.zIndex = '99999';
                                        document.body.style.overflow = 'hidden';
                                        window.romanticLoginAccount = cleanAccount;
                                        window.romanticLoginPassword = cleanPassword;
                                    }
                                }
                            } else {
                                console.error('âŒ showRomanticEasterEgg å‡½æ•°æœªå®šä¹‰ï¼', typeof window.showRomanticEasterEgg);
                                // å¤‡ç”¨æ–¹æ¡ˆï¼šç›´æ¥æ˜¾ç¤ºå…ƒç´ 
                                const egg = document.getElementById('romantic-easter-egg');
                                if (egg) {
                                    console.log('âš ï¸ å‡½æ•°æœªå®šä¹‰ï¼Œå°è¯•ç›´æ¥æ˜¾ç¤ºå…ƒç´ ...');
                                    egg.style.display = 'flex';
                                    egg.style.zIndex = '99999';
                                    egg.style.position = 'fixed';
                                    egg.style.top = '0';
                                    egg.style.left = '0';
                                    egg.style.width = '100vw';
                                    egg.style.height = '100vh';
                                    document.body.style.overflow = 'hidden';
                                    window.romanticLoginAccount = cleanAccount;
                                    window.romanticLoginPassword = cleanPassword;
                                    console.log('âœ… å½©è›‹å…ƒç´ å·²ç›´æ¥æ˜¾ç¤º');
                                } else {
                                    console.error('âŒ å½©è›‹å…ƒç´ ä¹Ÿä¸å­˜åœ¨ï¼');
                                    customAlert('å½©è›‹åŠŸèƒ½åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'é”™è¯¯');
                                }
                            }
                        }, 50);
                        // å»¶è¿Ÿ10ç§’åè‡ªåŠ¨å…³é—­å½©è›‹å¹¶ç»§ç»­æ­£å¸¸ç™»å½•æµç¨‹ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰
                        if (window.romanticLoginTimeout) {
                            clearTimeout(window.romanticLoginTimeout);
                        }
                        window.romanticLoginTimeout = setTimeout(() => {
                            // æ¸…é™¤å€’è®¡æ—¶ï¼Œé¿å…é‡å¤è°ƒç”¨
                            if (window.countdownInterval) {
                                clearInterval(window.countdownInterval);
                                window.countdownInterval = null;
                            }
                            if (typeof window.closeRomanticEasterEgg === 'function') {
                                window.closeRomanticEasterEgg();
                            }
                            // ç»§ç»­æ­£å¸¸ç™»å½•æµç¨‹
                            if (window.romanticLoginAccount && window.romanticLoginPassword) {
                                if (typeof handleRomanticLogin === 'function') {
                                    handleRomanticLogin(window.romanticLoginAccount, window.romanticLoginPassword);
                                }
                                // æ¸…é™¤ä¿å­˜çš„ç™»å½•ä¿¡æ¯
                                window.romanticLoginAccount = null;
                                window.romanticLoginPassword = null;
                            }
                            window.romanticLoginTimeout = null;
                        }, 10000);
                        return;
                    }
                    
                    // å¦‚æœä¸æ˜¯å½©è›‹è´¦å·ï¼Œç»§ç»­æ­£å¸¸ç™»å½•æµç¨‹
                    console.log('â„¹ï¸ ä¸æ˜¯å½©è›‹è´¦å·ï¼Œç»§ç»­æ­£å¸¸ç™»å½•æµç¨‹');

                // ========== é˜²æ­¢é‡å¤ç™»å½• ==========
                // ä½¿ç”¨è§„èŒƒåŒ–æ¯”è¾ƒï¼Œæ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ
                if (currentUser && normalizeAccount(currentUser.account) === normalizeAccount(account)) {
                    showNotification('This account is already logged in on another device', 'warning');
                    loginModal.style.display = 'none';
                    return;
                }

                // ========== ç™»å½•å‰æ¸…é™¤æœ¬åœ°ç¼“å­˜å’Œç™»å½•çŠ¶æ€ï¼Œé˜²æ­¢æ—§æ•°æ®/æ—§ä¼šè¯å¹²æ‰° ==========
                console.log('ğŸ§¹ ç™»å½•å‰æ¸…é™¤æœ¬åœ°ç¼“å­˜å’Œæ—§çš„ç™»å½•çŠ¶æ€...');
                try {
                    // 1. å…ˆæ¸…é™¤å½“å‰å†…å­˜ä¸­çš„ç™»å½•çŠ¶æ€
                    currentUser = null;

                    // 2. æ¸…é™¤æœ¬åœ°å­˜å‚¨ä¸­çš„ç™»å½•çŠ¶æ€ï¼ˆä½†ä¿ç•™è®¾å¤‡é™åˆ¶ç­‰é‡è¦ä¿¡æ¯ï¼‰
                    try {
                        // ä½¿ç”¨å°è£…çš„ Storage å·¥å…·ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                        if (typeof Storage !== 'undefined' && Storage.remove) {
                            Storage.remove('currentUser');
                        } else {
                            localStorage.removeItem('currentUser');
                        }
                    } catch (e1) {
                        console.warn('âš ï¸ æ¸…é™¤ currentUser æœ¬åœ°è®°å½•æ—¶å‡ºé”™:', e1);
                        // å…œåº•å†ç›´æ¥æ“ä½œ localStorage
                        try {
                            localStorage.removeItem('currentUser');
                        } catch (e2) {
                            console.warn('âš ï¸ ç›´æ¥æ“ä½œ localStorage æ¸…é™¤ currentUser å¤±è´¥:', e2);
                        }
                    }

                    // 3. æ¸…é™¤ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡ç¼“å­˜ï¼ˆè®¢å•ã€åœ°å€ç­‰ï¼‰
                    localStorage.removeItem('userOrders');
                    localStorage.removeItem('userAddresses');
                    
                    // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§è®¢å•ç¼“å­˜ï¼ˆé’ˆå¯¹ä¸åŒç”¨æˆ·çš„è®¢å•ï¼‰
                    // éå†localStorageï¼Œæ¸…é™¤æ‰€æœ‰ä»¥'userOrders_'å¼€å¤´çš„key
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && (key.startsWith('userOrders_') || key.startsWith('userAddresses_'))) {
                            keysToRemove.push(key);
                        }
                    }
                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                        console.log('ğŸ—‘ï¸ å·²æ¸…é™¤ç¼“å­˜:', key);
                    });
                    
                    // 4. æ¸…ç©ºå†…å­˜ä¸­çš„æ—§æ•°æ®
                    userOrders = [];
                    userAddresses = [];
                    userProfile = {};
                    
                    console.log('âœ… ç™»å½•ç›¸å…³æœ¬åœ°ç¼“å­˜å’Œæ—§ä¼šè¯å·²æ¸…é™¤');
                } catch (error) {
                    console.warn('âš ï¸ æ¸…é™¤ç™»å½•ç¼“å­˜/æ—§ä¼šè¯æ—¶å‡ºç°é”™è¯¯:', error);
                }

                const authResult = authenticateUser(account, password);
                
                // æ£€æŸ¥ç™»å½•ç»“æœ
                if (authResult && !authResult.banned && authResult.success !== false && authResult.account) {
                    // ç™»å½•æˆåŠŸ
                    // ========== æ¸…ç©ºæ—§ç”¨æˆ·æ•°æ®ï¼Œå‡†å¤‡åŠ è½½æ–°ç”¨æˆ·æ•°æ® ==========
                    console.log('ğŸ”„ ç™»å½•æˆåŠŸï¼Œå‡†å¤‡åŠ è½½æ–°ç”¨æˆ·æ•°æ®...');
                    
                    currentUser = authResult;
                    saveCurrentUser();
                    refreshCurrentUserSnapshot(authResult.account);

                    showNotification(`Login successful! Loading data from cloud...`, 'success');
                    loginModal.style.display = 'none';

                    // ç™»å½•æˆåŠŸåï¼Œå¼ºåˆ¶æ¢å¤é¡µé¢æ»šåŠ¨ï¼ˆé˜²æ­¢ä¹‹å‰çš„å¼¹çª—æˆ–å½©è›‹å°†é¡µé¢é”å®šï¼‰
                    try {
                        document.documentElement.style.overflowY = 'auto';
                        document.body.style.overflow = '';
                    } catch (e) {
                        console.warn('ç™»å½•åé‡ç½®é¡µé¢æ»šåŠ¨çŠ¶æ€æ—¶å‡ºé”™:', e);
                    }

                    // ========== å¼ºåˆ¶ä½¿ç”¨äº‘ç«¯æ¨¡å¼åŠ è½½æ•°æ® ==========
                    console.log('ğŸ”„ ç™»å½•æˆåŠŸï¼Œå¼ºåˆ¶ä½¿ç”¨äº‘ç«¯æ¨¡å¼');

                    try {
                        // äº‘ç«¯æ¨¡å¼ï¼šä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ®
                        if (cloudSync && cloudSync.isInitialized) {
                            console.log('â˜ï¸ äº‘ç«¯æ¨¡å¼ - ä»äº‘ç«¯æ•°æ®åº“åŠ è½½æ•°æ®...');

                            // åŠ è½½äº§å“æ•°æ®
                            const cloudProducts = await cloudSync.downloadData('products');
                            if (cloudProducts && cloudProducts.length > 0) {
                                products = cloudProducts;
                                localStorage.setItem('products', JSON.stringify(products));
                                console.log('âœ… äº§å“æ•°æ®å·²ä»äº‘ç«¯åŠ è½½:', products.length, 'ä¸ªäº§å“');
                            } else {
                                console.log('â„¹ï¸ äº‘ç«¯æš‚æ— äº§å“æ•°æ®');
                                products = [];
                            }

                            // åŠ è½½ç”¨æˆ·æ•°æ®(ä»…ç®¡ç†å‘˜)
                            if (authResult.role === 'admin') {
                                const cloudUsers = await cloudSync.downloadData('users');
                                if (cloudUsers && cloudUsers.length > 0) {
                                    allUsers = cloudUsers;
                                    localStorage.setItem('allUsers', JSON.stringify(allUsers));
                                    console.log('âœ… ç”¨æˆ·æ•°æ®å·²ä»äº‘ç«¯åŠ è½½:', allUsers.length, 'ä¸ªç”¨æˆ·');
                                }
                            }

                            // åŒæ­¥å½“å‰ç”¨æˆ·ç›¸å…³æ•°æ®å¹¶å»ºç«‹ç›‘å¬
                            await cloudSync.handleUserSessionChange();
                            
                            // ç¡®ä¿ä»localStorageé‡æ–°åŠ è½½æœ€æ–°çš„è®¢å•å’Œåœ°å€æ•°æ®ï¼ˆhandleUserSessionChangeå·²æ›´æ–°ï¼‰
                            const userOrdersKey = `userOrders_${authResult.account}`;
                            const userAddressesKey = `userAddresses_${authResult.account}`;
                            userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || JSON.parse(localStorage.getItem('userOrders')) || [];
                            userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || JSON.parse(localStorage.getItem('userAddresses')) || [];
                            
                            console.log('âœ… ç™»å½•åæ•°æ®å·²åŒæ­¥ - è®¢å•æ•°:', userOrders.length, 'åœ°å€æ•°:', userAddresses.length);

                            // ç«‹å³æ›´æ–°ç•Œé¢æ˜¾ç¤ºï¼ˆåœ¨æ˜¾ç¤ºé€šçŸ¥ä¹‹å‰ï¼‰
                            updateUserInterface();
                            renderProducts(products);
                            renderUserOrders();
                            renderAddressList();

                            showNotification(`â˜ï¸ Cloud data loaded successfully! Welcome ${authResult.username}`, 'success');
                        } else {
                            // äº‘ç«¯åŒæ­¥æœªå¯ç”¨,å›é€€åˆ°æœ¬åœ°ç¼“å­˜
                            console.log('âš ï¸ äº‘ç«¯åŒæ­¥æœªå¯ç”¨,ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ•°æ®');
                            products = JSON.parse(localStorage.getItem('products')) || [];
                            // ä»ç”¨æˆ·ç‰¹å®šçš„localStorageåŠ è½½è®¢å•å’Œåœ°å€
                            const userOrdersKey = `userOrders_${authResult.account}`;
                            const userAddressesKey = `userAddresses_${authResult.account}`;
                            userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || [];
                            userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || [];
                            allUsers = JSON.parse(localStorage.getItem('allUsers')) || [];
                            
                            // æ•°æ®è¿ç§»ï¼šä¸ºç°æœ‰ç”¨æˆ·æ•°æ®æ·»åŠ è§„èŒƒåŒ–å­—æ®µ
                            migrateUserDataToCanonical();
                            
                            // ç«‹å³æ›´æ–°ç•Œé¢æ˜¾ç¤º
                            updateUserInterface();
                            renderProducts(products);
                            renderUserOrders();
                            renderAddressList();
                            
                            showNotification(`ğŸ’¾ Cloud not connected, loaded local data! Welcome ${authResult.username}`, 'warning');
                        }
                    } catch (error) {
                        console.error('âŒ æ•°æ®åŠ è½½å¤±è´¥:', error);
                        showNotification('Data loading failed, using local cache', 'warning');
                        // å¤±è´¥æ—¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜
                        products = JSON.parse(localStorage.getItem('products')) || [];
                        const userOrdersKey = `userOrders_${authResult.account}`;
                        const userAddressesKey = `userAddresses_${authResult.account}`;
                        userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || [];
                        userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || [];
                        allUsers = JSON.parse(localStorage.getItem('allUsers')) || [];
                        
                        // æ•°æ®è¿ç§»ï¼šä¸ºç°æœ‰ç”¨æˆ·æ•°æ®æ·»åŠ è§„èŒƒåŒ–å­—æ®µ
                        migrateUserDataToCanonical();
                        
                        // ç«‹å³æ›´æ–°ç•Œé¢æ˜¾ç¤º
                        updateUserInterface();
                        renderProducts(products);
                        renderUserOrders();
                        renderAddressList();
                    }

                    // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºæ§åˆ¶é¢æ¿
                    if (authResult.role === 'admin') {
                        const controlPanel = document.getElementById('admin-control-panel');
                        if (controlPanel) {
                            controlPanel.style.display = 'block';
                        }
                    }

                    // å¦‚æœä¹‹å‰ç‚¹å‡»äº†é¢†å–äº§å“ï¼Œç™»å½•æˆåŠŸåè‡ªåŠ¨æ‰“å¼€æŠ¥åæ¨¡æ€æ¡†
                    if (pendingSignupProduct) {
                        setTimeout(() => {
                            openSignupModal(pendingSignupProduct);
                            pendingSignupProduct = null; // æ¸…é™¤å¾…é¢†å–äº§å“
                        }, 500);
                    }

                } else if (authResult && authResult.banned) {
                    // è´¦å·è¢«ç¦ç”¨
                    customAlert(authResult.message, t('accountDisabled'));
                } else if (authResult && authResult.success === false) {
                    // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºå…·ä½“é”™è¯¯åŸå› 
                    customAlert(authResult.message, t('loginFailed'));
                } else {
                    // æœªçŸ¥é”™è¯¯
                    customAlert(t('loginFailedRetry'), t('errorTitle'));
                }
            });

            // æ³¨å†Œè¡¨å•
            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const account = document.getElementById('register-account').value.trim();
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;

                // éªŒè¯è´¦å·æ˜¯å¦ä¸ºç©º
                if (!account) {
                    customAlert(t('pleaseEnterAccount'), t('registerFailed'));
                    return;
                }

                // éªŒè¯è´¦å·æ ¼å¼ï¼ˆå»ºè®®ä½¿ç”¨é‚®ç®±æ ¼å¼ï¼‰
                if (account.length < 3) {
                    customAlert(t('accountMinLength'), t('registerFailed'));
                    return;
                }

                // éªŒè¯å¯†ç æ˜¯å¦ä¸ºç©º
                if (!password) {
                    customAlert(t('enterPassword'), t('registerFailed'));
                    return;
                }

                // éªŒè¯ç¡®è®¤å¯†ç æ˜¯å¦ä¸ºç©º
                if (!confirm) {
                    customAlert(t('pleaseConfirmPassword'), t('registerFailed'));
                    return;
                }

                // éªŒè¯å¯†ç é•¿åº¦
                if (password.length < 6) {
                    customAlert(t('passwordMinLength'), t('registerFailed'));
                    return;
                }

                // éªŒè¯å¯†ç æ˜¯å¦åŒ¹é…
                if (password !== confirm) {
                    customAlert(t('passwordMismatchRetry'), t('registerFailed'));
                    return;
                }

                // éªŒè¯å¯†ç å¼ºåº¦ï¼ˆå»ºè®®ï¼šè‡³å°‘åŒ…å«å­—æ¯æˆ–æ•°å­—ï¼Œä½†å…è®¸çº¯å­—æ¯æˆ–çº¯æ•°å­—ï¼‰
                // åªæ£€æŸ¥æ˜¯å¦åŒ…å«æœ‰æ•ˆå­—ç¬¦ï¼Œä¸å¼ºåˆ¶è¦æ±‚åŒæ—¶åŒ…å«å­—æ¯å’Œæ•°å­—
                const passwordRegex = /^[A-Za-z\d@$!%*#?&]{6,}$/;
                if (!passwordRegex.test(password)) {
                    customAlert(t('passwordFormatError'), t('registerFailed'));
                    return;
                }

                const username = account.split('@')[0];
                const result = registerUser(account, password, username);

                if (result.success) {
                    // ========== æ¸…ç©ºæ—§ç”¨æˆ·æ•°æ®ï¼Œå‡†å¤‡æ–°ç”¨æˆ·æ•°æ® ==========
                    console.log('ğŸ”„ æ³¨å†ŒæˆåŠŸï¼Œæ¸…ç©ºæ—§ç”¨æˆ·æ•°æ®...');
                    userOrders = [];
                    userAddresses = [];
                    userProfile = {};
                    
                    // ä» allUsers ä¸­è·å–åˆšæ³¨å†Œçš„å®Œæ•´ç”¨æˆ·æ•°æ®ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æŸ¥æ‰¾ï¼‰
                    const newUserData = findUserByAccount(account);
                    if (newUserData) {
                        currentUser = {
                            account: newUserData.account,
                            username: newUserData.username,
                            role: newUserData.role,
                            status: newUserData.status,
                            points: newUserData.points
                        };
                    } else {
                        // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨åŸºæœ¬ä¿¡æ¯
                        currentUser = { account, username, role: 'user' };
                    }
                    saveCurrentUser();

                    // åŒæ­¥åˆ°äº‘ç«¯ï¼ˆç¡®ä¿æ–°ç”¨æˆ·è¢«æ·»åŠ åˆ°äº‘ç«¯çš„ allUsersï¼‰
                    if (cloudSync && cloudSync.isInitialized) {
                        try {
                            console.log('ğŸ”„ å¼€å§‹åŒæ­¥æ–°æ³¨å†Œç”¨æˆ·åˆ°äº‘ç«¯ allUsers...');
                            await cloudSync.syncAllUsers();
                            await cloudSync.handleUserSessionChange();
                            console.log('âœ… æ–°ç”¨æˆ·å·²åŒæ­¥åˆ°äº‘ç«¯ allUsers');
                        } catch (syncError) {
                            console.error('åŒæ­¥åˆ°äº‘ç«¯å¤±è´¥:', syncError);
                            // å³ä½¿åŒæ­¥å¤±è´¥ï¼Œæœ¬åœ°æ³¨å†Œå·²æˆåŠŸï¼Œç»§ç»­æ‰§è¡Œ
                        }
                    } else {
                        console.warn('âš ï¸ äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–ï¼Œæ–°ç”¨æˆ·ä»…ä¿å­˜åœ¨æœ¬åœ°');
                    }

                    // æ³¨å†ŒæˆåŠŸåï¼šç›´æ¥æç¤º + è‡ªåŠ¨ç™»å½•å¹¶å…³é—­æ³¨å†Œçª—å£
                    showNotification(t('registrationSuccess') || 'Registration successful!', 'success');
                    registerModal.style.display = 'none';
                    updateUserInterface();
                    renderUserOrders();
                    renderAddressList();

                    // å¦‚æœä¹‹å‰ç‚¹å‡»äº†é¢†å–äº§å“ï¼Œæ³¨å†ŒæˆåŠŸåè‡ªåŠ¨æ‰“å¼€æŠ¥åæ¨¡æ€æ¡†
                    if (pendingSignupProduct) {
                        setTimeout(() => {
                            openSignupModal(pendingSignupProduct);
                            pendingSignupProduct = null; // æ¸…é™¤å¾…é¢†å–äº§å“
                        }, 500);
                    }
                } else {
                    // æ³¨å†Œå¤±è´¥ï¼Œæ˜¾ç¤ºå…·ä½“é”™è¯¯åŸå› 
                    customAlert(result.message || t('registerFailedRetry'), t('registerFailed'));
                }
            });

            // ç”¨æˆ·ä¸»åŠ¨é€€å‡ºæ—¶ï¼Œæ¸…é™¤æœ¬åœ°æ‰€æœ‰æ•°æ®
            function clearAllLocalDataOnLogout() {
                try {
                    console.log('ğŸ§¹ ç”¨æˆ·ä¸»åŠ¨é€€å‡ºï¼Œå¼€å§‹æ¸…é™¤æœ¬åœ°æ‰€æœ‰æ•°æ®...');

                    // æ¸…é™¤ localStorage å…¨éƒ¨æ•°æ®
                    localStorage.clear();

                    // æ¸…é™¤ sessionStorage å…¨éƒ¨æ•°æ®
                    try {
                        sessionStorage.clear();
                    } catch (e) {
                        console.warn('æ¸…é™¤ sessionStorage æ—¶å‡ºé”™:', e);
                    }

                    // å¯é€‰ï¼šæ¸…é™¤ IndexedDBï¼ˆå¦‚æœæœ‰ä½¿ç”¨ï¼‰
                    try {
                        if ('indexedDB' in window && indexedDB.databases) {
                            indexedDB.databases().then(databases => {
                                databases.forEach(db => {
                                    if (db.name) {
                                        indexedDB.deleteDatabase(db.name);
                                        console.log(`âœ… å·²æ¸…é™¤ IndexedDB: ${db.name}`);
                                    }
                                });
                            }).catch(e => {
                                console.warn('æ¸…é™¤ IndexedDB æ—¶å‡ºé”™:', e);
                            });
                        }
                    } catch (e) {
                        console.warn('è®¿é—® IndexedDB æ—¶å‡ºé”™:', e);
                    }

                    // å¯é€‰ï¼šæ¸…é™¤ Service Worker ç¼“å­˜
                    try {
                        if ('caches' in window) {
                            caches.keys().then(names => {
                                names.forEach(name => {
                                    caches.delete(name);
                                    console.log(`âœ… å·²æ¸…é™¤ Service Worker ç¼“å­˜: ${name}`);
                                });
                            }).catch(e => {
                                console.warn('æ¸…é™¤ Service Worker ç¼“å­˜æ—¶å‡ºé”™:', e);
                            });
                        }
                    } catch (e) {
                        console.warn('è®¿é—® Service Worker ç¼“å­˜æ—¶å‡ºé”™:', e);
                    }

                    console.log('âœ… ç”¨æˆ·é€€å‡ºåï¼Œæœ¬åœ°æ•°æ®å·²å…¨éƒ¨æ¸…é™¤');
                } catch (error) {
                    console.error('âŒ é€€å‡ºæ—¶æ¸…é™¤æœ¬åœ°æ•°æ®å‡ºé”™:', error);
                }
            }

            // é€€å‡ºç™»å½•ï¼ˆä½¿ç”¨ bindFastTapï¼Œä¿è¯ç§»åŠ¨ç«¯ç‚¹å‡»ä¸€æ¬¡å°±è§¦å‘ï¼‰
            bindFastTap(logoutLink, async (e) => {
                e && e.preventDefault && e.preventDefault();

                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œé€€å‡ºå‰å…ˆåŒæ­¥äº§å“æ•°æ®åˆ°äº‘ç«¯ï¼Œé¿å…æ•°æ®ä¸¢å¤±
                const isAdmin = isCurrentUserAdmin();
                if (isAdmin && cloudSync && cloudSync.isInitialized) {
                    try {
                        console.log('ğŸ‘‘ ç®¡ç†å‘˜é€€å‡ºå‰ï¼Œå…ˆåŒæ­¥äº§å“æ•°æ®åˆ°äº‘ç«¯...');
                        // ç¡®ä¿æœ¬åœ°äº§å“æ•°æ®å·²ä¿å­˜
                        const localProducts = JSON.parse(localStorage.getItem('products') || '[]');
                        if (localProducts && localProducts.length > 0) {
                            products = localProducts;
                            await cloudSync.syncProducts();
                            console.log('âœ… ç®¡ç†å‘˜é€€å‡ºå‰ï¼Œäº§å“æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯');
                        } else {
                            console.log('â„¹ï¸ æœ¬åœ°æ— äº§å“æ•°æ®ï¼Œè·³è¿‡åŒæ­¥');
                        }
                    } catch (syncError) {
                        console.error('âŒ ç®¡ç†å‘˜é€€å‡ºå‰åŒæ­¥äº§å“æ•°æ®å¤±è´¥:', syncError);
                        // å³ä½¿åŒæ­¥å¤±è´¥ï¼Œä¹Ÿç»§ç»­é€€å‡ºæµç¨‹
                    }
                }

                // å…ˆå¤„ç†å½“å‰ä¼šè¯å’Œäº‘ç«¯çŠ¶æ€
                currentUser = null;
                localStorage.removeItem('currentUser');
                if (cloudSync && cloudSync.isInitialized) {
                    await cloudSync.handleUserSessionChange();
                } else {
                    userOrders = [];
                    userAddresses = [];
                }

                // æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®ï¼ˆåªåœ¨ç”¨æˆ·ä¸»åŠ¨é€€å‡ºæ—¶æ‰§è¡Œï¼‰
                clearAllLocalDataOnLogout();

                // æ›´æ–°ç•Œé¢å¹¶è¿”å›ä¸»é¡µ
                updateUserInterface();
                showHomePage();
            });

            // è¿œç¨‹ç™»å½•å¼ºåˆ¶å½“å‰è®¾å¤‡é€€å‡ºï¼ˆå¤šè®¾å¤‡ç™»å½•æ§åˆ¶ç”¨ï¼‰
            window.handleRemoteLogout = async function () {
                try {
                    currentUser = null;
                    localStorage.removeItem('currentUser');

                    if (cloudSync && cloudSync.isInitialized) {
                        await cloudSync.handleUserSessionChange();
                    } else {
                        userOrders = [];
                        userAddresses = [];
                    }

                    if (typeof clearAllLocalDataOnLogout === 'function') {
                        clearAllLocalDataOnLogout();
                    }

                    if (typeof updateUserInterface === 'function') {
                        updateUserInterface();
                    }
                    if (typeof showHomePage === 'function') {
                        showHomePage();
                    }
                    if (typeof showNotification === 'function') {
                        showNotification(t('loggedOutByOtherDevice'), 'warning');
                    }
                } catch (e) {
                    console.error('handleRemoteLogout æ‰§è¡Œå¤±è´¥:', e);
                }
            };

            const deleteAccountBtn = document.getElementById('delete-account-btn');
            if (deleteAccountBtn) {
                bindFastTap(deleteAccountBtn, handleSelfAccountDeletion);
            }

            // åŒæ­¥çŠ¶æ€ç‚¹å‡»äº‹ä»¶ - æ˜¾ç¤ºåŒæ­¥è¯¦æƒ…å¯¹è¯æ¡†
            const syncStatus = document.getElementById('sync-status');
            if (syncStatus) {
                bindFastTap(syncStatus, () => {
                    showSyncStatusDialog();
                });
            }

            // ========== ç®¡ç†å‘˜æ§åˆ¶é¢æ¿äº‹ä»¶ ==========
            const controlPanelBtn = document.getElementById('control-panel-btn');
            const controlPanelDropdown = document.getElementById('control-panel-dropdown');

            // ç‚¹å‡»æŒ‰é’®åˆ‡æ¢ä¸‹æ‹‰èœå•ï¼ˆä½¿ç”¨ bindFastTapï¼Œå…¼å®¹ç§»åŠ¨ç«¯ï¼‰
            if (controlPanelBtn) {
                bindFastTap(controlPanelBtn, (e) => {
                    e && e.stopPropagation && e.stopPropagation();
                    const isVisible = controlPanelDropdown.style.display === 'block';
                    controlPanelDropdown.style.display = isVisible ? 'none' : 'block';
                });
            }

            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', (e) => {
                if (controlPanelDropdown && !controlPanelDropdown.contains(e.target) && e.target !== controlPanelBtn) {
                    controlPanelDropdown.style.display = 'none';
                }
            });

            // å¼ºåˆ¶ä½¿ç”¨äº‘ç«¯æ¨¡å¼ - æ‰€æœ‰æ•°æ®ä»äº‘ç«¯è·å–
            window.currentDataSourceMode = 'cloud';
            localStorage.setItem('dataSourceMode', 'cloud');
            console.log('ğŸ”’ å·²å¯ç”¨äº‘ç«¯æ¨¡å¼ï¼Œæ‰€æœ‰æ•°æ®å®æ—¶åŒæ­¥');

            // åˆå§‹åŒ–æ—¶ä»äº‘ç«¯åŠ è½½æ•°æ®
            if (cloudSync && cloudSync.isInitialized) {
                console.log('ğŸ“¥ ä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ®...');
            }

            // æµ‹è¯•äº‘ç«¯è¿æ¥ï¼ˆä½¿ç”¨ bindFastTapï¼Œé¿å…ç§»åŠ¨ç«¯ç¬¬ä¸€æ¬¡ç‚¹å‡»æ— å“åº”ï¼‰
            const testCloudBtn = document.getElementById('test-cloud-connection');
            if (testCloudBtn) {
                bindFastTap(testCloudBtn, async function () {
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•ä¸­...';

                    try {
                        if (cloudSync && cloudSync.isInitialized) {
                            await cloudSync.testConnection();
                            showNotification('âœ… äº‘ç«¯è¿æ¥æ­£å¸¸ï¼', 'success');
                            document.getElementById('sync-status-text').textContent = 'çŠ¶æ€ï¼šè¿æ¥æ­£å¸¸';
                        } else {
                            showNotification('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–', 'warning');
                            document.getElementById('sync-status-text').textContent = 'çŠ¶æ€ï¼šæœªè¿æ¥';
                        }
                    } catch (error) {
                        console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error);
                        showNotification('âŒ è¿æ¥å¤±è´¥: ' + error.message, 'error');
                        document.getElementById('sync-status-text').textContent = 'çŠ¶æ€ï¼šè¿æ¥å¤±è´¥';
                    }

                    this.disabled = false;
                    this.innerHTML = '<i class="fas fa-cloud"></i> æµ‹è¯•äº‘ç«¯è¿æ¥';
                });
            }

            // å¼ºåˆ¶åŒæ­¥æ•°æ®ï¼ˆä½¿ç”¨ bindFastTapï¼‰
            const forceSyncBtn = document.getElementById('force-sync');
            if (forceSyncBtn) {
                bindFastTap(forceSyncBtn, async function () {
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åŒæ­¥ä¸­...';

                    try {
                        if (cloudSync && cloudSync.isInitialized) {
                            await cloudSync.syncAllData();
                            showNotification('âœ… æ•°æ®åŒæ­¥å®Œæˆï¼', 'success');

                            // é‡æ–°åŠ è½½æ•°æ®
                            products = JSON.parse(localStorage.getItem('products')) || [];
                            renderProducts(products);
                            if (document.getElementById('admin-panel').style.display !== 'none') {
                                renderAdminProducts();
                            }
                        } else {
                            showNotification('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–', 'warning');
                        }
                    } catch (error) {
                        console.error('åŒæ­¥å¤±è´¥:', error);
                        showNotification('âŒ åŒæ­¥å¤±è´¥: ' + error.message, 'error');
                    }

                    this.disabled = false;
                    this.innerHTML = '<i class="fas fa-sync-alt"></i> å¼ºåˆ¶åŒæ­¥æ•°æ®';
                });
            }

            // æ¸…é™¤æœ¬åœ°ç¼“å­˜ï¼ˆä½¿ç”¨ bindFastTapï¼‰
            const clearCacheBtn = document.getElementById('clear-cache');
            if (clearCacheBtn) {
                bindFastTap(clearCacheBtn, function () {
                    customConfirm(t('confirmClearCache'), t('confirmClearCache')).then(confirmed => {
                        if (!confirmed) return;
                        localStorage.removeItem('products');
                        localStorage.removeItem('userOrders');
                        localStorage.removeItem('allUsers');
                        products = [];
                        userOrders = [];
                        allUsers = [];
                        renderProducts(products);
                        if (document.getElementById('admin-panel').style.display !== 'none') {
                            renderAdminProducts();
                        }
                        showNotification('âœ… æœ¬åœ°ç¼“å­˜å·²æ¸…é™¤ï¼', 'success');
                    });
                });
            }

            // WhatsAppæŒ‰é’®å·²é€šè¿‡HTMLç›´æ¥é“¾æ¥ï¼Œæ— éœ€JavaScriptå¤„ç†

            // ========== æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤åŠŸèƒ½ ==========
            // ä¸‹è½½æ•°æ®åº“å¤‡ä»½
            const downloadDatabaseBtn = document.getElementById('download-database-btn');
            if (downloadDatabaseBtn) {
                downloadDatabaseBtn.addEventListener('click', function() {
                    try {
                        // æ”¶é›†æ‰€æœ‰éœ€è¦å¤‡ä»½çš„æ•°æ®
                        const backupData = {
                            version: '1.0',
                            timestamp: new Date().toISOString(),
                            data: {
                                products: JSON.parse(localStorage.getItem('products') || '[]'),
                                userOrders: JSON.parse(localStorage.getItem('userOrders') || '[]'),
                                allOrders: JSON.parse(localStorage.getItem('allOrders') || '[]'),
                                allUsers: JSON.parse(localStorage.getItem('allUsers') || '[]'),
                                homepageSettings: JSON.parse(localStorage.getItem('homepageSettings') || '{}'),
                                currentUser: JSON.parse(localStorage.getItem('currentUser') || 'null'),
                                language: localStorage.getItem('language') || 'en'
                            }
                        };

                        // ç»Ÿè®¡ä¿¡æ¯
                        const stats = {
                            productsCount: backupData.data.products.length,
                            ordersCount: backupData.data.userOrders.length,
                            allOrdersCount: backupData.data.allOrders.length,
                            usersCount: backupData.data.allUsers.length
                        };

                        // åˆ›å»ºJSONå­—ç¬¦ä¸²
                        const jsonString = JSON.stringify(backupData, null, 2);
                        
                        // åˆ›å»ºBlobå¯¹è±¡
                        const blob = new Blob([jsonString], { type: 'application/json' });
                        
                        // åˆ›å»ºä¸‹è½½é“¾æ¥
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `database-backup-${new Date().toISOString().split('T')[0]}-${Date.now()}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);

                        // æ˜¾ç¤ºå¤‡ä»½ä¿¡æ¯
                        const infoDiv = document.getElementById('database-backup-info');
                        const detailsDiv = document.getElementById('database-backup-details');
                        if (infoDiv && detailsDiv) {
                            detailsDiv.innerHTML = `
                                <div><strong>å¤‡ä»½æ—¶é—´ï¼š</strong>${new Date(backupData.timestamp).toLocaleString()}</div>
                                <div><strong>äº§å“æ•°é‡ï¼š</strong>${stats.productsCount}</div>
                                <div><strong>ç”¨æˆ·è®¢å•æ•°é‡ï¼š</strong>${stats.ordersCount}</div>
                                <div><strong>å…¨éƒ¨è®¢å•æ•°é‡ï¼š</strong>${stats.allOrdersCount}</div>
                                <div><strong>ç”¨æˆ·æ•°é‡ï¼š</strong>${stats.usersCount}</div>
                            `;
                            infoDiv.style.display = 'block';
                        }

                        showNotification('âœ… æ•°æ®åº“å¤‡ä»½å·²ä¸‹è½½', 'success');
                    } catch (error) {
                        console.error('å¤‡ä»½å¤±è´¥:', error);
                        showMessageModal(t('errorTitle'), t('databaseBackupFailed').replace('{error}', error.message), 'alert');
                    }
                });
            }

            // ä¸Šä¼ æ•°æ®åº“å¤‡ä»½å¹¶æ¢å¤
            window.handleDatabaseUpload = function(event) {
                const file = event.target.files[0];
                if (!file) {
                    return;
                }

                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!file.name.endsWith('.json')) {
                    showMessageModal(t('errorTitle'), t('pleaseUploadJSONFile'), 'alert');
                    event.target.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);

                        // éªŒè¯å¤‡ä»½æ–‡ä»¶æ ¼å¼
                        if (!backupData || !backupData.data) {
                            throw new Error('æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼');
                        }

                        // éªŒè¯æ•°æ®ç»“æ„ï¼ˆallOrdersæ˜¯å¯é€‰çš„ï¼Œå…¼å®¹æ—§ç‰ˆæœ¬å¤‡ä»½ï¼‰
                        const requiredKeys = ['products', 'userOrders', 'allUsers', 'homepageSettings'];
                        const missingKeys = requiredKeys.filter(key => !(key in backupData.data));
                        if (missingKeys.length > 0) {
                            throw new Error('å¤‡ä»½æ–‡ä»¶ç¼ºå°‘å¿…è¦çš„æ•°æ®ï¼š' + missingKeys.join(', '));
                        }

                        // éªŒè¯æ•°æ®ç±»å‹
                        if (!Array.isArray(backupData.data.products)) {
                            throw new Error('äº§å“æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                        if (!Array.isArray(backupData.data.userOrders)) {
                            throw new Error('ç”¨æˆ·è®¢å•æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                        if (!Array.isArray(backupData.data.allUsers)) {
                            throw new Error('ç”¨æˆ·æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                        if (typeof backupData.data.homepageSettings !== 'object') {
                            throw new Error('è®¾ç½®æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                        // allOrdersæ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®¾ä¸ºç©ºæ•°ç»„
                        if (backupData.data.allOrders && !Array.isArray(backupData.data.allOrders)) {
                            throw new Error('å…¨éƒ¨è®¢å•æ•°æ®æ ¼å¼é”™è¯¯');
                        }

                        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        const stats = {
                            productsCount: backupData.data.products.length,
                            ordersCount: backupData.data.userOrders.length,
                            allOrdersCount: (backupData.data.allOrders || []).length,
                            usersCount: backupData.data.allUsers.length,
                            backupTime: backupData.timestamp ? new Date(backupData.timestamp).toLocaleString() : 'æœªçŸ¥'
                        };

                        customConfirm(
                            `ç¡®å®šè¦æ¢å¤æ•°æ®åº“å—ï¼Ÿ\n\n` +
                            `å¤‡ä»½ä¿¡æ¯ï¼š\n` +
                            `- å¤‡ä»½æ—¶é—´ï¼š${stats.backupTime}\n` +
                            `- äº§å“æ•°é‡ï¼š${stats.productsCount}\n` +
                            `- ç”¨æˆ·è®¢å•æ•°é‡ï¼š${stats.ordersCount}\n` +
                            `- å…¨éƒ¨è®¢å•æ•°é‡ï¼š${stats.allOrdersCount}\n` +
                            `- ç”¨æˆ·æ•°é‡ï¼š${stats.usersCount}\n\n` +
                            `è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ¸…ç©ºå½“å‰æ‰€æœ‰æ•°æ®å¹¶æ›¿æ¢ä¸ºå¤‡ä»½æ•°æ®ï¼`,
                            'ç¡®è®¤æ¢å¤æ•°æ®åº“'
                        ).then(confirmed => {
                            if (!confirmed) {
                                event.target.value = '';
                                return;
                            }

                            try {
                                // æ¸…ç©ºå½“å‰æ•°æ®
                                localStorage.removeItem('products');
                                localStorage.removeItem('userOrders');
                                localStorage.removeItem('allOrders');
                                localStorage.removeItem('allUsers');
                                localStorage.removeItem('userAddresses');
                                
                                // æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç›¸å…³çš„ç¼“å­˜
                                const keysToRemove = [];
                                for (let i = 0; i < localStorage.length; i++) {
                                    const key = localStorage.key(i);
                                    if (key && (key.startsWith('userOrders_') || key.startsWith('userAddresses_'))) {
                                        keysToRemove.push(key);
                                    }
                                }
                                keysToRemove.forEach(key => localStorage.removeItem(key));
                                
                                // æ¢å¤æ•°æ®
                                localStorage.setItem('products', JSON.stringify(backupData.data.products));
                                localStorage.setItem('userOrders', JSON.stringify(backupData.data.userOrders));
                                if (backupData.data.allOrders && Array.isArray(backupData.data.allOrders)) {
                                    localStorage.setItem('allOrders', JSON.stringify(backupData.data.allOrders));
                                } else {
                                    localStorage.setItem('allOrders', JSON.stringify([]));
                                }
                                localStorage.setItem('allUsers', JSON.stringify(backupData.data.allUsers));
                                
                                if (backupData.data.currentUser && backupData.data.currentUser !== 'null') {
                                    localStorage.setItem('currentUser', JSON.stringify(backupData.data.currentUser));
                                } else {
                                    localStorage.removeItem('currentUser');
                                }
                                
                                if (backupData.data.language) {
                                    localStorage.setItem('language', backupData.data.language);
                                }

                                // é‡æ–°åŠ è½½å…¨å±€å˜é‡
                                products = backupData.data.products || [];
                                userOrders = backupData.data.userOrders || [];
                                allOrders = backupData.data.allOrders || [];
                                allUsers = backupData.data.allUsers || [];
                                currentUser = backupData.data.currentUser || null;

                                // é‡æ–°æ¸²æŸ“é¡µé¢
                                if (typeof renderProducts === 'function') {
                                    renderProducts(products);
                                }
                                
                                // å¦‚æœç®¡ç†å‘˜é¢æ¿æ‰“å¼€ï¼Œåˆ·æ–°æ‰€æœ‰ç›¸å…³é¡µé¢
                                const adminPanel = document.getElementById('admin-panel');
                                if (adminPanel && adminPanel.style.display !== 'none') {
                                    if (typeof renderAdminProducts === 'function') {
                                        renderAdminProducts();
                                    }
                                    if (typeof updateStatistics === 'function') {
                                        updateStatistics();
                                    }
                                    if (typeof renderOrdersTable === 'function') {
                                        renderOrdersTable();
                                    }
                                    if (typeof renderUsersTable === 'function') {
                                        renderUsersTable();
                                    }
                                }

                                // æ›´æ–°ç”¨æˆ·ç•Œé¢
                                if (typeof updateUserInterface === 'function') {
                                    updateUserInterface();
                                }
                                
                                // å¦‚æœç”¨æˆ·ä¸­å¿ƒæ‰“å¼€ï¼Œåˆ·æ–°è®¢å•åˆ—è¡¨
                                const userCenter = document.getElementById('user-center');
                                if (userCenter && userCenter.style.display !== 'none') {
                                    if (typeof renderUserOrders === 'function') {
                                        renderUserOrders();
                                    }
                                }
                                
                                // åº”ç”¨ä¸»é¡µè®¾ç½®
                                if (typeof applyHomepageSettings === 'function') {
                                    applyHomepageSettings();
                                }

                                // æ˜¾ç¤ºå¤‡ä»½ä¿¡æ¯
                                const infoDiv = document.getElementById('database-backup-info');
                                const detailsDiv = document.getElementById('database-backup-details');
                                if (infoDiv && detailsDiv) {
                                    detailsDiv.innerHTML = `
                                        <div><strong>æ¢å¤æ—¶é—´ï¼š</strong>${new Date().toLocaleString()}</div>
                                        <div><strong>å¤‡ä»½æ—¶é—´ï¼š</strong>${stats.backupTime}</div>
                                        <div><strong>äº§å“æ•°é‡ï¼š</strong>${stats.productsCount}</div>
                                        <div><strong>ç”¨æˆ·è®¢å•æ•°é‡ï¼š</strong>${stats.ordersCount}</div>
                                        <div><strong>å…¨éƒ¨è®¢å•æ•°é‡ï¼š</strong>${stats.allOrdersCount}</div>
                                        <div><strong>ç”¨æˆ·æ•°é‡ï¼š</strong>${stats.usersCount}</div>
                                    `;
                                    infoDiv.style.display = 'block';
                                }

                                showMessageModal(t('successTitle'), t('databaseRestoredSuccess'), 'alert');
                                showNotification('âœ… æ•°æ®åº“æ¢å¤æˆåŠŸ', 'success');

                                // åŒæ­¥åˆ°äº‘ç«¯ï¼ˆå¦‚æœå·²åˆå§‹åŒ–ï¼‰
                                if (cloudSync && cloudSync.isInitialized) {
                                    cloudSync.syncAllData().catch(err => {
                                        console.warn('äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                                        showNotification('âš ï¸ æ•°æ®å·²æ¢å¤ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥', 'warning');
                                    });
                                }

                            } catch (error) {
                                console.error('æ¢å¤å¤±è´¥:', error);
                                showMessageModal(t('errorTitle'), t('databaseRestoreFailed').replace('{error}', error.message), 'alert');
                                
                                // å¦‚æœæ¢å¤å¤±è´¥ï¼Œå°è¯•é‡æ–°åŠ è½½é¡µé¢æ•°æ®
                                try {
                                    products = JSON.parse(localStorage.getItem('products') || '[]');
                                    userOrders = JSON.parse(localStorage.getItem('userOrders') || '[]');
                                    allOrders = JSON.parse(localStorage.getItem('allOrders') || '[]');
                                    allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
                                    homepageSettings = JSON.parse(localStorage.getItem('homepageSettings') || '{}');
                                    if (typeof renderProducts === 'function') {
                                        renderProducts(products);
                                    }
                                } catch (reloadError) {
                                    console.error('é‡æ–°åŠ è½½æ•°æ®å¤±è´¥:', reloadError);
                                    showMessageModal(t('errorTitle'), t('dataRestoreFailed'), 'alert');
                                }
                            }

                            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
                            event.target.value = '';
                        });

                    } catch (error) {
                        console.error('è¯»å–å¤‡ä»½æ–‡ä»¶å¤±è´¥:', error);
                        showMessageModal(t('errorTitle'), t('readBackupFileFailed').replace('{error}', error.message), 'alert');
                        event.target.value = '';
                    }
                };

                reader.onerror = function() {
                    showMessageModal(t('errorTitle'), t('readFileFailed'), 'alert');
                    event.target.value = '';
                };

                reader.readAsText(file);
            };

            // æŠ¥åè¡¨å• - ä¿®æ”¹è¿™éƒ¨åˆ†ä»£ç 
            const signupForm = document.getElementById('signup-form');
            if (!signupForm) {
                console.error('âŒ æ‰¾ä¸åˆ°signup-formå…ƒç´ ');
            } else {
                signupForm.addEventListener('submit', function (e) {
                    e.preventDefault(); // å…ˆé˜»æ­¢é»˜è®¤æäº¤ï¼Œæ£€æŸ¥åœ°å€åå†å†³å®šæ˜¯å¦æäº¤
                    console.log('ğŸ“ æŠ¥åè¡¨å•æäº¤äº‹ä»¶è§¦å‘');
                    
                    if (!currentUser) {
                        console.warn('âš ï¸ ç”¨æˆ·æœªç™»å½•');
                        customAlert(t('pleaseLogin'), t('infoTitle')).then(() => {
                            document.getElementById('login-modal').style.display = 'flex';
                        });
                        return;
                    }
                    
                    console.log('âœ… ç”¨æˆ·å·²ç™»å½•:', currentUser.account);

                // è·å–è¡¨å•æ•°æ®
                const productName = document.getElementById('signup-product-name').value;
                const email = document.getElementById('signup-email').value;
                // ä»éšè—å­—æ®µè·å–åœ°å€ï¼ˆç”±åœ°å€é€‰æ‹©å™¨å¡«å……ï¼‰
                const addressInput = document.getElementById('signup-address-hidden');
                const address = addressInput ? addressInput.value.trim() : '';
                const notes = document.getElementById('signup-notes').value;

                // æ£€æŸ¥åœ°å€ï¼šå…ˆæ£€æŸ¥è¡¨å•ä¸­çš„åœ°å€å­—æ®µï¼Œå†æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æœ‰ä¿å­˜çš„åœ°å€
                const hasFormAddress = address && address.length > 0;
                
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æœ‰ä¿å­˜çš„åœ°å€ï¼ˆè¿‡æ»¤å½“å‰ç”¨æˆ·çš„åœ°å€ï¼‰
                const userSavedAddresses = userAddresses.filter(addr => {
                    // å¦‚æœåœ°å€æœ‰accountå­—æ®µï¼ŒåªåŒ¹é…å½“å‰ç”¨æˆ·çš„åœ°å€
                    if (addr.account !== undefined) {
                        return addr.account === currentUser.account;
                    }
                    // å…¼å®¹æ—§æ•°æ®ï¼šå¦‚æœæ²¡æœ‰accountå­—æ®µï¼Œè®¤ä¸ºæ˜¯å½“å‰ç”¨æˆ·çš„åœ°å€
                    return true;
                });
                const hasSavedAddress = userSavedAddresses && userSavedAddresses.length > 0;

                // å¦‚æœè¡¨å•ä¸­æ²¡æœ‰å¡«å†™åœ°å€ï¼Œä¸”ç”¨æˆ·ä¹Ÿæ²¡æœ‰ä¿å­˜çš„åœ°å€ï¼Œè·³è½¬åˆ°åœ°å€é¡µé¢
                if (!hasFormAddress && !hasSavedAddress) {
                    prepareReturnToSignup();
                    // å…³é—­æŠ¥åæ¨¡æ€æ¡†
                    closeModal('signup-modal');
                    
                    // æ˜¾ç¤ºç”¨æˆ·ä¸­å¿ƒå¹¶åˆ‡æ¢åˆ°åœ°å€é¡µé¢
                    showUserCenter();
                    showUserPage('address');
                    
                    // æ‰“å¼€åœ°å€æ·»åŠ æ¨¡æ€æ¡†
                    setTimeout(() => {
                        const addressModal = document.getElementById('address-modal');
                        if (addressModal) {
                            addressModal.style.display = 'flex';
                        }
                    }, 300);
                    
                    // æç¤ºç”¨æˆ·éœ€è¦å¡«å†™åœ°å€
                    showNotification(currentLanguage === 'zh' ? 'è¯·å…ˆå¡«å†™æ”¶è´§åœ°å€' : 'Please fill in your shipping address first', 'info');
                    return;
                }

                // å¦‚æœæœ‰åœ°å€ï¼ˆè¡¨å•ä¸­æœ‰æˆ–å·²ä¿å­˜ï¼‰ï¼Œç»§ç»­æäº¤æµç¨‹
                // æ£€æŸ¥currentProductæ˜¯å¦å­˜åœ¨
                if (!currentProduct) {
                    console.error('âŒ æäº¤å¤±è´¥ï¼šcurrentProductä¸ºç©º');
                    customAlert(t('systemError'), t('errorTitle'));
                    return;
                }

                // è®¾ç½®å›å¤é‚®ç®±
                document.getElementById('signup-email-input').value = email;

                // ç¡®å®šä½¿ç”¨çš„åœ°å€ï¼šä¼˜å…ˆä½¿ç”¨è¡¨å•ä¸­çš„åœ°å€ï¼Œå¦åˆ™ä½¿ç”¨ä¿å­˜çš„é»˜è®¤åœ°å€ï¼Œå†å¦åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªä¿å­˜çš„åœ°å€
                let finalAddress = '';
                let finalAddressDetail = null; // ä¿å­˜è¯¦ç»†åœ°å€ä¿¡æ¯ï¼ˆåŒ…å«è”ç³»äººï¼‰
                
                if (hasFormAddress) {
                    // å°è¯•è§£æåœ°å€JSONå¯¹è±¡
                    try {
                        const addressObj = JSON.parse(address);
                        if (addressObj && typeof addressObj === 'object' && addressObj.address) {
                            finalAddress = addressObj.address;
                            finalAddressDetail = addressObj; // ä¿å­˜è¯¦ç»†åœ°å€å¯¹è±¡ï¼ˆåŒ…å«å§“åã€ç”µè¯ï¼‰
                        } else {
                            finalAddress = address;
                        }
                    } catch (e) {
                        // å¦‚æœä¸æ˜¯JSONï¼Œç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²
                        finalAddress = address;
                    }
                } else if (hasSavedAddress) {
                    // ä¼˜å…ˆä½¿ç”¨é»˜è®¤åœ°å€
                    const defaultAddress = userSavedAddresses.find(addr => addr.isDefault === true);
                    const selectedAddr = defaultAddress || userSavedAddresses[0];
                    
                    if (selectedAddr) {
                        // æ ¼å¼åŒ–åœ°å€å­—ç¬¦ä¸²
                        if (selectedAddr.state) {
                            finalAddress = [
                                selectedAddr.detail || selectedAddr.street,
                                selectedAddr.unit,
                                selectedAddr.city,
                                selectedAddr.state,
                                selectedAddr.postal || selectedAddr.zip
                            ].filter(Boolean).join(', ');
                        } else {
                            finalAddress = [
                                selectedAddr.province || '',
                                selectedAddr.city || '',
                                selectedAddr.district || '',
                                selectedAddr.detail || selectedAddr.street || ''
                            ].filter(Boolean).join(' ');
                        }
                        
                        // ä¿å­˜è¯¦ç»†åœ°å€ä¿¡æ¯
                        finalAddressDetail = {
                            name: selectedAddr.name || '',
                            phone: selectedAddr.phone || '',
                            detail: selectedAddr.detail || selectedAddr.street || '',
                            unit: selectedAddr.unit || '',
                            city: selectedAddr.city || '',
                            state: selectedAddr.state || '',
                            postal: selectedAddr.postal || selectedAddr.zip || '',
                            country: selectedAddr.country || 'US'
                        };
                    }
                }

                // âœ… æ™®é€šç”¨æˆ·é™åˆ¶ï¼šé˜²æ­¢åŒä¸€è´¦æˆ·é‡å¤é¢†å–åŒä¸€å•†å“ + èœœç½æ¶ˆè€—
                if (!isCurrentUserAdmin()) {
                    // é˜²æ­¢åŒä¸€è´¦æˆ·é‡å¤é¢†å–åŒä¸€å•†å“
                    if (currentUser && currentUser.account && Array.isArray(userOrders)) {
                        const hasExisting = userOrders.some(o =>
                            o &&
                            o.productId === currentProduct.id &&
                            o.account === currentUser.account &&
                            o.status !== 'cancelled'
                        );
                        if (hasExisting) {
                            showNotification(t('duplicateClaimNotAllowed') || 'æ‚¨å·²ç»é¢†å–è¿‡è¯¥å•†å“ï¼Œä¸èƒ½é‡å¤é¢†å–ã€‚', 'warning');
                            return;
                        }
                    }

                    // èœœç½æ¶ˆè€—ï¼šæ¯æ¬¡æˆåŠŸé¢†å–å‰å†æ¬¡ç¡®è®¤å¹¶æ‰£é™¤ 1 ä¸ªèœœç½
                    try {
                        const user = findUserByAccount(currentUser.account);
                        const currentPoints = (user && user.points != null && !isNaN(user.points))
                            ? Number(user.points)
                            : 1;

                        if (currentPoints <= 0) {
                            showNotification(t('pointsNotEnoughForSubmit') || 'æ‚¨çš„èœœç½ä¸è¶³ï¼Œæ— æ³•å®Œæˆæœ¬æ¬¡é¢†å–ã€‚è¯·å®Œæˆè¯„ä»·ä»¥è·å–æ›´å¤šèœœç½ã€‚', 'warning');
                            return;
                        }

                        const newPoints = currentPoints - 1;
                        if (user) {
                            user.points = newPoints;
                        }
                        currentUser.points = newPoints;
                        saveAllUsers();
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));

                        const badge = document.getElementById('user-points-badge');
                        const valueEl = document.getElementById('user-points-value');
                        if (badge && valueEl) {
                            badge.style.display = 'inline-flex';
                            valueEl.textContent = newPoints;
                        }

                        showNotification(t('pointsClaimUsed') || 'âœ… æœ¬æ¬¡é¢†å–å·²æ¶ˆè€— 1 ä¸ªèœœç½', 'info');
                    } catch (err) {
                        console.warn('æ‰£å‡é¢†å–ç§¯åˆ†æ—¶å‡ºé”™:', err);
                    }
                }

                // è”ç³»äººä¿¡æ¯ä¼˜å…ˆæ¥è‡ªåœ°å€ï¼Œå…¶æ¬¡æ¥è‡ªç”¨æˆ·èµ„æ–™
                const latestUserData = findUserByAccount(currentUser.account);
                let customerName = finalAddressDetail?.name || latestUserData?.username || currentUser.username || '';
                let customerPhone = finalAddressDetail?.phone || '';
                if (!customerPhone && currentUser.account && !currentUser.account.includes('@')) {
                    customerPhone = currentUser.account;
                }

                // åˆ›å»ºæ–°è®¢å•ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
                // ä½¿ç”¨çŸ­æ ¼å¼æ—¶é—´æˆ³+éšæœºæ•°å­—ç¡®ä¿è®¢å•å·å”¯ä¸€æ€§ï¼ˆçº¯æ•°å­—æ ¼å¼ï¼Œçº¦12-14ä½ï¼‰ï¼Œé¿å…å¹¶å‘ä¸‹å•æ—¶è®¢å•å·é‡å¤
                // æ ¼å¼ï¼šæ—¶é—´æˆ³å10ä½ + 4ä½éšæœºæ•° = 14ä½æ•°å­—
                const timestamp = Date.now().toString();
                const shortTimestamp = timestamp.slice(-10); // å–æ—¶é—´æˆ³å10ä½
                const randomNum = Math.floor(Math.random() * 10000).toString().padStart(4, '0'); // 4ä½éšæœºæ•°ï¼Œä¸è¶³è¡¥0
                const orderId = parseInt(shortTimestamp + randomNum);
                const newOrder = {
                    id: orderId,
                    productId: currentProduct.id,
                    productName: productName,
                    price: currentProduct.price || 0,
                    originalPrice: currentProduct.price || 0,
                    promoPrice: currentProduct.newPrice !== undefined ? currentProduct.newPrice : 0,
                    image: currentProduct.image || '',
                    status: 'review',
                    date: Date.now(), // ä¿å­˜å®Œæ•´æ—¶é—´æˆ³ï¼Œç¡®ä¿æ—¶é—´å‡†ç¡®
                    customerInfo: { 
                        name: customerName, 
                        phone: customerPhone, 
                        email, 
                        address: finalAddress, // å®Œæ•´åœ°å€å­—ç¬¦ä¸²ï¼ˆå…¼å®¹æ—§ä»£ç ï¼‰
                        // è¯¦ç»†åœ°å€å­—æ®µ
                        addressDetail: finalAddressDetail?.detail || '',
                        addressUnit: finalAddressDetail?.unit || '',
                        addressCity: finalAddressDetail?.city || '',
                        addressState: finalAddressDetail?.state || '',
                        addressPostal: finalAddressDetail?.postal || '',
                        addressCountry: finalAddressDetail?.country || 'US',
                        // å…¼å®¹æ—§å­—æ®µå
                        detail: finalAddressDetail?.detail || '',
                        unit: finalAddressDetail?.unit || '',
                        city: finalAddressDetail?.city || '',
                        state: finalAddressDetail?.state || '',
                        postal: finalAddressDetail?.postal || '',
                        notes 
                    },
                    account: currentUser ? currentUser.account : null // æ·»åŠ ç”¨æˆ·æ ‡è¯†
                };

                userOrders.push(newOrder);
                saveUserOrders();

                // å‘é€ç»™å®¢æœï¼ˆå¦‚æœaddMessageå‡½æ•°å­˜åœ¨ï¼‰
                try {
                    const customerMessage = `æ–°çš„äº§å“æŠ¥åï¼š\näº§å“ï¼š${productName}\nå§“åï¼š${customerName}\nç”µè¯ï¼š${customerPhone}\né‚®ç®±ï¼š${email}\nåœ°å€ï¼š${newOrder.customerInfo.address}\nå¤‡æ³¨ï¼š${notes}`;
                    if (typeof addMessage === 'function') {
                        addMessage(customerMessage, 'service');
                    }
                } catch (err) {
                    console.warn('å‘é€å®¢æœæ¶ˆæ¯å¤±è´¥ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰:', err);
                }

                // æäº¤åˆ°Formspreeï¼ˆå¦‚æœéœ€è¦ï¼‰
                // æ³¨æ„ï¼šç”±äºæˆ‘ä»¬é˜»æ­¢äº†é»˜è®¤æäº¤ï¼Œè¿™é‡Œéœ€è¦æ‰‹åŠ¨æäº¤æˆ–ä½¿ç”¨fetch
                // å¦‚æœä¸éœ€è¦Formspreeæäº¤ï¼Œå¯ä»¥æ³¨é‡Šæ‰ä¸‹é¢çš„ä»£ç 
                const form = document.getElementById('signup-form');
                if (form && form.action) {
                    try {
                        // ä½¿ç”¨no-corsæ¨¡å¼é¿å…CORSé”™è¯¯ï¼ŒFormspreeä¼šå¤„ç†æäº¤
                        const formData = new FormData(form);
                        fetch(form.action, {
                            method: 'POST',
                            mode: 'no-cors', // ä½¿ç”¨no-corsæ¨¡å¼é¿å…CORSé”™è¯¯
                            body: formData
                        }).catch(err => {
                            // é™é»˜å¤„ç†é”™è¯¯ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ
                            console.log('Formspreeæäº¤ï¼ˆåå°å¤„ç†ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰');
                        });
                    } catch (err) {
                        // é™é»˜å¤„ç†é”™è¯¯
                        console.log('Formspreeæäº¤ï¼ˆåå°å¤„ç†ï¼‰');
                    }
                }

                // æ¸…ç©ºè¡¨å•
                console.log('âœ… è®¢å•åˆ›å»ºæˆåŠŸï¼Œå‡†å¤‡å…³é—­æ¨¡æ€æ¡†');
                setTimeout(() => {
                    try {
                        document.getElementById('signup-form').reset();
                        closeModal('signup-modal');
                        
                        // æ˜¾ç¤ºWhatsAppæç¤ºæ¨¡æ€æ¡†ï¼Œä¼ é€’è®¢å•å·
                        if (typeof showWhatsAppModal === 'function') {
                            showWhatsAppModal(newOrder.id);
                        } else {
                            console.warn('âš ï¸ showWhatsAppModalå‡½æ•°ä¸å­˜åœ¨');
                        }

                        // æ›´æ–°ç”¨æˆ·ä¸­å¿ƒè®¢å•
                        const userCenter = document.getElementById('user-center');
                        if (userCenter && userCenter.style.display === 'block') {
                            renderUserOrders();
                        }
                        
                        // é‡æ–°æ¸²æŸ“äº§å“åˆ—è¡¨ä»¥æ›´æ–°æŒ‰é’®çŠ¶æ€
                        if (typeof renderProducts === 'function' && Array.isArray(products)) {
                            renderProducts(products);
                        }
                        
                        console.log('âœ… æŠ¥åæµç¨‹å®Œæˆ');
                    } catch (err) {
                        console.error('âŒ å…³é—­æ¨¡æ€æ¡†æ—¶å‡ºé”™:', err);
                    }
                }, 100);
                });
            }

            // ç”¨æˆ·ä¸­å¿ƒèœå•åˆ‡æ¢
            const userMenuItems = document.querySelectorAll('.user-menu a');
            userMenuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // ç¡®ä¿ä¾§è¾¹æ æ˜¾ç¤ºï¼ˆä»"æˆ‘çš„æŠ¥å"è¿”å›æ—¶ï¼‰
                    const userSidebar = document.querySelector('.user-sidebar');
                    const userCenter = document.getElementById('user-center');
                    if (userSidebar) {
                        userSidebar.style.display = 'block';
                    }
                    if (userCenter) {
                        userCenter.classList.remove('sidebar-hidden');
                    }

                    // æ›´æ–°èœå•çŠ¶æ€
                    userMenuItems.forEach(menu => menu.classList.remove('active'));
                    item.classList.add('active');

                    // åˆ‡æ¢é¡µé¢
                    const tab = item.getAttribute('data-tab');
                    showUserPage(tab);
                });
            });

            // ç”¨æˆ·ä¸­å¿ƒè®¢å•æ ‡ç­¾åˆ‡æ¢
            const orderTabs = document.querySelectorAll('.order-tab');
            orderTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    orderTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const status = tab.getAttribute('data-status');
                    document.querySelectorAll('.order-list').forEach(list => {
                        list.classList.remove('active');
                    });
                    document.getElementById(`order-${status}`).classList.add('active');
                });
            });

            // ç”¨æˆ·ç®¡ç†ç­›é€‰æ§ä»¶
            const userRoleFilterEl = document.getElementById('user-role-filter');
            if (userRoleFilterEl) {
                userRoleFilterEl.addEventListener('change', (e) => {
                    userFilterRole = e.target.value;
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const userStatusFilterEl = document.getElementById('user-status-filter');
            if (userStatusFilterEl) {
                userStatusFilterEl.addEventListener('change', (e) => {
                    userFilterStatus = e.target.value;
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const userOnlineFilterEl = document.getElementById('user-online-filter');
            if (userOnlineFilterEl) {
                userOnlineFilterEl.addEventListener('change', (e) => {
                    userFilterOnline = e.target.value;
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const userDeviceFilterEl = document.getElementById('user-device-filter');
            if (userDeviceFilterEl) {
                userDeviceFilterEl.addEventListener('input', (e) => {
                    userDeviceFilter = e.target.value.trim();
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const userSearchInputEl = document.getElementById('user-search-input');
            if (userSearchInputEl) {
                userSearchInputEl.addEventListener('input', (e) => {
                    userSearchTerm = e.target.value.trim();
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const userRegisterDateStartEl = document.getElementById('user-register-date-start');
            if (userRegisterDateStartEl) {
                userRegisterDateStartEl.addEventListener('change', (e) => {
                    userFilterRegisterDateStart = e.target.value;
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const userRegisterDateEndEl = document.getElementById('user-register-date-end');
            if (userRegisterDateEndEl) {
                userRegisterDateEndEl.addEventListener('change', (e) => {
                    userFilterRegisterDateEnd = e.target.value;
                    resetPagination('users');
                    renderUsersTable();
                });
            }

            const orderRegisterDateStartEl = document.getElementById('order-register-date-start');
            if (orderRegisterDateStartEl) {
                orderRegisterDateStartEl.addEventListener('change', (e) => {
                    orderFilterRegisterDateStart = e.target.value;
                    resetPagination('orders');
                    renderOrdersTable();
                });
            }

            const orderRegisterDateEndEl = document.getElementById('order-register-date-end');
            if (orderRegisterDateEndEl) {
                orderRegisterDateEndEl.addEventListener('change', (e) => {
                    orderFilterRegisterDateEnd = e.target.value;
                    resetPagination('orders');
                    renderOrdersTable();
                });
            }

            const adminProductSearchInput = document.getElementById('admin-product-search');
            if (adminProductSearchInput) {
                const handleProductSearch = debounce((value) => {
                    adminProductSearchTerm = value.trim().toLowerCase();
                    resetPagination('products');
                    renderAdminProducts();
                }, 300);

                adminProductSearchInput.addEventListener('input', (e) => {
                    handleProductSearch(e.target.value);
                });
            }

            // è¯„ä»·æœç´¢ä¸åˆ†ç±»ç­›é€‰
            const reviewsSearchInput = document.getElementById('reviews-search-input');
            const reviewsFilterCategory = document.getElementById('reviews-filter-category');
            if (reviewsSearchInput) {
                const handleReviewSearch = debounce((value) => {
                    reviewSearchTerm = value;
                    resetPagination('reviews');
                    renderReviewsTable();
                }, 300);

                reviewsSearchInput.addEventListener('input', (e) => {
                    handleReviewSearch(e.target.value);
                });
            }
            if (reviewsFilterCategory) {
                reviewsFilterCategory.addEventListener('change', (e) => {
                    reviewSearchCategory = e.target.value || 'all';
                    resetPagination('reviews');
                    renderReviewsTable();
                });
            }

            // Excelä¸Šä¼ åŠŸèƒ½
            const excelUploadArea = document.getElementById('excel-upload-area');
            const excelFileInput = document.getElementById('excel-file');

            excelUploadArea.addEventListener('click', () => {
                excelFileInput.click();
            });

            excelUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                excelUploadArea.style.borderColor = 'var(--primary)';
                excelUploadArea.style.background = '#f8f9fa';
            });

            excelUploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                excelUploadArea.style.borderColor = '#ddd';
                excelUploadArea.style.background = 'white';
            });

            excelUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                excelUploadArea.style.borderColor = '#ddd';
                excelUploadArea.style.background = 'white';

                const files = e.dataTransfer.files;
                if (files.length > 0 && (files[0].name.endsWith('.xlsx') || files[0].name.endsWith('.xls'))) {
                    // FileList ä¸ºåªè¯»ï¼Œä¸å†å¼ºè¡Œèµ‹å€¼ç»™ input
                    handleExcelFile(files[0]);
                }
            });

            excelFileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleExcelFile(e.target.files[0]);
                }
            });

            // æ·»åŠ äº§å“æŒ‰é’®
            document.getElementById('add-product-btn').addEventListener('click', safeButtonClick('add-product-btn', () => {
                console.log('ğŸ”· ç‚¹å‡»æ·»åŠ äº§å“æŒ‰é’®ï¼Œå½“å‰äº§å“æ•°é‡:', products.length);
                openProductEditModal(null);
            }, 300));

            // æ‰¹é‡æ“ä½œæŒ‰é’®
            const selectAllProductsCheckbox = document.getElementById('select-all-products');
            if (selectAllProductsCheckbox) {
                selectAllProductsCheckbox.addEventListener('change', toggleSelectAllProducts);
            }

            const batchEditBtn = document.getElementById('batch-edit-btn');
            if (batchEditBtn) {
                batchEditBtn.addEventListener('click', safeButtonClick('batch-edit-btn', openBatchEditModal, 300));
            }

            const batchPublishBtn = document.getElementById('batch-publish-btn');
            if (batchPublishBtn) {
                batchPublishBtn.addEventListener('click', safeButtonClick('batch-publish-btn', batchPublishProducts, 300));
            }

            const batchHideBtn = document.getElementById('batch-hide-btn');
            if (batchHideBtn) {
                batchHideBtn.addEventListener('click', safeButtonClick('batch-hide-btn', batchHideProducts, 300));
            }

            const batchDeleteBtn = document.getElementById('batch-delete-btn');
            if (batchDeleteBtn) {
                batchDeleteBtn.addEventListener('click', safeButtonClick('batch-delete-btn', batchDeleteProducts, 300));
            }

            // æ‰¹é‡ç¼–è¾‘è¡¨å•
            const batchEditForm = document.getElementById('batch-edit-form');
            if (batchEditForm) {
                batchEditForm.addEventListener('submit', applyBatchEdit);

                // ä»·æ ¼æ“ä½œä¸‹æ‹‰æ¡†å˜åŒ–
                document.getElementById('batch-edit-price-action').addEventListener('change', function () {
                    const valueGroup = document.getElementById('batch-price-value-group');
                    valueGroup.style.display = this.value ? 'block' : 'none';
                });

                // åº“å­˜æ“ä½œä¸‹æ‹‰æ¡†å˜åŒ–
                document.getElementById('batch-edit-stock-action').addEventListener('change', function () {
                    const valueGroup = document.getElementById('batch-stock-value-group');
                    valueGroup.style.display = this.value ? 'block' : 'none';
                });
            }

            // åå°ç®¡ç†å¯¼èˆªåˆ‡æ¢ - ç«‹å³å“åº”ï¼Œæ— é˜²æŠ–
            const adminNavBtns = document.querySelectorAll('.admin-nav-btn');
            let currentTab = (document.querySelector('.admin-nav-btn.active') || {}).dataset?.tab || null;
            adminNavBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    if (!tab) return;

                    // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰å·²æ¿€æ´»çš„æ ‡ç­¾ï¼Œç›´æ¥è¿”å›
                    if (currentTab === tab && btn.classList.contains('active')) {
                        return;
                    }

                    // ç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€
                    adminNavBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTab = tab;

                    // ç«‹å³åˆ‡æ¢é¡µé¢æ˜¾ç¤º
                    showAdminPage(tab);
                });
            });

            // åå°ç®¡ç†æŒ‰é’®äº‹ä»¶
            document.getElementById('refresh-users-btn').addEventListener('click', safeButtonClick('refresh-users-btn', async () => {
                await showButtonFeedback('refresh-users-btn', async () => {
                    // æ›´æ–°ç”¨æˆ·åœ¨çº¿çŠ¶æ€
                    await updateAllUsersOnlineStatus();
                    renderUsersTable();
                });
            }, 300));

            document.getElementById('export-users-btn').addEventListener('click', safeButtonClick('export-users-btn', () => {
                showButtonFeedback('export-users-btn', () => {
                    exportUsersData();
                });
            }, 300));

            const deleteSelectedUsersBtn = document.getElementById('delete-selected-users-btn');
            if (deleteSelectedUsersBtn) {
                deleteSelectedUsersBtn.addEventListener('click', safeButtonClick('delete-selected-users-btn', deleteSelectedUsers, 300));
            }

            // è®¾å¤‡æ³¨å†Œé™åˆ¶ç®¡ç†äº‹ä»¶
            const setDeviceLimitBtn = document.getElementById('set-device-limit-btn');
            if (setDeviceLimitBtn) {
                setDeviceLimitBtn.addEventListener('click', safeButtonClick('set-device-limit-btn', () => {
                    const deviceId = document.getElementById('device-limit-device-input').value.trim();
                    const limitValue = parseInt(document.getElementById('device-limit-value-input').value);
                    
                    if (!deviceId) {
                        showMessageModal('é”™è¯¯', 'è¯·è¾“å…¥è®¾å¤‡ID', 'alert');
                        return;
                    }
                    
                    if (isNaN(limitValue) || limitValue < 0 || limitValue > 100) {
                        showMessageModal('é”™è¯¯', 'è¯·è¾“å…¥æœ‰æ•ˆçš„é™åˆ¶æ•°é‡ï¼ˆ0-100ï¼‰', 'alert');
                        return;
                    }
                    
                    deviceRegisterLimits[deviceId] = limitValue;
                    saveDeviceRegisterLimits();
                    showMessageModal('æˆåŠŸ', `è®¾å¤‡ ${deviceId} çš„æ³¨å†Œé™åˆ¶å·²è®¾ç½®ä¸º ${limitValue}`, 'success');
                    document.getElementById('device-limit-device-input').value = '';
                    updateDeviceLimitsList();
                }, 300));
            }

            const viewDeviceLimitsBtn = document.getElementById('view-device-limits-btn');
            if (viewDeviceLimitsBtn) {
                viewDeviceLimitsBtn.addEventListener('click', safeButtonClick('view-device-limits-btn', () => {
                    const listDiv = document.getElementById('device-limits-list');
                    if (listDiv.style.display === 'none') {
                        updateDeviceLimitsList();
                        listDiv.style.display = 'block';
                    } else {
                        listDiv.style.display = 'none';
                    }
                }, 200));
            }

            const resetDeviceLimitBtn = document.getElementById('reset-device-limit-btn');
            if (resetDeviceLimitBtn) {
                resetDeviceLimitBtn.addEventListener('click', safeButtonClick('reset-device-limit-btn', () => {
                    const deviceId = document.getElementById('device-limit-device-input').value.trim();
                    if (!deviceId) {
                        showMessageModal('é”™è¯¯', 'è¯·è¾“å…¥è¦é‡ç½®çš„è®¾å¤‡ID', 'alert');
                        return;
                    }
                    
                    if (deviceRegisterLimits[deviceId] !== undefined) {
                        delete deviceRegisterLimits[deviceId];
                        saveDeviceRegisterLimits();
                        showMessageModal('æˆåŠŸ', `è®¾å¤‡ ${deviceId} çš„æ³¨å†Œé™åˆ¶å·²é‡ç½®ä¸ºé»˜è®¤å€¼(${DEFAULT_DEVICE_REGISTER_LIMIT})`, 'success');
                        document.getElementById('device-limit-device-input').value = '';
                        updateDeviceLimitsList();
                    } else {
                        showMessageModal('æç¤º', `è®¾å¤‡ ${deviceId} æœªè®¾ç½®è‡ªå®šä¹‰é™åˆ¶ï¼Œå·²ä½¿ç”¨é»˜è®¤å€¼`, 'info');
                    }
                }, 300));
            }

            const clearCloudUsersBtn = document.getElementById('clear-cloud-users-btn');
            if (clearCloudUsersBtn) {
                clearCloudUsersBtn.addEventListener('click', safeButtonClick('clear-cloud-users-btn', async () => {
                    try {
                        if (!cloudSync || !cloudSync.isInitialized) {
                            showMessageModal(t('errorTitle'), t('cloudSyncNotEnabledError'), 'alert');
                            return;
                        }

                        if (!isCurrentUserAdmin()) {
                            showMessageModal(t('errorTitle'), t('onlyAdminCanOperate'), 'alert');
                            return;
                        }

                        const confirmed = await customConfirm(
                            'æ­¤æ“ä½œå°†æ¸…ç†äº‘ç«¯ users èŠ‚ç‚¹ï¼šä»…åˆ é™¤é‚£äº›ä¸åœ¨ allUsers åˆ—è¡¨ä¸­çš„è´¦å·æ•°æ®ã€‚\n\nâ€¢ allUsers ä¸ä¼šè¢«ä¿®æ”¹\nâ€¢ æœ¬åœ°ç”¨æˆ·åˆ—è¡¨ä¸å˜\n\næ˜¯å¦ç»§ç»­ï¼Ÿ',
                            'å±é™©æ“ä½œç¡®è®¤'
                        );
                        if (!confirmed) {
                            return;
                        }

                        // æŒ‰é’®ç¦ç”¨ä¸çŠ¶æ€åé¦ˆ
                        clearCloudUsersBtn.disabled = true;
                        const originalText = clearCloudUsersBtn.textContent;
                        clearCloudUsersBtn.textContent = 'æ­£åœ¨æ¸…ç†äº‘ç«¯ users...';

                        try {
                            const result = await cloudSync.clearCloudUsers();
                            if (result && result.skipped) {
                                showMessageModal(t('infoTitle'), t('cloudAllUsersEmpty'), 'alert');
                            } else {
                                const removed = result?.removed || 0;
                                showNotification(`å·²æ¸…ç† usersï¼šåˆ é™¤ ${removed} ä¸ªè´¦å·ï¼ˆä»…åˆ é™¤ä¸åœ¨ allUsers çš„è´¦å·ï¼‰`, 'success');
                            }
                        } catch (err) {
                            console.error('æ¸…ç†äº‘ç«¯ users å¤±è´¥:', err);
                            showMessageModal(t('errorTitle'), t('clearCloudUsersFailed').replace('{error}', err.message || err), 'alert');
                        } finally {
                            clearCloudUsersBtn.disabled = false;
                            clearCloudUsersBtn.textContent = originalText;
                        }
                    } catch (e) {
                        console.error('å¤„ç†æ¸…ç©ºäº‘ç«¯ç”¨æˆ·æŒ‰é’®ç‚¹å‡»æ—¶å‡ºé”™:', e);
                    }
                }, 300));
            }

            const selectAllUsersCheckbox = document.getElementById('select-all-users');
            if (selectAllUsersCheckbox) {
                selectAllUsersCheckbox.addEventListener('change', () => {
                    const shouldCheck = selectAllUsersCheckbox.checked;
                    document.querySelectorAll('.user-select-checkbox').forEach(cb => {
                        cb.checked = shouldCheck;
                        const account = cb.getAttribute('data-account');
                        if (shouldCheck) {
                            selectedUserAccounts.add(account);
                        } else {
                            selectedUserAccounts.delete(account);
                        }
                    });
                    refreshUserSelectionUI();
                });
            }

            document.getElementById('refresh-orders-btn').addEventListener('click', safeButtonClick('refresh-orders-btn', () => {
                showButtonFeedback('refresh-orders-btn', () => {
                    renderOrdersTable();
                });
            }, 300));

            document.getElementById('export-orders-btn').addEventListener('click', safeButtonClick('export-orders-btn', () => {
                showButtonFeedback('export-orders-btn', () => {
                    exportOrdersData();
                });
            }, 300));

            // ä¸Šä¼ è®¢å•æ•°æ®æ–‡ä»¶
            document.getElementById('upload-orders-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!file.name.match(/\.(xlsx|xls)$/i)) {
                    showNotification('è¯·é€‰æ‹©Excelæ–‡ä»¶ï¼ˆ.xlsxæˆ–.xlsæ ¼å¼ï¼‰', 'error');
                    e.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                    return;
                }

                // è¯»å–æ–‡ä»¶
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        // è¯»å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        
                        // è½¬æ¢ä¸ºJSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        if (jsonData.length === 0) {
                            showNotification('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®', 'warning');
                            return;
                        }

                        // æ‰¹é‡æ›´æ–°è®¢å•
                        importOrdersData(jsonData);
                    } catch (error) {
                        console.error('è¯»å–Excelæ–‡ä»¶å¤±è´¥:', error);
                        showNotification('è¯»å–Excelæ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
                    } finally {
                        // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©ï¼Œå…è®¸é‡å¤ä¸Šä¼ åŒä¸€æ–‡ä»¶
                        e.target.value = '';
                    }
                };
                reader.onerror = function() {
                    showNotification('è¯»å–æ–‡ä»¶å¤±è´¥', 'error');
                    e.target.value = '';
                };
                reader.readAsArrayBuffer(file);
            });

            const deleteSelectedOrdersBtn = document.getElementById('delete-selected-orders-btn');
            if (deleteSelectedOrdersBtn) {
                deleteSelectedOrdersBtn.addEventListener('click', safeButtonClick('delete-selected-orders-btn', deleteSelectedOrders, 300));
            }

            const selectAllOrdersCheckbox = document.getElementById('select-all-orders');
            if (selectAllOrdersCheckbox) {
                selectAllOrdersCheckbox.addEventListener('change', () => {
                    const shouldCheck = selectAllOrdersCheckbox.checked;
                    document.querySelectorAll('.order-select-checkbox').forEach(cb => {
                        cb.checked = shouldCheck;
                        const id = cb.getAttribute('data-order-id');
                        if (shouldCheck) {
                            selectedOrderIds.add(id);
                        } else {
                            selectedOrderIds.delete(id);
                        }
                    });
                    refreshOrderSelectionUI();
                });
            }

            // ä¸»é¡µç®¡ç†æŒ‰é’®äº‹ä»¶
            document.getElementById('preview-homepage-btn').addEventListener('click', safeButtonClick('preview-homepage-btn', () => {
                showHomePage();
                showNotification('å·²åˆ‡æ¢åˆ°ä¸»é¡µé¢„è§ˆ', 'info');
            }, 300));

            document.getElementById('reset-homepage-btn').addEventListener('click', safeButtonClick('reset-homepage-btn', () => {
                resetHomepageSettings();
            }, 300));

            document.getElementById('save-homepage-btn').addEventListener('click', safeButtonClick('save-homepage-btn', () => {
                saveHomepageSettings();
            }, 300));

            const addDesktopCarouselBtn = document.getElementById('add-carousel-btn-desktop');
            if (addDesktopCarouselBtn) {
                addDesktopCarouselBtn.addEventListener('click', safeButtonClick('add-carousel-btn-desktop', () => addCarouselItem('desktop'), 300));
            }

            const addMobileCarouselBtn = document.getElementById('add-carousel-btn-mobile');
            if (addMobileCarouselBtn) {
                addMobileCarouselBtn.addEventListener('click', safeButtonClick('add-carousel-btn-mobile', () => addCarouselItem('mobile'), 300));
            }

            const carouselTabs = document.querySelectorAll('.carousel-tab');
            const carouselPanels = document.querySelectorAll('.carousel-panel');
            carouselTabs.forEach(tab => {
                const tabId = tab.id || `carousel-tab-${tab.getAttribute('data-carousel-tab')}`;
                tab.addEventListener('click', safeButtonClick(tabId, () => {
                    const target = tab.getAttribute('data-carousel-tab');
                    carouselTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    carouselPanels.forEach(panel => {
                        if (panel.getAttribute('data-carousel-panel') === target) {
                            panel.classList.add('active');
                        } else {
                            panel.classList.remove('active');
                        }
                    });
                    renderCarouselList(target);
                }, 200));
            });

            // è®¢å•ç­›é€‰
            document.getElementById('order-status-filter').addEventListener('change', () => {
                resetPagination('orders');
                renderOrdersTable();
            });

            document.getElementById('order-search').addEventListener('input', debounce(() => {
                resetPagination('orders');
                renderOrdersTable();
            }, 300));

            const orderSearchField = document.getElementById('order-search-field');
            if (orderSearchField) {
                orderSearchField.addEventListener('change', () => {
                    resetPagination('orders');
                    renderOrdersTable();
                });
            }

            // åœ°å€ç®¡ç†åŠŸèƒ½
            const addAddressBtn = document.getElementById('add-address-btn');
            const addressModal = document.getElementById('address-modal');
            const addressForm = document.getElementById('address-form');
            const cancelAddressBtn = document.getElementById('cancel-address');

            if (addAddressBtn) {
                addAddressBtn.addEventListener('click', safeButtonClick('add-address-btn', () => {
                    openAddressModal();
                }, 300));
            }

            if (cancelAddressBtn) {
                cancelAddressBtn.addEventListener('click', safeButtonClick('cancel-address', () => {
                    closeModal('address-modal');
                }, 200));
            }

            if (addressForm && !addressForm._submitHandler) {
                addressForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // é˜²æ­¢é‡å¤æäº¤
                    if (addressForm._submitting) {
                        console.warn('è¡¨å•æ­£åœ¨æäº¤ä¸­ï¼Œå¿½ç•¥é‡å¤æäº¤');
                        return;
                    }
                    addressForm._submitting = true;
                    saveAddress();
                    // æäº¤å®Œæˆåé‡ç½®æ ‡å¿—
                    setTimeout(() => {
                        addressForm._submitting = false;
                    }, 1000);
                });
                addressForm._submitHandler = true;
            }

            // ä¸ªäººä¿¡æ¯è¡¨å•
            const profileForm = document.getElementById('profile-form');
            if (profileForm) {
                profileForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    saveProfile();
                });
            }

            // ä¿®æ”¹å¯†ç è¡¨å•
            const changePasswordForm = document.getElementById('change-password-form');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    changePassword();
                });
            }

            // ç¡®ä¿ç¼–è¾‘æ¨¡æ€æ¡†ä¹Ÿèƒ½å…³é—­
            const editModal = document.getElementById('edit-product-modal');
            if (editModal) {
                const closeBtn = editModal.querySelector('.close-modal');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        editModal.style.display = 'none';
                    });
                }
            }

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­ï¼ˆåºŸå¼ƒçš„é‡å¤ç»‘å®šå·²ç§»é™¤ï¼Œç»Ÿä¸€åœ¨åº•éƒ¨ï¼‰
            // ç¼–è¾‘æ¨¡æ€æ¡†å–æ¶ˆæŒ‰é’®
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', function () {
                    closeModal('edit-product-modal');
                });
            }

            // ç¼–è¾‘æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
            const editModalClose = document.querySelector('#edit-product-modal .close-modal');
            if (editModalClose) {
                editModalClose.addEventListener('click', function () {
                    closeModal('edit-product-modal');
                });
            }


            // ç»‘å®šä¸€æ¬¡æ€§ç¼–è¾‘è¡¨å•æäº¤äº‹ä»¶ï¼Œé¿å…é‡å¤ç»‘å®š
            const editForm = document.getElementById('edit-product-form');
            if (editForm) {
                editForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const productId = parseInt(document.getElementById('edit-product-id').value);
                    const targetProduct = products.find(p => p.id === productId);
                    if (!targetProduct) {
                        customAlert(t('productNotFound'), t('errorTitle'));
                        return;
                    }

                    const editImageInputs = Array.from(document.querySelectorAll('.edit-product-image-url'));
                    const editImageUrls = editImageInputs
                        .map(input => input.value.trim())
                        .filter(url => !!url)
                        .slice(0, 6);
                    const redirectUrl = (document.getElementById('edit-product-link')?.value || '').trim();
                    const amazonReviewUrl = (document.getElementById('edit-product-amazon-review-link')?.value || '').trim();

                    if (editImageUrls.length === 0) {
                        customAlert(t('pleaseEnterAtLeastOneImage'), t('errorTitle'));
                        return;
                    }

                    const updatedProduct = {
                        id: productId,
                        name: document.getElementById('edit-product-name').value.trim(),
                        price: parseFloat(document.getElementById('edit-product-price').value),
                        newPrice: parseFloat(document.getElementById('edit-product-new-price').value) || 0,
                        stock: parseInt(document.getElementById('edit-product-stock').value),
                        category: document.getElementById('edit-product-category').value,
                        image: editImageUrls[0],
                        imageUrls: editImageUrls,
                        description: document.getElementById('edit-product-description').value.trim(),
                        redirectUrl,
                        // å¯é€‰ï¼šç”¨äºåœ¨è¯„è®ºä¸º 5 æ˜Ÿæ—¶å¼•å¯¼ç”¨æˆ·å»äºšé©¬é€Šæ’°å†™è¯„è®ºçš„è‡ªå®šä¹‰é“¾æ¥
                        amazonReviewUrl
                    };

                    for (let i = 1; i <= 6; i++) {
                        updatedProduct[`imageUrl${i}`] = editImageUrls[i - 1] || '';
                    }

                    if (!updatedProduct.name) { customAlert(t('productNameRequired'), t('errorTitle')); return; }
                    if (!(updatedProduct.price > 0)) { customAlert(t('productPriceRequired'), t('errorTitle')); return; }
                    if (updatedProduct.stock < 0) { customAlert(t('stock') + ' ' + t('cannotBeNegative'), t('errorTitle')); return; }
                    if (!updatedProduct.image) { customAlert(t('productImageRequired'), t('errorTitle')); return; }

                    const productIndex = products.findIndex(p => p.id === productId);
                    if (productIndex !== -1) {
                        products[productIndex] = { ...products[productIndex], ...updatedProduct };
                        
                        // ä¿å­˜åˆ°æœ¬åœ°å¹¶åŒæ­¥åˆ°äº‘ç«¯ï¼ˆç­‰å¾…å®Œæˆï¼‰
                        saveProducts().then(() => {
                            console.log('âœ… äº§å“æ•°æ®ï¼ˆåŒ…æ‹¬newPriceï¼‰å·²ä¿å­˜å¹¶åŒæ­¥åˆ°äº‘ç«¯');
                            customAlert(t('productUpdateSuccess'), 'æˆåŠŸ');
                            closeModal('edit-product-modal');
                            if (document.getElementById('admin-panel').style.display !== 'none') {
                                renderAdminProducts();
                            }
                            if (document.getElementById('home-page').style.display !== 'none') {
                                renderProducts(products);
                            }
                        }).catch(err => {
                            console.warn('âš ï¸ äº§å“æ•°æ®ä¿å­˜æˆ–åŒæ­¥å¤±è´¥:', err);
                            customAlert(t('productUpdateSuccess'), 'æˆåŠŸ'); // å³ä½¿åŒæ­¥å¤±è´¥ï¼Œæœ¬åœ°å·²ä¿å­˜ï¼Œä»æ˜¾ç¤ºæˆåŠŸ
                            closeModal('edit-product-modal');
                            if (document.getElementById('admin-panel').style.display !== 'none') {
                                renderAdminProducts();
                            }
                            if (document.getElementById('home-page').style.display !== 'none') {
                                renderProducts(products);
                            }
                        });
                    } else {
                        customAlert(t('productUpdateFailed'), 'é”™è¯¯');
                    }
                });
            }
            }
        });

        // æ˜¾ç¤ºåŒæ­¥çŠ¶æ€å¯¹è¯æ¡†
        function showSyncStatusDialog() {
            // æ£€æŸ¥ Firebase SDK å’Œ CloudSync çŠ¶æ€
            const sdkLoaded = typeof firebase !== 'undefined';
            const syncInitialized = cloudSync && cloudSync.isInitialized;

            let dialogHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 10000; display: flex; align-items: center; justify-content: center;" id="sync-dialog">
                    <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 22px;">
                            <i class="fas fa-cloud"></i> äº‘ç«¯åŒæ­¥çŠ¶æ€
                        </h3>
            `;

            if (!sdkLoaded) {
                dialogHTML += `
                    <div style="padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #856404;">
                            <i class="fas fa-exclamation-triangle"></i> Firebase SDK æœªåŠ è½½
                        </h4>
                        <p style="margin: 0; color: #856404; line-height: 1.6;">
                            Firebase SDK æ— æ³•ä»CDNåŠ è½½ã€‚è¿™å¯èƒ½æ˜¯ç”±äºç½‘ç»œé—®é¢˜æˆ–é˜²ç«å¢™é™åˆ¶ã€‚
                            <br><br>
                            <strong>å½“å‰æ¨¡å¼ï¼š</strong> æœ¬åœ°å­˜å‚¨æ¨¡å¼<br>
                            <strong>å½±å“ï¼š</strong> æ•°æ®ä»…ä¿å­˜åœ¨å½“å‰è®¾å¤‡ï¼Œæ— æ³•è·¨è®¾å¤‡åŒæ­¥
                        </p>
                    </div>
                    <div style="padding: 15px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 4px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #0d47a1;">
                            <i class="fas fa-lightbulb"></i> è§£å†³æ–¹æ³•
                        </h4>
                        <ol style="margin: 0; padding-left: 20px; color: #0d47a1; line-height: 1.8;">
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>
                            <li>å°è¯•å…³é—­å¹¿å‘Šæ‹¦æˆªå™¨æˆ–é˜²ç«å¢™</li>
                            <li>è¿è¡Œè¯Šæ–­å·¥å…·ï¼š<code>firebase-diagnostic.html</code></li>
                            <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                        </ol>
                    </div>
                `;
            } else if (!syncInitialized) {
                dialogHTML += `
                    <div style="padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #856404;">
                            <i class="fas fa-exclamation-triangle"></i> äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–
                        </h4>
                        <p style="margin: 0; color: #856404; line-height: 1.6;">
                            Firebase SDK å·²åŠ è½½ï¼Œä½†äº‘ç«¯åŒæ­¥æœåŠ¡åˆå§‹åŒ–å¤±è´¥ã€‚
                            <br><br>
                            <strong>å¯èƒ½åŸå› ï¼š</strong><br>
                            â€¢ Firebase é…ç½®ä¸æ­£ç¡®<br>
                            â€¢ Firebase æ•°æ®åº“æœªåˆ›å»º<br>
                            â€¢ æ•°æ®åº“æƒé™è®¾ç½®æœ‰è¯¯<br>
                            <br>
                            <strong>å½“å‰æ¨¡å¼ï¼š</strong> æœ¬åœ°å­˜å‚¨æ¨¡å¼
                        </p>
                    </div>
                    <div style="padding: 15px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 4px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #0d47a1;">
                            <i class="fas fa-cog"></i> é…ç½®æ­¥éª¤
                        </h4>
                        <p style="margin: 0; color: #0d47a1; line-height: 1.8;">
                            1. è®¿é—® <a href="https://console.firebase.google.com/" target="_blank" style="color: #2196F3;">Firebase æ§åˆ¶å°</a><br>
                            2. åˆ›å»ºé¡¹ç›®å¹¶å¯ç”¨ Realtime Database<br>
                            3. è®¾ç½®æ•°æ®åº“è§„åˆ™ä¸ºæµ‹è¯•æ¨¡å¼ï¼ˆå…è®¸è¯»å†™ï¼‰<br>
                            4. æ›´æ–° main.html ä¸­çš„ Firebase é…ç½®<br>
                            <br>
                            è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ <code>FIREBASE_SETUP.md</code>
                        </p>
                    </div>
                `;
            } else {
                dialogHTML += `
                    <div style="padding: 20px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 4px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #155724;">
                            <i class="fas fa-check-circle"></i> äº‘ç«¯åŒæ­¥å·²å¯ç”¨
                        </h4>
                        <p style="margin: 0; color: #155724; line-height: 1.6;">
                            <strong>çŠ¶æ€ï¼š</strong> æ­£å¸¸è¿è¡Œ<br>
                            <strong>Firebase ç‰ˆæœ¬ï¼š</strong> ${firebase.SDK_VERSION || 'æœªçŸ¥'}<br>
                            <strong>ä¸Šæ¬¡åŒæ­¥ï¼š</strong> ${cloudSync.lastSyncTime || 'ä»æœªåŒæ­¥'}<br>
                            <strong>æ•°æ®åº“ï¼š</strong> ${cloudSync.firebaseConfig.databaseURL}
                        </p>
                    </div>
                    <div style="padding: 15px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 4px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #0d47a1;">
                            <i class="fas fa-info-circle"></i> åŠŸèƒ½è¯´æ˜
                        </h4>
                        <p style="margin: 0; color: #0d47a1; line-height: 1.8;">
                            âœ… æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°äº‘ç«¯<br>
                            âœ… æ”¯æŒå¤šè®¾å¤‡å®æ—¶åŒæ­¥<br>
                            âœ… ç¦»çº¿æ•°æ®è‡ªåŠ¨ç¼“å­˜<br>
                            âœ… ç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥
                        </p>
                    </div>
                `;
            }

            dialogHTML += `
                        <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
            `;

            // å§‹ç»ˆæä¾›æ‰“å¼€æ§åˆ¶å°æŒ‰é’®
            dialogHTML += `
                            <button onclick="openConsoleAndCheckErrors()" style="padding: 10px 20px; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-terminal"></i> æŸ¥çœ‹æ§åˆ¶å°
                            </button>
            `;

            // å¦‚æœSDKå·²åŠ è½½ä½†æœªåˆå§‹åŒ–ï¼Œæä¾›é‡è¯•æŒ‰é’®
            if (sdkLoaded && !syncInitialized) {
                dialogHTML += `
                            <button onclick="retryCloudSyncInit()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-sync-alt"></i> é‡è¯•åˆå§‹åŒ–
                            </button>
                `;
            }

            // å¦‚æœå·²åˆå§‹åŒ–ï¼Œæä¾›æ‰‹åŠ¨åŒæ­¥æŒ‰é’®
            if (syncInitialized) {
                dialogHTML += `
                            <button onclick="openSyncTestPanel()" style="padding: 10px 20px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-flask"></i> æµ‹è¯•åŠŸèƒ½
                            </button>
                            <button onclick="manualSyncNow()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-cloud-upload-alt"></i> ç«‹å³åŒæ­¥
                            </button>
                `;
            }

            dialogHTML += `
                            <button onclick="closeSyncDialog()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                å…³é—­
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // ç§»é™¤æ—§å¯¹è¯æ¡†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const oldDialog = document.getElementById('sync-dialog');
            if (oldDialog) {
                oldDialog.remove();
            }

            // æ·»åŠ æ–°å¯¹è¯æ¡†
            document.body.insertAdjacentHTML('beforeend', dialogHTML);

        }

        // å…³é—­åŒæ­¥çŠ¶æ€å¯¹è¯æ¡†
        function closeSyncDialog() {
            const dialog = document.getElementById('sync-dialog');
            if (dialog) {
                dialog.remove();
            }
        }

        // é‡è¯•äº‘ç«¯åŒæ­¥åˆå§‹åŒ–
        async function retryCloudSyncInit() {
            closeSyncDialog();
            showNotification('æ­£åœ¨é‡è¯•åˆå§‹åŒ–äº‘ç«¯åŒæ­¥...', 'info');

            try {
                if (!cloudSync) {
                    cloudSync = new CloudSyncManager();
                }
                await cloudSync.init();
                showNotification('âœ… äº‘ç«¯åŒæ­¥åˆå§‹åŒ–æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('é‡è¯•åˆå§‹åŒ–å¤±è´¥:', error);
                showNotification('âŒ åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®', 'error');
            }
        }

        // æ‰‹åŠ¨æ‰§è¡Œç«‹å³åŒæ­¥
        async function manualSyncNow() {
            if (!cloudSync || !cloudSync.isInitialized) {
                showNotification('äº‘ç«¯åŒæ­¥æœªå¯ç”¨', 'warning');
                return;
            }

            closeSyncDialog();
            showNotification('æ­£åœ¨åŒæ­¥æ•°æ®åˆ°äº‘ç«¯...', 'info');

            try {
                await cloudSync.syncAllData();
                showNotification('âœ… æ•°æ®åŒæ­¥æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('åŒæ­¥å¤±è´¥:', error);
                showNotification('âŒ åŒæ­¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // æ‰“å¼€æ§åˆ¶å°å¹¶æ˜¾ç¤ºæç¤º
        async function openConsoleAndCheckErrors() {
            closeSyncDialog();

            console.log('');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸ“Š äº‘ç«¯åŒæ­¥ç½‘ç»œè¯Šæ–­');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('');

            // Firebase SDK çŠ¶æ€
            console.log('1ï¸âƒ£ Firebase SDK çŠ¶æ€:');
            if (typeof firebase !== 'undefined') {
                console.log('   âœ… Firebase SDK å·²åŠ è½½');
                console.log('   ğŸ“¦ ç‰ˆæœ¬:', firebase.SDK_VERSION || 'æœªçŸ¥');
            } else {
                console.log('   âŒ Firebase SDK æœªåŠ è½½');
                console.log('   ğŸ’¡ å¯èƒ½åŸå› ï¼šCDN æ— æ³•è®¿é—®');
            }
            console.log('');

            // CloudSync çŠ¶æ€
            console.log('2ï¸âƒ£ CloudSync çŠ¶æ€:');
            if (cloudSync) {
                console.log('   âœ… CloudSync å®ä¾‹å·²åˆ›å»º');
                console.log('   åˆå§‹åŒ–çŠ¶æ€:', cloudSync.isInitialized ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–');
                if (cloudSync.isInitialized) {
                    console.log('   æ•°æ®åº“ URL:', cloudSync.firebaseConfig.databaseURL);
                }
            } else {
                console.log('   âŒ CloudSync å®ä¾‹æœªåˆ›å»º');
            }
            console.log('');

            // ç½‘ç»œçŠ¶æ€
            console.log('3ï¸âƒ£ ç½‘ç»œçŠ¶æ€:');
            console.log('   åœ¨çº¿çŠ¶æ€:', navigator.onLine ? 'âœ… åœ¨çº¿' : 'âŒ ç¦»çº¿');
            console.log('');

            // æœ¬åœ°å­˜å‚¨çŠ¶æ€
            console.log('4ï¸âƒ£ æœ¬åœ°å­˜å‚¨çŠ¶æ€:');
            try {
                const testKey = '__storage_test__';
                localStorage.setItem(testKey, 'test');
                localStorage.removeItem(testKey);
                console.log('   âœ… LocalStorage å¯ç”¨');

                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const users = JSON.parse(localStorage.getItem('allUsers') || '[]');
                const orders = JSON.parse(localStorage.getItem('userOrders') || '[]');

                console.log('   ğŸ“¦ äº§å“æ•°é‡:', products.length);
                console.log('   ğŸ‘¥ ç”¨æˆ·æ•°é‡:', users.length);
                console.log('   ğŸ“‹ è®¢å•æ•°é‡:', orders.length);
            } catch (error) {
                console.log('   âŒ LocalStorage ä¸å¯ç”¨:', error.message);
            }
            console.log('');

            // å¼€å§‹ç½‘ç»œè¿æ¥æµ‹è¯•
            console.log('5ï¸âƒ£ ç½‘ç»œè¿æ¥æµ‹è¯•:');
            console.log('   ğŸ”„ æ­£åœ¨æµ‹è¯• Firebase æœåŠ¡è¿æ¥...');
            console.log('');

            await runNetworkDiagnostics();

            console.log('');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸ’¡ æç¤ºï¼šå³ä½¿äº‘ç«¯åŒæ­¥ä¸å¯ç”¨ï¼Œåº”ç”¨ä»å¯æ­£å¸¸ä½¿ç”¨æœ¬åœ°å­˜å‚¨');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('');

            showNotification('ç½‘ç»œè¯Šæ–­å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¯¦ç»†ä¿¡æ¯', 'info');
        }

        // ç½‘ç»œè¯Šæ–­å‡½æ•°
        async function runNetworkDiagnostics() {
            const endpoints = [
                {
                    name: 'Firebase CDN (SDK)',
                    url: 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js',
                    type: 'script',
                    description: 'Firebase æ ¸å¿ƒ SDK æ–‡ä»¶'
                },
                {
                    name: 'Firebase Database CDN',
                    url: 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js',
                    type: 'script',
                    description: 'Firebase æ•°æ®åº“ SDK æ–‡ä»¶'
                },
                {
                    name: 'Google APIs (é€šç”¨)',
                    url: 'https://www.googleapis.com/robot.txt',
                    type: 'api',
                    description: 'Google API æœåŠ¡'
                },
                {
                    name: 'Firebase ä¸»ç«™',
                    url: 'https://firebase.google.com/robots.txt',
                    type: 'api',
                    description: 'Firebase å®˜æ–¹ç½‘ç«™'
                },
                {
                    name: 'æ‚¨çš„ Firebase æ•°æ®åº“',
                    url: 'https://grok-f3406-default-rtdb.firebaseio.com/.json?shallow=true',
                    type: 'database',
                    description: 'å®æ—¶æ•°æ®åº“è¿æ¥'
                }
            ];

            const results = [];

            // æ˜¾ç¤ºè¯Šæ–­é¢æ¿
            showDiagnosticPanel(endpoints);

            for (let i = 0; i < endpoints.length; i++) {
                const endpoint = endpoints[i];
                updateDiagnosticItem(i, 'testing');

                const result = await testEndpoint(endpoint);
                results.push(result);

                updateDiagnosticItem(i, result.success ? 'success' : 'failed', result);

                const status = result.success ? 'âœ…' : 'âŒ';
                const timing = result.time ? ` (${result.time}ms)` : '';
                console.log(`   ${status} ${endpoint.name}${timing}`);

                if (!result.success) {
                    console.log(`      é”™è¯¯: ${result.error}`);
                    if (result.suggestion) {
                        console.log(`      å»ºè®®: ${result.suggestion}`);
                    }
                }
            }

            console.log('');
            console.log('ğŸ“ˆ è¯Šæ–­æ€»ç»“:');
            const successCount = results.filter(r => r.success).length;
            const totalCount = results.length;
            console.log(`   æˆåŠŸ: ${successCount}/${totalCount}`);

            // æ›´æ–°è¯Šæ–­é¢æ¿æ€»ç»“
            updateDiagnosticSummary(successCount, totalCount);

            if (successCount === 0) {
                console.log('');
                console.log('âš ï¸ æ‰€æœ‰è¿æ¥éƒ½å¤±è´¥äº†ï¼å¯èƒ½çš„åŸå› ï¼š');
                console.log('   1. æ‚¨çš„ç½‘ç»œç¯å¢ƒæ— æ³•è®¿é—® Google æœåŠ¡');
                console.log('   2. é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢äº†è¿æ¥');
                console.log('   3. DNS è§£æé—®é¢˜');
                console.log('');
                console.log('ğŸ’¡ å»ºè®®çš„è§£å†³æ–¹æ¡ˆï¼š');
                console.log('   â†’ ä½¿ç”¨ VPN è¿æ¥');
                console.log('   â†’ æ›´æ¢ç½‘ç»œç¯å¢ƒï¼ˆå¦‚ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹ï¼‰');
                console.log('   â†’ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®');
                console.log('   â†’ æˆ–è€…ç»§ç»­ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼');
            } else if (successCount < totalCount) {
                console.log('');
                console.log('âš ï¸ éƒ¨åˆ†è¿æ¥å¤±è´¥');
                console.log('   Firebase æœåŠ¡å¯èƒ½ä¸ç¨³å®šæˆ–éƒ¨åˆ†åŠŸèƒ½å—é™');
            } else {
                console.log('');
                console.log('âœ… æ‰€æœ‰è¿æ¥æ­£å¸¸ï¼');
                console.log('   å¦‚æœä»ç„¶æ— æ³•åˆå§‹åŒ–ï¼Œè¯·æ£€æŸ¥ Firebase é…ç½®');
            }
        }

        // æ˜¾ç¤ºè¯Šæ–­é¢æ¿
        function showDiagnosticPanel(endpoints) {
            const existingPanel = document.getElementById('diagnostic-panel');
            if (existingPanel) {
                existingPanel.remove();
            }

            let panelHTML = `
                <div id="diagnostic-panel" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                     background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); 
                     z-index: 10001; max-width: 700px; width: 90%; max-height: 80vh; overflow: auto;">
                    <div style="padding: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0; color: #333; font-size: 22px;">
                                <i class="fas fa-network-wired"></i> ç½‘ç»œè¿æ¥è¯Šæ–­
                            </h2>
                            <button onclick="closeDiagnosticPanel()" style="background: none; border: none; font-size: 24px; 
                                    cursor: pointer; color: #999; padding: 0; width: 30px; height: 30px;">Ã—</button>
                        </div>
                        
                        <div id="diagnostic-items" style="margin-bottom: 20px;">
            `;

            endpoints.forEach((endpoint, index) => {
                panelHTML += `
                    <div id="diagnostic-item-${index}" style="padding: 15px; margin-bottom: 10px; background: #f8f9fa; 
                         border-radius: 8px; border-left: 4px solid #ccc;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: #333; margin-bottom: 5px;">
                                    <i class="fas fa-circle" id="status-icon-${index}" style="font-size: 8px; color: #ccc;"></i>
                                    ${endpoint.name}
                                </div>
                                <div style="font-size: 12px; color: #666;">${endpoint.description}</div>
                                <div id="result-${index}" style="font-size: 12px; color: #999; margin-top: 5px;">
                                    ç­‰å¾…æµ‹è¯•...
                                </div>
                            </div>
                            <div id="spinner-${index}" style="display: none;">
                                <i class="fas fa-spinner fa-spin" style="color: #2196F3; font-size: 20px;"></i>
                            </div>
                        </div>
                    </div>
                `;
            });

            panelHTML += `
                        </div>
                        
                        <div id="diagnostic-summary" style="padding: 15px; background: #f0f0f0; border-radius: 8px; margin-bottom: 15px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“Š è¯Šæ–­è¿›åº¦</div>
                            <div style="font-size: 14px; color: #666;">æ­£åœ¨å‡†å¤‡æµ‹è¯•...</div>
                        </div>
                        
                        <div style="text-align: right;">
                            <button onclick="closeDiagnosticPanel()" style="padding: 10px 20px; background: #6c757d; 
                                    color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                å…³é—­
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', panelHTML);
        }

        // æ›´æ–°è¯Šæ–­é¡¹çŠ¶æ€
        function updateDiagnosticItem(index, status, result = null) {
            const item = document.getElementById(`diagnostic-item-${index}`);
            const statusIcon = document.getElementById(`status-icon-${index}`);
            const resultDiv = document.getElementById(`result-${index}`);
            const spinner = document.getElementById(`spinner-${index}`);

            if (!item) return;

            if (status === 'testing') {
                item.style.borderLeftColor = '#2196F3';
                statusIcon.style.color = '#2196F3';
                statusIcon.className = 'fas fa-spinner fa-spin';
                resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•...';
                resultDiv.style.color = '#2196F3';
                spinner.style.display = 'block';
            } else if (status === 'success') {
                item.style.borderLeftColor = '#28a745';
                statusIcon.style.color = '#28a745';
                statusIcon.className = 'fas fa-check-circle';
                resultDiv.innerHTML = `<i class="fas fa-check"></i> è¿æ¥æˆåŠŸ (${result.time}ms)`;
                resultDiv.style.color = '#28a745';
                spinner.style.display = 'none';
            } else if (status === 'failed') {
                item.style.borderLeftColor = '#dc3545';
                statusIcon.style.color = '#dc3545';
                statusIcon.className = 'fas fa-times-circle';
                resultDiv.innerHTML = `<i class="fas fa-times"></i> ${result.error}`;
                if (result.suggestion) {
                    resultDiv.innerHTML += `<br><small style="color: #ff9800;">ğŸ’¡ ${result.suggestion}</small>`;
                }
                resultDiv.style.color = '#dc3545';
                spinner.style.display = 'none';
            }
        }

        // æ›´æ–°è¯Šæ–­æ€»ç»“
        function updateDiagnosticSummary(successCount, totalCount) {
            const summaryDiv = document.getElementById('diagnostic-summary');
            if (!summaryDiv) return;

            const percentage = Math.round((successCount / totalCount) * 100);
            let statusColor = '#28a745';
            let statusIcon = 'fa-check-circle';
            let statusText = 'æ‰€æœ‰è¿æ¥æ­£å¸¸ï¼';
            let recommendation = 'Firebase äº‘ç«¯åŒæ­¥å·²å°±ç»ªï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚';

            if (successCount === 0) {
                statusColor = '#dc3545';
                statusIcon = 'fa-times-circle';
                statusText = 'æ‰€æœ‰è¿æ¥å¤±è´¥';
                recommendation = 'æ‚¨çš„ç½‘ç»œæ— æ³•è®¿é—® Firebase æœåŠ¡ã€‚å»ºè®®ä½¿ç”¨ VPN æˆ–æ›´æ¢ç½‘ç»œç¯å¢ƒï¼Œæˆ–ç»§ç»­ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼ã€‚';
            } else if (successCount < totalCount) {
                statusColor = '#ff9800';
                statusIcon = 'fa-exclamation-triangle';
                statusText = 'éƒ¨åˆ†è¿æ¥å¤±è´¥';
                recommendation = 'Firebase æœåŠ¡å¯èƒ½ä¸ç¨³å®šã€‚æŸäº›åŠŸèƒ½å¯èƒ½å—é™ï¼Œå»ºè®®æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚';
            }

            summaryDiv.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fas ${statusIcon}" style="color: ${statusColor}; font-size: 24px; margin-right: 10px;"></i>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 16px; color: ${statusColor};">${statusText}</div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">æˆåŠŸ: ${successCount}/${totalCount} (${percentage}%)</div>
                    </div>
                </div>
                <div style="font-size: 13px; color: #555; padding: 10px; background: white; border-radius: 5px;">
                    ${recommendation}
                </div>
            `;
        }

        // å…³é—­è¯Šæ–­é¢æ¿
        function closeDiagnosticPanel() {
            const panel = document.getElementById('diagnostic-panel');
            if (panel) {
                panel.remove();
            }
        }

        // æ‰“å¼€äº‘ç«¯åŒæ­¥æµ‹è¯•é¢æ¿
        function openSyncTestPanel() {
            closeSyncDialog();

            // æ£€æŸ¥ CloudSync æ˜¯å¦å¯ç”¨
            if (!cloudSync || !cloudSync.isInitialized) {
                showNotification('âš ï¸ äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆåˆå§‹åŒ–', 'warning');
                setTimeout(() => {
                    retryCloudSyncInit();
                }, 1000);
                return;
            }

            const panelHTML = `
                <div id="sync-test-panel" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                     background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); 
                     z-index: 10001; max-width: 800px; width: 90%; max-height: 85vh; overflow: auto;">
                    <div style="padding: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0; color: #333; font-size: 22px;">
                                <i class="fas fa-cloud-upload-alt"></i> äº‘ç«¯åŒæ­¥åŠŸèƒ½æµ‹è¯•
                            </h2>
                            <button onclick="closeSyncTestPanel()" style="background: none; border: none; font-size: 24px; 
                                    cursor: pointer; color: #999; padding: 0; width: 30px; height: 30px;">Ã—</button>
                        </div>
                        
                        <!-- å½“å‰çŠ¶æ€ -->
                        <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                            <div style="font-weight: bold; color: #1976d2; margin-bottom: 10px;">
                                <i class="fas fa-info-circle"></i> å½“å‰æ•°æ®çŠ¶æ€
                            </div>
                            <div id="sync-test-status" style="font-size: 14px; color: #555;">
                                æ­£åœ¨åŠ è½½...
                            </div>
                        </div>
                        
                        <!-- æµ‹è¯•åŠŸèƒ½åŒº -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <!-- ä¸Šä¼ åŠŸèƒ½ -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 40px; color: #4CAF50; margin-bottom: 10px;">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #333;">ä¸Šä¼ åˆ°äº‘ç«¯</h3>
                                <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                                    å°†æœ¬åœ°æ•°æ®ä¸Šä¼ åˆ° Firebase
                                </p>
                                <button onclick="testUploadToCloud()" style="padding: 8px 16px; background: #4CAF50; 
                                        color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                                    <i class="fas fa-upload"></i> æµ‹è¯•ä¸Šä¼ 
                                </button>
                            </div>
                            
                            <!-- ä¸‹è½½åŠŸèƒ½ -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 40px; color: #2196F3; margin-bottom: 10px;">
                                    <i class="fas fa-cloud-download-alt"></i>
                                </div>
                                <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #333;">ä»äº‘ç«¯ä¸‹è½½</h3>
                                <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                                    ä» Firebase ä¸‹è½½æ•°æ®åˆ°æœ¬åœ°
                                </p>
                                <button onclick="testDownloadFromCloud()" style="padding: 8px 16px; background: #2196F3; 
                                        color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                                    <i class="fas fa-download"></i> æµ‹è¯•ä¸‹è½½
                                </button>
                            </div>
                            
                            <!-- åŒæ­¥åŠŸèƒ½ -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 40px; color: #FF9800; margin-bottom: 10px;">
                                    <i class="fas fa-sync-alt"></i>
                                </div>
                                <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #333;">åŒå‘åŒæ­¥</h3>
                                <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                                    æœ¬åœ°ä¸äº‘ç«¯æ•°æ®åŒæ­¥
                                </p>
                                <button onclick="testSyncWithCloud()" style="padding: 8px 16px; background: #FF9800; 
                                        color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                                    <i class="fas fa-sync"></i> æµ‹è¯•åŒæ­¥
                                </button>
                            </div>
                        </div>
                        
                        <!-- é«˜çº§æµ‹è¯• -->
                        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                            <div style="font-weight: bold; color: #856404; margin-bottom: 10px;">
                                <i class="fas fa-flask"></i> é«˜çº§æµ‹è¯•
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button onclick="testCreateTestData()" style="padding: 8px 12px; background: white; 
                                        border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 13px;">
                                    <i class="fas fa-plus"></i> åˆ›å»ºæµ‹è¯•æ•°æ®
                                </button>
                                <button onclick="testClearCloudData()" style="padding: 8px 12px; background: white; 
                                        border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 13px;">
                                    <i class="fas fa-trash"></i> æ¸…ç©ºäº‘ç«¯æ•°æ®
                                </button>
                                <button onclick="testViewCloudData()" style="padding: 8px 12px; background: white; 
                                        border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 13px;">
                                    <i class="fas fa-eye"></i> æŸ¥çœ‹äº‘ç«¯æ•°æ®
                                </button>
                                <button onclick="testAutoSync()" style="padding: 8px 12px; background: white; 
                                        border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 13px;">
                                    <i class="fas fa-magic"></i> æµ‹è¯•è‡ªåŠ¨åŒæ­¥
                                </button>
                            </div>
                        </div>
                        
                        <!-- æµ‹è¯•æ—¥å¿— -->
                        <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="font-weight: bold; color: #333;">
                                    <i class="fas fa-terminal"></i> æµ‹è¯•æ—¥å¿—
                                </div>
                                <button onclick="clearSyncTestLog()" style="padding: 5px 10px; background: #6c757d; 
                                        color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                    æ¸…ç©ºæ—¥å¿—
                                </button>
                            </div>
                            <div id="sync-test-log" style="background: #1e1e1e; color: #d4d4d4; padding: 12px; 
                                 border-radius: 5px; font-family: 'Courier New', monospace; font-size: 12px; 
                                 max-height: 250px; overflow-y: auto; line-height: 1.6;">
                                <div style="color: #4ec9b0;">ç­‰å¾…æµ‹è¯•...</div>
                            </div>
                        </div>
                        
                        <div style="text-align: right;">
                            <button onclick="closeSyncTestPanel()" style="padding: 10px 20px; background: #6c757d; 
                                    color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                å…³é—­
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', panelHTML);

            // æ›´æ–°å½“å‰çŠ¶æ€
            updateSyncTestStatus();
        }

        // å…³é—­åŒæ­¥æµ‹è¯•é¢æ¿
        function closeSyncTestPanel() {
            const panel = document.getElementById('sync-test-panel');
            if (panel) {
                panel.remove();
            }
        }

        // æ›´æ–°åŒæ­¥æµ‹è¯•çŠ¶æ€
        function updateSyncTestStatus() {
            const statusDiv = document.getElementById('sync-test-status');
            if (!statusDiv) return;

            try {
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const users = JSON.parse(localStorage.getItem('allUsers') || '[]');
                const orders = JSON.parse(localStorage.getItem('userOrders') || '[]');

                statusDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #4CAF50;">${products.length}</div>
                            <div style="font-size: 12px; color: #666;">äº§å“</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #2196F3;">${users.length}</div>
                            <div style="font-size: 12px; color: #666;">ç”¨æˆ·</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #FF9800;">${orders.length}</div>
                            <div style="font-size: 12px; color: #666;">è®¢å•</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                statusDiv.innerHTML = `<div style="color: #dc3545;">æ— æ³•è¯»å–æœ¬åœ°æ•°æ®</div>`;
            }
        }

        // æ·»åŠ æµ‹è¯•æ—¥å¿—
        function addSyncTestLog(message, type = 'info') {
            const logDiv = document.getElementById('sync-test-log');
            if (!logDiv) return;

            const timestamp = new Date().toLocaleTimeString();
            let color = '#d4d4d4';
            let icon = 'â—';

            switch (type) {
                case 'success':
                    color = '#4ec9b0';
                    icon = 'âœ“';
                    break;
                case 'error':
                    color = '#f48771';
                    icon = 'âœ—';
                    break;
                case 'warning':
                    color = '#dcdcaa';
                    icon = 'âš ';
                    break;
                case 'info':
                    color = '#569cd6';
                    icon = 'â„¹';
                    break;
            }

            const logEntry = document.createElement('div');
            logEntry.style.color = color;
            logEntry.innerHTML = `<span style="color: #858585;">[${timestamp}]</span> ${icon} ${message}`;

            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // æ¸…ç©ºæµ‹è¯•æ—¥å¿—
        function clearSyncTestLog() {
            const logDiv = document.getElementById('sync-test-log');
            if (logDiv) {
                logDiv.innerHTML = '<div style="color: #4ec9b0;">æ—¥å¿—å·²æ¸…ç©º</div>';
            }
        }

        // æµ‹è¯•ä¸Šä¼ åˆ°äº‘ç«¯
        async function testUploadToCloud() {
            addSyncTestLog('å¼€å§‹æµ‹è¯•ä¸Šä¼ åŠŸèƒ½...', 'info');

            try {
                if (!cloudSync || !cloudSync.isInitialized) {
                    throw new Error('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–');
                }

                addSyncTestLog('è¯»å–æœ¬åœ°æ•°æ®...', 'info');
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const users = JSON.parse(localStorage.getItem('allUsers') || '[]');
                const orders = JSON.parse(localStorage.getItem('userOrders') || '[]');

                addSyncTestLog(`æœ¬åœ°æ•°æ®: ${products.length} äº§å“, ${users.length} ç”¨æˆ·, ${orders.length} è®¢å•`, 'info');

                addSyncTestLog('ä¸Šä¼ äº§å“æ•°æ®...', 'info');
                await cloudSync.uploadData('products', products);

                addSyncTestLog('ä¸Šä¼ ç”¨æˆ·æ•°æ®...', 'info');
                await cloudSync.uploadData('users', users);

                addSyncTestLog('ä¸Šä¼ è®¢å•æ•°æ®...', 'info');
                await cloudSync.uploadData('orders', orders);

                addSyncTestLog('âœ“ æ‰€æœ‰æ•°æ®ä¸Šä¼ æˆåŠŸï¼', 'success');
                showNotification('âœ… æ•°æ®å·²æˆåŠŸä¸Šä¼ åˆ°äº‘ç«¯', 'success');

            } catch (error) {
                addSyncTestLog(`âœ— ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
                showNotification('âŒ ä¸Šä¼ å¤±è´¥', 'error');
                console.error('ä¸Šä¼ å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•ä»äº‘ç«¯ä¸‹è½½
        async function testDownloadFromCloud() {
            addSyncTestLog('å¼€å§‹æµ‹è¯•ä¸‹è½½åŠŸèƒ½...', 'info');

            try {
                if (!cloudSync || !cloudSync.isInitialized) {
                    throw new Error('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–');
                }

                addSyncTestLog('ä»äº‘ç«¯ä¸‹è½½äº§å“æ•°æ®...', 'info');
                const cloudProducts = await cloudSync.downloadData('products');

                addSyncTestLog('ä»äº‘ç«¯ä¸‹è½½ç”¨æˆ·æ•°æ®...', 'info');
                const cloudUsers = await cloudSync.downloadData('users');

                addSyncTestLog('ä»äº‘ç«¯ä¸‹è½½è®¢å•æ•°æ®...', 'info');
                const cloudOrders = await cloudSync.downloadData('orders');

                const productsCount = cloudProducts ? cloudProducts.length : 0;
                const usersCount = cloudUsers ? cloudUsers.length : 0;
                const ordersCount = cloudOrders ? cloudOrders.length : 0;

                addSyncTestLog(`äº‘ç«¯æ•°æ®: ${productsCount} äº§å“, ${usersCount} ç”¨æˆ·, ${ordersCount} è®¢å•`, 'info');

                if (cloudProducts) {
                    localStorage.setItem('products', JSON.stringify(cloudProducts));
                    addSyncTestLog('âœ“ äº§å“æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
                }

                if (cloudUsers) {
                    localStorage.setItem('allUsers', JSON.stringify(cloudUsers));
                    addSyncTestLog('âœ“ ç”¨æˆ·æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
                }

                if (cloudOrders) {
                    localStorage.setItem('userOrders', JSON.stringify(cloudOrders));
                    addSyncTestLog('âœ“ è®¢å•æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
                }

                addSyncTestLog('âœ“ æ‰€æœ‰æ•°æ®ä¸‹è½½æˆåŠŸï¼', 'success');
                showNotification('âœ… æ•°æ®å·²æˆåŠŸä»äº‘ç«¯ä¸‹è½½', 'success');
                updateSyncTestStatus();

                // åˆ·æ–°å½“å‰é¡µé¢æ˜¾ç¤º
                if (typeof loadProducts === 'function') {
                    loadProducts();
                }

            } catch (error) {
                addSyncTestLog(`âœ— ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
                showNotification('âŒ ä¸‹è½½å¤±è´¥', 'error');
                console.error('ä¸‹è½½å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•åŒå‘åŒæ­¥
        async function testSyncWithCloud() {
            addSyncTestLog('å¼€å§‹æµ‹è¯•åŒå‘åŒæ­¥åŠŸèƒ½...', 'info');

            try {
                if (!cloudSync || !cloudSync.isInitialized) {
                    throw new Error('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–');
                }

                addSyncTestLog('æ‰§è¡ŒåŒå‘åŒæ­¥...', 'info');
                await cloudSync.syncAllData();

                addSyncTestLog('âœ“ åŒå‘åŒæ­¥å®Œæˆï¼', 'success');
                showNotification('âœ… æ•°æ®åŒæ­¥æˆåŠŸ', 'success');
                updateSyncTestStatus();

            } catch (error) {
                addSyncTestLog(`âœ— åŒæ­¥å¤±è´¥: ${error.message}`, 'error');
                showNotification('âŒ åŒæ­¥å¤±è´¥', 'error');
                console.error('åŒæ­¥å¤±è´¥:', error);
            }
        }

        // åˆ›å»ºæµ‹è¯•æ•°æ®
        function testCreateTestData() {
            addSyncTestLog('åˆ›å»ºæµ‹è¯•æ•°æ®...', 'info');

            const testProduct = {
                id: 'test_' + Date.now(),
                name: 'æµ‹è¯•äº§å“ ' + new Date().toLocaleTimeString(),
                price: 99.99,
                stock: 100,
                category: 'æµ‹è¯•åˆ†ç±»',
                description: 'è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•äº‘ç«¯åŒæ­¥çš„äº§å“',
                images: [],
                createdAt: new Date().toISOString()
            };

            const products = JSON.parse(localStorage.getItem('products') || '[]');
            products.push(testProduct);
            localStorage.setItem('products', JSON.stringify(products));

            addSyncTestLog(`âœ“ å·²åˆ›å»ºæµ‹è¯•äº§å“: ${testProduct.name}`, 'success');
            showNotification('âœ… æµ‹è¯•æ•°æ®å·²åˆ›å»º', 'success');
            updateSyncTestStatus();

            if (typeof loadProducts === 'function') {
                loadProducts();
            }
        }

        // æ¸…ç©ºäº‘ç«¯æ•°æ®
        async function testClearCloudData() {
            if (!confirm(t('confirmClearCloud'))) {
                return;
            }

            addSyncTestLog('æ¸…ç©ºäº‘ç«¯æ•°æ®...', 'warning');

            try {
                if (!cloudSync || !cloudSync.isInitialized) {
                    throw new Error('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–');
                }

                await cloudSync.uploadData('products', []);
                await cloudSync.uploadData('users', []);
                await cloudSync.uploadData('orders', []);

                addSyncTestLog('âœ“ äº‘ç«¯æ•°æ®å·²æ¸…ç©º', 'success');
                showNotification('âœ… äº‘ç«¯æ•°æ®å·²æ¸…ç©º', 'success');

            } catch (error) {
                addSyncTestLog(`âœ— æ¸…ç©ºå¤±è´¥: ${error.message}`, 'error');
                showNotification('âŒ æ¸…ç©ºå¤±è´¥', 'error');
            }
        }

        // æŸ¥çœ‹äº‘ç«¯æ•°æ®
        async function testViewCloudData() {
            addSyncTestLog('è·å–äº‘ç«¯æ•°æ®...', 'info');

            try {
                if (!cloudSync || !cloudSync.isInitialized) {
                    throw new Error('äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–');
                }

                const cloudProducts = await cloudSync.downloadData('products');
                const cloudUsers = await cloudSync.downloadData('users');
                const cloudOrders = await cloudSync.downloadData('orders');

                console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                console.log('ğŸ“¦ äº‘ç«¯æ•°æ®è¯¦æƒ…');
                console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                console.log('äº§å“æ•°æ®:', cloudProducts);
                console.log('ç”¨æˆ·æ•°æ®:', cloudUsers);
                console.log('è®¢å•æ•°æ®:', cloudOrders);
                console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

                const productsCount = cloudProducts ? cloudProducts.length : 0;
                const usersCount = cloudUsers ? cloudUsers.length : 0;
                const ordersCount = cloudOrders ? cloudOrders.length : 0;

                addSyncTestLog(`äº‘ç«¯æ•°æ®: ${productsCount} äº§å“, ${usersCount} ç”¨æˆ·, ${ordersCount} è®¢å•`, 'info');
                addSyncTestLog('è¯¦ç»†æ•°æ®å·²è¾“å‡ºåˆ°æ§åˆ¶å°', 'success');
                showNotification('è¯¦ç»†æ•°æ®å·²è¾“å‡ºåˆ°æ§åˆ¶å° (F12)', 'info');

            } catch (error) {
                addSyncTestLog(`âœ— è·å–å¤±è´¥: ${error.message}`, 'error');
                showNotification('âŒ è·å–å¤±è´¥', 'error');
            }
        }

        // æµ‹è¯•è‡ªåŠ¨åŒæ­¥
        async function testAutoSync() {
            addSyncTestLog('æµ‹è¯•è‡ªåŠ¨åŒæ­¥æœºåˆ¶...', 'info');

            if (!cloudSync || !cloudSync.isInitialized) {
                addSyncTestLog('âœ— äº‘ç«¯åŒæ­¥æœªåˆå§‹åŒ–', 'error');
                return;
            }

            addSyncTestLog('è‡ªåŠ¨åŒæ­¥åŠŸèƒ½æ­£å¸¸è¿è¡Œä¸­', 'success');
            addSyncTestLog('æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨åŒæ­¥ä¸€æ¬¡', 'info');
            addSyncTestLog('æ•°æ®ä¿®æ”¹æ—¶ä¹Ÿä¼šè‡ªåŠ¨è§¦å‘åŒæ­¥', 'info');
            showNotification('è‡ªåŠ¨åŒæ­¥åŠŸèƒ½æ­£å¸¸', 'success');
        }

        // æµ‹è¯•å•ä¸ªç«¯ç‚¹
        async function testEndpoint(endpoint) {
            const startTime = Date.now();

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ç§’è¶…æ—¶

                const response = await fetch(endpoint.url, {
                    method: 'HEAD',
                    mode: 'no-cors', // é¿å… CORS é—®é¢˜
                    cache: 'no-cache',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const endTime = Date.now();

                return {
                    success: true,
                    time: endTime - startTime,
                    endpoint: endpoint.name
                };
            } catch (error) {
                const endTime = Date.now();
                let errorMsg = error.message;
                let suggestion = '';

                if (error.name === 'AbortError') {
                    errorMsg = 'è¿æ¥è¶…æ—¶ï¼ˆ>10ç§’ï¼‰';
                    suggestion = 'ç½‘ç»œé€Ÿåº¦è¿‡æ…¢æˆ–æœåŠ¡å™¨æ— å“åº”';
                } else if (errorMsg.includes('Failed to fetch')) {
                    errorMsg = 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨';
                    suggestion = 'å¯èƒ½è¢«é˜²ç«å¢™é˜»æ­¢æˆ– DNS è§£æå¤±è´¥';
                } else if (errorMsg.includes('NetworkError')) {
                    errorMsg = 'ç½‘ç»œé”™è¯¯';
                    suggestion = 'æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä»£ç†è®¾ç½®';
                }

                return {
                    success: false,
                    time: endTime - startTime,
                    endpoint: endpoint.name,
                    error: errorMsg,
                    suggestion: suggestion
                };
            }
        }

        // æ›´æ–°ç”¨æˆ·ç•Œé¢çŠ¶æ€
        function updateUserInterface() {
            const loginLink = document.getElementById('login-link');
            const registerLink = document.getElementById('register-link');
            const logoutLink = document.getElementById('logout-link');
            const userCenterLink = document.getElementById('user-center-link');
            const myOrdersLink = document.getElementById('my-orders-link');
            const adminLink = document.getElementById('admin-link');
            const adminBottomNavBtn = document.getElementById('bottom-admin-btn');
            const usernameDisplay = document.getElementById('username-display');
            const userPointsBadge = document.getElementById('user-points-badge');
            const userPointsValue = document.getElementById('user-points-value');

            if (currentUser) {
                // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨ï¼Œå¹¶è·å–æœ€æ–°ç”¨æˆ·ä¿¡æ¯
                const user = findUserByAccount(currentUser.account);
                if (user && user.status === 'banned') {
                    // ç”¨æˆ·å·²è¢«ç¦ç”¨ï¼šå…ˆå°†æœ¬åœ°æ•°æ®å®‰å…¨åŒæ­¥åˆ°äº‘ç«¯ï¼Œç„¶åæ¸…ç©ºæœ¬åœ°æ•°æ®å¹¶å¼ºåˆ¶ç™»å‡º
                    (async () => {
                        try {
                            if (cloudSync && cloudSync.isInitialized) {
                                console.log('âš ï¸ æ£€æµ‹åˆ°è´¦å·è¢«ç¦ç”¨ï¼Œå¼€å§‹åœ¨é€€å‡ºå‰åŒæ­¥æ•°æ®åˆ°äº‘ç«¯...');
                                try {
                                    await cloudSync.syncOrders();
                                } catch (orderSyncError) {
                                    console.error('ç¦ç”¨ç™»å‡ºå‰åŒæ­¥è®¢å•åˆ°äº‘ç«¯å¤±è´¥:', orderSyncError);
                                }
                                try {
                                    await cloudSync.syncAddresses();
                                } catch (addressSyncError) {
                                    console.error('ç¦ç”¨ç™»å‡ºå‰åŒæ­¥åœ°å€åˆ°äº‘ç«¯å¤±è´¥:', addressSyncError);
                                }
                            } else {
                                console.warn('cloudSync æœªåˆå§‹åŒ–ï¼Œæ— æ³•åœ¨ç¦ç”¨ç™»å‡ºå‰æ‰§è¡Œäº‘ç«¯åŒæ­¥');
                            }
                        } catch (syncError) {
                            console.error('å¤„ç†ç¦ç”¨ç™»å‡ºå‰äº‘ç«¯åŒæ­¥æ—¶å‡ºé”™:', syncError);
                        }

                        // åœ¨æ•°æ®ä¸Šä¼ å°è¯•å®Œæˆåï¼Œæ¸…ç©ºæœ¬åœ°æ‰€æœ‰æ•°æ®
                        try {
                            if (typeof clearAllLocalDataOnLogout === 'function') {
                                clearAllLocalDataOnLogout();
                            } else {
                                console.warn('clearAllLocalDataOnLogout æœªå®šä¹‰ï¼Œè·³è¿‡æœ¬åœ°æ•°æ®æ¸…ç†');
                            }
                        } catch (clearError) {
                            console.error('ç¦ç”¨ç™»å‡ºæ—¶æ¸…ç©ºæœ¬åœ°æ•°æ®å‡ºé”™:', clearError);
                        }

                        // æœ€åæ›´æ–°å½“å‰ç”¨æˆ·çŠ¶æ€å¹¶åˆ·æ–°ç•Œé¢ä¸ºâ€œæœªç™»å½•â€
                        currentUser = null;
                        try {
                            localStorage.removeItem('currentUser');
                        } catch (e) {
                            console.warn('ç§»é™¤ localStorage[currentUser] æ—¶å‡ºé”™:', e);
                        }

                        loginLink.style.display = 'inline';
                        registerLink.style.display = 'inline';
                        logoutLink.style.display = 'none';
                        userCenterLink.style.display = 'none';
                        if (myOrdersLink) myOrdersLink.style.display = 'none';
                        adminLink.style.display = 'none';
                        usernameDisplay.textContent = 'ç”¨æˆ·å';
                        if (userPointsBadge) userPointsBadge.style.display = 'none';
                        if (adminBottomNavBtn) adminBottomNavBtn.style.display = 'none';

                        // è¿”å›é¦–é¡µ
                        document.getElementById('home-page').style.display = 'block';
                        document.getElementById('user-center').style.display = 'none';
                        document.getElementById('admin-panel').style.display = 'none';

                        showNotification('Your account has been disabled. Data synchronization completed and you have been automatically logged out', 'error');
                    })();

                    // ç«‹å³è¿”å›ï¼Œé¿å…ç»§ç»­æŒ‰ç…§â€œå·²ç™»å½•çŠ¶æ€â€æ›´æ–°ç•Œé¢
                    return;
                }

                // å¦‚æœåœ¨allUsersä¸­æ‰¾åˆ°ç”¨æˆ·ï¼Œæ›´æ–°currentUserçš„username
                if (user && user.username) {
                    currentUser.username = user.username;
                }

                loginLink.style.display = 'none';
                registerLink.style.display = 'none';
                logoutLink.style.display = 'inline';
                userCenterLink.style.display = 'inline';
                if (myOrdersLink) myOrdersLink.style.display = 'inline';
                usernameDisplay.textContent = currentUser.username;

                // æ˜¾ç¤ºå¹¶æ›´æ–°ç§¯åˆ†
                let safePoints = currentUser.points;
                if ((safePoints == null || isNaN(safePoints)) && currentUser.account) {
                    const latest = findUserByAccount(currentUser.account);
                    if (latest && latest.points != null) {
                        safePoints = Number(latest.points);
                    }
                }
                if (safePoints == null || isNaN(safePoints)) {
                    safePoints = 1;
                } else {
                    safePoints = Number(safePoints);
                }
                currentUser.points = safePoints;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                if (userPointsBadge && userPointsValue) {
                    userPointsBadge.style.display = 'inline-flex';
                    userPointsValue.textContent = safePoints;
                }

                // æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºåå°ç®¡ç†é“¾æ¥
                if (isAdmin()) {
                    adminLink.style.display = 'inline';
                    if (adminBottomNavBtn) adminBottomNavBtn.style.display = 'inline-block';
                } else {
                    adminLink.style.display = 'none';
                    if (adminBottomNavBtn) adminBottomNavBtn.style.display = 'none';
                }
            } else {
                loginLink.style.display = 'inline';
                registerLink.style.display = 'inline';
                logoutLink.style.display = 'none';
                userCenterLink.style.display = 'none';
                if (myOrdersLink) myOrdersLink.style.display = 'none';
                adminLink.style.display = 'none';
                usernameDisplay.textContent = 'ç”¨æˆ·å';
                if (userPointsBadge) userPointsBadge.style.display = 'none';
                if (adminBottomNavBtn) adminBottomNavBtn.style.display = 'none';
            }
        }

        // ç»Ÿä¸€ç»‘å®šã€Œå¿«é€Ÿç‚¹å‡»ã€ï¼šæ”¹ä¸ºåªä½¿ç”¨æœ€ç¨³å®šçš„ click äº‹ä»¶ï¼Œé¿å…ä»»ä½•é¢å¤–èŠ‚æµ/é˜»æ­¢é»˜è®¤è¡Œä¸ºé€ æˆ PC ç«¯éœ€è¦å¤šæ¬¡ç‚¹å‡»
        function bindFastTap(element, handler) {
            if (!element || typeof handler !== 'function') return;
            element.addEventListener('click', function (e) {
                handler.call(element, e);
            });
        }

        // å…³é—­å…¨å±€é˜²è¿ç‚¹ï¼šåªæ‹¦æˆªå·²ç¦ç”¨å…ƒç´ ï¼Œå…¶ä»–ç‚¹å‡»ç«‹å³é€ä¼ 
        (function setupGlobalClickGuard() {
            document.addEventListener('click', function (e) {
                const target = e.target.closest('button, a, .btn');
                if (!target) return;
                if (target.disabled) {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                }
            }, true);
        })();

        // æ¸²æŸ“é¦–é¡µäº§å“åˆ—è¡¨ï¼ˆä½¿ç”¨é˜²æŠ–ä»¥é¿å…é¢‘ç¹å®Œæ•´é‡ç»˜å¯¼è‡´é—ªçƒï¼‰
        (function () {
            let _renderTimeout = null;
            function _renderProductsNow(productsToRender) {
                const productsGrid = document.getElementById('products-grid');
                const productDetail = document.getElementById('product-detail');
                const topCarousel = document.querySelector('.carousel');
                const productsLoading = document.getElementById('products-loading');

                if (!productsGrid || !productDetail) {
                    console.info('é¦–é¡µå·²éšè—å•†å“å±•ç¤ºï¼ŒrenderProducts è·³è¿‡æ¸²æŸ“ã€‚');
                    return;
                }

                // é¦–æ¬¡æ¸²æŸ“æˆ–æ¯æ¬¡åˆ·æ–°æ—¶ï¼Œéšè—â€œåŠ è½½ä¸­â€å ä½
                if (productsLoading) {
                    productsLoading.style.display = 'none';
                }

                productDetail.style.display = 'none';
                productsGrid.style.display = 'grid';

                if (!productsToRender || productsToRender.length === 0) {
                    productsGrid.innerHTML = `<div class="no-products">${t('noProducts')}</div>`;
                    return;
                }

                // è¿‡æ»¤æ‰æ— æ•ˆçš„äº§å“ï¼ˆundefinedã€null æˆ–ç¼ºå°‘å¿…è¦å±æ€§ï¼‰
                const validProducts = productsToRender.filter(product =>
                    product && typeof product === 'object' && product.id && product.name && (product.visible !== false)
                );

                if (validProducts.length === 0) {
                    productsGrid.innerHTML = `<div class="no-products">${t('noProducts')}</div>`;
                    return;
                }

                productsGrid.innerHTML = validProducts.map(product => {
                    if (!product) return ''; // é¢å¤–å®‰å…¨æ£€æŸ¥
                    const categoryLabel = getCategoryLabel(product.category);
                    const oldPrice = formatCurrency(product.price);
                    const newPrice = formatCurrency(product.newPrice !== undefined ? product.newPrice : 0);
                    const stock = (product && typeof product.stock !== 'undefined') ? product.stock : 0;
                const hasAmazonLink = !!(product && product.redirectUrl);
                const amazonIconUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACUCAMAAABC4vDmAAAAqFBMVEX///8AAAD/mQD/lwDl5eX/lQAyMjL/kwD4+Pj/kQD/jwD/jABRUVHi4uL19fXe3t5mZmbQ0NC3t7f//PlHR0e+vr5BQUHs7OzIyMiWlpaurq55eXlwcHCJiYlbW1vW1tYrKyshISH/7Nz/4cb/9e0YGBienp4RERH/1LD/oUH/nCE5OTn/pT7/oTL/sWP/6NP/tm7/pU3/zqH/xpb/vYL/ggD/rVb/unhlGJA0AAAH00lEQVR4nO2baZeqOBCGr41pCO7SiruCtCItKsvo//9nE9RWFFIsSfSeM/N+tBt4qFRVKpXw5w+jmo3OYDQdz74W35VKZf351Z6uep1Wk/W+5dVaTWaflRQZ9cmw9QagRredhhPXuKe/FKmXbqFn9ceNVxG1VnmArvrqvAJJny4KMBHVhXuXMipGdNZUrG+1+iWYiG/NBTINSyFF6opCao5LM1UqQzFM+hcDkyCqRjl3umvFn0nPlS1BDXgzNWfMTBWjyhmKxcdvmvBlKpMyU8R1AKtrPlAzhSNUnQ9TpcIxs/d4MVXa3JgUtqwZ14JbAGYa6nM86hGtcqQNbnMgnMrrq9gqYTDJgJpyYhpAD1n3nhYuAwOE+uEUf1PgGeOUZ8CDyKfea37Tn5A6GMoPBMWnZO8UZIJfg1OtQB89an6GCtQxFyhqklpT07MOrHfqPJiq1DoKyM6Ar3OBoicEYB4DioovHlDUdN4HOistOhR0WW41acMH5WadDvXDJVHRUsIIgqJ7+iefKVnprobj9tdT8llA80WTXldwgrqQNfVqYzCatvufC4PUoQZYrjXpVeGnmOaQUu10u7C7AlCLd3T4zlLoiep/qAf9lcP3ekfPIeUvhGrO6WU9zzyVKZLIGq3OaDiuG8Y3sKB+FZTe6Q6nlL2H10Mp1Xl3XLCXJhZK707bBTvqYqH0+bAEj1Co6pShCyMESumxtTtEQHVZe5/8oQbg4vctUArUVXgT1JwDEm+oFZ9mLFcoLo10zlBZHbp3QHFj4giVK+yMRX286nZajUajBRR5vKBybIK0V/FDCFDlyQkKaFdcVB/pj+tlqEbntGzPSOOT5DaQeCj4aEQ/bWdKOFQVNlPq+l04FHjOhtYfFgw1h/rPtFavaCgoRc1oFwmGUgCmCnWxKxgKypv0zQPBnTyg+gV29KndWy5QDWDZC2zo6/TaiwMUtCkK7OcDLWsOUNDWD9AQBxIuByggc9aBXiywmcoBCjAUtEcGGHjB3DSDshS0DQLELHvPswFAAYe0oGJnzXzeBdiqhaA60HzJfDKhWw4KPE8IbTTlEjTJ0H0KLlWZD1FBUBPqNlbGMRTW4xIQFH2LM6OlxnoyAfKpCi0LghdV2I8rgQNB8VigQrgI3irMFpQSKv30a7JX04znJeCVTC/tkqzBi8SY1MF711PiCDzXBF1YQAZ482SqGkC5/C62UzgZH1c8Z/Xcx0GZfD3ra4ZJvNKr5u/5f7Ecmcg8I7hYXb1W6RVqQLIkq2p243y9mE2nkx+jCFKFbV7mcLg6XSwDmCvES4mh2FM4HWXmCpUZf2XVZ4m/liEGim2qKfmtjNGCMumM8WhXs9TG7JqUcvQLZ8xn4MoE4HnJ2aAFCY9PaIpv831flsGUkefzWU/mN49PupUmaZPhd2oZVlzNYru093VOSuga/D5CLDLbxJfAiXqaqTx4kpJ7b63/aImnvAD1j0ooT+1NHCbhxA/X8TliHdM8xxC2U9aCsXlKxNd0vYwoHKdPHTdbifkaUpm3DQrQur+iunD3kkQpqUC7iIVL76acvqlPR+BKYD77NlLNaNp+uDtuXXfr7U6BvY/9yT4si3A19VZ3OG7X6/X2ZDwcDap6ZkgpetKM2j7cOLKMkHQWQrLsePbtz/8g9WAWweIgK9jUZEn6eJRUu5nHRR/ICZhGtaC00JGfgc5Ch99/MR3yD3hbaAyZZLr4MmSyjIlkdDOZdIP6s8TkRwntXjWGDpYcd+NFzu0TBQfPlRNQf/zzb7IUvAZqaS/3phX/xQwuVCiM/ejjM6fsLl/pWnFdqLD98Bu+mE897GmXidUSRc9XH5/uX8MBqeGr08MF6vz42tNABeo1AmTHf8MY2pGlJDf58zUwJRnbVtqF3GUF29P1SedYk5ORds4MF+Gtnfgzf6TQxeg3h4eRpeSUXGm66JbwZSTWWpp5VKOhubq2to1S5SbtkZaL7/MQ3vrimOydfDYA2l3814o8Wtql/3N4pyLWqgVCInEfqOrFUyTnahsbJxPCXYEanymxc+Ket+yd9PvmEvp1oiOKCKnX7H/noetlNcfmZy5rf1Lv4YSc3ztbUU0gA8FlHvFDWSFh98SngjBDT469MdrcRiHKUpILRlaAHosdCakoXLIFo7UMpNrDffHxnqNPBErNyEKmI388iqSITXl7WfZuIz+WdZIa3pksObJb1jyi+WqiMiT2wju7aBmh7ZehW8PPla/sxN/QJwkB5Yio5SatYEVY8o7+PieYtrd3niMnbyTJxwdn8KQPnK+WCySUpCI3lHBN3Ya+vTSpbJa5tP3TVo0slPJqsvToPqRCQJS8mbz1NeumkZHyWiIV7S4MzlUkkWZZ5p6wBKejt3E/yOIpdWkQmem57g7lbIeKvYKHKXe+2Oxc+qtq7SZVPS8D0szze5HqPceLpuLUSY8mzXZoL1xKpOC2EzbR8KFo9NhOMhDLImEp4FR6aL6LaL5VCEl2Q47VkGZ7KusoSqrrcy7QtP2BstDOaSTHE7J4M323VspcUaERiFu4macNKmgvSZY2opeS2jJwajifwUgWwzU3YKwucsryDxsHwxYjPMSNDi9aqV259nZIZjYVX9twcSFMMvzHwQemRqFoSz887I7e1nUiuduNd9wdTv5rBgxUNBGbeyKTzMvv6tn8R/Uvjyygg2H1gsIAAAAASUVORK5CYII=';
                    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²é¢†å–è¯¥äº§å“
                    let isClaimed = false;
                    if (currentUser && currentUser.account && Array.isArray(userOrders)) {
                        isClaimed = userOrders.some(o =>
                            o &&
                            o.productId === product.id &&
                            o.account === currentUser.account &&
                            o.status !== 'cancelled'
                        );
                    }
                    
                    const buttonText = isClaimed ? t('getItNow') : t('claimNow');
                    
                    // è·å–Get it nowæŒ‰é’®é¢œè‰²
                    const getItNowButtonColor = (homepageSettings && homepageSettings.getItNowButtonColor) || '#667eea';
                    // ä¸ºGet it nowæŒ‰é’®åº”ç”¨è‡ªå®šä¹‰é¢œè‰²ï¼ˆä»…å½“æŒ‰é’®æ–‡æœ¬æ˜¯"Get it now"æ—¶ï¼‰
                    const buttonStyle = isClaimed ? `style="background: ${getItNowButtonColor}; border-color: ${getItNowButtonColor}; color: white;"` : '';
                    
                    return `
                        <article class="home-feature-card" data-product-id="${product.id}">
                            <div class="home-feature-image">
                                <img src="${getPrimaryProductImage(product)}" alt="${product.name || ''}">
                                ${hasAmazonLink ? `<img class="home-feature-amazon-icon" src="${amazonIconUrl}" alt="Amazon" onerror="this.onerror=null; this.src='images/amazon-fallback.png'">` : ''}
                            </div>
                            <div class="home-feature-body">
                                <div>
                                    <h3 style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; word-break: break-word; line-height: 1.3; max-height: calc(1.3em * 2);">${product.name || ''}</h3>
                                    <div class="home-feature-price">
                                        <span style="text-decoration: line-through; color: #999; margin-right: 10px;">${oldPrice}</span>
                                        <span style="color: #e74c3c; font-weight: bold; font-size: 1.2em;">${newPrice}</span>
                                    </div>
                                    <div class="home-feature-stock">${t('stock')} ${stock} ${t('pieces')}</div>
                                </div>
                                <div class="home-feature-actions">
                                    <button class="btn btn-primary view-detail">${t('viewDetail')}</button>
                                    <button class="btn ${isClaimed ? 'get-it-now-btn' : 'btn-secondary'} signup-btn" data-product-id="${product.id}" data-is-claimed="${isClaimed}" ${buttonStyle}>${buttonText}</button>
                                </div>
                            </div>
                        </article>
                    `;
                }).join('');

                // é‡æ–°ç»‘å®šäº‹ä»¶ï¼šæŠ¥å / Claim Now æŒ‰é’®
                document.querySelectorAll('.signup-btn').forEach(btn => {
                    bindFastTap(btn, function (e) {
                        // é˜²æ­¢ç‚¹å‡»å†’æ³¡åˆ°æ•´å¼ å¡ç‰‡ä¸Šï¼Œä»è€Œè¯¯è§¦å‘ã€ŒæŸ¥çœ‹è¯¦æƒ…ã€
                        if (e) {
                            e.preventDefault();
                            e.stopPropagation();
                        }

                        const productId = parseInt(this.getAttribute('data-product-id'), 10);
                        const isClaimed = this.getAttribute('data-is-claimed') === 'true';
                        const product = products.find(p => p.id === productId);
                        
                        if (!product) {
                            alert(t('systemError'));
                            return;
                        }
                        
                        // å¦‚æœå·²é¢†å–ï¼Œæ˜¾ç¤ºWhatsAppæ¨¡æ€æ¡†
                        if (isClaimed) {
                            // æŸ¥æ‰¾å¯¹åº”çš„è®¢å•
                            let orderId = null;
                            let orderStatus = null;
                            if (currentUser && currentUser.account && Array.isArray(userOrders)) {
                                const order = userOrders.find(o =>
                                    o &&
                                    o.productId === productId &&
                                    o.account === currentUser.account &&
                                    o.status !== 'cancelled'
                                );
                                if (order) {
                                    orderId = order.id;
                                    orderStatus = order.status;
                                }
                            }
                            
                            // æ£€æŸ¥è®¢å•çŠ¶æ€ï¼šå¦‚æœæ˜¯è¿è¾“ä¸­æˆ–å·²å®Œæˆï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                            if (orderStatus === 'shipping' || orderStatus === 'completed') {
                                if (typeof customAlert === 'function') {
                                    customAlert('You have already claimed this product.\n\nPlease select a different item.', 'Information');
                                } else if (typeof showNotification === 'function') {
                                    showNotification('You have already claimed this product. Please select a different item.', 'warning');
                                } else {
                                    alert('You have already claimed this product.\n\nPlease select a different item.');
                                }
                                return;
                            }
                            
                            // æ˜¾ç¤ºWhatsAppæ¨¡æ€æ¡†
                            if (typeof showWhatsAppModal === 'function') {
                                showWhatsAppModal(orderId);
                            } else {
                                // å¦‚æœæ²¡æœ‰showWhatsAppModalå‡½æ•°ï¼Œç›´æ¥æ‰“å¼€WhatsAppé“¾æ¥
                                const phoneNumber = '+17077902826';
                                const message = orderId 
                                    ? `Please confirm my Beefreebies order #${orderId}`
                                    : `I want to get my ${product.name}`;
                                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                                window.open(whatsappUrl, '_blank');
                            }
                        } else {
                            // æœªé¢†å–ï¼Œæ‰“å¼€æŠ¥åæ¨¡æ€æ¡†
                            openSignupModal(product);
                        }
                    });
                });

                // è¯¦æƒ…æŒ‰é’®ï¼šä»ç„¶è¿›å…¥äº§å“è¯¦æƒ…é¡µ
                document.querySelectorAll('.view-detail').forEach(btn => {
                    bindFastTap(btn, function (e) {
                        if (e) {
                            e.preventDefault();
                            e.stopPropagation();
                        }
                        const productId = this.closest('.home-feature-card').getAttribute('data-product-id');
                        showProductDetail(parseInt(productId, 10));
                    });
                });

                // æ•´ä¸ªå¡ç‰‡ç‚¹å‡»ä»ä½¿ç”¨æ™®é€š clickï¼Œé¿å…ä¸å†…éƒ¨æŒ‰é’®å†²çª
                document.querySelectorAll('.home-feature-card').forEach(card => {
                    card.addEventListener('click', function () {
                        const productId = this.getAttribute('data-product-id');
                        showProductDetail(parseInt(productId, 10));
                    });
                });
            }

            // æš´éœ²é˜²æŠ–åçš„æ¥å£ï¼Œå‡å°‘çŸ­æ—¶é—´å†…é‡å¤å®Œæ•´é‡ç»˜å¯¼è‡´çš„é—ªçƒ
            window.renderProducts = function (productsToRender) {
                if (_renderTimeout) clearTimeout(_renderTimeout);
                _renderTimeout = setTimeout(() => {
                    _renderProductsNow(productsToRender);
                    _renderTimeout = null;
                }, 120);
            };
        })();

        // æ˜¾ç¤ºäº§å“è¯¦æƒ…
        function showProductDetail(productId) {
            // ä½¿ç”¨è§„èŒƒåŒ– IDï¼Œé¿å…å­—ç¬¦ä¸²/æ•°å­—æ··ç”¨å¯¼è‡´æ‰¾ä¸åˆ°äº§å“
            const product = products.find(p => normalizeOrderId(p.id) === normalizeOrderId(productId));
            if (!product) return;

            currentProduct = product;

            const productsGrid = document.getElementById('products-grid');
            const productDetail = document.getElementById('product-detail');
            const topCarousel = document.querySelector('.carousel');
            if (!productsGrid || !productDetail) {
                return;
            }

            const oldPrice = formatCurrency(product.price || 0);
            const newPrice = formatCurrency(product.newPrice !== undefined ? product.newPrice : 0);
            const imageUrls = getProductImageUrls(product);
            const hasMultipleImages = imageUrls.length > 1;
            
            // è·å–è¯¥äº§å“çš„è¯„ä»·åˆ—è¡¨
            const productReviews = (product.reviews || []).sort((a, b) => b.createdAt - a.createdAt);
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²é¢†å–è¯¥äº§å“
            let isClaimed = false;
            if (currentUser && currentUser.account && Array.isArray(userOrders)) {
                isClaimed = userOrders.some(o =>
                    o &&
                    o.productId === product.id &&
                    o.account === currentUser.account &&
                    o.status !== 'cancelled'
                );
            }
            
            const detailButtonText = isClaimed ? t('getItNow') : t('registerNow');
            
            // è·å–Get it nowæŒ‰é’®é¢œè‰²
            const getItNowButtonColor = (homepageSettings && homepageSettings.getItNowButtonColor) || '#667eea';
            // ä¸ºGet it nowæŒ‰é’®åº”ç”¨è‡ªå®šä¹‰é¢œè‰²ï¼ˆä»…å½“æŒ‰é’®æ–‡æœ¬æ˜¯"Get it now"æ—¶ï¼‰
            const detailButtonStyle = isClaimed ? `style="background: ${getItNowButtonColor}; border-color: ${getItNowButtonColor}; color: white;"` : '';
            
            productDetail.innerHTML = `
                <div class="product-detail-content">
                    <div class="product-detail-image">
                        <div class="product-gallery">
                            <div class="product-gallery-main">
                                ${hasMultipleImages ? `
                                    <button type="button" class="product-gallery-arrow" data-action="prev"><i class="fas fa-chevron-left"></i></button>
                                ` : ''}
                                <div class="product-gallery-slides">
                                    ${imageUrls.map((url, index) => `
                                        <div class="product-gallery-slide ${index === 0 ? 'active' : ''}" data-index="${index}">
                                            <img src="${url}" alt="${product.name} ${index + 1}">
                                        </div>
                                    `).join('')}
                                </div>
                                ${hasMultipleImages ? `
                                    <button type="button" class="product-gallery-arrow" data-action="next"><i class="fas fa-chevron-right"></i></button>
                                ` : ''}
                            </div>
                            ${imageUrls.length ? `
                                <div class="product-gallery-thumbs">
                                    ${imageUrls.map((url, index) => `
                                        <button type="button" class="product-gallery-thumb ${index === 0 ? 'active' : ''}" data-index="${index}" aria-label="Preview image ${index + 1}">
                                            <img src="${url}" alt="${product.name} thumbnail ${index + 1}">
                                        </button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    <div class="product-detail-info">
                        <h1 class="product-detail-title">${product.name}</h1>
                        <div class="product-detail-price">
                            <span style="text-decoration: line-through; color: #999; margin-right: 15px; font-size: 0.9em;">${oldPrice}</span>
                            <span style="color: #e74c3c; font-weight: bold; font-size: 1.3em;">${newPrice}</span>
                        </div>
                        <div class="product-detail-description">
                            <p>${product.description || ''}</p>
                            <p>${t('stock')}: ${(product && typeof product.stock !== 'undefined') ? product.stock : 0} ${t('pieces')}</p>
                        </div>
                        <div class="product-detail-actions">
                            <button class="btn ${isClaimed ? 'get-it-now-btn' : 'btn-primary'} signup-now" data-is-claimed="${isClaimed}" ${detailButtonStyle}>${detailButtonText}</button>
                            <button class="btn btn-secondary back-to-list">${t('returnToList')}</button>
                        </div>
                    </div>
                </div>
                
                <!-- è¯„ä»·åŒºåŸŸ -->
                <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #eee;">
                    <h2 style="margin-bottom: 20px; color: var(--primary); font-size: 24px;">
                        <i class="fas fa-star" style="margin-right: 8px; color: #ffc107;"></i>${t('reviews')} (${productReviews.length})
                    </h2>
                    
                    ${productReviews.length === 0 ? `
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <i class="fas fa-comment-slash" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p style="font-size: 16px;">${t('noReviews')}</p>
                        </div>
                    ` : `
                        <div class="reviews-list" style="display: flex; flex-direction: column; gap: 20px;">
                            ${productReviews.map(review => `
                                <div class="review-item" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid var(--primary);">
                                    ${isCurrentUserAdmin() ? `
                                        <div class="review-admin-actions">
                                            <button class="btn-icon" title="${t('deleteReview') || 'åˆ é™¤è¯„ä»·'}" onclick="deleteReview('${normalizeOrderId(review.orderId)}')">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    ` : ''}
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                        <div>
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                                <strong style="font-size: 16px; color: var(--primary);">${review.userName || t('customerName')}</strong>
                                                ${review.userPhone ? `<span style="color: #999; font-size: 14px;">${review.userPhone}</span>` : ''}
                                            </div>
                                            <div class="review-rating" style="display: flex; gap: 3px; margin-bottom: 8px;">
                                                ${Array.from({length: 5}, (_, i) => `
                                                    <i class="fas fa-star" style="color: ${i < review.rating ? '#ffc107' : '#ddd'}; font-size: 14px;"></i>
                                                `).join('')}
                                                <span style="margin-left: 8px; color: #666; font-size: 14px;">${review.rating} ${t('stars')}</span>
                                            </div>
                                            <p style="color: #666; font-size: 13px; margin: 0;">
                                                <i class="fas fa-shopping-bag" style="margin-right: 5px;"></i>${t('purchasedProduct')}: ${review.productName || product.name}
                                            </p>
                                        </div>
                                        <div style="text-align: right; color: #999; font-size: 13px;">
                                            <i class="fas fa-clock" style="margin-right: 5px;"></i>${formatDate(review.createdAt)}
                                        </div>
                                    </div>
                                    <div class="review-comment" style="color: #333; line-height: 1.6; font-size: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                        ${review.comment}
                                        ${review.adminReply ? `
                                            <div class="admin-reply" style="margin-top: 15px; padding: 12px 15px; border-radius: 6px; background: #fff; border-left: 3px solid #3498db; font-size: 14px; color: #34495e;">
                                                <strong style="color:#3498db; margin-right:6px;">${t('adminReply') || 'ç®¡ç†å‘˜å›å¤'}ï¼š</strong>
                                                <span>${review.adminReply}</span>
                                            </div>
                                        ` : ''}
                                        ${Array.isArray(review.replies) && review.replies.length ? `
                                            <div class="customer-replies" style="margin-top: 15px; padding: 12px 15px; border-radius: 6px; background: #fff; border-left: 3px solid #2ecc71;">
                                                <strong style="color:#2ecc71; display:block; margin-bottom:8px;">${t('customerReplies') || 'ç”¨æˆ·å›å¤'}</strong>
                                                ${review.replies.map(reply => `
                                                    <div class="customer-reply-item" style="margin-bottom: 10px;">
                                                        <div style="display:flex; justify-content: space-between; font-size: 13px; color:#666; margin-bottom:4px;">
                                                            <span><i class="fas fa-user-circle" style="margin-right:6px;"></i>${reply.userName || t('customerName')}</span>
                                                            <span><i class="fas fa-clock" style="margin-right:6px;"></i>${formatDate(reply.createdAt)}</span>
                                                        </div>
                                                        <p style="margin:0; color:#34495e;">
                                                            ${reply.replyToUserName ? `<span style="color:#999;">@${reply.replyToUserName}</span> ` : ''}
                                                            ${reply.message}
                                                        </p>
                                                        <div style="margin-top:4px; display:flex; justify-content:flex-end; gap:8px; font-size:12px;">
                                                            ${currentUser ? `
                                                                <button class="btn btn-xs btn-link review-reply-btn"
                                                                    data-review-id="${review.reviewId}"
                                                                    data-product-id="${product.id}"
                                                                    data-target-type="reply"
                                                                    data-target-user="${reply.userName || t('customerName')}"
                                                                    data-target-reply-id="${reply.replyId}">
                                                                    <i class="fas fa-reply" style="margin-right:4px;"></i>${t('reply') || 'å›å¤'}
                                                                </button>
                                                            ` : ''}
                                                        </div>
                                                        ${isCurrentUserAdmin() ? `
                                                            <div class="customer-reply-admin-actions">
                                                                <button class="btn-icon" title="${t('deleteReview') || 'åˆ é™¤è¯„ä»·å›å¤'}"
                                                                    onclick="deleteReviewReply('${normalizeOrderId(product.id)}', '${review.reviewId}', '${reply.replyId}')">
                                                                    <i class="fas fa-trash-alt"></i>
                                                                </button>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                    ${currentUser ? `
                                        <div class="review-actions" style="margin-top: 15px; text-align: right;">
                                            <button class="btn btn-sm btn-outline-primary review-reply-btn"
                                                data-review-id="${review.reviewId}"
                                                data-product-id="${product.id}"
                                                data-target-type="review"
                                                data-target-user="${review.userName || t('customerName')}">
                                                <i class="fas fa-reply" style="margin-right:6px;"></i>${t('reply') || 'å›å¤'}
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;

            productsGrid.style.display = 'none';
            productDetail.style.display = 'block';
            if (topCarousel) topCarousel.style.display = 'none';
            if (topCarousel) topCarousel.style.display = 'none';

            // ç»‘å®šæŒ‰é’®äº‹ä»¶ï¼Œç§»é™¤å†…è” onclick
            const signupNowBtn = document.querySelector('#product-detail .signup-now');
            const backBtn = document.querySelector('#product-detail .back-to-list');
            if (signupNowBtn) {
                signupNowBtn.addEventListener('click', function (e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    const isClaimed = this.getAttribute('data-is-claimed') === 'true';
                    
                    // å¦‚æœå·²é¢†å–ï¼Œæ˜¾ç¤ºWhatsAppæ¨¡æ€æ¡†
                    if (isClaimed) {
                        // æŸ¥æ‰¾å¯¹åº”çš„è®¢å•
                        let orderId = null;
                        let orderStatus = null;
                        if (currentUser && currentUser.account && Array.isArray(userOrders)) {
                            const order = userOrders.find(o =>
                                o &&
                                o.productId === currentProduct.id &&
                                o.account === currentUser.account &&
                                o.status !== 'cancelled'
                            );
                            if (order) {
                                orderId = order.id;
                                orderStatus = order.status;
                            }
                        }
                        
                        // æ£€æŸ¥è®¢å•çŠ¶æ€ï¼šå¦‚æœæ˜¯è¿è¾“ä¸­æˆ–å·²å®Œæˆï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                        if (orderStatus === 'shipping' || orderStatus === 'completed') {
                            if (typeof customAlert === 'function') {
                                customAlert('You have already claimed this product.\n\nPlease select a different item.', 'Information');
                            } else if (typeof showNotification === 'function') {
                                showNotification('You have already claimed this product. Please select a different item.', 'warning');
                            } else {
                                alert('You have already claimed this product.\n\nPlease select a different item.');
                            }
                            return;
                        }
                        
                        // æ˜¾ç¤ºWhatsAppæ¨¡æ€æ¡†
                        if (typeof showWhatsAppModal === 'function') {
                            showWhatsAppModal(orderId);
                        } else {
                            // å¦‚æœæ²¡æœ‰showWhatsAppModalå‡½æ•°ï¼Œç›´æ¥æ‰“å¼€WhatsAppé“¾æ¥
                            const phoneNumber = '+17077902826';
                            const message = orderId 
                                ? `Please confirm my Beefreebies order #${orderId}`
                                : `I want to get my ${currentProduct.name}`;
                            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                            window.open(whatsappUrl, '_blank');
                        }
                    } else {
                        // æœªé¢†å–ï¼Œæ‰“å¼€æŠ¥åæ¨¡æ€æ¡†
                        openSignupModal(currentProduct);
                    }
                });
            }
            if (backBtn) {
                backBtn.addEventListener('click', function (e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    showProductList();
                });
            }

            document.querySelectorAll('#product-detail .review-reply-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const pid = this.getAttribute('data-product-id');
                    const rid = this.getAttribute('data-review-id');
                    const targetType = this.getAttribute('data-target-type') || 'review';
                    const targetUser = this.getAttribute('data-target-user') || '';
                    const targetReplyId = this.getAttribute('data-target-reply-id') || null;
                    handleReviewReply(pid, rid, targetType, targetReplyId, targetUser);
                });
            });

            initProductGalleryControls();
        }

        // æ˜¾ç¤ºäº§å“åˆ—è¡¨
        function showProductList() {
            const productsGrid = document.getElementById('products-grid');
            const productDetail = document.getElementById('product-detail');
            const topCarousel = document.querySelector('.carousel');

            if (!productsGrid || !productDetail) {
                return;
            }

            productDetail.style.display = 'none';
            productsGrid.style.display = 'grid';
            if (topCarousel) topCarousel.style.display = 'block';
        }

        function initProductGalleryControls() {
            const gallery = document.querySelector('#product-detail .product-gallery');
            if (!gallery) return;

            const slides = Array.from(gallery.querySelectorAll('.product-gallery-slide'));
            const thumbs = Array.from(gallery.querySelectorAll('.product-gallery-thumb'));
            if (!slides.length) return;

            let currentIndex = slides.findIndex(slide => slide.classList.contains('active'));
            if (currentIndex < 0) currentIndex = 0;

            const showSlide = (index) => {
                if (!slides.length) return;
                const previousIndex = currentIndex;
                currentIndex = (index + slides.length) % slides.length;

                const directionClass = currentIndex > previousIndex ? 'slide-from-right' : 'slide-from-left';

                slides.forEach((slide, idx) => {
                    const isActive = idx === currentIndex;
                    slide.classList.toggle('active', isActive);
                    slide.classList.remove('slide-from-left', 'slide-from-right');
                    if (isActive) {
                        // è§¦å‘åŠ¨ç”»
                        slide.classList.add(directionClass);
                        slide.addEventListener('animationend', () => {
                            slide.classList.remove('slide-from-left', 'slide-from-right');
                        }, { once: true });
                    }
                });

                thumbs.forEach((thumb, idx) => thumb.classList.toggle('active', idx === currentIndex));
            };

            const prevBtn = gallery.querySelector('[data-action="prev"]');
            const nextBtn = gallery.querySelector('[data-action="next"]');

            if (prevBtn) {
                prevBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showSlide(currentIndex - 1);
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showSlide(currentIndex + 1);
                });
            }

            thumbs.forEach(thumb => {
                thumb.addEventListener('click', (e) => {
                    e.preventDefault();
                    const index = parseInt(thumb.getAttribute('data-index'), 10);
                    if (!isNaN(index)) {
                        showSlide(index);
                    }
                });
            });

            // ç§»åŠ¨ç«¯æ»‘åŠ¨åˆ‡æ¢
            let touchStartX = null;
            let touchStartY = null;

            gallery.addEventListener('touchstart', (e) => {
                if (!e.touches || !e.touches.length) return;
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
            }, { passive: true });

            gallery.addEventListener('touchend', (e) => {
                if (touchStartX === null || !e.changedTouches || !e.changedTouches.length) return;
                const touch = e.changedTouches[0];
                const deltaX = touch.clientX - touchStartX;
                const deltaY = touch.clientY - touchStartY;

                // åªæœ‰å·¦å³æ»‘åŠ¨æ˜æ˜¾æ—¶æ‰è§¦å‘ï¼Œé¿å…ä¸é¡µé¢ä¸Šä¸‹æ»šåŠ¨å†²çª
                if (Math.abs(deltaX) > 40 && Math.abs(deltaX) > Math.abs(deltaY)) {
                    if (deltaX < 0) {
                        // å‘å·¦æ»‘ï¼Œçœ‹ä¸‹ä¸€å¼ 
                        showSlide(currentIndex + 1);
                    } else {
                        // å‘å³æ»‘ï¼Œçœ‹ä¸Šä¸€å¼ 
                        showSlide(currentIndex - 1);
                    }
                }

                touchStartX = null;
                touchStartY = null;
            }, { passive: true });
        }

        function captureSignupFormData() {
            const form = document.getElementById('signup-form');
            if (!form) return null;

            return {
                email: document.getElementById('signup-email')?.value || '',
                notes: document.getElementById('signup-notes')?.value || '',
                address: document.getElementById('signup-address-hidden')?.value || ''
            };
        }

        function restoreSignupFormData() {
            if (!pendingSignupFormData) return;

            const { email, notes } = pendingSignupFormData;
            const emailInput = document.getElementById('signup-email');
            const notesInput = document.getElementById('signup-notes');

            if (emailInput) emailInput.value = email || '';
            if (notesInput) notesInput.value = notes || '';

            // åœ°å€éœ€è¦ç”¨æˆ·é‡æ–°é€‰æ‹©ï¼Œé¿å…æ—§å€¼å¤±æ•ˆ
            const addressHidden = document.getElementById('signup-address-hidden');
            if (addressHidden) {
                addressHidden.value = '';
            }

            pendingSignupFormData = null;
        }

        function prepareReturnToSignup() {
            pendingSignupFormData = captureSignupFormData();
            shouldReturnToSignup = true;
            if (currentProduct) {
                pendingSignupProduct = currentProduct;
            }
        }

        // æ‰“å¼€æŠ¥åæ¨¡æ€æ¡†
        function openSignupModal(product) {
            console.log('ğŸ“ æŠ¥åè°ƒè¯• - ç‚¹å‡»çš„äº§å“:', product);

            if (!currentUser) {
                // æœªç™»å½•æ—¶ï¼Œè®°å½•å¾…é¢†å–çš„äº§å“ï¼Œç„¶åæ‰“å¼€ç™»å½•/æ³¨å†Œé€‰æ‹©æ¨¡æ€æ¡†
                pendingSignupProduct = product;
                const authChoiceModal = document.getElementById('auth-choice-modal');
                if (authChoiceModal) {
                    authChoiceModal.style.display = 'flex';
                }
                return;
            }

            // âœ… æ£€æŸ¥æ˜¯å¦å·²ç»é¢†å–è¿‡è¯¥äº§å“
            if (currentUser && currentUser.account && Array.isArray(userOrders)) {
                const hasExisting = userOrders.some(o =>
                    o &&
                    o.productId === product.id &&
                    o.account === currentUser.account &&
                    o.status !== 'cancelled'
                );
                if (hasExisting) {
                    // ä½¿ç”¨å¼¹çª—æç¤ºï¼Œè€Œä¸æ˜¯é€šçŸ¥
                    customAlert(
                        t('productAlreadyClaimed') || 'è¿™ä¸ªäº§å“å·²ç»é¢†å–è¿‡å•¦ï¼Œå¿«å»çœ‹çœ‹å…¶å®ƒå¥½ç‰©å§ï¼',
                        t('infoTitle') || 'æç¤º'
                    );
                    return;
                }
            }

            // ğŸ’ é¢†å–å‰æ£€æŸ¥èœœç½
            try {
                const user = findUserByAccount(currentUser.account);
                const currentPoints = (user && user.points != null && !isNaN(user.points))
                    ? Number(user.points)
                    : 1;

                if (currentPoints <= 0) {
                    // ä¹‹å‰ç”¨å³ä¸Šè§’æ°”æ³¡æç¤ºï¼Œç°åœ¨æ”¹ä¸ºå¼¹çª—æç¤ºï¼Œé¿å…"æ²¡ååº”"çš„æ„Ÿè§‰
                    const isEnglish = (typeof t === 'function' && t('pointsBalance') === 'Honey Balance') || 
                                      (typeof window !== 'undefined' && window.currentLanguage === 'en');
                    const alertMessage = isEnglish 
                        ? 'Balance: 0<br><br>â€¢ Write a review to earn <span class="honey-highlight">Honey</span>.<br><br>â€¢ Contact support for help.'
                        : 'ä½™é¢: 0<br><br>â€¢ å®Œæˆè¯„ä»·å¯è·å¾—<span class="honey-highlight">èœœç½</span>ã€‚<br><br>â€¢ å¦‚éœ€å¸®åŠ©ï¼Œè¯·è”ç³»å®¢æœã€‚';
                    const alertTitle = isEnglish ? 'Out of Honey' : 'èœœç½ä¸è¶³';
                    customAlert(alertMessage, alertTitle);
                    return;
                }
            } catch (err) {
                console.warn('æ£€æŸ¥é¢†å–èœœç½æ—¶å‡ºé”™ï¼Œå…è®¸ç»§ç»­é¢†å–ä»¥é¿å…é˜»å¡:', err);
            }

            if (!product) {
                console.error('âŒ æŠ¥åå¤±è´¥ï¼šäº§å“æ•°æ®ä¸ºç©º');
                customAlert(t('systemError'), t('errorTitle'));
                return;
            }

            currentProduct = product;
            const signupModal = document.getElementById('signup-modal');

            // å¡«å……äº§å“ä¿¡æ¯
            document.getElementById('signup-product-name').value = product.name;

            // å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œé¢„å¡«ç”¨æˆ·ä¿¡æ¯
            if (currentUser) {
                const emailInput = document.getElementById('signup-email');
                if (emailInput) {
                    emailInput.value = currentUser.account.includes('@') ? currentUser.account : '';
                }
            }

            // æ›´æ–°åœ°å€é€‰æ‹©å™¨
            updateSignupAddressSelector();

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            signupModal.style.display = 'flex';
            document.body.classList.add('modal-open');
            console.log('âœ… æŠ¥åæ¨¡æ€æ¡†å·²æ‰“å¼€');

            if (pendingSignupFormData) {
                restoreSignupFormData();
            }
        }

        // æ›´æ–°æŠ¥åè¡¨å•ä¸­çš„åœ°å€é€‰æ‹©å™¨
        function updateSignupAddressSelector() {
            const addressSelect = document.getElementById('signup-address-select');
            const addressBtn = document.getElementById('signup-address-btn');
            const addressHidden = document.getElementById('signup-address-hidden');
            
            if (!addressSelect || !addressBtn || !addressHidden) return;

            // è·å–å½“å‰ç”¨æˆ·çš„åœ°å€åˆ—è¡¨ï¼ˆä¼˜å…ˆä½¿ç”¨å…¨å±€å˜é‡ï¼Œç¡®ä¿æ•°æ®åŒæ­¥ï¼‰
            let addresses = [];
            if (currentUser && currentUser.account) {
                // ä¼˜å…ˆä½¿ç”¨å…¨å±€å˜é‡ userAddresses
                if (Array.isArray(userAddresses) && userAddresses.length > 0) {
                    const normalizedCurrentAccount = normalizeAccount(currentUser.account);
                    addresses = userAddresses.filter(addr => !addr.account || normalizeAccount(addr.account) === normalizedCurrentAccount);
                } else {
                    // å¦‚æœå…¨å±€å˜é‡ä¸ºç©ºï¼Œä» localStorage è¯»å–
                    const userAddressesKey = `userAddresses_${currentUser.account}`;
                    addresses = JSON.parse(localStorage.getItem(userAddressesKey)) || JSON.parse(localStorage.getItem('userAddresses')) || [];
                    // è¿‡æ»¤æ‰ä¸å±äºå½“å‰ç”¨æˆ·çš„åœ°å€
                    const normalizedCurrentAccount = normalizeAccount(currentUser.account);
                    addresses = addresses.filter(addr => !addr.account || normalizeAccount(addr.account) === normalizedCurrentAccount);
                }
            } else {
                // æœªç™»å½•ç”¨æˆ·ï¼Œä½¿ç”¨å…¨å±€å˜é‡æˆ– localStorage
                addresses = Array.isArray(userAddresses) && userAddresses.length > 0 
                    ? userAddresses 
                    : JSON.parse(localStorage.getItem('userAddresses')) || [];
            }

            // æ¸…ç©ºé€‰æ‹©å™¨
            addressSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åœ°å€</option>';
            addressHidden.value = '';

            if (addresses.length > 0) {
                // æœ‰åœ°å€ï¼Œæ˜¾ç¤ºä¸‹æ‹‰é€‰æ‹©æ¡†
                addressSelect.style.display = 'block';
                addressBtn.style.display = 'none';

                // å¡«å……åœ°å€é€‰é¡¹
                addresses.forEach((address) => {
                    // æ„å»ºå®Œæ•´åœ°å€å­—ç¬¦ä¸²
                    const fullAddress = address.state 
                        ? [
                            address.detail,
                            address.unit,
                            address.city,
                            address.state,
                            address.postal
                          ].filter(Boolean).join(', ')
                        : [
                            address.province || '',
                            address.city || '',
                            address.district || '',
                            address.detail || ''
                          ].filter(Boolean).join(' ');

                    const addressText = `${address.name} - ${address.phone} - ${fullAddress}${address.isDefault ? ' (é»˜è®¤)' : ''}`;
                    const option = document.createElement('option');
                    const payload = JSON.stringify({
                        name: address.name,
                        phone: address.phone,
                        address: fullAddress,
                        detail: address.detail || address.street || '',
                        unit: address.unit || '',
                        city: address.city || '',
                        state: address.state || '',
                        postal: address.postal || address.zip || '',
                        country: address.country || 'US',
                        full: addressText
                    });
                    option.value = payload;
                    option.textContent = addressText;
                    if (address.isDefault) {
                        option.selected = true;
                        addressHidden.value = payload;
                    }
                    addressSelect.appendChild(option);
                });

                // å¦‚æœæ²¡æœ‰é»˜è®¤åœ°å€ï¼Œé»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªæœ‰æ•ˆåœ°å€
                if (!addressHidden.value && addressSelect.options.length > 1) {
                    addressSelect.options[1].selected = true;
                    addressHidden.value = addressSelect.options[1].value;
                }

                // ç›‘å¬åœ°å€é€‰æ‹©å˜åŒ–
                addressSelect.onchange = function() {
                    if (this.value) {
                        addressHidden.value = this.value;
                    } else {
                        addressHidden.value = '';
                    }
                };
            } else {
                // æ²¡æœ‰åœ°å€ï¼Œæ˜¾ç¤ºè·³è½¬æŒ‰é’®
                addressSelect.style.display = 'none';
                addressBtn.style.display = 'block';
                
                // æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼šè·³è½¬åˆ°ç”¨æˆ·ä¸­å¿ƒåœ°å€é¡µé¢
                // å…ˆç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤ç»‘å®š
                const newAddressBtn = addressBtn.cloneNode(true);
                addressBtn.parentNode.replaceChild(newAddressBtn, addressBtn);
                
                // é‡æ–°è·å–æŒ‰é’®å¼•ç”¨
                const updatedAddressBtn = document.getElementById('signup-address-btn');
                if (updatedAddressBtn) {
                    // æ›´æ–°æŒ‰é’®æ–‡æœ¬ï¼ˆå›½é™…åŒ–ï¼‰
                    const btnText = document.getElementById('signup-address-btn-text');
                    if (btnText && typeof t === 'function') {
                        btnText.textContent = t('goToAddressPage');
                    }
                    
                    // ç»‘å®šç‚¹å‡»äº‹ä»¶
                    updatedAddressBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        prepareReturnToSignup();
                        
                        console.log('ğŸ“ ç‚¹å‡»äº†"å‰å¾€ç”¨æˆ·ä¸­å¿ƒæ·»åŠ åœ°å€"æŒ‰é’®');
                        
                        // å…³é—­æŠ¥åæ¨¡æ€æ¡†
                        if (typeof closeModal === 'function') {
                            closeModal('signup-modal');
                        }
                        
                        // æ˜¾ç¤ºç”¨æˆ·ä¸­å¿ƒå¹¶åˆ‡æ¢åˆ°åœ°å€é¡µé¢
                        if (typeof showUserCenter === 'function') {
                            showUserCenter();
                        }
                        
                        if (typeof showUserPage === 'function') {
                            showUserPage('address');
                        }
                        
                        // æ‰“å¼€åœ°å€æ·»åŠ æ¨¡æ€æ¡†
                        setTimeout(() => {
                            const addressModal = document.getElementById('address-modal');
                            if (addressModal) {
                                addressModal.style.display = 'flex';
                                console.log('âœ… åœ°å€æ·»åŠ æ¨¡æ€æ¡†å·²æ‰“å¼€');
                            } else {
                                console.warn('âš ï¸ æœªæ‰¾åˆ°åœ°å€æ·»åŠ æ¨¡æ€æ¡†');
                            }
                        }, 300);
                        
                        // æç¤ºç”¨æˆ·éœ€è¦å¡«å†™åœ°å€
                        const currentLang = localStorage.getItem('language') || 'zh';
                        if (typeof showNotification === 'function') {
                            showNotification(currentLang === 'zh' ? 'è¯·å…ˆå¡«å†™æ”¶è´§åœ°å€' : 'Please fill in your shipping address first', 'info');
                        }
                    });
                    
                    console.log('âœ… åœ°å€æŒ‰é’®ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š');
                } else {
                    console.error('âŒ æ— æ³•æ‰¾åˆ°åœ°å€æŒ‰é’®å…ƒç´ ');
                }
            }
        }

        // æ¸²æŸ“ç”¨æˆ·è®¢å•
        function renderUserOrders() {
            const orderContainers = {
                'all': document.getElementById('order-all'),
                'pending': document.getElementById('order-pending'),
                'review': document.getElementById('order-review'),
                'shipping': document.getElementById('order-shipping'),
                'completed': document.getElementById('order-completed'),
                'rejected': document.getElementById('order-rejected'),
                'cancelled': document.getElementById('order-cancelled')
            };

            // æ¸…ç©ºæ‰€æœ‰è®¢å•å®¹å™¨
            Object.values(orderContainers).forEach(container => {
                if (container) container.innerHTML = '';
            });

            // ç¡®ä¿userOrdersæ˜¯æ•°ç»„ä¸”åªåŒ…å«å½“å‰ç”¨æˆ·çš„è®¢å•
            if (!Array.isArray(userOrders)) {
                userOrders = [];
            }

            // è¿‡æ»¤æ‰ä¸å±äºå½“å‰ç”¨æˆ·çš„è®¢å•ï¼ˆå¦‚æœæœ‰accountå­—æ®µï¼‰
            if (currentUser && currentUser.account) {
                userOrders = userOrders.filter(order => {
                    // å¦‚æœè®¢å•æœ‰accountå­—æ®µï¼Œåªæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„è®¢å•
                    if (order.account) {
                        return order.account === currentUser.account;
                    }
                    // æ—§æ•°æ®æ²¡æœ‰accountå­—æ®µï¼Œä¿ç•™ï¼ˆå…¼å®¹æ€§ï¼‰
                    return true;
                });
            }

            if (userOrders.length === 0) {
                if (orderContainers.all) orderContainers.all.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t('noOrders')}</p>`;
                if (orderContainers.review) orderContainers.review.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t('noReviewOrders')}</p>`;
                if (orderContainers.shipping) orderContainers.shipping.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t('noShippingOrders')}</p>`;
                if (orderContainers.completed) orderContainers.completed.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t('noCompletedOrders')}</p>`;
                if (orderContainers.rejected) orderContainers.rejected.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t('noRejectedOrders')}</p>`;
                if (orderContainers.cancelled) orderContainers.cancelled.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t('noCancelledOrders')}</p>`;
                return;
            }

            userOrders.forEach(order => {
                // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå–æ¶ˆè®¢å•æŒ‰é’®ï¼ˆè¿è¾“ä¸­ä¹‹å‰çš„çŠ¶æ€ï¼špendingæˆ–reviewï¼‰
                // ä¸åŒºåˆ†ç®¡ç†å‘˜ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥å–æ¶ˆè®¢å•
                const isPendingOrReview = order.status === 'pending' || order.status === 'review';
                const canCancel = isPendingOrReview && currentUser;
                
                // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºè¯„ä»·æŒ‰é’®ï¼ˆå·²å®Œæˆä¸”æœªè¯„ä»·ï¼‰
                // ä¸åŒºåˆ†ç®¡ç†å‘˜ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è¯„ä»·
                const isCompleted = order.status === 'completed';
                const hasNotReviewed = !order.hasReview || order.hasReview === false || order.hasReview === 'false';
                const showReviewBtn = isCompleted && currentUser && hasNotReviewed;
                
                // ä½¿ç”¨æ›´å®½æ¾çš„åŒ¹é…æ–¹å¼ï¼Œå…¼å®¹å­—ç¬¦ä¸²å’Œæ•°å­—ç±»å‹çš„ID
                const relatedProduct = products.find(p => {
                    if (!p || !p.id || !order.productId) return false;
                    const pId = String(p.id).trim();
                    const orderProductId = String(order.productId).trim();
                    return pId === orderProductId;
                });
                const originalPrice = relatedProduct && relatedProduct.price !== undefined
                    ? relatedProduct.price
                    : (order.originalPrice !== undefined ? order.originalPrice : order.price || 0);
                const promoPriceRaw = relatedProduct && relatedProduct.newPrice !== undefined
                    ? relatedProduct.newPrice
                    : (order.promoPrice !== undefined ? order.promoPrice : 0);
                const formattedOldPrice = formatCurrency(originalPrice);
                const formattedNewPrice = formatCurrency(promoPriceRaw);
                const formattedDate = formatDate(order.date);
                
                // æ£€æŸ¥äº§å“æ˜¯å¦æœ‰è·³è½¬é“¾æ¥ï¼Œä¸”è®¢å•çŠ¶æ€ä¸ºpendingæˆ–reviewï¼ˆä¸¤è€…éƒ½æ˜¾ç¤ºä¸º"Pending"ï¼‰
                const orderStatus = String(order.status || '').toLowerCase();
                const isPending = orderStatus === 'pending' || orderStatus === 'review';
                const hasRedirectUrl = isPending && relatedProduct && relatedProduct.redirectUrl && String(relatedProduct.redirectUrl || '').trim() !== '';

                const orderHtml = `
                    <div class="order-item" data-order-id="${order.id}" style="cursor: pointer; position: relative;">
                        <div class="order-image" style="background-image: url('${order.image}')"></div>
                        <div class="order-details" style="flex: 1;">
                            <div class="order-title">${order.productName}</div>
                            <div class="order-price">
                                <span class="order-price-old">${formattedOldPrice}</span>
                                <span class="order-price-new">${formattedNewPrice}</span>
                            </div>
                            ${formattedDate ? `<div class="order-date">${formattedDate}</div>` : ''}
                            <div style="display: flex; align-items: center; gap: 8px; margin: 8px 0;">
                                <span style="font-weight: 500; color: #666;">${t('orderId')}:</span>
                                <span style="font-family: monospace; color: var(--primary); font-weight: 500;">${order.id}</span>
                                <button type="button" class="btn order-copy-btn" onclick="event.stopPropagation(); copyOrderId('${order.id}');" title="${t('copyOrderId') || 'å¤åˆ¶è®¢å•å·'}">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <div class="order-status status-${order.status}" style="margin: 8px 0;">${getStatusText(order.status)}</div>
                            ${(canCancel || showReviewBtn || hasRedirectUrl) ? `
                            <div class="order-action-buttons">
                                ${canCancel ? `
                                    <button class="btn btn-danger btn-sm" onclick="event.stopPropagation(); cancelOrder(${order.id});" 
                                            style="padding: 8px 16px; font-size: 13px; border-radius: 6px; font-weight: 500; box-shadow: 0 2px 4px rgba(231,76,60,0.2); transition: all 0.3s;"
                                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(231,76,60,0.3)';"
                                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(231,76,60,0.2)';">
                                        <i class="fas fa-times-circle" style="margin-right: 6px;"></i>${t('cancelOrder')}
                                    </button>
                                ` : ''}
                                ${hasRedirectUrl ? `
                                    <a href="${relatedProduct.redirectUrl}" target="_blank" rel="noopener noreferrer" 
                                       class="btn btn-primary btn-sm" 
                                       onclick="event.stopPropagation();"
                                       style="padding: 8px 16px; font-size: 13px; border-radius: 6px; font-weight: 500; box-shadow: 0 2px 4px rgba(52,152,219,0.2); transition: all 0.3s; text-decoration: none; display: inline-flex; justify-content: center; align-items: center; gap: 8px;"
                                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(52,152,219,0.3)';"
                                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(52,152,219,0.2)';">
                                        <i class="fas fa-shopping-cart"></i><span style="display:inline-block; text-align:center;">Place the order</span>
                                    </a>
                                ` : ''}
                                ${canCancel ? `
                                    <button class="btn btn-success btn-sm" onclick="event.stopPropagation(); confirmOrderAgain(${order.id});"
                                            style="padding: 8px 16px; font-size: 13px; border-radius: 6px; font-weight: 500; box-shadow: 0 2px 4px rgba(16,124,16,0.2); transition: all 0.3s;"
                                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(16,124,16,0.3)';"
                                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(16,124,16,0.2)';">
                                        <i class="fas fa-check-circle" style="margin-right: 6px;"></i>${t('confirmOrderAgain')}
                                    </button>
                                ` : ''}
                                ${showReviewBtn ? `
                                    <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); openReviewModal(${order.id});" 
                                            style="padding: 8px 16px; font-size: 13px; border-radius: 6px; font-weight: 500; box-shadow: 0 2px 4px rgba(52,152,219,0.2); transition: all 0.3s;"
                                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(52,152,219,0.3)';"
                                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(52,152,219,0.2)';">
                                        <i class="fas fa-star" style="margin-right: 6px;"></i>${t('writeReview')}
                                    </button>
                                ` : ''}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                // æ·»åŠ åˆ°å…¨éƒ¨è®¢å•
                orderContainers.all.innerHTML += orderHtml;

                // æ·»åŠ åˆ°å¯¹åº”çŠ¶æ€è®¢å•
                // pendingçŠ¶æ€ä¹Ÿæ˜¾ç¤ºåœ¨reviewå®¹å™¨ä¸­
                if (order.status === 'pending' && orderContainers.review) {
                    orderContainers.review.innerHTML += orderHtml;
                } else if (orderContainers[order.status]) {
                    orderContainers[order.status].innerHTML += orderHtml;
                }
            });

            // ä¸ºæ‰€æœ‰è®¢å•é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.order-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    const orderId = this.getAttribute('data-order-id');
                    if (orderId) {
                        // ä½¿ç”¨normalizeOrderIdç¡®ä¿å…¼å®¹æ–°æ—§è®¢å•IDæ ¼å¼ï¼ˆæ•°å­—æˆ–å­—ç¬¦ä¸²ï¼‰
                        showOrderDetailsModal(normalizeOrderId(orderId));
                    }
                });
            });

            // å¤„ç†ç©ºçŠ¶æ€
            Object.entries(orderContainers).forEach(([status, container]) => {
                if (status !== 'all' && container && container.innerHTML === '') {
                    let emptyText = '';
                    if (status === 'review') emptyText = t('noReviewOrders');
                    else if (status === 'shipping') emptyText = t('noShippingOrders');
                    else if (status === 'completed') emptyText = t('noCompletedOrders');
                    else if (status === 'rejected') emptyText = t('noRejectedOrders');
                    else if (status === 'cancelled') emptyText = t('noCancelledOrders');
                    else emptyText = t('noOrders');
                    container.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${emptyText}</p>`;
                }
            });
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': t('orderReview'), // pendingçŠ¶æ€ä¹Ÿæ˜¾ç¤ºä¸º"å¾…ä¸Šä¼ "
                'review': t('orderReview'),
                'shipping': t('orderShipping'),
                'rejected': t('orderRejected'),
                'cancelled': t('orderCancelled'),
                'completed': t('orderCompleted')
            };
            return statusMap[status] || status;
        }

        function formatDeviceLabel(deviceId) {
            if (!deviceId) return '';
            const cleanId = String(deviceId).trim();
            if (!cleanId) return '';
            const suffix = cleanId.slice(-4).toUpperCase();
            return `è®¾å¤‡${suffix}`;
        }

        function getCategoryLabel(category) {
            if (currentLanguage === 'en') {
                const map = {
                    'electronics': 'Electronics',
                    'home': 'Home & Living',
                    'clothing': 'Clothing & Shoes',
                    'beauty': 'Beauty & Skincare'
                };
                return map[category] || 'Featured';
            } else {
            const map = {
                'electronics': 'Electronics',
                'home': 'Home & Living',
                'clothing': 'Clothing & Shoes',
                'beauty': 'Beauty & Skincare'
            };
            return map[category] || 'Featured';
            }
        }

        // åå°ç®¡ç†é¡µé¢åˆ‡æ¢ - ç«‹å³å“åº”ï¼Œæ•°æ®å¼‚æ­¥åŠ è½½
        function showAdminPage(tab) {
            // éšè—æ‰€æœ‰é¡µé¢
            const pages = document.querySelectorAll('.admin-page');
            pages.forEach(page => page.classList.remove('active'));

            // æ‰¾åˆ°ç›®æ ‡é¡µé¢
            let targetPage = null;
            switch (tab) {
                case 'products':
                    targetPage = document.getElementById('admin-products');
                    break;
                case 'users':
                    targetPage = document.getElementById('admin-users');
                    break;
                case 'orders':
                    targetPage = document.getElementById('admin-orders');
                    break;
                case 'reviews':
                    targetPage = document.getElementById('admin-reviews');
                    break;
                case 'homepage':
                    targetPage = document.getElementById('admin-homepage');
                    break;
                case 'statistics':
                    targetPage = document.getElementById('admin-statistics');
                    break;
            }

            if (!targetPage) return;

            // ç«‹å³æ˜¾ç¤ºç›®æ ‡é¡µé¢
            targetPage.classList.add('active');

            // å°†æ•°æ®åŠ è½½æ”¾å…¥å¾®ä»»åŠ¡/å¼‚æ­¥ï¼Œé¿å…é˜»å¡ç‚¹å‡»
            queueMicrotask(() => {
                switch (tab) {
                    case 'products':
                        renderAdminProducts();
                        break;
                    case 'users':
                        // å…ˆæ¸²æŸ“è¡¨æ ¼ï¼Œå†å¼‚æ­¥æ›´æ–°çŠ¶æ€
                        renderUsersTable();
                        Promise.resolve()
                            .then(() => updateAllUsersOnlineStatus())
                            .then(() => {
                                renderUsersTable();
                            })
                            .catch(() => {
                                // æ›´æ–°å¤±è´¥ä¹Ÿä¸é˜»å¡é¡µé¢æ˜¾ç¤º
                            });
                        // å¦‚æœè®¾å¤‡é™åˆ¶åˆ—è¡¨å·²å±•å¼€ï¼Œæ›´æ–°æ˜¾ç¤º
                        const deviceLimitsList = document.getElementById('device-limits-list');
                        if (deviceLimitsList && deviceLimitsList.style.display !== 'none') {
                            updateDeviceLimitsList();
                        }
                        break;
                    case 'orders':
                        // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œç¡®ä¿åŠ è½½æ‰€æœ‰è®¢å•
                        const loadOrders = () => {
                            renderOrdersTable();
                        };
                        if (currentUser && currentUser.role === 'admin' && cloudSync && cloudSync.isInitialized) {
                            if (allOrders.length === 0 || allOrders.length < userOrders.length) {
                                renderOrdersTable(); // å…ˆå±•ç¤ºå·²æœ‰æ•°æ®
                                Promise.resolve()
                                    .then(() => cloudSync.loadAllOrders())
                                    .then(() => {
                                        renderOrdersTable();
                                    })
                                    .catch(err => {
                                        console.error('åŠ è½½æ‰€æœ‰è®¢å•å¤±è´¥:', err);
                                    });
                            } else {
                                loadOrders();
                            }
                        } else {
                            loadOrders();
                        }
                        break;
                    case 'reviews':
                        renderReviewsTable();
                        break;
                    case 'homepage':
                        loadHomepageSettings();
                        break;
                    case 'statistics':
                        renderStatistics();
                        break;
                }
            });
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿å‡½æ•°
        function copyToClipboard(text, element) {
            if (!text || text.trim() === '') return false;
            
            // ç§»é™¤HTMLæ ‡ç­¾ï¼Œåªä¿ç•™æ–‡æœ¬å†…å®¹
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            const plainText = tempDiv.textContent || tempDiv.innerText || text;
            
            // ä½¿ç”¨ç°ä»£ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(plainText).then(() => {
                    showCopyTooltip(element, 'å·²å¤åˆ¶!');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyToClipboard(plainText, element);
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopyToClipboard(plainText, element);
            }
        }

        // é™çº§å¤åˆ¶æ–¹æ¡ˆ
        function fallbackCopyToClipboard(text, element) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyTooltip(element, 'å·²å¤åˆ¶!');
                } else {
                    showCopyTooltip(element, 'å¤åˆ¶å¤±è´¥');
                }
            } catch (err) {
                console.error('é™çº§å¤åˆ¶å¤±è´¥:', err);
                showCopyTooltip(element, 'å¤åˆ¶å¤±è´¥');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        // æ˜¾ç¤ºå¤åˆ¶æç¤º
        function showCopyTooltip(element, message) {
            // ç§»é™¤å·²å­˜åœ¨çš„æç¤º
            const existingTooltip = element.querySelector('.copy-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }

            // åˆ›å»ºæ–°æç¤º
            const tooltip = document.createElement('div');
            tooltip.className = 'copy-tooltip';
            tooltip.textContent = message;
            element.style.position = 'relative';
            element.appendChild(tooltip);

            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                tooltip.classList.add('show');
            }, 10);

            // 2ç§’åç§»é™¤
            setTimeout(() => {
                tooltip.classList.remove('show');
                setTimeout(() => {
                    if (tooltip.parentNode) {
                        tooltip.parentNode.removeChild(tooltip);
                    }
                }, 300);
            }, 2000);
        }

        // ä¸ºè¡¨æ ¼å•å…ƒæ ¼ç»‘å®šå¤åˆ¶äº‹ä»¶
        function bindCopyEvents(tableId, excludeColumns = []) {
            const table = document.getElementById(tableId);
            if (!table) return;

            const tbody = table.querySelector('tbody');
            if (!tbody) return;

            // è·å–è¡¨å¤´ï¼Œç¡®å®šå“ªäº›åˆ—éœ€è¦æ’é™¤
            const headers = table.querySelectorAll('thead th');
            const excludeIndices = new Set();
            headers.forEach((th, index) => {
                const headerText = th.textContent.trim().toLowerCase();
                // æ’é™¤æ“ä½œåˆ—ã€å¤é€‰æ¡†åˆ—
                if (headerText.includes('æ“ä½œ') || 
                    headerText.includes('action') || 
                    th.querySelector('input[type="checkbox"]') ||
                    excludeColumns.includes(index)) {
                    excludeIndices.add(index);
                }
            });

            // ä¸ºæ¯ä¸ªå•å…ƒæ ¼ç»‘å®šç‚¹å‡»äº‹ä»¶
            tbody.querySelectorAll('tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach((cell, index) => {
                    // è·³è¿‡æ’é™¤çš„åˆ—
                    if (excludeIndices.has(index)) {
                        return;
                    }

                    // è·³è¿‡åŒ…å«å¤é€‰æ¡†çš„å•å…ƒæ ¼
                    if (cell.querySelector('input[type="checkbox"]')) {
                        return;
                    }

                    // æ£€æŸ¥æ˜¯å¦åŒ…å«æŒ‰é’®ï¼ˆæ“ä½œåˆ—ï¼‰
                    const hasButton = cell.querySelector('button');
                    if (hasButton) {
                        return;
                    }

                    // æ·»åŠ å¯å¤åˆ¶æ ·å¼ç±»
                    cell.classList.add('copyable-cell');
                    
                    // ç»‘å®šç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('click', function(e) {
                        // å¦‚æœç‚¹å‡»çš„æ˜¯é“¾æ¥ï¼Œä¸è§¦å‘å¤åˆ¶ï¼ˆè®©é“¾æ¥æ­£å¸¸å·¥ä½œï¼‰
                        if (e.target.tagName === 'A' || e.target.closest('a')) {
                            return;
                        }
                        
                        // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘å¤åˆ¶
                        if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                            return;
                        }
                        
                        e.stopPropagation();
                        
                        // è·å–è¦å¤åˆ¶çš„æ–‡æœ¬
                        let textToCopy = '';
                        // å¦‚æœå•å…ƒæ ¼å†…æœ‰é“¾æ¥ï¼Œå¤åˆ¶é“¾æ¥çš„æ–‡æœ¬å†…å®¹
                        const link = cell.querySelector('a');
                        if (link) {
                            textToCopy = link.textContent.trim();
                        } else {
                            // å¦åˆ™å¤åˆ¶æ•´ä¸ªå•å…ƒæ ¼çš„æ–‡æœ¬
                            textToCopy = cell.textContent.trim();
                        }
                        
                        if (textToCopy) {
                            copyToClipboard(textToCopy, cell);
                        }
                    });
                });
            });
        }

        // æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼
        // è®¡ç®—æ³¨å†Œå¤©æ•°
        function getRegisterDays(registerTime) {
            if (!registerTime) return 0;
            try {
                const registerDate = new Date(registerTime);
                const now = new Date();
                const diffTime = now - registerDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            } catch (e) {
                return 0;
            }
        }

        function renderUsersTable() {
            const tbody = document.getElementById('users-table-body');

            // åªå±•ç¤ºæ™®é€šç”¨æˆ·ï¼ˆå†…ç½®ç®¡ç†å‘˜è´¦å·ä¸åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼‰
            const allUsersList = [...allUsers];

            // ç»Ÿè®¡æ¯ä¸ªè®¾å¤‡IDæ³¨å†Œçš„è´¦å·æ•°é‡ï¼ˆä»…æ™®é€šç”¨æˆ·ï¼‰
            const deviceUserCountMap = {};
            allUsersList.forEach(user => {
                if (user.role !== 'admin' && user.deviceId) {
                    deviceUserCountMap[user.deviceId] = (deviceUserCountMap[user.deviceId] || 0) + 1;
                }
            });

            if (allUsersList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">æš‚æ— ç”¨æˆ·æ•°æ®</td></tr>';
                return;
            }

            // ç§»é™¤å·²ä¸å­˜åœ¨çš„é€‰ä¸­è´¦å·ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æ¯”è¾ƒï¼‰
            selectedUserAccounts.forEach(account => {
                const normalizedAccount = normalizeAccount(account);
                if (!allUsersList.some(u => {
                    if (u.role === 'admin') return false;
                    if (u.accountCanonical) {
                        return u.accountCanonical === normalizedAccount;
                    }
                    return normalizeAccount(u.account) === normalizedAccount;
                })) {
                    selectedUserAccounts.delete(account);
                }
            });

            let filteredUsers = allUsersList.filter(user => {
                const userStatus = user.status || 'active';

                if (userFilterRole && user.role !== userFilterRole) {
                    return false;
                }

                if (userFilterStatus && userStatus !== userFilterStatus) {
                    return false;
                }

                // åœ¨çº¿çŠ¶æ€ç­›é€‰
                if (userFilterOnline) {
                    const isOnline = userOnlineStatus[user.account] === true;
                    if (userFilterOnline === 'online' && !isOnline) {
                        return false;
                    }
                    if (userFilterOnline === 'offline' && isOnline) {
                        return false;
                    }
                }

                // æ³¨å†Œæ—¥æœŸç­›é€‰
                if (userFilterRegisterDateStart || userFilterRegisterDateEnd) {
                    if (user.registerTime) {
                        try {
                            const registerDate = new Date(user.registerTime);
                            const registerDateStr = registerDate.toISOString().split('T')[0];
                            
                            if (userFilterRegisterDateStart && registerDateStr < userFilterRegisterDateStart) {
                                return false;
                            }
                            if (userFilterRegisterDateEnd && registerDateStr > userFilterRegisterDateEnd) {
                                return false;
                            }
                        } catch (e) {
                            // æ—¥æœŸè§£æå¤±è´¥ï¼Œè·³è¿‡æ­¤ç­›é€‰
                        }
                    } else {
                        // æ²¡æœ‰æ³¨å†Œæ—¶é—´ï¼Œå¦‚æœè®¾ç½®äº†ç­›é€‰åˆ™æ’é™¤
                        if (userFilterRegisterDateStart || userFilterRegisterDateEnd) {
                            return false;
                        }
                    }
                }

                if (userDeviceFilter) {
                    const filterValue = userDeviceFilter.toLowerCase();
                    const rawDevice = (user.deviceId || '').toLowerCase();
                    const label = formatDeviceLabel(user.deviceId).toLowerCase();
                    if (!rawDevice.includes(filterValue) && !label.includes(filterValue)) {
                        return false;
                    }
                }

                if (userSearchTerm) {
                    const term = userSearchTerm.toLowerCase();
                    const fields = [
                        user.username || '',
                        user.account || '',
                        user.email || '',
                        user.phone || ''
                    ];
                    const matched = fields.some(field => field.toLowerCase().includes(term));
                    if (!matched) {
                        return false;
                    }
                }

                return true;
            });

            if (filteredUsers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·</td></tr>';
                updatePaginationControls('users', 0);
                return;
            }

            const { items: paginatedUsers } = getPaginatedItems(filteredUsers, 'users');

            tbody.innerHTML = paginatedUsers.map(user => {
                // è·å–ç”¨æˆ·å¯†ç 
                let userPassword = '******';
                if (user.role === 'admin') {
                    const adminInfo = ADMIN_ACCOUNTS[user.account];
                    userPassword = adminInfo ? adminInfo.password : 'ç³»ç»Ÿé¢„è®¾';
                } else {
                    userPassword = user.password || 'æœªè®¾ç½®';
                }

                // è·å–ç”¨æˆ·çŠ¶æ€
                const userStatus = user.status || 'active';
                const userPoints = (user.points == null || isNaN(user.points)) ? 1 : Number(user.points);
                const statusBadge = userStatus === 'banned'
                    ? '<span class="status-badge status-banned">å·²ç¦ç”¨</span>'
                    : '<span class="status-badge status-active">æ­£å¸¸</span>';

                // æ˜¯å¦ä¸ºåŒè®¾å¤‡æ³¨å†Œçš„å¤šä¸ªè´¦å·ï¼ˆæ™®é€šç”¨æˆ·ï¼‰
                const isSuspiciousDevice =
                    user.role !== 'admin' &&
                    user.deviceId &&
                    deviceUserCountMap[user.deviceId] > 1;

                const deviceLabel = formatDeviceLabel(user.deviceId);
                // è·å–è®¾å¤‡æ³¨å†Œé™åˆ¶ä¿¡æ¯
                const deviceLimit = user.deviceId ? getDeviceRegisterLimit(user.deviceId) : null;
                const deviceCurrentCount = user.deviceId ? (deviceUserCountMap[user.deviceId] || 0) : 0;
                const deviceLimitInfo = user.deviceId && deviceLimit !== null
                    ? ` (${deviceCurrentCount}/${deviceLimit})`
                    : '';
                const suspiciousBadge = isSuspiciousDevice && deviceLabel
                    ? `<span class="status-badge status-pending" style="margin-left:6px;" title="åŒä¸€è®¾å¤‡æ³¨å†Œäº†å¤šä¸ªè´¦å·${deviceLimitInfo ? 'ï¼Œé™åˆ¶ï¼š' + deviceLimit + 'ï¼Œå½“å‰ï¼š' + deviceCurrentCount : ''}">${deviceLabel}${deviceLimitInfo}</span>`
                    : (deviceLabel ? `<span class="status-badge" style="margin-left:6px; background-color: #6c757d; color: white;" title="è®¾å¤‡æ³¨å†Œé™åˆ¶ï¼š${deviceLimit}ï¼Œå½“å‰ï¼š${deviceCurrentCount}">${deviceLabel}${deviceLimitInfo}</span>` : '');

                let rowStyle = '';
                if (userStatus === 'banned') {
                    rowStyle = 'style="opacity: 0.6; background-color: #fff3f3;"';
                } else if (isSuspiciousDevice) {
                    rowStyle = 'style="background-color: #fffdf3;"';
                }

                const selectable = user.role !== 'admin';
                const isChecked = selectable && selectedUserAccounts.has(user.account);

                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨çº¿
                const isOnline = userOnlineStatus[user.account] === true;
                const onlineIndicator = isOnline 
                    ? '<span class="online-indicator" title="ç”¨æˆ·åœ¨çº¿" style="display: inline-block; width: 8px; height: 8px; background-color: #28a745; border-radius: 50%; margin-right: 6px; vertical-align: middle;"></span>' 
                    : '';

                return `
                    <tr ${rowStyle}>
                        <td class="select-col">
                            ${selectable ? `<input type="checkbox" class="user-select-checkbox" data-account="${user.account}" ${isChecked ? 'checked' : ''}>` : ''}
                        </td>
                        <td>${user.id}</td>
                        <td>${onlineIndicator}${user.username || ''}${user.registerTime ? `<span style="color: #666; font-size: 0.9em; margin-left: 5px;">(æ³¨å†Œ${getRegisterDays(user.registerTime)}å¤©)</span>` : ''}${suspiciousBadge}</td>
                        <td>${user.account}</td>
                        <td>${userPassword}</td>
                        <td><span class="status-badge ${user.role === 'admin' ? 'status-active' : 'status-inactive'}">${user.role === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}</span></td>
                        <td>${user.registerTime}</td>
                        <td>${userPoints}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="viewUserDetails('${user.account}')">æŸ¥çœ‹</button>
                            ${user.role !== 'admin' ? (
                        userStatus === 'banned'
                            ? `<button class="btn btn-sm btn-success" onclick="unbanUser('${user.account}')">è§£ç¦</button>`
                            : `<button class="btn btn-sm btn-danger" onclick="banUser('${user.account}')">ç¦ç”¨</button>`
                    ) : ''}
                            ${user.role !== 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteUserAccount('${user.account}')" style="background-color: #c0392b;">åˆ é™¤è´¦å·</button>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');

            // ç»‘å®šå¤šé€‰äº‹ä»¶
            const userCheckboxes = tbody.querySelectorAll('.user-select-checkbox');
            userCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const account = checkbox.getAttribute('data-account');
                    if (checkbox.checked) {
                        selectedUserAccounts.add(account);
                    } else {
                        selectedUserAccounts.delete(account);
                    }
                    refreshUserSelectionUI();
                });
            });

            refreshUserSelectionUI();
            updatePaginationControls('users', filteredUsers.length, renderUsersTable);
            
            // ç»‘å®šå¤åˆ¶äº‹ä»¶
            setTimeout(() => {
                bindCopyEvents('users-table', [0, 9]); // æ’é™¤å¤é€‰æ¡†åˆ—(0)å’Œæ“ä½œåˆ—(9)
            }, 100);
        }

        function refreshUserSelectionUI() {
            const batchDeleteBtn = document.getElementById('delete-selected-users-btn');
            const selectAllCheckbox = document.getElementById('select-all-users');
            const checkboxes = document.querySelectorAll('.user-select-checkbox');
            const selectedCount = selectedUserAccounts.size;

            if (batchDeleteBtn) {
                batchDeleteBtn.style.display = selectedCount > 0 ? 'inline-flex' : 'none';
                batchDeleteBtn.textContent = selectedCount > 0
                    ? `æ‰¹é‡åˆ é™¤è´¦å· (${selectedCount})`
                    : 'æ‰¹é‡åˆ é™¤è´¦å·';
            }

            if (selectAllCheckbox) {
                const total = checkboxes.length;
                const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
                if (total === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                } else {
                    selectAllCheckbox.checked = checked === total;
                    selectAllCheckbox.indeterminate = checked > 0 && checked < total;
                }
            }
        }

        // æ¸²æŸ“è®¢å•è¡¨æ ¼
        function renderOrdersTable() {
            const tbody = document.getElementById('orders-table-body');
            const statusFilter = document.getElementById('order-status-filter').value;
            const searchTerm = document.getElementById('order-search').value.toLowerCase();
            const searchFieldSelect = document.getElementById('order-search-field');
            const searchField = searchFieldSelect ? searchFieldSelect.value : 'all';

            // åå°ç®¡ç†æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„è®¢å•ï¼Œæ™®é€šç”¨æˆ·åªæ˜¾ç¤ºè‡ªå·±çš„è®¢å•
            let ordersToDisplay = [];
            if (currentUser && currentUser.role === 'admin') {
                // ç®¡ç†å‘˜ï¼šæ˜¾ç¤ºæ‰€æœ‰è®¢å•
                if (allOrders.length === 0) {
                    // å¦‚æœå…¨å±€è®¢å•æ•°ç»„ä¸ºç©ºï¼Œå°è¯•ä»localStorageåŠ è½½
                    const savedAllOrders = localStorage.getItem('allOrders');
                    if (savedAllOrders) {
                        try {
                            allOrders = JSON.parse(savedAllOrders);
                            ordersToDisplay = allOrders;
                        } catch (e) {
                            console.error('è§£æä¿å­˜çš„æ‰€æœ‰è®¢å•å¤±è´¥:', e);
                            ordersToDisplay = userOrders; // ä¸´æ—¶ä½¿ç”¨å½“å‰ç”¨æˆ·è®¢å•
                        }
                    } else {
                        // å¦‚æœlocalStorageä¹Ÿæ²¡æœ‰ï¼Œå¼‚æ­¥åŠ è½½æ‰€æœ‰è®¢å•
                        if (cloudSync && cloudSync.isInitialized) {
                            cloudSync.loadAllOrders().then(() => {
                                renderOrdersTable(); // åŠ è½½å®Œæˆåé‡æ–°æ¸²æŸ“
                            });
                        }
                        ordersToDisplay = userOrders; // ä¸´æ—¶ä½¿ç”¨å½“å‰ç”¨æˆ·è®¢å•
                    }
                } else {
                    ordersToDisplay = allOrders;
                }
            } else {
                // æ™®é€šç”¨æˆ·ï¼šåªæ˜¾ç¤ºè‡ªå·±çš„è®¢å•
                ordersToDisplay = userOrders.filter(order => 
                    !order.account || order.account === currentUser?.account
                );
            }

            let filteredOrders = ordersToDisplay;

            // çŠ¶æ€ç­›é€‰
            if (statusFilter) {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }

            // æ³¨å†Œæ—¥æœŸç­›é€‰ï¼ˆæ ¹æ®è®¢å•å…³è”çš„ç”¨æˆ·è´¦å·ï¼‰
            if (orderFilterRegisterDateStart || orderFilterRegisterDateEnd) {
                filteredOrders = filteredOrders.filter(order => {
                    const orderAccount = order.account || order.customerInfo?.account || '';
                    if (!orderAccount) return true; // æ²¡æœ‰è´¦å·ä¿¡æ¯ï¼Œä¿ç•™
                    
                    const user = findUserByAccount(orderAccount);
                    if (!user || !user.registerTime) {
                        // æ‰¾ä¸åˆ°ç”¨æˆ·æˆ–æ²¡æœ‰æ³¨å†Œæ—¶é—´ï¼Œå¦‚æœè®¾ç½®äº†ç­›é€‰åˆ™æ’é™¤
                        return !(orderFilterRegisterDateStart || orderFilterRegisterDateEnd);
                    }
                    
                    try {
                        const registerDate = new Date(user.registerTime);
                        const registerDateStr = registerDate.toISOString().split('T')[0];
                        
                        if (orderFilterRegisterDateStart && registerDateStr < orderFilterRegisterDateStart) {
                            return false;
                        }
                        if (orderFilterRegisterDateEnd && registerDateStr > orderFilterRegisterDateEnd) {
                            return false;
                        }
                        return true;
                    } catch (e) {
                        // æ—¥æœŸè§£æå¤±è´¥ï¼Œä¿ç•™
                        return true;
                    }
                });
            }

            // æœç´¢ç­›é€‰
            if (searchTerm) {
                filteredOrders = filteredOrders.filter(order => {
                    const idStr = String(order.id || '').toLowerCase();
                    const productName = (order.productName || '').toLowerCase();
                    const usernameValue = (order.account || order.customerInfo?.account || order.customerInfo?.name || order.customerInfo?.email || '').toLowerCase();

                    switch (searchField) {
                        case 'id':
                            return idStr.includes(searchTerm);
                        case 'productName':
                            return productName.includes(searchTerm);
                        case 'username':
                            return usernameValue.includes(searchTerm);
                        case 'all':
                        default:
                            return (
                                idStr.includes(searchTerm) ||
                                productName.includes(searchTerm) ||
                                usernameValue.includes(searchTerm)
                            );
                    }
                });
            }

            // æ¸…ç†ä¸å­˜åœ¨çš„é€‰ä¸­è®¢å•
            // å¦‚æœå·²é€‰æ‹©æŒ‰ä¸‹å•æ—¶é—´æ’åºï¼Œåˆ™åœ¨å±•ç¤ºå‰å…ˆå¯¹ filteredOrders æ’åº
            if (typeof orderTimeSort !== 'undefined' && orderTimeSort) {
                try {
                    filteredOrders.sort((a, b) => {
                        const ta = new Date(a.date || a.updatedAt || 0).getTime() || 0;
                        const tb = new Date(b.date || b.updatedAt || 0).getTime() || 0;
                        return orderTimeSort === 'asc' ? ta - tb : tb - ta;
                    });
                } catch (e) {
                    console.warn('æ’åºä¸‹å•æ—¶é—´æ—¶å‡ºé”™ï¼Œè·³è¿‡æ’åº', e);
                }
            }
            // å¦‚æœæŒ‰ç”¨æˆ·åï¼ˆç”¨æˆ·æ³¨å†Œæ—¶é—´ï¼‰æ’åºè¢«è®¾ç½®ï¼Œåˆ™æŒ‰ç”¨æˆ·æ³¨å†Œæ—¶é—´æ’åº
            if (typeof userRegisterSort !== 'undefined' && userRegisterSort) {
                try {
                    filteredOrders.sort((a, b) => {
                        const accountA = a.account || a.customerInfo?.account || a.customerInfo?.name || '';
                        const accountB = b.account || b.customerInfo?.account || b.customerInfo?.name || '';
                        const userA = findUserByAccount(accountA) || {};
                        const userB = findUserByAccount(accountB) || {};
                        const ta = userA.registerTime ? new Date(userA.registerTime).getTime() : 0;
                        const tb = userB.registerTime ? new Date(userB.registerTime).getTime() : 0;
                        return userRegisterSort === 'asc' ? ta - tb : tb - ta;
                    });
                } catch (e) {
                    console.warn('æ’åºç”¨æˆ·æ³¨å†Œæ—¶é—´æ—¶å‡ºé”™ï¼Œè·³è¿‡æ’åº', e);
                }
            }

            selectedOrderIds.forEach(id => {
                if (!filteredOrders.some(o => normalizeOrderId(o.id) === id)) {
                    selectedOrderIds.delete(id);
                }
            });

            if (filteredOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px;">æš‚æ— è®¢å•æ•°æ®</td></tr>';
                refreshOrderSelectionUI();
                updatePaginationControls('orders', 0);
                return;
            }

            const { items: paginatedOrders } = getPaginatedItems(filteredOrders, 'orders');

            tbody.innerHTML = paginatedOrders.map(order => {
                const customerInfo = order.customerInfo || {};
                const usernameValue = order.account || customerInfo.account || customerInfo.name || customerInfo.email || '';
                const customerName = customerInfo.name || '';
                const customerPhone = customerInfo.phone || '';
                const customerEmail = customerInfo.email || '';
                const productName = order.productName || '';
                const orderIdStr = normalizeOrderId(order.id);
                
                // è·å–ç”¨æˆ·æ³¨å†Œå¤©æ•°
                let registerDaysText = '';
                if (usernameValue) {
                    const user = findUserByAccount(usernameValue);
                    if (user && user.registerTime) {
                        const days = getRegisterDays(user.registerTime);
                        registerDaysText = `<span style="color: #666; font-size: 0.9em; margin-left: 5px;">(æ³¨å†Œ${days}å¤©)</span>`;
                    }
                }
                
                const isChecked = currentUser && currentUser.role === 'admin' && selectedOrderIds.has(orderIdStr);

                return `
                <tr>
                    <td>
                        ${currentUser && currentUser.role === 'admin'
                            ? `<input type="checkbox" class="order-select-checkbox" data-order-id="${orderIdStr}" ${isChecked ? 'checked' : ''}>`
                            : ''}
                    </td>
                    <td>${orderIdStr}</td>
                    <td>${productName}</td>
                    <td><a href="#" class="order-username-link" data-username="${usernameValue}" data-customer-name="${customerName}" data-customer-phone="${customerPhone}" data-customer-email="${customerEmail}" style="color: var(--primary); text-decoration: underline; cursor: pointer;">${usernameValue || '-'}</a>${registerDaysText}</td>
                    <td><span class="status-badge status-${order.status || 'pending'}">${getStatusText(order.status || 'pending')}</span></td>
                    <td>
                        <span class="tracking-number-display" data-order-id="${orderIdStr}">${order.trackingNumber || t('notFilled')}</span>
                        <button class="btn btn-sm btn-primary" onclick="editTrackingNumber('${orderIdStr}')" style="margin-left: 5px;">${t('edit')}</button>
                    </td>
                    <td>${formatDate(order.date || order.updatedAt || Date.now())}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewOrderDetails('${orderIdStr}')">æŸ¥çœ‹</button>
                        <button class="btn btn-sm btn-secondary" onclick="openOrderStatusModal('${orderIdStr}')">æ›´æ–°çŠ¶æ€</button>
                        ${currentUser && currentUser.role === 'admin'
                            ? `<button class="btn btn-sm btn-danger" onclick="deleteSingleOrder('${orderIdStr}')">${t('deleteOrder') || 'åˆ é™¤è®¢å•'}</button>`
                            : ''}
                    </td>
                </tr>
            `;
            }).join('');

            // ä¸ºå®¢æˆ·å§“åé“¾æ¥æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.order-username-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const customerName = link.getAttribute('data-customer-name');
                    const customerPhone = link.getAttribute('data-customer-phone');
                    const customerEmail = link.getAttribute('data-customer-email');
                    showCustomerHistory(customerName, customerPhone, customerEmail);
                });
            });

            // ç»‘å®šè®¢å•é€‰æ‹©å¤é€‰æ¡†äº‹ä»¶
            if (currentUser && currentUser.role === 'admin') {
                tbody.querySelectorAll('.order-select-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const id = checkbox.getAttribute('data-order-id');
                        if (checkbox.checked) {
                            selectedOrderIds.add(id);
                        } else {
                            selectedOrderIds.delete(id);
                        }
                        refreshOrderSelectionUI();
                    });
                });
            }

            refreshOrderSelectionUI();
            updatePaginationControls('orders', filteredOrders.length, renderOrdersTable);
            
            // ç»‘å®šå¤åˆ¶äº‹ä»¶
            setTimeout(() => {
                bindCopyEvents('orders-table', [0, 7]); // æ’é™¤å¤é€‰æ¡†åˆ—(0)å’Œæ“ä½œåˆ—(7)
            }, 100);
        }

        // è®¢å•æ—¶é—´æ’åºçŠ¶æ€ï¼šnull | 'asc' | 'desc'
        let orderTimeSort = null;
        // ç”¨æˆ·æ³¨å†Œæ—¶é—´æ’åºçŠ¶æ€ï¼šnull | 'asc' | 'desc'
        let userRegisterSort = null;

        // åˆ‡æ¢ä¸‹å•æ—¶é—´æ’åºå¹¶é‡æ–°æ¸²æŸ“è¡¨æ ¼
        function toggleOrderTimeSort() {
            orderTimeSort = orderTimeSort === 'asc' ? 'desc' : 'asc';
            // åˆ‡å›ç¬¬ä¸€é¡µä»¥ä¾¿ç”¨æˆ·çœ‹åˆ°æ’åºç»“æœï¼ˆå¦‚æœæœ‰åˆ†é¡µé€»è¾‘ï¼‰
            try { if (typeof setCurrentPage === 'function') setCurrentPage('orders', 1); } catch (e) {}
            updateOrderTimeHeaderUI();
            renderOrdersTable();
        }

        function updateOrderTimeHeaderUI() {
            const th = document.getElementById('orders-th-time');
            if (!th) return;
            const indicator = th.querySelector('.sort-indicator');
            if (indicator) {
                indicator.textContent = orderTimeSort === 'asc' ? 'â–²' : orderTimeSort === 'desc' ? 'â–¼' : '';
            }
            // è§†è§‰åé¦ˆï¼šé«˜äº®è¡¨å¤´èƒŒæ™¯
            if (orderTimeSort) {
                th.style.backgroundColor = '#f5f7ff';
            } else {
                th.style.backgroundColor = '';
            }
        }

        // åˆ‡æ¢æŒ‰ç”¨æˆ·æ³¨å†Œæ—¶é—´æ’åºå¹¶é‡æ–°æ¸²æŸ“è¡¨æ ¼
        function toggleUserRegisterSort() {
            userRegisterSort = userRegisterSort === 'asc' ? 'desc' : 'asc';
            // å–æ¶ˆæŒ‰è®¢å•æ—¶é—´æ’åºï¼ˆä¸¤è€…äº’æ–¥ï¼‰
            orderTimeSort = null;
            try { if (typeof setCurrentPage === 'function') setCurrentPage('orders', 1); } catch (e) {}
            updateUserRegisterHeaderUI();
            updateOrderTimeHeaderUI();
            renderOrdersTable();
        }

        function updateUserRegisterHeaderUI() {
            const th = document.getElementById('orders-th-username');
            if (!th) return;
            const indicator = th.querySelector('.sort-indicator');
            if (indicator) {
                indicator.textContent = userRegisterSort === 'asc' ? 'â–²' : userRegisterSort === 'desc' ? 'â–¼' : '';
            }
            // è§†è§‰åé¦ˆï¼šé«˜äº®è¡¨å¤´èƒŒæ™¯
            if (userRegisterSort) {
                th.style.backgroundColor = '#f5f7ff';
            } else {
                th.style.backgroundColor = '';
            }
        }

        // åœ¨è¡¨å¤´ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆå»¶è¿Ÿç»‘å®šï¼Œç¡®ä¿DOMå·²åŠ è½½ï¼‰
        setTimeout(() => {
            // ç»‘å®šä¸‹å•æ—¶é—´æ’åº
            const thTime = document.getElementById('orders-th-time');
            if (thTime) {
                thTime.classList.add('sortable');
                thTime.style.cursor = 'pointer';
                // å¦‚æœå°šæœªå­˜åœ¨æŒ‡ç¤ºå™¨ï¼Œåˆ›å»ºä¸€ä¸ª
                if (!thTime.querySelector('.sort-indicator')) {
                    const indicator = document.createElement('span');
                    indicator.className = 'sort-indicator';
                    indicator.style.marginLeft = '8px';
                    thTime.appendChild(indicator);
                }
                thTime.addEventListener('click', toggleOrderTimeSort);
                updateOrderTimeHeaderUI();
            }

            // ç»‘å®šç”¨æˆ·åï¼ˆæŒ‰ç”¨æˆ·æ³¨å†Œæ—¶é—´ï¼‰æ’åº
            const thUser = document.getElementById('orders-th-username');
            if (thUser) {
                thUser.classList.add('sortable');
                thUser.style.cursor = 'pointer';
                if (!thUser.querySelector('.sort-indicator')) {
                    const indicator = document.createElement('span');
                    indicator.className = 'sort-indicator';
                    indicator.style.marginLeft = '8px';
                    thUser.appendChild(indicator);
                }
                thUser.addEventListener('click', toggleUserRegisterSort);
                updateUserRegisterHeaderUI();
            }
        }, 100);

        function collectAllReviews() {
            const reviews = [];
            products.forEach(product => {
                if (product && Array.isArray(product.reviews)) {
                    product.reviews.forEach(review => {
                        reviews.push({
                            ...review,
                            productId: product.id,
                            productName: product.name || review.productName || t('product') || 'äº§å“',
                        });
                    });
                }
            });
            return reviews.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
        }

        function refreshOrderSelectionUI() {
            const batchDeleteBtn = document.getElementById('delete-selected-orders-btn');
            const selectAllCheckbox = document.getElementById('select-all-orders');
            const checkboxes = document.querySelectorAll('.order-select-checkbox');
            const selectedCount = selectedOrderIds.size;

            if (batchDeleteBtn) {
                const hasAdmin = currentUser && currentUser.role === 'admin';
                batchDeleteBtn.style.display = hasAdmin && selectedCount > 0 ? 'inline-flex' : 'none';
                batchDeleteBtn.textContent = selectedCount > 0
                    ? `æ‰¹é‡åˆ é™¤è®¢å• (${selectedCount})`
                    : 'æ‰¹é‡åˆ é™¤è®¢å•';
            }

            if (selectAllCheckbox) {
                const total = checkboxes.length;
                const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
                if (total === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                } else {
                    selectAllCheckbox.checked = checked === total;
                    selectAllCheckbox.indeterminate = checked > 0 && checked < total;
                }
            }
        }

        function renderReviewsTable() {
            const tbody = document.getElementById('reviews-table-body');
            if (!tbody) return;

            const allReviews = collectAllReviews();
            if (!Array.isArray(allReviews) || allReviews.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:40px;">æš‚æ— è¯„ä»·æ•°æ®</td></tr>';
                updatePaginationControls('reviews', 0);
                return;
            }

            const keyword = (reviewSearchTerm || '').trim().toLowerCase();
            const category = (reviewSearchCategory || 'all');

            const filteredReviews = keyword
                ? allReviews.filter(review => {
                    if (!review) return false;
                    const k = keyword;

                    const fields = {
                        product: [review.productName],
                        user: [review.userName, review.userAccount],
                        comment: [review.comment],
                        rating: [String(review.rating)],
                        reply: [review.adminReply],
                        all: [
                            review.productName,
                            review.userName,
                            review.userAccount,
                            review.comment,
                            String(review.rating),
                            review.adminReply
                        ]
                    };

                    const targets = fields[category] || fields.all;

                    return targets.some(field => {
                        if (field === undefined || field === null) return false;
                        return field.toString().toLowerCase().includes(k);
                    });
                })
                : allReviews;

            const reviews = filteredReviews;
            if (reviews.length === 0) {
                const emptyMessage = keyword
                    ? 'æœªæ‰¾åˆ°åŒ¹é…çš„è¯„ä»·ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ‡æ¢ç­›é€‰åˆ†ç±»'
                    : 'æš‚æ— è¯„ä»·æ•°æ®';
                tbody.innerHTML = `<tr><td colspan="8" style="text-align:center; padding:40px;">${emptyMessage}</td></tr>`;
                updatePaginationControls('reviews', 0);
                return;
            }

            const { items: paginatedReviews } = getPaginatedItems(reviews, 'reviews');

            tbody.innerHTML = paginatedReviews.map(review => {
                const createdAt = review.createdAt ? formatDate(review.createdAt) : '-';
                const ratingStars = Array.from({ length: 5 }, (_, i) =>
                    `<i class="fas fa-star" style="color:${i < (review.rating || 0) ? '#ffc107' : '#ddd'};"></i>`
                ).join('');
                const hasOrderLink = !!review.orderId;

                return `
                    <tr>
                        <td>${review.reviewId || '-'}</td>
                        <td>${review.productName}</td>
                        <td>${review.userName || '-'}</td>
                        <td>${ratingStars}</td>
                        <td style="max-width: 280px;">${review.comment || '-'}</td>
                        <td>${review.adminReply ? `<span style="color:#2c3e50;">${review.adminReply}</span>` : '<span style="color:#bbb;">æœªå›å¤</span>'}</td>
                        <td>${createdAt}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" ${hasOrderLink ? `onclick="replyToReview('${review.orderId}')"` : 'disabled'}>${t('replyReview') || 'å›å¤è¯„ä»·'}</button>
                            <button class="btn btn-sm btn-danger" ${hasOrderLink ? `onclick="deleteReview('${review.orderId}')"` : 'disabled'} style="margin-left:6px;">${t('deleteReview') || 'åˆ é™¤è¯„ä»·'}</button>
                        </td>
                    </tr>
                `;
            }).join('');

            updatePaginationControls('reviews', reviews.length, renderReviewsTable);
        }

        // å›¾è¡¨å®ä¾‹å­˜å‚¨
        let dailyUsersChart = null;
        let dailyOrdersChart = null;
        let userTrendChart = null;

        // è·å–å›¾è¡¨æ—¥æœŸèŒƒå›´
        function getChartDateRange() {
            const startDateInput = document.getElementById('chart-start-date');
            const endDateInput = document.getElementById('chart-end-date');
            
            let startDate, endDate;
            
            if (startDateInput && startDateInput.value) {
                startDate = new Date(startDateInput.value);
                startDate.setHours(0, 0, 0, 0);
            } else {
                // é»˜è®¤æœ€è¿‘30å¤©
                startDate = new Date();
                startDate.setDate(startDate.getDate() - 30);
                startDate.setHours(0, 0, 0, 0);
            }
            
            if (endDateInput && endDateInput.value) {
                endDate = new Date(endDateInput.value);
                endDate.setHours(23, 59, 59, 999);
            } else {
                endDate = new Date();
                endDate.setHours(23, 59, 59, 999);
            }
            
            return { startDate, endDate };
        }

        // è®¡ç®—æ¯å¤©çš„æ–°æ³¨å†Œç”¨æˆ·æ•°é‡ï¼ˆæ”¯æŒè‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼‰
        function getDailyNewUsers(startDate, endDate) {
            const dailyCount = {};
            
            // å¦‚æœæ²¡æœ‰æä¾›æ—¥æœŸèŒƒå›´ï¼Œä½¿ç”¨é»˜è®¤å€¼
            if (!startDate || !endDate) {
                const range = getChartDateRange();
                startDate = range.startDate;
                endDate = range.endDate;
            }

            // è®¡ç®—æ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰æ—¥æœŸ
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const dateKey = currentDate.toISOString().split('T')[0];
                dailyCount[dateKey] = 0;
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // ç»Ÿè®¡æ‰€æœ‰ç”¨æˆ·ï¼ˆæ’é™¤ç®¡ç†å‘˜ï¼‰
            allUsers.forEach(user => {
                if (user.registerTime) {
                    try {
                        const registerDate = new Date(user.registerTime);
                        registerDate.setHours(0, 0, 0, 0);
                        if (registerDate >= startDate && registerDate <= endDate) {
                            const dateKey = registerDate.toISOString().split('T')[0];
                            if (dailyCount.hasOwnProperty(dateKey)) {
                                dailyCount[dateKey]++;
                            }
                        }
                    } catch (e) {
                        console.warn('Invalid registerTime:', user.registerTime);
                    }
                }
            });

            return dailyCount;
        }

        // è®¡ç®—æ¯å¤©çš„è®¢å•æ•°é‡ï¼ˆæ”¯æŒè‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼‰
        function getDailyOrders(startDate, endDate) {
            const dailyCount = {};
            
            // å¦‚æœæ²¡æœ‰æä¾›æ—¥æœŸèŒƒå›´ï¼Œä½¿ç”¨é»˜è®¤å€¼
            if (!startDate || !endDate) {
                const range = getChartDateRange();
                startDate = range.startDate;
                endDate = range.endDate;
            }

            // è®¡ç®—æ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰æ—¥æœŸ
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const dateKey = currentDate.toISOString().split('T')[0];
                dailyCount[dateKey] = 0;
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // ç»Ÿè®¡æ‰€æœ‰è®¢å•ï¼ˆä½¿ç”¨ allOrdersï¼‰
            allOrders.forEach(order => {
                const orderTime = order.date || order.updatedAt || order.createdAt;
                if (orderTime) {
                    try {
                        const orderDate = new Date(typeof orderTime === 'number' ? orderTime : orderTime);
                        orderDate.setHours(0, 0, 0, 0);
                        if (orderDate >= startDate && orderDate <= endDate) {
                            const dateKey = orderDate.toISOString().split('T')[0];
                            if (dailyCount.hasOwnProperty(dateKey)) {
                                dailyCount[dateKey]++;
                            }
                        }
                    } catch (e) {
                        console.warn('Invalid order time:', orderTime);
                    }
                }
            });

            return dailyCount;
        }

        // ç»˜åˆ¶æ¯æ—¥æ–°æ³¨å†Œç”¨æˆ·æŠ˜çº¿å›¾
        function renderDailyUsersChart() {
            const ctx = document.getElementById('dailyUsersChart');
            if (!ctx) return;

            const { startDate, endDate } = getChartDateRange();
            const dailyData = getDailyNewUsers(startDate, endDate);
            const labels = Object.keys(dailyData).sort().map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            });
            const data = Object.keys(dailyData).sort().map(date => dailyData[date]);

            if (dailyUsersChart) {
                dailyUsersChart.destroy();
            }

            dailyUsersChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ–°æ³¨å†Œç”¨æˆ·æ•°',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // ç»˜åˆ¶æ¯æ—¥è®¢å•æŠ˜çº¿å›¾
        function renderDailyOrdersChart() {
            const ctx = document.getElementById('dailyOrdersChart');
            if (!ctx) return;

            const { startDate, endDate } = getChartDateRange();
            const dailyData = getDailyOrders(startDate, endDate);
            const labels = Object.keys(dailyData).sort().map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            });
            const data = Object.keys(dailyData).sort().map(date => dailyData[date]);

            if (dailyOrdersChart) {
                dailyOrdersChart.destroy();
            }

            dailyOrdersChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'è®¢å•æ•°é‡',
                        data: data,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // ç»˜åˆ¶ç”¨æˆ·æ³¨å†Œè¶‹åŠ¿å›¾
        function renderUserTrendChart() {
            const ctx = document.getElementById('userTrendChart');
            if (!ctx) return;

            const { startDate, endDate } = getChartDateRange();
            const dailyData = getDailyNewUsers(startDate, endDate);
            const labels = Object.keys(dailyData).sort().map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            });
            const data = Object.keys(dailyData).sort().map(date => dailyData[date]);

            // è®¡ç®—ç´¯è®¡ç”¨æˆ·æ•°
            let cumulative = 0;
            const cumulativeData = data.map(count => {
                cumulative += count;
                return cumulative;
            });

            if (userTrendChart) {
                userTrendChart.destroy();
            }

            userTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'æ¯æ—¥æ–°æ³¨å†Œ',
                            data: data,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y',
                            pointRadius: 3
                        },
                        {
                            label: 'ç´¯è®¡æ³¨å†Œ',
                            data: cumulativeData,
                            borderColor: 'rgb(255, 159, 64)',
                            backgroundColor: 'rgba(255, 159, 64, 0.1)',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y1',
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'æ¯æ—¥æ–°æ³¨å†Œæ•°'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç´¯è®¡æ³¨å†Œæ•°'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        function initDateRangePicker() {
            const startDateInput = document.getElementById('chart-start-date');
            const endDateInput = document.getElementById('chart-end-date');
            const applyBtn = document.getElementById('apply-date-range');
            const resetBtn = document.getElementById('reset-date-range');

            if (!startDateInput || !endDateInput) return;

            // è®¾ç½®é»˜è®¤å€¼ï¼ˆæœ€è¿‘30å¤©ï¼‰
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);

            startDateInput.value = startDate.toISOString().split('T')[0];
            endDateInput.value = endDate.toISOString().split('T')[0];

            // åº”ç”¨æŒ‰é’®äº‹ä»¶
            if (applyBtn) {
                applyBtn.addEventListener('click', () => {
                    const start = startDateInput.value;
                    const end = endDateInput.value;
                    
                    if (!start || !end) {
                        customAlert('è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸ', 'æç¤º');
                        return;
                    }
                    
                    if (new Date(start) > new Date(end)) {
                        customAlert('å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ', 'æç¤º');
                        return;
                    }
                    
                    // é‡æ–°ç»˜åˆ¶æ‰€æœ‰å›¾è¡¨
                    renderDailyUsersChart();
                    renderDailyOrdersChart();
                    renderUserTrendChart();
                });
            }

            // é‡ç½®æŒ‰é’®äº‹ä»¶
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    const endDate = new Date();
                    const startDate = new Date();
                    startDate.setDate(startDate.getDate() - 30);

                    startDateInput.value = startDate.toISOString().split('T')[0];
                    endDateInput.value = endDate.toISOString().split('T')[0];
                    
                    // é‡æ–°ç»˜åˆ¶æ‰€æœ‰å›¾è¡¨
                    renderDailyUsersChart();
                    renderDailyOrdersChart();
                    renderUserTrendChart();
                });
            }
        }

        // Helper: parse date-only strings like "YYYY-MM-DD" into local Date at day's start/end
        // This avoids the built-in Date('YYYY-MM-DD') parsing which can be treated as UTC
        // and cause off-by-one-day errors when converting between timezones.
        function parseDateOnlyToLocalStart(dateStr) {
            if (!dateStr) return null;
            // Expecting "YYYY-MM-DD"
            const parts = String(dateStr).split('-');
            if (parts.length === 3) {
                const y = Number(parts[0]);
                const m = Number(parts[1]) - 1;
                const d = Number(parts[2]);
                const dt = new Date(y, m, d);
                dt.setHours(0, 0, 0, 0);
                return dt;
            }
            const dt = new Date(dateStr);
            dt.setHours(0, 0, 0, 0);
            return dt;
        }

        function parseDateOnlyToLocalEnd(dateStr) {
            if (!dateStr) return null;
            const parts = String(dateStr).split('-');
            if (parts.length === 3) {
                const y = Number(parts[0]);
                const m = Number(parts[1]) - 1;
                const d = Number(parts[2]);
                return new Date(y, m, d, 23, 59, 59, 999);
            }
            const dt = new Date(dateStr);
            dt.setHours(23, 59, 59, 999);
            return dt;
        }

        // æ¸²æŸ“ç»Ÿè®¡æ•°æ®
        function renderStatistics() {
            const totalUsers = allUsers.length + Object.keys(ADMIN_ACCOUNTS).length;
            const totalProducts = products.length;
            // ä½¿ç”¨ allOrders è€Œä¸æ˜¯ userOrdersï¼Œå› ä¸ºè¿™æ˜¯ç®¡ç†å‘˜ç»Ÿè®¡æ‰€æœ‰è®¢å•
            const totalOrders = allOrders.length;
            const pendingOrders = allOrders.filter(order => {
                const status = order.status || '';
                return status === 'review' || status === 'pending';
            }).length;

            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('total-products').textContent = totalProducts;
            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('pending-orders').textContent = pendingOrders;

            // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
            initDateRangePicker();

            // ç»˜åˆ¶å›¾è¡¨
            if (typeof Chart !== 'undefined') {
                // å»¶è¿Ÿç»˜åˆ¶ï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
                setTimeout(() => {
                    renderDailyUsersChart();
                    renderDailyOrdersChart();
                    renderUserTrendChart();
                }, 100);
            }
        }

        // åˆ‡æ¢ç»Ÿè®¡è¡¨æ ¼æ˜¾ç¤º/éšè—
        function toggleStatTable(statType) {
            // éšè—æ‰€æœ‰è¡¨æ ¼
            const allTables = document.querySelectorAll('.stat-table-section');
            allTables.forEach(table => {
                table.style.display = 'none';
            });

            // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„activeçŠ¶æ€
            const allCards = document.querySelectorAll('.stat-card');
            allCards.forEach(card => {
                card.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„è¡¨æ ¼
            const targetTable = document.getElementById(`stat-table-${statType}`);
            const targetCard = document.querySelector(`[data-stat-type="${statType}"]`);
            
            if (targetTable && targetCard) {
                // å¦‚æœè¡¨æ ¼å½“å‰æ˜¯éšè—çš„ï¼Œåˆ™æ˜¾ç¤ºå®ƒå¹¶æ·»åŠ activeçŠ¶æ€
                if (targetTable.style.display === 'none') {
                    targetTable.style.display = 'block';
                    targetCard.classList.add('active');
                    
                    // æ ¹æ®ç±»å‹æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ•°æ®
                    switch(statType) {
                        case 'users':
                            renderUsersStatTable();
                            break;
                        case 'products':
                            renderProductsStatTable();
                            break;
                        case 'orders':
                            initOrderFilters(); // åˆå§‹åŒ–ç­›é€‰å™¨
                            updateSortIcons();
                            renderOrdersStatTable();
                            break;
                        case 'pending':
                            renderPendingStatTable();
                            break;
                    }
                } else {
                    // å¦‚æœè¡¨æ ¼å½“å‰æ˜¯æ˜¾ç¤ºçš„ï¼Œåˆ™éšè—å®ƒå¹¶ç§»é™¤activeçŠ¶æ€
                    targetTable.style.display = 'none';
                    targetCard.classList.remove('active');
                }
            }
        }

        // æ¸²æŸ“ç”¨æˆ·ç»Ÿè®¡è¡¨æ ¼
        function renderUsersStatTable() {
            const tbody = document.getElementById('users-stat-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            // æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·
            Object.entries(ADMIN_ACCOUNTS).forEach(([account, userInfo]) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                row.innerHTML = `
                    <td style="padding: 12px;">${userInfo.username || account}</td>
                    <td style="padding: 12px;">${account}</td>
                    <td style="padding: 12px;"><span class="role-badge admin">ç®¡ç†å‘˜</span></td>
                    <td style="padding: 12px;">ç³»ç»Ÿé¢„è®¾</td>
                    <td style="padding: 12px;"><span class="status-badge status-active">æ­£å¸¸</span></td>
                `;
                tbody.appendChild(row);
            });

            // æ·»åŠ æ™®é€šç”¨æˆ·
            allUsers.forEach(user => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                const registerTime = user.registerTime ? new Date(user.registerTime).toLocaleString('zh-CN') : 'æœªçŸ¥';
                const status = user.status === 'banned' ? 'å·²ç¦ç”¨' : 'æ­£å¸¸';
                const statusClass = user.status === 'banned' ? 'status-banned' : 'status-active';
                row.innerHTML = `
                    <td style="padding: 12px;">${user.username || user.account}</td>
                    <td style="padding: 12px;">${user.account}</td>
                    <td style="padding: 12px;"><span class="role-badge user">æ™®é€šç”¨æˆ·</span></td>
                    <td style="padding: 12px;">${registerTime}</td>
                    <td style="padding: 12px;"><span class="status-badge ${statusClass}">${status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // æ¸²æŸ“äº§å“é¢†å–æƒ…å†µç»Ÿè®¡è¡¨æ ¼
        function renderProductsStatTable() {
            const tbody = document.getElementById('products-stat-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            // ç»Ÿè®¡æ¯ä¸ªäº§å“çš„è®¢å•æƒ…å†µ
            const productStats = {};

            // åˆå§‹åŒ–æ‰€æœ‰äº§å“çš„ç»Ÿè®¡
            products.forEach(product => {
                productStats[product.id] = {
                    productId: product.id,
                    productName: product.name || product.title || 'æœªçŸ¥äº§å“',
                    totalOrders: 0,
                    completedOrders: 0,
                    pendingOrders: 0,
                    cancelledOrders: 0
                };
            });

            // ç»Ÿè®¡è®¢å•
            allOrders.forEach(order => {
                const productId = order.productId;
                if (productId && productStats[productId]) {
                    productStats[productId].totalOrders++;
                    
                    const status = order.status || '';
                    if (status === 'completed' || status === 'shipped') {
                        productStats[productId].completedOrders++;
                    } else if (status === 'review' || status === 'pending') {
                        productStats[productId].pendingOrders++;
                    } else if (status === 'cancelled' || status === 'canceled') {
                        productStats[productId].cancelledOrders++;
                    }
                }
            });

            // æ¸²æŸ“è¡¨æ ¼è¡Œ
            Object.values(productStats).forEach(stat => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                row.innerHTML = `
                    <td style="padding: 12px;">${stat.productName}</td>
                    <td style="padding: 12px;">${stat.productId}</td>
                    <td style="padding: 12px; text-align: center; font-weight: 500;">${stat.totalOrders}</td>
                    <td style="padding: 12px; text-align: center; color: #28a745;">${stat.completedOrders}</td>
                    <td style="padding: 12px; text-align: center; color: #ffc107;">${stat.pendingOrders}</td>
                    <td style="padding: 12px; text-align: center; color: #dc3545;">${stat.cancelledOrders}</td>
                `;
                tbody.appendChild(row);
            });

            // å¦‚æœæ²¡æœ‰äº§å“ï¼Œæ˜¾ç¤ºæç¤º
            if (products.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="padding: 24px; text-align: center; color: var(--gray);">
                        æš‚æ— äº§å“æ•°æ®
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // æ¸²æŸ“è®¢å•ç»Ÿè®¡è¡¨æ ¼ï¼ˆæ”¯æŒç­›é€‰ï¼‰
        function renderOrdersStatTable() {
            const tbody = document.getElementById('orders-stat-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            // åº”ç”¨ç­›é€‰æ¡ä»¶
            let filteredOrders = [...allOrders];

            // çŠ¶æ€ç­›é€‰
            if (currentOrderFilters.status) {
                filteredOrders = filteredOrders.filter(order => {
                    const status = order.status || '';
                    if (currentOrderFilters.status === 'cancelled' || currentOrderFilters.status === 'canceled') {
                        return status === 'cancelled' || status === 'canceled';
                    }
                    return status === currentOrderFilters.status;
                });
            }

            // äº§å“ç­›é€‰
            if (currentOrderFilters.product) {
                filteredOrders = filteredOrders.filter(order => 
                    order.productName === currentOrderFilters.product
                );
            }

            // æ—¥æœŸèŒƒå›´ç­›é€‰ï¼ˆæŒ‰æœ¬åœ°æ—¥æœŸè¾¹ç•Œè§£æï¼Œé¿å…æ—¶åŒºå¼•èµ·çš„è·¨æ—¥é—®é¢˜ï¼‰
            if (currentOrderFilters.startDate) {
                const startDate = parseDateOnlyToLocalStart(currentOrderFilters.startDate);
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date || order.createdAt || 0);
                    orderDate.setHours(0, 0, 0, 0);
                    return orderDate >= startDate;
                });
            }

            if (currentOrderFilters.endDate) {
                const endDate = parseDateOnlyToLocalEnd(currentOrderFilters.endDate);
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date || order.createdAt || 0);
                    return orderDate <= endDate;
                });
            }

            // å®¢æˆ·å§“åç­›é€‰
            if (currentOrderFilters.customer) {
                const customerName = currentOrderFilters.customer.toLowerCase();
                filteredOrders = filteredOrders.filter(order => {
                    const name = (order.customerInfo?.name || '').toLowerCase();
                    return name.includes(customerName);
                });
            }

            // è®¢å•IDç­›é€‰
            if (currentOrderFilters.orderId) {
                const orderId = currentOrderFilters.orderId.toLowerCase();
                filteredOrders = filteredOrders.filter(order => {
                    const id = String(order.id || '').toLowerCase();
                    return id.includes(orderId);
                });
            }

            // æŒ‰å½“å‰æ’åºè®¾ç½®æ’åºï¼ˆé»˜è®¤æŒ‰æ—¥æœŸé™åºï¼‰
            const sortedOrders = [...filteredOrders].sort((a, b) => {
                const field = currentOrderSort?.field || 'date';
                const order = currentOrderSort?.order === 'asc' ? 1 : -1; // asc -> 1, desc -> -1 (reverse)

                if (field === 'date') {
                    const dateA = new Date(a.date || a.createdAt || 0).getTime();
                    const dateB = new Date(b.date || b.createdAt || 0).getTime();
                    return (dateA - dateB) * order;
                }

                if (field === 'id') {
                    const idA = isNaN(Number(a.id)) ? String(a.id || '') : Number(a.id);
                    const idB = isNaN(Number(b.id)) ? String(b.id || '') : Number(b.id);
                    if (typeof idA === 'number' && typeof idB === 'number') {
                        return (idA - idB) * order;
                    }
                    return String(idA).localeCompare(String(idB)) * order;
                }

                // å…¶å®ƒå­—æ®µå›é€€åˆ°å­—ç¬¦ä¸²æ¯”è¾ƒ
                const valA = String(a[field] || '').toLowerCase();
                const valB = String(b[field] || '').toLowerCase();
                return valA.localeCompare(valB) * order;
            });

            // æ˜¾ç¤ºç­›é€‰ç»“æœæ•°é‡
            const resultDiv = document.getElementById('orders-filter-result');
            if (resultDiv) {
                if (filteredOrders.length === allOrders.length) {
                    resultDiv.innerHTML = `<i class="fas fa-info-circle" style="margin-right: 6px;"></i>å…± ${allOrders.length} æ¡è®¢å•`;
                } else {
                    resultDiv.innerHTML = `<i class="fas fa-filter" style="margin-right: 6px;"></i>æ˜¾ç¤º ${filteredOrders.length} / ${allOrders.length} æ¡è®¢å•`;
                }
            }

            // æ¸²æŸ“è®¢å•è¡Œ
            sortedOrders.forEach(order => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                const orderDate = order.date ? new Date(order.date).toLocaleString('zh-CN') : 'æœªçŸ¥';
                const status = getStatusText(order.status);
                const statusClass = getOrderStatusClass(order.status);
                row.innerHTML = `
                    <td style="padding: 12px;">${order.id || 'N/A'}</td>
                    <td style="padding: 12px;">${order.productName || 'æœªçŸ¥äº§å“'}</td>
                    <td style="padding: 12px;">${order.customerInfo?.name || 'æœªçŸ¥'}</td>
                    <td style="padding: 12px;">${orderDate}</td>
                    <td style="padding: 12px; text-align: center;"><span class="status-badge ${statusClass}">${status}</span></td>
                `;
                tbody.appendChild(row);
            });

            // å¦‚æœæ²¡æœ‰è®¢å•ï¼Œæ˜¾ç¤ºæç¤º
            if (sortedOrders.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="padding: 24px; text-align: center; color: var(--gray);">
                        ${allOrders.length === 0 ? 'æš‚æ— è®¢å•æ•°æ®' : 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®¢å•'}
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // æ¸²æŸ“å¾…å¤„ç†è®¢å•è¡¨æ ¼
        function renderPendingStatTable() {
            const tbody = document.getElementById('pending-stat-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            // ç­›é€‰å¾…å¤„ç†è®¢å•
            const pendingOrders = allOrders.filter(order => {
                const status = order.status || '';
                return status === 'review' || status === 'pending';
            });

            // æŒ‰å½“å‰æ’åºè®¾ç½®æ’åºï¼ˆä¸ä¸»è¡¨ä¸€è‡´ï¼‰
            const sortedPending = [...pendingOrders].sort((a, b) => {
                const field = currentOrderSort?.field || 'date';
                const order = currentOrderSort?.order === 'asc' ? 1 : -1;

                if (field === 'date') {
                    const dateA = new Date(a.date || a.createdAt || 0).getTime();
                    const dateB = new Date(b.date || b.createdAt || 0).getTime();
                    return (dateA - dateB) * order;
                }

                if (field === 'id') {
                    const idA = isNaN(Number(a.id)) ? String(a.id || '') : Number(a.id);
                    const idB = isNaN(Number(b.id)) ? String(b.id || '') : Number(b.id);
                    if (typeof idA === 'number' && typeof idB === 'number') {
                        return (idA - idB) * order;
                    }
                    return String(idA).localeCompare(String(idB)) * order;
                }

                const valA = String(a[field] || '').toLowerCase();
                const valB = String(b[field] || '').toLowerCase();
                return valA.localeCompare(valB) * order;
            });

            sortedPending.forEach(order => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                const orderDate = order.date ? new Date(order.date).toLocaleString('zh-CN') : 'æœªçŸ¥';
                const status = getStatusText(order.status);
                row.innerHTML = `
                    <td style="padding: 12px;">${order.id || 'N/A'}</td>
                    <td style="padding: 12px;">${order.productName || 'æœªçŸ¥äº§å“'}</td>
                    <td style="padding: 12px;">${order.customerInfo?.name || 'æœªçŸ¥'}</td>
                    <td style="padding: 12px;">${orderDate}</td>
                    <td style="padding: 12px; text-align: center;"><span class="status-badge status-inactive">${status}</span></td>
                `;
                tbody.appendChild(row);
            });

            // å¦‚æœæ²¡æœ‰å¾…å¤„ç†è®¢å•ï¼Œæ˜¾ç¤ºæç¤º
            if (pendingOrders.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="padding: 24px; text-align: center; color: var(--gray);">
                        æš‚æ— å¾…å¤„ç†è®¢å•
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // è·å–è®¢å•çŠ¶æ€æ ·å¼ç±»ï¼ˆä¼˜åŒ–åçš„é¢œè‰²ï¼‰
        function getOrderStatusClass(status) {
            const statusMap = {
                'pending': 'status-pending',
                'review': 'status-review',
                'shipping': 'status-shipping',
                'completed': 'status-completed',
                'shipped': 'status-shipped',
                'cancelled': 'status-cancelled',
                'canceled': 'status-cancelled'
            };
            return statusMap[status] || 'status-inactive';
        }

        // è®¢å•ç­›é€‰ç›¸å…³å˜é‡
        let currentOrderFilters = {
            status: '',
            product: '',
            startDate: '',
            endDate: '',
            customer: '',
            orderId: ''
        };

        // å½“å‰æ’åºè®¾ç½®ï¼šfield å¯ä»¥æ˜¯ 'date' æˆ– 'id' ç­‰ï¼Œorder ä¸º 'asc' æˆ– 'desc'
        let currentOrderSort = {
            field: 'date',
            order: 'desc'
        };

        function setOrderSort(field) {
            if (!field) return;
            if (currentOrderSort.field === field) {
                currentOrderSort.order = currentOrderSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentOrderSort.field = field;
                // æ–°é€‰æ‹©çš„å­—æ®µé»˜è®¤ä½¿ç”¨é™åºï¼ˆä¾¿äºæŸ¥çœ‹æœ€æ–°ï¼‰
                currentOrderSort.order = 'desc';
            }
            updateSortIcons();
            renderOrdersStatTable();
        }

        function updateSortIcons() {
            // æ”¯æŒçš„å­—æ®µé›†åˆï¼ˆå¦‚éœ€æ‰©å±•è¯·åœ¨æ­¤æ·»åŠ ï¼‰
            const fields = ['id', 'date'];
            fields.forEach(f => {
                const icon = document.getElementById(`sort-icon-${f}`);
                if (!icon) return;
                icon.classList.remove('fa-sort-up', 'fa-sort-down', 'fa-sort');
                if (currentOrderSort.field === f) {
                    if (currentOrderSort.order === 'asc') {
                        icon.classList.add('fa-sort-up');
                    } else {
                        icon.classList.add('fa-sort-down');
                    }
                } else {
                    icon.classList.add('fa-sort');
                }
            });
        }

        // ç‚¹å‡»è¡¨å¤´è¡Œæ—¶å¾ªç¯åˆ‡æ¢æ’åºï¼ˆé¡ºåºï¼šdate desc -> date asc -> id desc -> id ascï¼‰
        function cycleHeaderSort() {
            const sequence = [
                { field: 'date', order: 'desc' },
                { field: 'date', order: 'asc' },
                { field: 'id', order: 'desc' },
                { field: 'id', order: 'asc' }
            ];

            const curIndex = sequence.findIndex(s => s.field === currentOrderSort.field && s.order === currentOrderSort.order);
            const next = sequence[(curIndex + 1) % sequence.length];
            currentOrderSort.field = next.field;
            currentOrderSort.order = next.order;
            updateSortIcons();
            renderOrdersStatTable();
            // å¦‚æœå¾…å¤„ç†è¡¨æ ¼ä¹Ÿåœ¨æ˜¾ç¤ºï¼Œåˆ™åŒæ—¶åˆ·æ–°å®ƒ
            const pendingTbody = document.getElementById('pending-stat-table-body');
            if (document.getElementById('stat-table-pending')?.style.display !== 'none' && pendingTbody) {
                renderPendingStatTable();
            }
        }

        // åˆå§‹åŒ–è®¢å•ç­›é€‰ï¼ˆå¡«å……äº§å“ä¸‹æ‹‰æ¡†ï¼‰
        function initOrderFilters() {
            const productSelect = document.getElementById('filter-order-product');
            if (!productSelect) return;

            // è·å–æ‰€æœ‰å”¯ä¸€çš„äº§å“åç§°
            const uniqueProducts = [...new Set(allOrders.map(order => order.productName).filter(Boolean))];
            uniqueProducts.sort();

            // æ¸…ç©ºå¹¶æ·»åŠ é€‰é¡¹
            productSelect.innerHTML = '<option value="">å…¨éƒ¨äº§å“</option>';
            uniqueProducts.forEach(productName => {
                const option = document.createElement('option');
                option.value = productName;
                option.textContent = productName;
                productSelect.appendChild(option);
            });
        }

        // åº”ç”¨è®¢å•ç­›é€‰
        function applyOrderFilters() {
            // è·å–ç­›é€‰æ¡ä»¶
            currentOrderFilters = {
                status: document.getElementById('filter-order-status')?.value || '',
                product: document.getElementById('filter-order-product')?.value || '',
                startDate: document.getElementById('filter-order-start-date')?.value || '',
                endDate: document.getElementById('filter-order-end-date')?.value || '',
                customer: document.getElementById('filter-order-customer')?.value.trim() || '',
                orderId: document.getElementById('filter-order-id')?.value.trim() || ''
            };

            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            renderOrdersStatTable();
        }

        // é‡ç½®è®¢å•ç­›é€‰
        function resetOrderFilters() {
            // æ¸…ç©ºæ‰€æœ‰ç­›é€‰æ¡ä»¶
            if (document.getElementById('filter-order-status')) {
                document.getElementById('filter-order-status').value = '';
            }
            if (document.getElementById('filter-order-product')) {
                document.getElementById('filter-order-product').value = '';
            }
            if (document.getElementById('filter-order-start-date')) {
                document.getElementById('filter-order-start-date').value = '';
            }
            if (document.getElementById('filter-order-end-date')) {
                document.getElementById('filter-order-end-date').value = '';
            }
            if (document.getElementById('filter-order-customer')) {
                document.getElementById('filter-order-customer').value = '';
            }
            if (document.getElementById('filter-order-id')) {
                document.getElementById('filter-order-id').value = '';
            }

            // é‡ç½®ç­›é€‰å¯¹è±¡
            currentOrderFilters = {
                status: '',
                product: '',
                startDate: '',
                endDate: '',
                customer: '',
                orderId: ''
            };

            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            renderOrdersStatTable();
        }

        // æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
        function viewUserDetails(account) {
            const user = findUserByAccount(account) ||
                (findAdminAccount(account) ? { account: findAdminAccount(account).account, ...findAdminAccount(account).data } : null);

            if (user) {
                const userInfo = user[1] || user;
                const password = userInfo.password || 'ç³»ç»Ÿé¢„è®¾å¯†ç ';
                const points = (userInfo.points == null || isNaN(userInfo.points)) ? 1 : Number(userInfo.points);

                // åˆ›å»ºè¯¦æƒ…æ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>ç”¨æˆ·è¯¦æƒ…</h3>
                            <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="user-detail-grid">
                                <div class="detail-item">
                                    <label>ç”¨æˆ·åï¼š</label>
                                    <span>${userInfo.username}</span>
                                </div>
                                <div class="detail-item">
                                    <label>è´¦å·ï¼š</label>
                                    <span>${account}</span>
                                </div>
                                <div class="detail-item">
                                    <label>å¯†ç ï¼š</label>
                                    <span class="password-field">
                                        <span id="password-display">${'*'.repeat(password.length)}</span>
                                        <button class="btn btn-sm btn-secondary" onclick="togglePassword('${account}')">æ˜¾ç¤ºå¯†ç </button>
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <label>è§’è‰²ï¼š</label>
                                    <span class="role-badge ${userInfo.role}">${userInfo.role === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>æ³¨å†Œæ—¶é—´ï¼š</label>
                                    <span>${user.registerTime || 'ç³»ç»Ÿé¢„è®¾'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>çŠ¶æ€ï¼š</label>
                                    <span class="status-badge ${userInfo.status === 'banned' ? 'status-banned' : 'status-active'}">
                                        ${userInfo.status === 'banned' ? 'å·²ç¦ç”¨' : 'æ­£å¸¸'}
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <label>èœœç½ï¼š</label>
                                    <span>
                                        <input id="user-points-input" type="number" min="0" step="1" value="${points}" style="width: 120px; padding: 4px 8px; border-radius: 4px; border: 1px solid #d1d5db;">
                                    </span>
                                </div>
                                ${userInfo.bannedTime ? `
                                <div class="detail-item">
                                    <label>ç¦ç”¨æ—¶é—´ï¼š</label>
                                    <span>${new Date(userInfo.bannedTime).toLocaleString()}</span>
                                </div>
                                ` : ''}
                            </div>
                            <div class="user-actions" style="margin-top: 20px;">
                                <button class="btn btn-primary" onclick="editUserPassword('${account}')">ä¿®æ”¹å¯†ç </button>
                                <button class="btn btn-secondary" onclick="updateUserPoints('${account}')">ä¿å­˜ç§¯åˆ†</button>
                                <button class="btn btn-secondary" onclick="resetUserData('${account}')">é‡ç½®ç”¨æˆ·æ•°æ®</button>
                                ${userInfo.role !== 'admin' ? (
                        userInfo.status === 'banned'
                            ? `<button class="btn btn-success" onclick="unbanUser('${account}')">è§£ç¦ç”¨æˆ·</button>`
                            : `<button class="btn btn-danger" onclick="banUser('${account}')">ç¦ç”¨ç”¨æˆ·</button>`
                    ) : ''}
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            }
        }

        // åˆ‡æ¢å¯†ç æ˜¾ç¤º
        function togglePassword(account) {
            const user = findUserByAccount(account) ||
                (findAdminAccount(account) ? { account: findAdminAccount(account).account, ...findAdminAccount(account).data } : null);

            if (user) {
                const userInfo = user[1] || user;
                const passwordDisplay = document.getElementById('password-display');
                const button = event.target;

                if (passwordDisplay.textContent.includes('*')) {
                    passwordDisplay.textContent = userInfo.password || 'ç³»ç»Ÿé¢„è®¾å¯†ç ';
                    button.textContent = 'éšè—å¯†ç ';
                } else {
                    passwordDisplay.textContent = '*'.repeat((userInfo.password || 'ç³»ç»Ÿé¢„è®¾å¯†ç ').length);
                    button.textContent = 'æ˜¾ç¤ºå¯†ç ';
                }
            }
        }

        // ä¿®æ”¹ç”¨æˆ·å¯†ç 
        async function editUserPassword(account) {
            const newPassword = prompt(t('enterNewPassword'));
            if (!newPassword || newPassword.length < 6) {
                showNotification(t('passwordTooShortError'), 'error');
                return;
            }

            const user = findUserByAccount(account);
            if (!user) {
                showNotification('åªèƒ½ä¿®æ”¹æ™®é€šç”¨æˆ·å¯†ç ', 'error');
                return;
            }

            user.password = newPassword;
            user.updatedAt = Date.now();
            await saveAllUsers();
            showNotification('å¯†ç ä¿®æ”¹æˆåŠŸ', 'success');
        }

        // æ›´æ–°ç”¨æˆ·ç§¯åˆ†ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰
        async function updateUserPoints(account) {
            const input = document.getElementById('user-points-input');
            if (!input) {
                showNotification('æœªæ‰¾åˆ°èœœç½è¾“å…¥æ¡†', 'error');
                return;
            }

            const value = Number(input.value);
            if (isNaN(value) || value < 0) {
                showNotification('èœœç½å¿…é¡»æ˜¯å¤§äºæˆ–ç­‰äº 0 çš„æ•°å­—', 'error');
                return;
            }

            const user = findUserByAccount(account);
            if (!user) {
                showNotification('åªèƒ½ä¿®æ”¹æ™®é€šç”¨æˆ·èœœç½', 'error');
                return;
            }

            user.points = value;
            user.updatedAt = Date.now();

            // å¦‚æœå½“å‰ç™»å½•ç”¨æˆ·å°±æ˜¯è¢«ä¿®æ”¹çš„è´¦å·ï¼ŒåŠæ—¶åˆ·æ–° currentUser ä¸ UI
            // ä½¿ç”¨è§„èŒƒåŒ–æ¯”è¾ƒï¼Œæ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ
            if (currentUser && normalizeAccount(currentUser.account) === normalizeAccount(account)) {
                currentUser.points = value;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserInterface();
            }

            // ä½¿ç”¨ç»Ÿä¸€çš„ç®¡ç†å‘˜æ›´æ–°æµç¨‹ï¼ŒåŒæ­¥åˆ°äº‘ç«¯
            await saveAllUsers();

            showNotification('ç”¨æˆ·èœœç½å·²æ›´æ–°', 'success');
            // åŒæ­¥åˆ·æ–°ç”¨æˆ·åˆ—è¡¨ä¸­çš„ç§¯åˆ†æ˜¾ç¤º
            renderUsersTable();
        }

        // é‡ç½®ç”¨æˆ·æ•°æ®
        function resetUserData(account) {
            if (!confirm(t('confirmResetUserData'))) {
                return;
            }

            // åˆ é™¤ç”¨æˆ·ç›¸å…³æ•°æ®
            userOrders = userOrders.filter(order => order.customerInfo.email !== account);
            userAddresses = userAddresses.filter(addr => addr.account !== account);

            saveUserOrders();
            saveUserAddresses();

            showNotification(t('userDataReset'), 'success');
        }

        // ç¦ç”¨ç”¨æˆ·ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰
        async function banUser(account) {
            if (confirm(t('confirmBanUser'))) {
                const user = findUserByAccount(account);
                if (user) {
                    user.status = 'banned';
                    user.bannedTime = new Date().toISOString();
                    user.updatedAt = Date.now();
                    await saveAllUsers();
                    renderUsersTable();
                    showNotification(t('userBanned'), 'success');

                    // å…³é—­ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => modal.remove());

                    // å¦‚æœè¢«ç¦ç”¨çš„ç”¨æˆ·æ­£åœ¨ç™»å½•ï¼Œå¼ºåˆ¶å…¶é€€å‡ºï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æ¯”è¾ƒï¼‰
                    if (currentUser && normalizeAccount(currentUser.account) === normalizeAccount(account)) {
                        currentUser = null;
                        localStorage.removeItem('currentUser');
                        updateUserInterface();
                        showNotification('è¯¥è´¦å·å·²è¢«ç¦ç”¨å¹¶å·²é€€å‡ºç™»å½•', 'warning');
                    }
                }
            }
        }

        // è§£ç¦ç”¨æˆ·ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰
        async function unbanUser(account) {
            if (confirm(t('confirmUnbanUser'))) {
                const user = findUserByAccount(account);
                if (user) {
                    user.status = 'active';
                    delete user.bannedTime;
                    user.updatedAt = Date.now();
                    await saveAllUsers();
                    renderUsersTable();
                    showNotification(t('userUnbanned'), 'success');

                    // å…³é—­ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => modal.remove());
                }
            }
        }

        function safeParseArray(raw) {
            if (!raw) return [];
            try {
                const parsed = JSON.parse(raw);
                return Array.isArray(parsed) ? parsed : [];
            } catch (error) {
                console.warn('è§£ææœ¬åœ°æ•°æ®å¤±è´¥:', error);
                return [];
            }
        }

        // åˆ é™¤æœ¬åœ°å’Œäº‘ç«¯ä¸­çš„æŒ‡å®šè´¦å·åŠå…¶å…³è”æ•°æ®
        async function removeAccountData(account) {
            if (!account) throw new Error('è´¦å·æ— æ•ˆ');

            // ä½¿ç”¨è§„èŒƒåŒ–æ¯”è¾ƒï¼Œæ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ
            const isCurrent = currentUser && normalizeAccount(currentUser.account) === normalizeAccount(account);
            const result = { orders: 0, addresses: 0 };

            // ç§»é™¤ç”¨æˆ·åˆ—è¡¨ï¼ˆä½¿ç”¨è§„èŒƒåŒ–æ ¼å¼æŸ¥æ‰¾ï¼‰
            const normalizedAccount = normalizeAccount(account);
            const userIndex = allUsers.findIndex(u => {
                if (u.accountCanonical) {
                    return u.accountCanonical === normalizedAccount;
                }
                return normalizeAccount(u.account) === normalizedAccount;
            });
            if (userIndex !== -1) {
                allUsers.splice(userIndex, 1);
            }

            // ç§»é™¤ç”¨æˆ·èµ„æ–™
            let profileChanged = false;
            if (userProfile[account]) {
                delete userProfile[account];
                profileChanged = true;
            }

            // æ¸…é™¤æœ¬åœ°è®¢å•ç¼“å­˜
            const ordersKey = `userOrders_${account}`;
            const storedOrders = safeParseArray(localStorage.getItem(ordersKey));
            result.orders = storedOrders.length;
            localStorage.removeItem(ordersKey);

            // æ¸…é™¤å…¨å±€è®¢å•æ•°ç»„ä¸­çš„è®°å½•
            if (allOrders.length > 0) {
                const before = allOrders.length;
                allOrders = allOrders.filter(order => order.account !== account);
                if (before !== allOrders.length) {
                    localStorage.setItem('allOrders', JSON.stringify(allOrders));
                }
            }

            // æ¸…é™¤å½“å‰ç”¨æˆ·è®¢å•/åœ°å€
            if (isCurrent) {
                userOrders = [];
                saveUserOrders();
                userAddresses = [];
                saveUserAddresses();
            } else {
                userOrders = userOrders.filter(order => order.account !== account);
                localStorage.setItem('userOrders', JSON.stringify(userOrders));
            }

            // æ¸…é™¤åœ°å€ç¼“å­˜
            const addressesKey = `userAddresses_${account}`;
            const storedAddresses = safeParseArray(localStorage.getItem(addressesKey));
            result.addresses = storedAddresses.length;
            localStorage.removeItem(addressesKey);

            // æ›´æ–°æœ¬åœ°å­˜å‚¨
            saveAllUsers();
            if (profileChanged) {
                saveUserProfile();
            }

            // æ›´æ–°å¤šé€‰çŠ¶æ€
            selectedUserAccounts.delete(account);

            // ========= åŒæ­¥äº‘ç«¯ç”¨æˆ·æ•°æ®ï¼ˆallUsers + users/<id>ï¼‰ç¡®ä¿åˆ é™¤æŒä¹…åŒ– =========
            if (cloudSync && cloudSync.isInitialized) {
                try {
                    // 1) ä» allUsers åˆ—è¡¨ä¸­åˆ é™¤è¯¥è´¦å·å¹¶å†™å›äº‘ç«¯
                    const usersRef = cloudSync.db.ref('allUsers');
                    const snapshot = await usersRef.once('value');
                    const cloudUsers = Array.isArray(snapshot.val()) ? snapshot.val() : [];
                    const normalizedAccount = normalizeAccount(account);
                    const updatedUsers = cloudUsers.filter(u => {
                        if (!u) return true;
                        if (u.accountCanonical) {
                            return u.accountCanonical !== normalizedAccount;
                        }
                        return normalizeAccount(u.account) !== normalizedAccount;
                    });
                    await usersRef.set(updatedUsers);
                    console.log(`âœ… å·²ä» allUsers åˆ—è¡¨ä¸­åˆ é™¤è´¦å· ${account}`);

                    // 2) åˆ é™¤ users/<id> èŠ‚ç‚¹ä¸‹çš„ç”¨æˆ·ç§æœ‰æ•°æ®
                    await cloudSync.deleteUserAccount(account);
                } catch (error) {
                    console.error('åˆ é™¤äº‘ç«¯ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                }
            }

            return result;
        }

        // ========== åˆ é™¤ç”¨æˆ·è´¦å·åŠŸèƒ½ ==========
        // å½»åº•åˆ é™¤ç”¨æˆ·è´¦å·åŠå…¶æ‰€æœ‰ç›¸å…³æ•°æ®
        async function deleteUserAccount(account) {
            const user = findUserByAccount(account);
            if (!user) {
                showNotification(t('userNotExists'), 'error');
                return;
            }

            // äºŒæ¬¡ç¡®è®¤åˆ é™¤æ“ä½œ
            const confirmDelete = confirm(
                t('confirmDeleteUser')
                    .replace('{account}', account)
                    .replace('{username}', user.username)
                    .replace('{registerTime}', user.registerTime)
            );

            if (!confirmDelete) {
                return;
            }

            // å†æ¬¡ç¡®è®¤
            const finalConfirm = prompt(
                t('finalConfirmDelete').replace('{account}', account),
                ''
            );

            if (finalConfirm !== account) {
                showNotification(t('accountInputMismatch'), 'warning');
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ å¼€å§‹åˆ é™¤ç”¨æˆ·è´¦å·:', account);

                const { orders, addresses } = await removeAccountData(account);

                // æ›´æ–°ç•Œé¢
                renderUsersTable();

                // å…³é—­ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => modal.remove());

                showNotification(
                    t('userDeletedSuccess')
                        .replace('{account}', account)
                        .replace('{orders}', orders)
                        .replace('{addresses}', addresses),
                    'success'
                );

                console.log('ğŸ‰ ç”¨æˆ·è´¦å·åˆ é™¤å®Œæˆ');

                // 10. å¦‚æœè¢«åˆ é™¤çš„ç”¨æˆ·æ­£åœ¨ç™»å½•ï¼Œå¼ºåˆ¶å…¶é€€å‡º
                // ä½¿ç”¨è§„èŒƒåŒ–æ¯”è¾ƒï¼Œæ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ
                if (currentUser && normalizeAccount(currentUser.account) === normalizeAccount(account)) {
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    if (cloudSync && cloudSync.isInitialized) {
                        await cloudSync.handleUserSessionChange();
                    }
                    updateUserInterface();
                    showNotification(t('accountDeletedByAdmin'), 'error');
                    // è·³è½¬åˆ°é¦–é¡µ
                    document.getElementById('home-page').style.display = 'block';
                    document.getElementById('user-center').style.display = 'none';
                    document.getElementById('admin-panel').style.display = 'none';
                }

            } catch (error) {
                console.error('âŒ åˆ é™¤ç”¨æˆ·å¤±è´¥:', error);
                showNotification(t('deleteUserFailed') + ': ' + error.message, 'error');
            }
        }

        async function deleteSelectedUsers() {
            if (selectedUserAccounts.size === 0) {
                showNotification(t('pleaseSelectAccountsToDelete'), 'warning');
                return;
            }

            const accounts = Array.from(selectedUserAccounts);
            if (!confirm(t('confirmDeleteSelectedAccounts').replace('{count}', accounts.length))) {
                return;
            }

            showNotification(t('deletingAccounts'), 'info');

            for (const account of accounts) {
                try {
                    await removeAccountData(account);
                } catch (error) {
                    console.error(`åˆ é™¤è´¦å· ${account} å¤±è´¥:`, error);
                    showNotification(`åˆ é™¤è´¦å· ${account} å¤±è´¥: ${error.message}`, 'error');
                }
            }

            renderUsersTable();
            showNotification(t('batchDeleteComplete'), 'success');
        }

        async function handleSelfAccountDeletion() {
            if (!currentUser) {
                showNotification(t('pleaseLoginBeforeDeletion'), 'warning');
                return;
            }

            const account = currentUser.account;
            const firstConfirm = confirm(t('confirmDeleteSelfAccount'));
            if (!firstConfirm) {
                return;
            }

            const finalInput = prompt(t('finalConfirmDeleteSelf').replace('{account}', account), '');
            if (finalInput !== account) {
                showNotification(t('accountInputMismatchCancel'), 'warning');
                return;
            }

            try {
                await removeAccountData(account);
                currentUser = null;
                localStorage.removeItem('currentUser');

                if (cloudSync && cloudSync.isInitialized) {
                    await cloudSync.handleUserSessionChange();
                }

                updateUserInterface();
                showHomePage();
                showNotification(t('accountDeletedSuccess'), 'success');
            } catch (error) {
                console.error('æ³¨é”€è´¦å·å¤±è´¥:', error);
                showNotification(t('deleteAccountFailed') + 'ï¼š' + error.message, 'error');
            }
        }

        async function deleteOrdersByIds(orderIds, showSuccessMessage = true) {
            const ids = (orderIds || []).map(normalizeOrderId).filter(Boolean);
            if (ids.length === 0) {
                showNotification(t('noOrdersToDelete'), 'warning');
                return false;
            }

            const uniqueIds = Array.from(new Set(ids));
            const ordersToDelete = uniqueIds
                .map(id => findOrderById(id))
                .filter(order => !!order);

            if (ordersToDelete.length === 0) {
                showNotification('æœªæ‰¾åˆ°è¦åˆ é™¤çš„è®¢å•', 'warning');
                return false;
            }

            const idSet = new Set(uniqueIds);

            if (allOrders && allOrders.length > 0) {
                allOrders = allOrders.filter(order => !idSet.has(normalizeOrderId(order.id)));
                localStorage.setItem('allOrders', JSON.stringify(allOrders));
            }

            if (userOrders && userOrders.length > 0) {
                userOrders = userOrders.filter(order => !idSet.has(normalizeOrderId(order.id)));
                saveUserOrders();
            }

            if (cloudSync && cloudSync.isInitialized) {
                const userOrderMap = new Map();
                ordersToDelete.forEach(order => {
                    if (!order.account) return;
                    if (!userOrderMap.has(order.account)) {
                        userOrderMap.set(order.account, []);
                    }
                    userOrderMap.get(order.account).push(normalizeOrderId(order.id));
                });

                for (const [account, idsForUser] of userOrderMap.entries()) {
                    try {
                        const ref = getCloudOrdersRefForAccount(account);
                        if (!ref) continue;
                        const snapshot = await ref.once('value');
                        const cloudUserOrders = snapshot.val() || [];
                        const filtered = cloudUserOrders.filter(o => !idsForUser.includes(normalizeOrderId(o.id)));
                        await ref.set(filtered);
                    } catch (error) {
                        console.error(`åŒæ­¥åˆ é™¤ç”¨æˆ· ${account} è®¢å•å¤±è´¥:`, error);
                    }
                }
            }

            renderOrdersTable();
            renderUserOrders();

            if (showSuccessMessage) {
                showNotification('è®¢å•å·²åˆ é™¤', 'success');
            }

            if (cloudSync && cloudSync.isInitialized && currentUser && currentUser.role === 'admin') {
                cloudSync.loadAllOrders().catch(err => console.warn('åˆ·æ–°æ‰€æœ‰è®¢å•å¤±è´¥', err));
            }

            return true;
        }

        async function deleteSelectedOrders() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤è®¢å•', 'warning');
                return;
            }

            if (selectedOrderIds.size === 0) {
                showNotification('è¯·å…ˆå‹¾é€‰è¦åˆ é™¤çš„è®¢å•', 'warning');
                return;
            }

            const ids = Array.from(selectedOrderIds);
            if (!confirm(t('confirmDeleteSelectedOrders').replace('{count}', ids.length))) {
                return;
            }

            const result = await deleteOrdersByIds(ids, false);
            if (result) {
                selectedOrderIds.clear();
                refreshOrderSelectionUI();
                showNotification(t('batchDeleteComplete'), 'success');
            }
        }

        async function deleteSingleOrder(orderId) {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤è®¢å•', 'warning');
                return;
            }

            const order = findOrderById(orderId);
            if (!order) {
                showNotification(t('orderNotFound') || 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                return;
            }

            const orderLabel = normalizeOrderId(orderId);
            if (!confirm(t('confirmDeleteOrder').replace('{orderLabel}', orderLabel))) {
                return;
            }

            await deleteOrdersByIds([orderId]);
            selectedOrderIds.delete(orderLabel);
            refreshOrderSelectionUI();
        }

        // æ˜¾ç¤ºå®¢æˆ·å†å²è®¢å•ä¿¡æ¯
        function showCustomerHistory(customerName, customerPhone, customerEmail) {
            // æŸ¥æ‰¾è¯¥å®¢æˆ·çš„æ‰€æœ‰è®¢å•
            const customerOrders = userOrders.filter(order =>
                order.customerInfo.name === customerName ||
                order.customerInfo.phone === customerPhone ||
                order.customerInfo.email === customerEmail
            );

            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºå®¢æˆ·å†å²
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>å®¢æˆ·å†å²è®¢å• - ${customerName}</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="customer-info-summary" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: var(--dark);">å®¢æˆ·ä¿¡æ¯</h4>
                            <p style="margin: 5px 0;"><strong>å§“åï¼š</strong>${customerName}</p>
                            <p style="margin: 5px 0;"><strong>ç”µè¯ï¼š</strong>${customerPhone}</p>
                            <p style="margin: 5px 0;"><strong>é‚®ç®±ï¼š</strong>${customerEmail}</p>
                            <p style="margin: 5px 0;"><strong>è®¢å•æ€»æ•°ï¼š</strong>${customerOrders.length} å•</p>
                        </div>
                        
                        <h4 style="margin-bottom: 15px; color: var(--dark);">å†å²è®¢å•åˆ—è¡¨</h4>
                        ${customerOrders.length === 0 ?
                    '<p style="text-align: center; color: #999; padding: 20px;">è¯¥å®¢æˆ·æš‚æ— å†å²è®¢å•</p>' :
                    `<div class="customer-orders-list" style="max-height: 400px; overflow-y: auto;">
                                ${customerOrders.map((order, index) => `
                                    <div class="order-history-item" style="padding: 15px; background: white; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 10px;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                            <div>
                                                <h5 style="margin: 0 0 5px 0; color: var(--dark);">è®¢å• #${order.id}</h5>
                                                <p style="margin: 0; color: var(--gray); font-size: 14px;">${formatDate(order.date)}</p>
                                            </div>
                                            <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                                        </div>
                                        <div style="font-size: 14px;">
                                            <p style="margin: 5px 0;"><strong>äº§å“ï¼š</strong>${order.productName}</p>
                                            <p style="margin: 5px 0;">
                                                <strong>ä»·æ ¼ï¼š</strong>
                                                <span class="order-price-old">${formatCurrency(order.originalPrice ?? order.price)}</span>
                                                <span class="order-price-new">${formatCurrency(order.promoPrice ?? 0)}</span>
                                            </p>
                                            <p style="margin: 5px 0;"><strong>åœ°å€ï¼š</strong>${order.customerInfo.address}</p>
                                            ${order.customerInfo.notes ? `<p style="margin: 5px 0;"><strong>å¤‡æ³¨ï¼š</strong>${order.customerInfo.notes}</p>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>`
                }
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // æŸ¥çœ‹è®¢å•è¯¦æƒ…
        function viewOrderDetails(orderId) {
            showOrderDetailsModal(orderId);
        }

        // ===== è®¢å•è¾…åŠ©å‡½æ•° =====
        function normalizeOrderId(orderId) {
            if (orderId === null || orderId === undefined) return '';
            return String(orderId);
        }

        function findOrderById(orderId) {
            const targetId = normalizeOrderId(orderId);
            let order = userOrders.find(o => normalizeOrderId(o.id) === targetId);
            if (!order && allOrders.length > 0) {
                order = allOrders.find(o => normalizeOrderId(o.id) === targetId);
            }
            return order || null;
        }

        function getCloudOrdersRefForAccount(account) {
            if (!cloudSync || !cloudSync.isInitialized || !account) return null;
            const userPath = cloudSync.getUserPath(account);
            return cloudSync.db.ref(`${userPath}/orders`);
        }

        function getCloudOrdersRefForOrder(order) {
            if (!order || !order.account) return null;
            return getCloudOrdersRefForAccount(order.account);
        }

        // ç®¡ç†å‘˜ä¸“ç”¨ï¼šç›´æ¥åœ¨äº‘ç«¯æ›´æ–°æŒ‡å®šè®¢å•çš„çŠ¶æ€ï¼ˆä»¥äº‘ç«¯ä¸ºå”¯ä¸€çœŸæºï¼‰
        // è¿”å› true è¡¨ç¤ºå·²åœ¨äº‘ç«¯æˆåŠŸæ›´æ–°å¹¶åˆ·æ–°åˆ°æœ¬åœ°ï¼›false è¡¨ç¤ºéœ€è¦å›é€€åˆ°æœ¬åœ°æ—§é€»è¾‘
        async function adminUpdateOrderStatusOnCloud(order, newStatus, statusText) {
            try {
                if (!cloudSync || !cloudSync.isInitialized) {
                    console.warn('adminUpdateOrderStatusOnCloud: cloudSync æœªåˆå§‹åŒ–ï¼Œä½¿ç”¨æœ¬åœ°æ›´æ–°é€»è¾‘');
                    return false;
                }
                if (!currentUser || currentUser.role !== 'admin') {
                    console.warn('adminUpdateOrderStatusOnCloud: å½“å‰ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œä½¿ç”¨æœ¬åœ°æ›´æ–°é€»è¾‘');
                    return false;
                }
                if (!order || !order.id) {
                    console.error('adminUpdateOrderStatusOnCloud: è®¢å•æ— æ•ˆ');
                    return false;
                }

                const userOrdersRef = getCloudOrdersRefForOrder(order);
                if (!userOrdersRef) {
                    console.warn('adminUpdateOrderStatusOnCloud: æ— æ³•å®šä½è®¢å•æ‰€å±ç”¨æˆ·è·¯å¾„ï¼Œä½¿ç”¨æœ¬åœ°æ›´æ–°é€»è¾‘');
                    return false;
                }

                console.log('ğŸ”„ ç®¡ç†å‘˜æ­£åœ¨äº‘ç«¯æ›´æ–°è®¢å•çŠ¶æ€:', {
                    orderId: order.id,
                    account: order.account,
                    newStatus,
                    statusText
                });

                // åœ¨æ›´æ–°æœŸé—´æš‚æ—¶é˜»æ­¢å®æ—¶ç›‘å¬è¦†ç›–æœ¬åœ°æ•°æ®
                cloudSync._syncState.inProgress = true;

                const snapshot = await userOrdersRef.once('value');
                let cloudUserOrders = snapshot.val() || [];
                if (!Array.isArray(cloudUserOrders)) {
                    console.warn('adminUpdateOrderStatusOnCloud: äº‘ç«¯è®¢å•æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨æœ¬åœ°æ›´æ–°é€»è¾‘');
                    return false;
                }

                // ä½¿ç”¨ä¸æœ¬åœ°ä¸€è‡´çš„IDè§„èŒƒåŒ–è§„åˆ™ï¼Œé¿å…å­—ç¬¦ä¸²/æ•°å­—ä¸ä¸€è‡´å¯¼è‡´åŒ¹é…å¤±è´¥
                const targetId = normalizeOrderId(order.id);
                const orderIndex = cloudUserOrders.findIndex(o => o && normalizeOrderId(o.id) === targetId);
                if (orderIndex === -1) {
                    console.warn('adminUpdateOrderStatusOnCloud: äº‘ç«¯æœªæ‰¾åˆ°è¯¥è®¢å•ï¼Œä½¿ç”¨æœ¬åœ°æ›´æ–°é€»è¾‘');
                    return false;
                }

                const updateTimestamp = Date.now();
                const original = cloudUserOrders[orderIndex] || {};

                // æé«˜ç®¡ç†å‘˜æ›´æ–°çš„"æƒé‡"ï¼šä½¿ç”¨ç•¥å¾®é åçš„æ—¶é—´æˆ³ï¼Œç¡®ä¿åœ¨ä»»ä½•åˆå¹¶é€»è¾‘é‡Œéƒ½ä»¥äº‘ç«¯ä¸ºå‡†
                const strongUpdateTimestamp = Date.now() + 30 * 1000; // æ¯”å½“å‰æ—¶é—´æ™š30ç§’
                
                // ä¿ç•™è®¢å•çš„æ‰€æœ‰é‡è¦å­—æ®µï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
                cloudUserOrders[orderIndex] = {
                    ...original,
                    status: newStatus,
                    updatedAt: strongUpdateTimestamp,
                    // ç¡®ä¿ä¿ç•™æ‰€æœ‰å¿…è¦å­—æ®µ
                    account: original.account || order.account,
                    productId: original.productId || order.productId,
                    productName: original.productName || order.productName,
                    price: original.price !== undefined ? original.price : order.price,
                    image: original.image || order.image,
                    customerInfo: original.customerInfo || order.customerInfo,
                    date: original.date || order.date || Date.now(),
                    trackingNumber: original.trackingNumber || order.trackingNumber
                };

                // ä½¿ç”¨ set æ–¹æ³•æ›´æ–°ï¼Œè¿™ä¼šè§¦å‘æ‰€æœ‰å®¢æˆ·ç«¯çš„å®æ—¶ç›‘å¬å™¨
                await userOrdersRef.set(cloudUserOrders);
                
                console.log('ğŸ“¤ è®¢å•æ›´æ–°å·²å†™å…¥äº‘ç«¯ï¼Œå®æ—¶ç›‘å¬å™¨å°†è‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰å®¢æˆ·ç«¯');

                console.log('âœ… ç®¡ç†å‘˜å·²åœ¨äº‘ç«¯æ›´æ–°è®¢å•çŠ¶æ€:', {
                    orderId: order.id,
                    newStatus,
                    updatedAt: updateTimestamp
                });

                // ä»äº‘ç«¯é‡æ–°åŠ è½½æ‰€æœ‰è®¢å•ï¼Œåˆ·æ–°åå°åˆ—è¡¨ï¼ˆä»¥äº‘ç«¯ä¸ºå‡†ï¼‰
                if (typeof cloudSync.loadAllOrders === 'function') {
                    try {
                        await cloudSync.loadAllOrders();
                        console.log('âœ… å·²ä»äº‘ç«¯é‡æ–°åŠ è½½æ‰€æœ‰è®¢å•ï¼ˆç®¡ç†å‘˜è§†å›¾ï¼‰');
                    } catch (reloadErr) {
                        console.warn('adminUpdateOrderStatusOnCloud: é‡æ–°åŠ è½½æ‰€æœ‰è®¢å•å¤±è´¥ï¼ˆå¯å¿½ç•¥ï¼‰:', reloadErr);
                    }
                }

                return true;
            } catch (e) {
                console.error('adminUpdateOrderStatusOnCloud æ‰§è¡Œå¤±è´¥:', e);
                return false;
            } finally {
                // ç¨å¾®å»¶è¿Ÿæ¸…ç†æ ‡è®°ï¼Œé¿å…ç›‘å¬å™¨ç«‹åˆ»è¦†ç›–
                if (cloudSync) {
                    setTimeout(() => {
                        cloudSync._syncState.inProgress = false;
                    }, 500);
                }
            }
        }

        function findReviewContextByOrderId(orderId) {
            const targetId = normalizeOrderId(orderId);
            for (const product of products) {
                if (!product || !Array.isArray(product.reviews)) continue;
                const index = product.reviews.findIndex(review => normalizeOrderId(review.orderId) === targetId);
                if (index > -1) {
                    return { product, index };
                }
            }
            return null;
        }

        // æ ¼å¼åŒ–è®¢å•åœ°å€æ˜¾ç¤º
        function renderOrderContactInfo(order) {
            const info = order.customerInfo || {};
            const name = info.name || info.fullName || order.account || t('notFilled');
            const account = info.account || info.username || order.account || t('notFilled');
            const email = info.email || t('notFilled');
            const phone = info.phone || t('notFilled');
            let street = info.addressDetail || info.detail || info.street || '';
            let unit = info.addressUnit || info.unit || '';
            let city = info.addressCity || info.city || '';
            let state = info.addressState || info.state || '';
            let postal = info.addressPostal || info.postal || info.zip || '';

            // å¦‚æœè¯¦ç»†å­—æ®µç¼ºå¤±ï¼Œä½†æœ‰æ•´æ®µåœ°å€å­—ç¬¦ä¸²ï¼Œå°è¯•æ™ºèƒ½è§£æ
            if (info.address && (!street || !city || !state || !postal)) {
                const parsed = parseAddressString(info.address);
                street = street || parsed.street;
                unit = unit || parsed.unit;
                city = city || parsed.city;
                state = state || parsed.state;
                postal = postal || parsed.postal;
            }

            const safeText = (value) => (value ? value : (t('notFilled') || 'N/A'));

            return `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px;">
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('name') || 'Full Name'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(name)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('account') || 'Account'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(account)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('email') || 'Email'}</div>
                        <div style="font-size: 15px; font-weight: 600; word-break: break-all;">${safeText(email)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('phone') || 'Phone'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(phone)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('street') || 'Street'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(street)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('unit') || 'Unit / Suite'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(unit)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('city') || 'City'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(city)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('state') || 'State'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(state)}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #777;">${t('postal') || 'ZIP Code'}</div>
                        <div style="font-size: 15px; font-weight: 600;">${safeText(postal)}</div>
                    </div>
                </div>
                ${info.notes ? `<div style="margin-top: 12px;"><strong>${t('notes')}ï¼š</strong>${info.notes}</div>` : ''}
            `;
        }

        function parseAddressString(addressStr) {
            const result = { street: '', unit: '', city: '', state: '', postal: '' };
            if (!addressStr || typeof addressStr !== 'string') {
                return result;
            }

            const parts = addressStr.split(',').map(p => p.trim()).filter(Boolean);
            if (parts.length === 0) return result;

            result.street = parts[0] || '';

            if (parts.length >= 5) {
                result.unit = parts[1] || '';
                result.city = parts[2] || '';
                result.state = parts[parts.length - 2] || '';
                result.postal = parts[parts.length - 1] || '';
            } else if (parts.length === 4) {
                result.unit = parts[1] || '';
                result.city = parts[2] || '';
                result.state = parts[3] || '';
            } else if (parts.length === 3) {
                result.city = parts[1] || '';
                if (/^\d{5}(-\d{4})?$/.test(parts[2])) {
                    result.postal = parts[2];
                } else if (/^[A-Za-z]{2,3}$/.test(parts[2])) {
                    result.state = parts[2];
                } else {
                    result.city = `${result.city ? result.city + ', ' : ''}${parts[2]}`;
                }
            } else if (parts.length === 2) {
                result.city = parts[1] || '';
            }

            // å¦‚æœä»æœªè¯†åˆ«å‡ºå·/é‚®ç¼–ï¼Œå°è¯•ä»æœ€åä¸¤ä¸ªå­—æ®µæ¨æ–­
            if (!result.postal && parts.length >= 2 && /^\d{5}(-\d{4})?$/.test(parts[parts.length - 1])) {
                result.postal = parts[parts.length - 1];
            }
            if (!result.state && parts.length >= 2 && /^[A-Za-z]{2,3}$/.test(parts[parts.length - 2])) {
                result.state = parts[parts.length - 2];
            }

            return result;
        }

        function formatOrderAddress(customerInfo) {
            if (!customerInfo) return t('notFilled') || 'æœªå¡«å†™';
            
            // å¦‚æœåœ°å€æœ‰è¯¦ç»†å­—æ®µï¼Œæ ¼å¼åŒ–æ˜¾ç¤º
            if (customerInfo.addressDetail || customerInfo.detail || customerInfo.street) {
                const addressParts = [];
                
                // è¡—é“åœ°å€
                const street = customerInfo.addressDetail || customerInfo.detail || customerInfo.street || '';
                if (street) addressParts.push(street);
                
                // å•å…ƒ/å¥—æˆ¿å·
                const unit = customerInfo.addressUnit || customerInfo.unit || '';
                if (unit) addressParts.push(unit);
                
                // åŸå¸‚
                const city = customerInfo.addressCity || customerInfo.city || '';
                if (city) addressParts.push(city);
                
                // å·/çœ
                const state = customerInfo.addressState || customerInfo.state || '';
                
                // é‚®ç¼–
                const postal = customerInfo.addressPostal || customerInfo.postal || customerInfo.zip || '';
                
                // æ„å»ºæ ¼å¼åŒ–åœ°å€
                let formattedAddress = '';
                if (addressParts.length > 0) {
                    formattedAddress = addressParts.join(', ');
                }
                
                if (state && postal) {
                    formattedAddress += (formattedAddress ? ', ' : '') + `${state} ${postal}`;
                } else if (state) {
                    formattedAddress += (formattedAddress ? ', ' : '') + state;
                } else if (postal) {
                    formattedAddress += (formattedAddress ? ', ' : '') + postal;
                }
                
                if (formattedAddress) {
                    return `<div style="margin-top: 5px; line-height: 1.6;">
                        ${street ? `<div><strong>${currentLanguage === 'zh' ? 'è¡—é“åœ°å€' : 'Street'}:</strong> ${street}</div>` : ''}
                        ${unit ? `<div><strong>${currentLanguage === 'zh' ? 'å•å…ƒ/å¥—æˆ¿' : 'Unit/Suite'}:</strong> ${unit}</div>` : ''}
                        ${city ? `<div><strong>${currentLanguage === 'zh' ? 'åŸå¸‚' : 'City'}:</strong> ${city}</div>` : ''}
                        ${state ? `<div><strong>${currentLanguage === 'zh' ? 'å·/çœ' : 'State'}:</strong> ${state}</div>` : ''}
                        ${postal ? `<div><strong>${currentLanguage === 'zh' ? 'é‚®ç¼–' : 'ZIP Code'}:</strong> ${postal}</div>` : ''}
                    </div>`;
                }
            }
            
            // å¦‚æœåªæœ‰å­—ç¬¦ä¸²åœ°å€ï¼Œå°è¯•è§£æå¹¶æ ¼å¼åŒ–
            if (customerInfo.address) {
                const addressStr = customerInfo.address;
                
                // å°è¯•è§£ææ ¼å¼ï¼šdetail, unit, city, state, postal
                const parts = addressStr.split(',').map(p => p.trim()).filter(p => p);
                
                if (parts.length >= 3) {
                    // æ™ºèƒ½è¯†åˆ«ï¼šæœ€åä¸€ä¸ªå¯èƒ½æ˜¯é‚®ç¼–ï¼ˆçº¯æ•°å­—ï¼‰ï¼Œå€’æ•°ç¬¬äºŒä¸ªå¯èƒ½æ˜¯å·ï¼ˆ2-3ä¸ªå­—æ¯ï¼‰
                    let street = parts[0] || '';
                    let unit = '';
                    let city = '';
                    let state = '';
                    let postal = '';
                    
                    // æ£€æŸ¥æœ€åä¸€ä¸ªæ˜¯å¦æ˜¯é‚®ç¼–ï¼ˆ5ä½æ•°å­—ï¼‰
                    const lastPart = parts[parts.length - 1];
                    if (/^\d{5}(-\d{4})?$/.test(lastPart)) {
                        postal = lastPart;
                        // å€’æ•°ç¬¬äºŒä¸ªå¯èƒ½æ˜¯å·ï¼ˆ2-3ä¸ªå¤§å†™å­—æ¯ï¼‰
                        if (parts.length >= 2 && /^[A-Z]{2,3}$/.test(parts[parts.length - 2])) {
                            state = parts[parts.length - 2];
                            city = parts.length >= 3 ? parts[parts.length - 3] : '';
                            unit = parts.length >= 4 ? parts[1] : '';
                        } else {
                            // æ²¡æœ‰æ˜ç¡®çš„å·ï¼Œæœ€åä¸€ä¸ªå¯èƒ½æ˜¯åŸå¸‚
                            city = parts.length >= 2 ? parts[parts.length - 2] : '';
                            unit = parts.length >= 3 ? parts[1] : '';
                        }
                    } else if (parts.length === 3) {
                        // 3ä¸ªéƒ¨åˆ†ï¼šè¡—é“, åŸå¸‚, å·/é‚®ç¼–
                        city = parts[1] || '';
                        // æ£€æŸ¥ç¬¬ä¸‰ä¸ªæ˜¯å¦æ˜¯é‚®ç¼–æˆ–å·
                        if (/^\d{5}(-\d{4})?$/.test(parts[2])) {
                            postal = parts[2];
                        } else if (/^[A-Z]{2,3}$/.test(parts[2])) {
                            state = parts[2];
                        }
                    } else if (parts.length >= 4) {
                        // 4ä¸ªæˆ–æ›´å¤šéƒ¨åˆ†ï¼šè¡—é“, å•å…ƒ, åŸå¸‚, å·, é‚®ç¼–
                        unit = parts[1] || '';
                        city = parts[2] || '';
                        if (parts.length >= 4) {
                            // æ£€æŸ¥å€’æ•°ç¬¬äºŒä¸ªæ˜¯å¦æ˜¯å·
                            if (/^[A-Z]{2,3}$/.test(parts[parts.length - 2])) {
                                state = parts[parts.length - 2];
                                postal = parts[parts.length - 1] || '';
                            } else {
                                state = parts[3] || '';
                                postal = parts.length >= 5 ? parts[4] : '';
                            }
                        }
                    }
                    
                    return `<div style="margin-top: 5px; line-height: 1.6;">
                        ${street ? `<div><strong>${currentLanguage === 'zh' ? 'è¡—é“åœ°å€' : 'Street'}:</strong> ${street}</div>` : ''}
                        ${unit ? `<div><strong>${currentLanguage === 'zh' ? 'å•å…ƒ/å¥—æˆ¿' : 'Unit/Suite'}:</strong> ${unit}</div>` : ''}
                        ${city ? `<div><strong>${currentLanguage === 'zh' ? 'åŸå¸‚' : 'City'}:</strong> ${city}</div>` : ''}
                        ${state ? `<div><strong>${currentLanguage === 'zh' ? 'å·/çœ' : 'State'}:</strong> ${state}</div>` : ''}
                        ${postal ? `<div><strong>${currentLanguage === 'zh' ? 'é‚®ç¼–' : 'ZIP Code'}:</strong> ${postal}</div>` : ''}
                    </div>`;
                } else {
                    // å¦‚æœæ— æ³•è§£æï¼Œç›´æ¥æ˜¾ç¤ºåŸåœ°å€
                    return `<div style="margin-top: 5px; white-space: pre-wrap; line-height: 1.6;">${addressStr}</div>`;
                }
            }
            
            return t('notFilled') || 'æœªå¡«å†™';
        }

        function normalizeUSPhone(value) {
            if (!value) return '';
            const digits = value.replace(/\D/g, '');
            let core = digits;
            if (core.length === 11 && core.startsWith('1')) {
                core = core.slice(1);
            }
            if (core.length !== 10) return null;
            return '+1' + core;
        }

        function extractUSPhoneDigits(value) {
            if (!value) return '';
            const digits = value.replace(/\D/g, '');
            if (digits.length === 11 && digits.startsWith('1')) {
                return digits.slice(1, 11);
            }
            if (digits.length >= 10) {
                return digits.slice(-10);
            }
            return digits;
        }

        function attachUSPhoneInputBehavior(inputId) {
            const input = document.getElementById(inputId);
            if (!input || input.dataset.usPhoneBound === 'true') return;
            input.dataset.usPhoneBound = 'true';

            const wrapper = input.closest('.phone-input-wrapper');

            input.addEventListener('input', function () {
                const digitsOnly = this.value.replace(/\D/g, '').slice(0, 10);
                this.value = digitsOnly;
                this.setCustomValidity('');
                if (wrapper) wrapper.classList.remove('error');
            });

            input.addEventListener('blur', function () {
                if (!this.value) {
                    this.setCustomValidity('');
                    if (wrapper) wrapper.classList.remove('error');
                    return;
                }
                const normalized = normalizeUSPhone(this.value);
                if (!normalized) {
                    const message = t('invalidPhoneFormat') || 'Invalid phone number format';
                    this.setCustomValidity(message);
                    if (wrapper) wrapper.classList.add('error');
                    if (typeof this.reportValidity === 'function') {
                        this.reportValidity();
                    } else {
                        customAlert(message, t('infoTitle') || 'æç¤º');
                    }
                } else {
                    this.setCustomValidity('');
                    if (wrapper) wrapper.classList.remove('error');
                }
            });
        }

        // æ˜¾ç¤ºè®¢å•è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆåŒ…å«äº§å“ä¿¡æ¯å’Œå¿«é€’å•å·ï¼‰
        function showOrderDetailsModal(orderId) {
            const order = findOrderById(orderId);
            
            if (!order) {
                console.error('æœªæ‰¾åˆ°è®¢å•ï¼Œè®¢å•ID:', orderId);
                console.log('userOrdersæ•°é‡:', userOrders.length);
                console.log('allOrdersæ•°é‡:', allOrders.length);
                showNotification(t('orderNotFound') || 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                return;
            }

            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'order-details-modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3>${t('orderDetails')}</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body" style="padding: 20px;">
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="flex: 0 0 160px;">
                                <div class="order-image" style="background-image: url('${order.image || ''}'); width: 160px; height: 160px; background-size: cover; background-position: center; border-radius: 8px; border: 1px solid #ddd;"></div>
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <h3 style="margin-top: 0; color: var(--primary); font-size: 18px; line-height: 1.4; max-height: 3.2em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; word-break: break-word;">
                                    ${order.productName}
                                </h3>
                                <div style="margin: 15px 0;">
                                    <p style="margin: 8px 0;"><strong>${t('orderId')}ï¼š</strong>${order.id}</p>
                                    <p style="margin: 8px 0;">
                                        <strong>${t('price') || 'ä»·æ ¼'}ï¼š</strong>
                                        <span class="order-price-old">${formatCurrency(order.originalPrice ?? order.price)}</span>
                                        <span class="order-price-new" style="font-size: 18px;">${formatCurrency(order.promoPrice ?? 0)}</span>
                                    </p>
                                    <p style="margin: 8px 0;"><strong>${t('orderStatus')}ï¼š</strong><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></p>
                                    <p style="margin: 8px 0;"><strong>${t('orderTime')}ï¼š</strong>${formatDate(order.date)}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin-top: 0; margin-bottom: 15px; color: var(--primary);">
                                <i class="fas fa-truck" style="margin-right: 8px;"></i>${t('expressInfo')}
                            </h4>
                            ${currentUser && currentUser.role === 'admin' ? `
                                <!-- ç®¡ç†å‘˜ï¼šå¯ä»¥ç¼–è¾‘å¿«é€’å•å· -->
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">${t('trackingNumber')}ï¼š</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input type="text" id="tracking-number-input" value="${order.trackingNumber || ''}" 
                                               placeholder="${t('trackingNumberPlaceholder')}" 
                                               style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                        <button class="btn btn-primary" onclick="saveTrackingNumber('${normalizeOrderId(order.id)}')" style="padding: 10px 20px;">
                                            <i class="fas fa-save"></i> ${t('save')}
                                        </button>
                                    </div>
                                    ${order.trackingNumber ? `
                                        <a href="https://tools.usps.com/go/TrackConfirmAction?qtc_tLabels1=${order.trackingNumber}" 
                                           target="_blank" 
                                           rel="noopener noreferrer"
                                           style="display: inline-block; background: #ffc107; color: #8b4513; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 15px; transition: all 0.3s; box-shadow: 0 2px 6px rgba(255,193,7,0.3); border: none; cursor: pointer; margin-top: 10px;"
                                           onmouseover="this.style.background='#ffb300'; this.style.boxShadow='0 4px 8px rgba(255,193,7,0.4)'; this.style.transform='translateY(-2px)';"
                                           onmouseout="this.style.background='#ffc107'; this.style.boxShadow='0 2px 6px rgba(255,193,7,0.3)'; this.style.transform='translateY(0)';">
                                            <i class="fas fa-truck" style="margin-right: 6px;"></i>${t('trackPackage')}
                                        </a>
                                        <p style="margin-top: 10px; color: #666; font-size: 12px;">
                                            <i class="fas fa-info-circle"></i> ${t('trackingNumberInfo')}
                                        </p>
                                    ` : ''}
                                </div>
                            ` : `
                                <!-- æ™®é€šç”¨æˆ·ï¼šåªæ˜¾ç¤ºå¿«é€’ä¿¡æ¯ï¼Œä¸èƒ½ç¼–è¾‘ -->
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">${t('trackingNumber')}ï¼š</label>
                                    ${order.trackingNumber ? `
                                        <div style="padding: 10px; background: white; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; margin-bottom: 10px;">
                                            <span style="font-weight: 500; color: var(--primary);">${order.trackingNumber}</span>
                                        </div>
                                        <a href="https://tools.usps.com/go/TrackConfirmAction?qtc_tLabels1=${order.trackingNumber}" 
                                           target="_blank" 
                                           rel="noopener noreferrer"
                                           style="display: inline-block; background: #ffc107; color: #8b4513; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 15px; transition: all 0.3s; box-shadow: 0 2px 6px rgba(255,193,7,0.3); border: none; cursor: pointer;"
                                           onmouseover="this.style.background='#ffb300'; this.style.boxShadow='0 4px 8px rgba(255,193,7,0.4)'; this.style.transform='translateY(-2px)';"
                                           onmouseout="this.style.background='#ffc107'; this.style.boxShadow='0 2px 6px rgba(255,193,7,0.3)'; this.style.transform='translateY(0)';">
                                            <i class="fas fa-truck" style="margin-right: 6px;"></i>${t('trackPackage')}
                                        </a>
                                        <p style="margin-top: 10px; color: #666; font-size: 12px;">
                                            <i class="fas fa-info-circle"></i> ${t('trackingNumberInfo')}
                                        </p>
                                    ` : `
                                        <div style="padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; text-align: center; color: #856404;">
                                            <i class="fas fa-info-circle" style="margin-right: 5px;"></i>${t('noTrackingInfo')}
                                        </div>
                                    `}
                                </div>
                            `}
                        </div>

                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="margin-top: 0; margin-bottom: 15px; color: var(--primary);">
                                <i class="fas fa-user" style="margin-right: 8px;"></i>${t('customerInfo')}
                            </h4>
                            ${renderOrderContactInfo(order)}
                        </div>
                        
                        ${(() => {
                            // æ£€æŸ¥è®¢å•çŠ¶æ€æ˜¯å¦ä¸ºpendingæˆ–review
                            const orderStatus = String(order.status || '').toLowerCase();
                            const isPending = orderStatus === 'pending' || orderStatus === 'review';
                            
                            if (isPending && currentUser && !currentUser.role) {
                                // è·å–äº§å“ä¿¡æ¯ä»¥æ£€æŸ¥æ˜¯å¦æœ‰redirectUrl
                                const relatedProduct = Array.isArray(products) ? products.find(p => normalizeOrderId(p.id) === normalizeOrderId(order.productId)) : null;
                                
                                // è·å–Get it nowæŒ‰é’®é¢œè‰²
                                const buttonColor = (homepageSettings && homepageSettings.getItNowButtonColor) || '#667eea';
                                
                                // å°†åå…­è¿›åˆ¶é¢œè‰²è½¬æ¢ä¸ºRGBç”¨äºé˜´å½±æ•ˆæœ
                                const hexToRgb = (hex) => {
                                    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                                    return result ? {
                                        r: parseInt(result[1], 16),
                                        g: parseInt(result[2], 16),
                                        b: parseInt(result[3], 16)
                                    } : { r: 102, g: 126, b: 234 };
                                };
                                const rgb = hexToRgb(buttonColor);
                                const shadowColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.4)`;
                                const shadowColorHover = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.5)`;
                                
                                return `
                                    <div style="margin-top: 20px; text-align: center;">
                                        <button class="btn btn-success" onclick="showWhatsAppModal('${normalizeOrderId(order.id)}'); this.closest('.modal').remove();" 
                                                style="padding: 12px 30px; font-size: 16px; background: ${buttonColor}; border: none; font-weight: 600; box-shadow: 0 4px 15px ${shadowColor}; transition: all 0.3s; color: white;"
                                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px ${shadowColorHover}';"
                                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px ${shadowColor}';">
                                            <i class="fab fa-whatsapp" style="margin-right: 8px;"></i>Get it now
                                        </button>
                                    </div>
                                `;
                            }
                            return '';
                        })()}
                        
                        ${order.status === 'completed' && currentUser && !currentUser.role && !(order.hasReview === true) ? `
                            <div style="margin-top: 20px; text-align: center;">
                                <button class="btn btn-primary" onclick="openReviewModal(${order.id})" style="padding: 12px 30px; font-size: 16px;">
                                    <i class="fas fa-star" style="margin-right: 8px;"></i>${t('writeReview')}
                                </button>
                            </div>
                        ` : ''}

                        ${(currentUser && currentUser.role === 'admin' && order.hasReview) ? `
                            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-secondary" onclick="replyToReview('${normalizeOrderId(order.id)}')">${t('replyReview') || 'å›å¤è¯„ä»·'}</button>
                                <button class="btn btn-danger" onclick="deleteReview('${normalizeOrderId(order.id)}')">${t('deleteReview') || 'åˆ é™¤è¯„ä»·'}</button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // ä¿å­˜å¿«é€’å•å·ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        async function saveTrackingNumber(orderId) {
            const input = document.getElementById('tracking-number-input');
            if (!input) return;

            const trackingNumber = input.value.trim();
            const order = findOrderById(orderId);
            
            if (!order) {
                console.error('æœªæ‰¾åˆ°è®¢å•ï¼Œè®¢å•ID:', orderId);
                showNotification('æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                return;
            }
            
            const normalizedId = normalizeOrderId(orderId);
            const isInAllOrders = allOrders.some(o => normalizeOrderId(o.id) === normalizedId);
            const isInUserOrders = userOrders.some(o => normalizeOrderId(o.id) === normalizedId);

            // æ›´æ–°è®¢å•çš„å¿«é€’å•å·
            order.trackingNumber = trackingNumber;
            order.updatedAt = Date.now();
            
            // å¦‚æœè®¢å•åœ¨allOrdersä¸­ï¼Œä¹Ÿéœ€è¦æ›´æ–°
            if (isInAllOrders) {
                const allOrder = allOrders.find(o => o.id === orderId);
                if (allOrder) {
                    allOrder.trackingNumber = trackingNumber;
                    allOrder.updatedAt = Date.now();
                    localStorage.setItem('allOrders', JSON.stringify(allOrders));
                }
            }
            
            // å¦‚æœè®¢å•åœ¨userOrdersä¸­ï¼Œä¿å­˜å¹¶åŒæ­¥
            if (isInUserOrders) {
                saveUserOrders(); // è¿™ä¼šè§¦å‘äº‘ç«¯åŒæ­¥
            } else if (isInAllOrders && currentUser && currentUser.role === 'admin' && order.account) {
                if (cloudSync && cloudSync.isInitialized) {
                    try {
                        const userOrdersRef = getCloudOrdersRefForOrder(order);
                        if (userOrdersRef) {
                            const snapshot = await userOrdersRef.once('value');
                            const userOrders = snapshot.val() || [];
                            const orderIndex = userOrders.findIndex(o => normalizeOrderId(o.id) === normalizedId);
                            if (orderIndex !== -1) {
                                userOrders[orderIndex].trackingNumber = trackingNumber;
                                userOrders[orderIndex].updatedAt = Date.now();
                                await userOrdersRef.set(userOrders);
                                console.log('âœ… å·²æ›´æ–°å…¶ä»–ç”¨æˆ·çš„è®¢å•å¿«é€’å•å·');
                            }
                        }
                    } catch (err) {
                        console.error('æ›´æ–°å…¶ä»–ç”¨æˆ·è®¢å•å¤±è´¥:', err);
                    }
                }
            }
            
            // æ›´æ–°æ˜¾ç¤º
            const displayElement = document.querySelector(`.tracking-number-display[data-order-id="${orderId}"]`);
            if (displayElement) {
                displayElement.textContent = trackingNumber || t('notFilled');
            }

            showNotification(t('trackingNumberSaved'), 'success');
            
            // å¦‚æœæ˜¯åœ¨è¯¦æƒ…æ¨¡æ€æ¡†ä¸­ï¼Œæ›´æ–°æ˜¾ç¤º
            const modalInput = document.getElementById('tracking-number-input');
            if (modalInput) {
                modalInput.value = trackingNumber;
            }
            
            // åˆ·æ–°è®¢å•è¡¨æ ¼ï¼ˆå¦‚æœæ˜¯åå°ç®¡ç†ï¼‰
            const adminOrders = document.getElementById('admin-orders');
            if (adminOrders && adminOrders.classList.contains('active')) {
                renderOrdersTable();
            }

            if (cloudSync && cloudSync.isInitialized && currentUser && currentUser.role === 'admin') {
                cloudSync.loadAllOrders().catch(err => console.warn('åˆ·æ–°æ‰€æœ‰è®¢å•å¤±è´¥', err));
            }
        }

        // ç¼–è¾‘å¿«é€’å•å·ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        async function editTrackingNumber(orderId) {
            const order = findOrderById(orderId);
            
            if (!order) {
                console.error('æœªæ‰¾åˆ°è®¢å•ï¼Œè®¢å•ID:', orderId);
                showNotification('æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                return;
            }

            const newTrackingNumber = prompt(t('enterTrackingNumber'), order.trackingNumber || '');
            if (newTrackingNumber === null) return;

            const trackingNumber = newTrackingNumber.trim();
            order.trackingNumber = trackingNumber;
            order.updatedAt = Date.now();
            
            const normalizedId = normalizeOrderId(orderId);
            const isInAllOrders = allOrders.some(o => normalizeOrderId(o.id) === normalizedId);
            const isInUserOrders = userOrders.some(o => normalizeOrderId(o.id) === normalizedId);
            
            if (isInAllOrders) {
                const allOrder = allOrders.find(o => o.id === orderId);
                if (allOrder) {
                    allOrder.trackingNumber = trackingNumber;
                    allOrder.updatedAt = Date.now();
                    localStorage.setItem('allOrders', JSON.stringify(allOrders));
                }
            }
            
            // å¦‚æœè®¢å•åœ¨userOrdersä¸­ï¼Œä¿å­˜å¹¶åŒæ­¥
            if (isInUserOrders) {
                saveUserOrders(); // è¿™ä¼šè§¦å‘äº‘ç«¯åŒæ­¥
            } else if (isInAllOrders && currentUser && currentUser.role === 'admin' && order.account) {
                if (cloudSync && cloudSync.isInitialized) {
                    try {
                        const userOrdersRef = getCloudOrdersRefForOrder(order);
                        if (userOrdersRef) {
                            const snapshot = await userOrdersRef.once('value');
                            const userOrders = snapshot.val() || [];
                            const orderIndex = userOrders.findIndex(o => normalizeOrderId(o.id) === normalizedId);
                            if (orderIndex !== -1) {
                                userOrders[orderIndex].trackingNumber = trackingNumber;
                                userOrders[orderIndex].updatedAt = Date.now();
                                await userOrdersRef.set(userOrders);
                                console.log('âœ… å·²æ›´æ–°å…¶ä»–ç”¨æˆ·çš„è®¢å•å¿«é€’å•å·');
                            }
                        }
                    } catch (err) {
                        console.error('æ›´æ–°å…¶ä»–ç”¨æˆ·è®¢å•å¤±è´¥:', err);
                    }
                }
            }
            
            renderOrdersTable();
            showNotification(t('trackingNumberUpdated'), 'success');

            if (cloudSync && cloudSync.isInitialized && currentUser && currentUser.role === 'admin') {
                cloudSync.loadAllOrders().catch(err => console.warn('åˆ·æ–°æ‰€æœ‰è®¢å•å¤±è´¥', err));
            }
        }

        // æ‰“å¼€è®¢å•çŠ¶æ€æ›´æ–°æ¨¡æ€æ¡†ï¼ˆä½¿ç”¨æŒ‰é’®é€‰æ‹©ï¼‰
        function openOrderStatusModal(orderId) {
            const order = findOrderById(orderId);
            
            if (!order) {
                console.error('æœªæ‰¾åˆ°è®¢å•ï¼Œè®¢å•ID:', orderId);
                console.log('userOrdersæ•°é‡:', userOrders.length);
                console.log('allOrdersæ•°é‡:', allOrders.length);
                showNotification(t('orderNotFound') || 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                return;
            }

            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>${t('updateOrderStatus')}</h3>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">${t('orderInfo')}</h4>
                            <p style="margin: 5px 0;"><strong>${t('orderId')}ï¼š</strong>${order.id}</p>
                            <p style="margin: 5px 0;"><strong>${t('product') || 'äº§å“'}ï¼š</strong>${order.productName}</p>
                            <p style="margin: 5px 0;"><strong>${t('customer') || 'å®¢æˆ·'}ï¼š</strong>${order.customerInfo.name}</p>
                            <p style="margin: 5px 0;"><strong>${t('currentStatus')}ï¼š</strong><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></p>
                        </div>
                        
                        <h4 style="margin-bottom: 15px;">${t('selectNewStatus')}</h4>
                        <div class="status-buttons" style="display: grid; gap: 10px;">
                            <button class="status-select-btn" data-status="review" style="padding: 15px; border: 2px solid #3498db; background: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; color: #3498db; transition: all 0.3s; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-hourglass-half" style="font-size: 20px;"></i>
                                <span>${t('orderReview')}</span>
                            </button>
                            <button class="status-select-btn" data-status="shipping" style="padding: 15px; border: 2px solid #9b59b6; background: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; color: #9b59b6; transition: all 0.3s; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-truck" style="font-size: 20px;"></i>
                                <span>${t('orderShipping')}</span>
                            </button>
                            <button class="status-select-btn" data-status="cancelled" style="padding: 15px; border: 2px solid #95a5a6; background: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; color: #95a5a6; transition: all 0.3s; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-ban" style="font-size: 20px;"></i>
                                <span>${t('orderCancelled')}</span>
                            </button>
                            <button class="status-select-btn" data-status="completed" style="padding: 15px; border: 2px solid #2ecc71; background: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; color: #2ecc71; transition: all 0.3s; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-check-circle" style="font-size: 20px;"></i>
                                <span>${t('orderCompleted')}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ä¸ºçŠ¶æ€æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            modal.querySelectorAll('.status-select-btn').forEach(btn => {
                // æ›´æ–°æŒ‰é’®æ–‡æœ¬ä¸ºå›½é™…åŒ–æ–‡æœ¬
                const status = btn.getAttribute('data-status');
                const span = btn.querySelector('span');
                if (span) {
                    if (status === 'review') span.textContent = t('orderReview');
                    else if (status === 'shipping') span.textContent = t('orderShipping');
                    else if (status === 'rejected') span.textContent = t('orderRejected');
                    else if (status === 'cancelled') span.textContent = t('orderCancelled');
                    else if (status === 'completed') span.textContent = t('orderCompleted');
                }
                
                // é«˜äº®å½“å‰çŠ¶æ€
                if (btn.getAttribute('data-status') === order.status) {
                    const color = btn.style.color;
                    btn.style.background = color;
                    btn.style.color = 'white';
                }

                // æ·»åŠ æ‚¬åœæ•ˆæœ
                btn.addEventListener('mouseenter', function () {
                    if (this.getAttribute('data-status') !== order.status) {
                        const color = this.style.color;
                        this.style.background = color;
                        this.style.color = 'white';
                    }
                });

                btn.addEventListener('mouseleave', function () {
                    if (this.getAttribute('data-status') !== order.status) {
                        this.style.background = 'white';
                        const borderColor = this.style.borderColor;
                        this.style.color = borderColor;
                    }
                });

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                btn.addEventListener('click', async function () {
                    const newStatus = this.getAttribute('data-status');
                    const statusText = this.querySelector('span').textContent;

                    if (confirm(`${t('confirmStatusUpdate')}"${statusText}"${t('confirmStatusUpdateSuffix')}`)) {
                        // æ˜¾ç¤ºæ›´æ–°ä¸­æç¤º
                        showNotification(t('updatingOrderStatus'), 'info');
                        
                        try {
                            let handledByCloud = false;

                            // ä¼˜å…ˆä½¿ç”¨â€œäº‘ç«¯ä¸ºå”¯ä¸€çœŸæºâ€çš„ç®¡ç†å‘˜ä¸“ç”¨æ›´æ–°é€»è¾‘
                            if (cloudSync && cloudSync.isInitialized && currentUser && currentUser.role === 'admin') {
                                handledByCloud = await adminUpdateOrderStatusOnCloud(order, newStatus, statusText);
                            }

                            if (handledByCloud) {
                                // äº‘ç«¯æ›´æ–°æˆåŠŸï¼šæœ¬åœ°åˆ—è¡¨ä¾èµ– loadAllOrders å’Œå®æ—¶ç›‘å¬åˆ·æ–°
                                showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"ï¼Œå·²åŒæ­¥åˆ°äº‘ç«¯ï¼`, 'success');
                                
                                // ç«‹å³åˆ·æ–°åå°è¡¨æ ¼ï¼ˆä½¿ç”¨æœ€æ–°çš„ allOrdersï¼‰
                                if (typeof renderOrdersTable === 'function') {
                                    renderOrdersTable();
                                }
                                if (typeof renderUserOrders === 'function') {
                                    renderUserOrders();
                                }

                                modal.remove();
                                return;
                            }

                            // ===== äº‘ç«¯ä¸å¯ç”¨æˆ–è®¢å•æ‰¾ä¸åˆ°æ—¶ï¼Œå›é€€ä¸ºåŸæœ‰çš„æœ¬åœ° + äº‘ç«¯æ··åˆæ›´æ–°é€»è¾‘ =====

                            // ä½¿ç”¨è§„èŒƒåŒ–IDï¼Œé¿å…å­—ç¬¦ä¸²/æ•°å­—ä¸ä¸€è‡´å¯¼è‡´æ‰¾ä¸åˆ°è®¢å•
                            const targetId = normalizeOrderId(order.id);
                            // è®°å½•è¯¥è®¢å•æ˜¯å¦å­˜åœ¨äºå…¨å±€å’Œç”¨æˆ·è®¢å•æ•°ç»„ä¸­ï¼Œé¿å… isInAllOrders æœªå®šä¹‰å¯¼è‡´æŠ¥é”™
                            const isInAllOrders = Array.isArray(allOrders) && allOrders.some(o => o && normalizeOrderId(o.id) === targetId);
                            const isInUserOrders = Array.isArray(userOrders) && userOrders.some(o => o && normalizeOrderId(o.id) === targetId);

                            // æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆæœ¬åœ°å¯¹è±¡æœ¬èº«ï¼‰
                            order.status = newStatus;
                            order.updatedAt = Date.now();
                            
                            // å¦‚æœè®¢å•åœ¨allOrdersä¸­ï¼Œä¹Ÿéœ€è¦æ›´æ–°
                            const allOrder = allOrders.find(o => normalizeOrderId(o.id) === targetId);
                            if (allOrder) {
                                allOrder.status = newStatus;
                                allOrder.updatedAt = Date.now();
                                localStorage.setItem('allOrders', JSON.stringify(allOrders));
                            }
                            
                            // å¦‚æœè®¢å•åœ¨userOrdersä¸­ï¼Œä¿å­˜å¹¶åŒæ­¥
                            const userOrder = userOrders.find(o => normalizeOrderId(o.id) === targetId);
                            if (userOrder) {
                                // å…ˆæ›´æ–°æœ¬åœ°
                                userOrder.status = newStatus;
                                userOrder.updatedAt = Date.now();
                                // ç«‹å³ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                                if (currentUser && currentUser.account) {
                                    const userOrdersKey = `userOrders_${currentUser.account}`;
                                    localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                                }
                                localStorage.setItem('userOrders', JSON.stringify(userOrders));
                                
                                // ç«‹å³åŒæ­¥åˆ°äº‘ç«¯
                                if (cloudSync && cloudSync.isInitialized) {
                                    try {
                                        cloudSync._syncState.inProgress = true;
                                        await cloudSync.syncOrders();
                                        console.log('âœ… è®¢å•çŠ¶æ€å·²åŒæ­¥åˆ°äº‘ç«¯ï¼ˆå›é€€é€»è¾‘ï¼‰');
                                        showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"ï¼Œå·²åŒæ­¥åˆ°äº‘ç«¯ï¼`, 'success');
                                    } catch (err) {
                                        console.error('äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                                        showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`, 'warning');
                                    } finally {
                                        setTimeout(() => {
                                            cloudSync._syncState.inProgress = false;
                                        }, 2000);
                                    }
                                } else {
                                    showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"`, 'success');
                                }
                            } else if (isInAllOrders && currentUser && currentUser.role === 'admin' && order.account) {
                                // å¦‚æœè®¢å•ä¸åœ¨userOrdersä¸­ä½†åœ¨allOrdersä¸­ï¼Œéœ€è¦åŒæ­¥åˆ°å¯¹åº”ç”¨æˆ·çš„äº‘ç«¯æ•°æ®
                                if (cloudSync && cloudSync.isInitialized) {
                                    try {
                                        const userOrdersRef = getCloudOrdersRefForOrder(order);
                                        if (!userOrdersRef) {
                                            console.warn('æœªèƒ½è·å–è®¢å•æ‰€å±ç”¨æˆ·çš„äº‘ç«¯è·¯å¾„');
                                            return;
                                        }
                                        const snapshot = await userOrdersRef.once('value');
                                        const cloudUserOrders = snapshot.val() || [];
                                        
                                        // æ›´æ–°è¯¥ç”¨æˆ·çš„è®¢å•
                                        const orderIndex = cloudUserOrders.findIndex(o => o.id === order.id);
                                        if (orderIndex !== -1) {
                                            // ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ï¼Œç¡®ä¿æ¯”ä»»ä½•æœ¬åœ°æ•°æ®éƒ½æ–°
                                            // æ·»åŠ 1æ¯«ç§’ç¡®ä¿æ—¶é—´æˆ³å”¯ä¸€ä¸”æ¯”å½“å‰æ—¶é—´æ–°
                                            const updateTimestamp = Date.now() + 1;
                                            cloudUserOrders[orderIndex].status = newStatus;
                                            cloudUserOrders[orderIndex].updatedAt = updateTimestamp;
                                            
                                            // ç¡®ä¿ä¿ç•™è®¢å•çš„åŸå§‹åˆ›å»ºæ—¶é—´å’Œå…¶ä»–é‡è¦å­—æ®µ
                                            if (!cloudUserOrders[orderIndex].date && order.date) {
                                                cloudUserOrders[orderIndex].date = order.date;
                                            }
                                            // ä¿ç•™å…¶ä»–å­—æ®µ
                                            if (order.productId) cloudUserOrders[orderIndex].productId = order.productId;
                                            if (order.productName) cloudUserOrders[orderIndex].productName = order.productName;
                                            if (order.price !== undefined) cloudUserOrders[orderIndex].price = order.price;
                                            if (order.image) cloudUserOrders[orderIndex].image = order.image;
                                            if (order.customerInfo) cloudUserOrders[orderIndex].customerInfo = order.customerInfo;
                                            if (order.account) cloudUserOrders[orderIndex].account = order.account;
                                            
                                            // ä½¿ç”¨ set æ–¹æ³•æ›´æ–°ï¼Œè¿™ä¼šè§¦å‘æ‰€æœ‰å®¢æˆ·ç«¯çš„å®æ—¶ç›‘å¬å™¨
                                            await userOrdersRef.set(cloudUserOrders);
                                            console.log('âœ… å·²æ›´æ–°å…¶ä»–ç”¨æˆ·çš„è®¢å•çŠ¶æ€åˆ°äº‘ç«¯ï¼ˆå›é€€é€»è¾‘ï¼‰');
                                            console.log('   è®¢å•ID:', order.id);
                                            console.log('   æ–°çŠ¶æ€:', newStatus);
                                            console.log('   æ›´æ–°æ—¶é—´æˆ³:', updateTimestamp);
                                            console.log('ğŸ“¤ å·²è§¦å‘å®æ—¶åŒæ­¥ï¼Œå®¢æˆ·ç«¯å°†è‡ªåŠ¨æ›´æ–°');
                                            
                                            showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"ï¼Œå·²åŒæ­¥åˆ°å®¢æˆ·è´¦æˆ·ï¼å®¢æˆ·ç«¯å°†è‡ªåŠ¨åˆ·æ–°ã€‚`, 'success');
                                            
                                            // é¢å¤–è§¦å‘ä¸€æ¬¡æ›´æ–°ï¼Œç¡®ä¿å®¢æˆ·ç«¯æ”¶åˆ°ï¼ˆä½¿ç”¨ç¨å¾®ä¸åŒçš„æ—¶é—´æˆ³ï¼‰
                                            setTimeout(async () => {
                                                try {
                                                    cloudUserOrders[orderIndex].updatedAt = Date.now() + 2;
                                                    await userOrdersRef.set(cloudUserOrders);
                                                    console.log('âœ… äºŒæ¬¡åŒæ­¥è§¦å‘æˆåŠŸï¼Œç¡®ä¿å®¢æˆ·ç«¯æ”¶åˆ°æ›´æ–°');
                                                } catch (err) {
                                                    console.warn('äºŒæ¬¡åŒæ­¥è§¦å‘å¤±è´¥ï¼ˆå¯å¿½ç•¥ï¼‰:', err);
                                                }
                                            }, 300);
                                        } else {
                                            showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"ï¼Œä½†æœªåœ¨å®¢æˆ·è´¦æˆ·ä¸­æ‰¾åˆ°è¯¥è®¢å•`, 'warning');
                                        }
                                    } catch (err) {
                                        console.error('æ›´æ–°å…¶ä»–ç”¨æˆ·è®¢å•çŠ¶æ€å¤±è´¥:', err);
                                        showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"ï¼Œä½†åŒæ­¥åˆ°å®¢æˆ·è´¦æˆ·å¤±è´¥`, 'error');
                                    }
                                } else {
                                    showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"`, 'success');
                                }
                            } else {
                                showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"${statusText}"`, 'success');
                            }
                            
                            // ç«‹å³åˆ·æ–°æ˜¾ç¤º
                            renderOrdersTable();
                            renderUserOrders(); // åŒæ—¶æ›´æ–°ç”¨æˆ·ä¸­å¿ƒçš„è®¢å•åˆ—è¡¨
                            
                            modal.remove();

                            if (cloudSync && cloudSync.isInitialized && currentUser && currentUser.role === 'admin') {
                                cloudSync.loadAllOrders().catch(err => console.warn('åˆ·æ–°æ‰€æœ‰è®¢å•å¤±è´¥', err));
                            }
                        } catch (error) {
                            console.error('æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥:', error);
                            showNotification('æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                        }
                    }
                });
            });
        }

        // æ‰“å¼€è¯„ä»·æ¨¡æ€æ¡†
        function openReviewModal(orderId) {
            // æŸ¥æ‰¾è®¢å•
            const order = userOrders.find(o => o.id === orderId);
            if (!order) {
                showNotification(t('orderNotFound'), 'error');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²ç»è¯„ä»·è¿‡
            if (order.hasReview) {
                showNotification(t('reviewExists'), 'info');
                return;
            }
            
            // å°†å½“å‰è®¢å•ä¿å­˜åœ¨å±€éƒ¨å˜é‡ï¼Œé¿å…é—­åŒ…å†…å‡ºç° name shadowing æˆ–å…¨å±€æœªå®šä¹‰çš„é—®é¢˜
            const modalOrder = order;

            // åˆ›å»ºè¯„ä»·æ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'review-modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 480px; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <div class="modal-header" style="background: linear-gradient(135deg,#7a64f1,#6a56d8); color:#fff; padding:16px; display:flex; justify-content:space-between; align-items:center; font-weight:600; font-size:18px;">
                        <span>${t('writeReview')}</span>
                        <button class="close-modal" style="cursor:pointer; font-size:24px; line-height:1; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:50%; background:transparent; border:0;">&times;</button>
                    </div>

                    <div class="modal-body" style="padding:20px; max-height:70vh; overflow-y:auto;">
                        <div class="product" style="display:flex; gap:16px; margin-bottom:20px; padding-bottom:12px; border-bottom:1px solid #f0f0f0; align-items:flex-start;">
                            <img src="${order.image || ''}" alt="${order.productName}" style="width:80px; height:80px; object-fit:cover; border-radius:8px; border:1px solid #eee; flex-shrink:0;">
                            <div style="flex:1;">
                                <div style="font-size:15px; line-height:1.4; color:#333; margin-bottom:8px; font-weight:500; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; word-break:break-word;">
                                    ${order.productName}
                                </div>
                                <div style="font-size:16px; font-weight:600;">
                                    <del style="color:#999; font-weight:normal; margin-right:8px;">${formatCurrency(order.originalPrice ?? order.price)}</del>
                                    <span style="color:#ff4d4f;">${formatCurrency(order.promoPrice ?? 0)}</span>
                                </div>
                            </div>
                        </div>

                        <div class="section" style="margin-bottom:20px;">
                            <div style="font-size:16px; margin-bottom:12px; font-weight:600; color:#333; display:flex; align-items:center;">${t('rating')}ï¼š <span style="color:#ff4d4f; margin-left:6px;">*</span></div>
                            <div class="stars" id="review-stars" style="display:flex; gap:12px; font-size:36px; color:#ddd; cursor:pointer; justify-content:center; padding:10px 0; margin-bottom:5px;">
                                <div class="star" data-value="1" style="transition:all 0.2s; width:44px; height:44px; display:flex; align-items:center; justify-content:center;">â˜†</div>
                                <div class="star" data-value="2" style="transition:all 0.2s; width:44px; height:44px; display:flex; align-items:center; justify-content:center;">â˜†</div>
                                <div class="star" data-value="3" style="transition:all 0.2s; width:44px; height:44px; display:flex; align-items:center; justify-content:center;">â˜†</div>
                                <div class="star" data-value="4" style="transition:all 0.2s; width:44px; height:44px; display:flex; align-items:center; justify-content:center;">â˜†</div>
                                <div class="star" data-value="5" style="transition:all 0.2s; width:44px; height:44px; display:flex; align-items:center; justify-content:center;">â˜†</div>
                            </div>
                            <div class="error-message" id="ratingError" style="color:#ff4d4f; font-size:14px; margin-top:6px; display:none; align-items:center;">âš  ${t('ratingRequired') || 'è¯·é€‰æ‹©è¯„åˆ†'}</div>
                        </div>

                        <div class="honey-reward" style="background: linear-gradient(135deg,#FFF9E6,#FFE680); border:1px solid #FFD700; border-radius:8px; padding:12px; margin:12px 0; text-align:center; font-weight:600; color:#8B4513;">
                            <span style="font-size:18px; margin-right:8px;">ğŸ¯</span> Leave a review to get 2 HONEY! ğŸ‰<br>
                            <small style="display:block; font-size:13px; color:#8B4513; font-weight:500; margin-top:6px;">Redeem 1 HONEY for 1 product.</small>
                        </div>

                        <div class="amazon-btn-container" id="amazonBtnContainer" style="margin:12px 0; display:none; animation:fadeInUp 0.28s ease;">
                            <a id="amazonBtn" class="amazon-btn" href="${order.amazonReviewUrl || ''}" aria-label="${t('writeOnAmazon') || 'Write a review on Amazon'}" target="_blank" rel="noopener noreferrer" style="display:flex; align-items:center; justify-content:center; width:100%; margin-top:6px; padding:14px 16px; background: linear-gradient(to bottom, #f7dfa5, #f0c14b); color:#111; border:1px solid #a88734; font-weight:700; text-decoration:none; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.10); font-size:15px;">
                                <span class="amazon-logo" aria-hidden="true" style="display:inline-block; width:22px; height:22px; margin-right:12px; background-image:url('https://pngpai.com/pai_img/sml/33c17401-2e91-435a-ab3e-b51531336586.png'); background-size:contain; background-repeat:no-repeat; flex-shrink:0;"></span>
                                ${t('write a review On Amazon') || 'Write a review on Amazon'}
                            </a>
                        </div>

                        <div class="form-group" style="margin-bottom:20px;">
                            <label style="display:block; font-size:16px; margin-bottom:10px; font-weight:600; color:#333;">${t('reviewTitle') || 'Review title'}: <span style="color:#ff4d4f">*</span></label>
                            <input type="text" id="reviewTitle" placeholder="${t('Please enter your review title...') || 'Please enter your review title...'}" style="width:100%; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:15px; background:#f9f9f9;">
                            <div class="error-message" id="titleError" style="color:#ff4d4f; font-size:14px; margin-top:6px; display:none;">âš  ${t('titleRequired') || 'Please enter a review title'}</div>
                        </div>
                    </div>

                    <div class="modal-footer" style="display:flex; justify-content:space-between; gap:12px; padding:16px; border-top:1px solid #eee; background:#f9f9f9;">
                        <button class="btn btn-secondary" id="reviewCancelBtn" style="padding:12px 18px; border-radius:8px; background:#f0f0f0; color:#666;">${t('cancel')}</button>
                        <button class="btn btn-primary" id="reviewSubmitBtn" disabled style="padding:12px 18px; border-radius:8px; background:linear-gradient(to bottom,#6a56d8,#7a64f1); color:#fff;">${t('submitReview')}</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ç»‘å®šæ˜Ÿçº§è¯„åˆ†äº‹ä»¶ï¼ˆåŸºäºå‚è€ƒå®ç°ï¼‰
            const stars = modal.querySelectorAll('#review-stars .star');
            let selectedRating = 0;
            
            // Helper: å°†ä»»æ„ Amazon å•†å“é“¾æ¥è§„èŒƒåŒ–ä¸ºæ’°å†™è¯„è®ºé¡µé¢é“¾æ¥ï¼ˆä¼˜å…ˆä½¿ç”¨åŸåŸŸåï¼‰
            // æ”¯æŒçš„è¾“å…¥ä¾‹å­ï¼š
            // - https://www.amazon.com/dp/B0G4672X31
            // - https://www.amazon.com/gp/product/B0G4672X31
            // - https://www.amazon.com/product-reviews/B0G4672X31
            // - https://www.amazon.com/... ?asin=B0G4672X31
            function normalizeAmazonToCreateReview(rawUrl) {
                try {
                    if (!rawUrl) return '';
                    var urlStr = rawUrl.toString().trim();
                    if (!urlStr) return '';
                    // å¦‚æœå·²ç»æ˜¯ create-review é“¾æ¥ï¼Œç›´æ¥è¿”å›
                    if (/\/review\/create-review/i.test(urlStr)) return urlStr;

                    // ä½¿ç”¨æ­£åˆ™æå– ASINï¼ˆ10 ä½å­—æ¯æ•°å­—ï¼‰
                    var asinMatch = urlStr.match(/\/dp\/([A-Z0-9]{10})/i)
                        || urlStr.match(/\/gp\/product\/([A-Z0-9]{10})/i)
                        || urlStr.match(/\/product-reviews\/([A-Z0-9]{10})/i)
                        || urlStr.match(/[?&]asin=([A-Z0-9]{10})/i);

                    // è§£æåŸå§‹åŸŸåï¼Œå›é€€åˆ° www.amazon.com
                    var a = document.createElement('a');
                    a.href = urlStr;
                    var host = a.hostname || 'www.amazon.com';
                    var proto = a.protocol && a.protocol.indexOf('http') === 0 ? a.protocol : 'https:';

                    if (asinMatch && asinMatch[1]) {
                        var asin = asinMatch[1];
                        return proto + '//' + host + '/review/create-review?asin=' + asin;
                    }

                    // å›é€€ï¼šå¦‚æœæ— æ³•è§£æ ASINï¼Œåˆ™è¿”å›åŸå§‹é“¾æ¥ä»¥ä¿è¯ä¸é˜»æ–­ç”¨æˆ·
                    return urlStr;
                } catch (e) {
                    console.warn('normalizeAmazonToCreateReview error', e);
                    return rawUrl || '';
                }
            }

            function updateStarsDisplay(value) {
                stars.forEach((s, idx) => {
                    if (idx < value) {
                        s.classList.add('active');
                        s.style.color = '#ffc107';
                        s.textContent = 'â˜…';
                        s.style.transform = 'scale(1.05)';
                    } else {
                        s.classList.remove('active');
                        s.style.color = '#ddd';
                        s.textContent = 'â˜†';
                        s.style.transform = '';
                    }
                });
            }
            
            // ç®€å•çš„é”™è¯¯æ˜¾ç¤º/éšè—è¾…åŠ©å‡½æ•°ï¼ˆä»…ä½œç”¨äºå½“å‰æ¨¡æ€å†…çš„é”™è¯¯å…ƒç´ ï¼‰
            function showError(el) {
                if (!el) return;
                el.style.display = 'flex';
            }
            function hideError(el) {
                if (!el) return;
                el.style.display = 'none';
            }

            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    selectedRating = value;
                    try { console.log('DEBUG: review modal star click, value=', value); } catch(e){}
                    updateStarsDisplay(value);
                    hideError(modal.querySelector('#ratingError'));

                    // å¦‚æœäº”æ˜Ÿä¸”æœ‰äºšé©¬é€Šé“¾æ¥åˆ™æ˜¾ç¤ºäºšé©¬é€ŠæŒ‰é’®ï¼ˆå¹¶å°†é“¾æ¥è§„èŒƒåŒ–ä¸ºæ’°å†™è¯„è®ºé¡µé¢ï¼‰
                    try {
                        // è·å–è®¢å•/äº§å“å¯èƒ½å­˜åœ¨çš„è·³è½¬é“¾æ¥ï¼ˆä¼˜å…ˆçº§ï¼šorder.amazonReviewUrl -> order.redirectUrl -> äº§å“.redirectUrlï¼‰
                        function resolveAmazonCandidate() {
                            try {
                                // æ–°é€»è¾‘ï¼šä»…å½“äº§å“å¡«å†™äº†ä¸“ç”¨äºâ€œæ’°å†™äºšé©¬é€Šè¯„è®ºâ€çš„é“¾æ¥æ—¶ï¼Œæ‰è¿”å›è¯¥é“¾æ¥ã€‚
                                // ç›®çš„æ˜¯ç¡®ä¿â€œWrite a review on Amazonâ€æŒ‰é’®åªåœ¨äº§å“å±‚é…ç½®è¯¥é“¾æ¥æ—¶å±•ç¤ºã€‚
                                var candidate = '';
                                if (modalOrder && modalOrder.productId) {
                                    var prod = products.find(p => String(p.id) === String(modalOrder.productId));
                                    if (prod) {
                                        candidate = prod.amazonReviewUrl || '';
                                    }
                                }
                                // å¦‚æœæ‰¾ä¸åˆ°äº§å“æˆ–äº§å“æ²¡æœ‰è¯¥å­—æ®µï¼Œåˆ™ä¸æ˜¾ç¤ºæŒ‰é’®ï¼ˆè¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰
                                return (candidate || '').toString().trim();
                            } catch (e) {
                                return '';
                            }
                        }

                        var rawAmazonUrl = resolveAmazonCandidate();
                        try { console.log('DEBUG: rawAmazonUrl=', rawAmazonUrl); } catch(e){}
                        if (value === 5 && rawAmazonUrl) {
                            var reviewUrl = normalizeAmazonToCreateReview(rawAmazonUrl);
                            var amazonContainer = modal.querySelector('#amazonBtnContainer');
                            var amazonBtnEl = modal.querySelector('#amazonBtn');
                            if (amazonBtnEl) {
                                amazonBtnEl.href = reviewUrl;
                            }
                            if (amazonContainer) amazonContainer.style.display = 'block';
                        } else {
                            var amazonContainerHide = modal.querySelector('#amazonBtnContainer');
                            if (amazonContainerHide) amazonContainerHide.style.display = 'none';
                        }
                    } catch (err) {
                        console.warn('amazon button guard', err);
                        var amazonContainerErr = modal.querySelector('#amazonBtnContainer');
                        if (amazonContainerErr) amazonContainerErr.style.display = 'none';
                    }

                    // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
                    const titleFilled = modal.querySelector('#reviewTitle').value.trim().length > 0;
                    modal.querySelector('#reviewSubmitBtn').disabled = !(selectedRating > 0 && titleFilled);
                });

                // è§¦æ‘¸è®¾å¤‡åé¦ˆ
                if ('ontouchstart' in window) {
                    star.addEventListener('touchstart', function() {
                        if (!this.classList.contains('active')) {
                            this.style.transform = 'scale(1.05)';
                        }
                    });
                    star.addEventListener('touchend', function() {
                        this.style.transform = '';
                    });
                }
            });

            // æ ‡é¢˜è¾“å…¥ç›‘å¬ï¼Œæ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
            modal.querySelector('#reviewTitle').addEventListener('input', function() {
                hideError(modal.querySelector('#titleError'));
                const titleFilled = this.value.trim().length > 0;
                modal.querySelector('#reviewSubmitBtn').disabled = !(selectedRating > 0 && titleFilled);
            });

            // å…³é—­ä¸å–æ¶ˆ
            modal.querySelector('.close-modal').addEventListener('click', function() {
                modal.remove();
            });
            modal.querySelector('#reviewCancelBtn').addEventListener('click', function() {
                modal.remove();
            });
            
            // åˆå§‹åŒ–æ—¶æ ¹æ®å·²æœ‰è¯„åˆ†å†³å®šæ˜¯å¦æ˜¾ç¤º Amazon æŒ‰é’®ï¼ˆä¾‹å¦‚å½“æœåŠ¡ç«¯æ¸²æŸ“å·²è®¾ç½® 5 æ˜Ÿï¼‰
                (function initAmazonVisibility() {
                    try {
                        // åˆå§‹åŒ–æ—¶ä»…å½“å¯¹åº”äº§å“é…ç½®äº† amazonReviewUrl ä¸”å½“å‰ä¸º 5 æ˜Ÿæ—¶æ‰æ˜¾ç¤ºæŒ‰é’®
                        try {
                            var amazonContainerInit = modal.querySelector('#amazonBtnContainer');
                            var amazonBtnInit = modal.querySelector('#amazonBtn');
                            var current = Number(selectedRating) || 0;
                            if (!current) {
                                var activeStars = modal.querySelectorAll('#review-stars .star.active');
                                current = activeStars ? activeStars.length : 0;
                            }
                            var amazonUrlInitRaw = '';
                            if (modalOrder && modalOrder.productId) {
                                var prodInit = products.find(p => String(p.id) === String(modalOrder.productId));
                                if (prodInit && prodInit.amazonReviewUrl) {
                                    amazonUrlInitRaw = prodInit.amazonReviewUrl.toString().trim();
                                }
                            }
                            if (amazonUrlInitRaw && current === 5) {
                                var normalized = normalizeAmazonToCreateReview(amazonUrlInitRaw);
                                if (amazonBtnInit) amazonBtnInit.href = normalized;
                                if (amazonContainerInit) amazonContainerInit.style.display = '';
                            } else {
                                if (amazonContainerInit) amazonContainerInit.style.display = 'none';
                            }
                        } catch (err) {
                            if (modal.querySelector('#amazonBtnContainer')) modal.querySelector('#amazonBtnContainer').style.display = 'none';
                        }
                    } catch (err) {
                        // ä¸é˜»å¡ä¸»æµç¨‹
                        console.error('initAmazonVisibility error', err);
                    }
                })();
        }

        // æäº¤è¯„ä»·
        async function submitReview(orderId) {
            const order = userOrders.find(o => o.id === orderId);
            if (!order) {
                showNotification(t('orderNotFound'), 'error');
                return;
            }

            // è·å–è¯„åˆ†ï¼ˆå…¼å®¹æ–°æ¨¡æ€ç»“æ„ï¼šä½¿ç”¨ .star.activeï¼‰
            const rating = document.querySelectorAll('#review-modal .star.active').length;
            if (rating === 0) {
                showNotification(t('ratingRequired'), 'error');
                return;
            }

            // è·å–è¯„ä»·æ ‡é¢˜ï¼ˆå‚è€ƒæ–°æ¨¡æ€ï¼Œæ ‡é¢˜ä¸ºå¿…å¡«é¡¹ï¼‰
            const titleEl = document.getElementById('reviewTitle');
            const titleText = titleEl ? titleEl.value.trim() : '';
            if (!titleText) {
                showNotification(t('titleRequired') || 'Please enter a review title', 'error');
                return;
            }

            // ç¡®ä¿productIdå­˜åœ¨
            if (!order.productId) {
                console.error('è®¢å•ç¼ºå°‘productIdå­—æ®µ:', order);
                showNotification('è®¢å•ä¿¡æ¯ä¸å®Œæ•´ï¼Œæ— æ³•æäº¤è¯„ä»·', 'error');
                return;
            }

            // åˆ›å»ºè¯„ä»·å¯¹è±¡
            const review = {
                reviewId: 'review_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                productId: order.productId,
                orderId: orderId,
                userId: currentUser.account,
                userName: order.customerInfo.name,
                userPhone: order.customerInfo.phone ? order.customerInfo.phone.substring(0, 3) + '****' + order.customerInfo.phone.substring(7) : '',
                rating: rating,
                title: titleText,
                comment: '', // å…¼å®¹æ—§æ¥å£ï¼Œä¿ç•™ comment å­—æ®µä½†ç½®ç©º
                createdAt: Date.now(),
                productName: order.productName
            };

            // æ›´æ–°è®¢å•ï¼Œæ ‡è®°å·²è¯„ä»·
            order.hasReview = true;
            order.reviewId = review.reviewId;

            // ä¿å­˜è¯„ä»·åˆ°äº§å“ï¼ˆä½¿ç”¨è§„èŒƒåŒ– ID åŒ¹é…ï¼Œé¿å…å­—ç¬¦ä¸²/æ•°å­—ä¸ä¸€è‡´ï¼‰
            const product = products.find(p => normalizeOrderId(p.id) === normalizeOrderId(review.productId));
            if (product) {
                if (!product.reviews) {
                    product.reviews = [];
                }
                product.reviews.push(review);
                product.reviews.sort((a, b) => b.createdAt - a.createdAt); // æŒ‰æ—¶é—´å€’åº
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆäº§å“ä¸è®¢å•ï¼‰
            try {
                localStorage.setItem('products', JSON.stringify(products));
            } catch (e) {
                console.warn('ä¿å­˜äº§å“è¯„ä»·åˆ°æœ¬åœ°å¤±è´¥:', e);
            }
            saveUserOrders();

            // åŒæ­¥åˆ°äº‘ç«¯ï¼ˆä»…åŒæ­¥å½“å‰äº§å“è¯„ä»· + è®¢å•ï¼Œé¿å…æ™®é€šç”¨æˆ·è¦†ç›–å…¨éƒ¨äº§å“ï¼‰
            if (cloudSync && cloudSync.isInitialized) {
                try {
                    // åªåŒæ­¥å½“å‰äº§å“çš„ reviews åˆ°äº‘ç«¯ï¼ˆä½¿ç”¨è§„èŒƒåŒ– ID åŒ¹é…ï¼‰
                    const productIndex = products.findIndex(p => normalizeOrderId(p.id) === normalizeOrderId(review.productId));
                    if (productIndex !== -1 && cloudSync.db) {
                        const reviewsToSync = products[productIndex].reviews || [];
                        await cloudSync.db.ref(`products/${productIndex}/reviews`).set(reviewsToSync);
                        console.log('âœ… å½“å‰äº§å“è¯„ä»·å·²åŒæ­¥åˆ°äº‘ç«¯');
                    } else {
                        console.warn('æœªæ‰¾åˆ°å¯¹åº”äº§å“æˆ– cloudSync.db ä¸å¯ç”¨ï¼Œè·³è¿‡è¯„ä»·äº‘ç«¯åŒæ­¥:', review.productId);
                    }

                    // åŒæ­¥è®¢å•ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
                    await cloudSync.syncOrders();
                } catch (err) {
                    console.error('è¯„ä»·äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                }
            }

            // å…³é—­æ¨¡æ€æ¡†
            document.getElementById('review-modal').remove();

            // æ›´æ–°è®¢å•åˆ—è¡¨ä¸­çš„â€œå†™è¯„ä»·â€æŒ‰é’®ä¸ºæ„Ÿè°¢æç¤º
            try {
                const selector = `.order-item[data-order-id="${orderId}"]`;
                const orderItemEl = document.querySelector(selector);
                if (orderItemEl) {
                    const smallReviewBtn = orderItemEl.querySelector('button.btn.btn-primary.btn-sm');
                    if (smallReviewBtn) {
                        const badge = document.createElement('div');
                        badge.className = 'review-thankyou-badge';
                        badge.innerHTML = `<i class="fas fa-check-circle"></i>${t('reviewThankYou')}`;
                        smallReviewBtn.replaceWith(badge);
                    }
                }

                // è®¢å•è¯¦æƒ…å¼¹çª—ä¸­çš„å¤§æŒ‰é’®ä¹Ÿæ›¿æ¢ä¸ºæ„Ÿè°¢æç¤º
                const orderDetailsModal = document.getElementById('order-details-modal');
                if (orderDetailsModal) {
                    const bigReviewBtn = orderDetailsModal.querySelector('button.btn.btn-primary');
                    if (bigReviewBtn) {
                        const badge = document.createElement('div');
                        badge.className = 'review-thankyou-badge';
                        badge.style.marginTop = '10px';
                        badge.innerHTML = `<i class="fas fa-check-circle"></i>${t('reviewThankYou')}`;
                        bigReviewBtn.replaceWith(badge);
                    }
                }
            } catch (e) {
                console.warn('æ›´æ–°è¯„ä»·æŒ‰é’®å¤–è§‚æ—¶å‡ºé”™:', e);
            }

            // å¦‚æœå½“å‰åœ¨äº§å“è¯¦æƒ…é¡µï¼Œåˆ·æ–°è¯„ä»·åˆ—è¡¨ï¼ˆä½¿ç”¨è§„èŒƒåŒ– ID åˆ¤æ–­æ˜¯å¦åŒä¸€äº§å“ï¼‰
            const productDetail = document.getElementById('product-detail');
            if (
                productDetail &&
                productDetail.style.display !== 'none' &&
                currentProduct &&
                normalizeOrderId(currentProduct.id) === normalizeOrderId(review.productId)
            ) {
                showProductDetail(review.productId);
            }
            
            // å…³é—­è®¢å•è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆå¦‚æœæ‰“å¼€ï¼‰
            const orderDetailsModal = document.getElementById('order-details-modal');
            if (orderDetailsModal) {
                orderDetailsModal.remove();
            }

            // ğŸ è¯„ä»·å®Œæˆï¼Œå¥–åŠ± 2 ä¸ªèœœç½
            try {
                if (currentUser) {
                    const user = findUserByAccount(currentUser.account);
                    if (user) {
                        const oldPoints = (user.points == null || isNaN(user.points)) ? 1 : Number(user.points);
                        const newPoints = oldPoints + 2;
                        user.points = newPoints;
                        currentUser.points = newPoints;
                        saveAllUsers();
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));

                        // å³æ—¶æ›´æ–°ä¸ªäººä¸­å¿ƒèœœç½æ˜¾ç¤º
                        const badge = document.getElementById('user-points-badge');
                        const valueEl = document.getElementById('user-points-value');
                        if (badge && valueEl) {
                            badge.style.display = 'inline-flex';
                            valueEl.textContent = newPoints;
                        }

                        showNotification((t && t('reviewSubmitted')) || 'è¯„ä»·å·²æäº¤ï¼Œç§¯åˆ† +1', 'success');
                        showNotification((t && t('pointsReviewReward')) || 'ğŸ‰ è¯„ä»·å¥–åŠ±ï¼šç§¯åˆ† +1', 'success');
                        return;
                    }
                }
            } catch (err) {
                console.warn('æ›´æ–°è¯„ä»·ç§¯åˆ†æ—¶å‡ºé”™:', err);
            }

            showNotification(t('reviewSubmitted'), 'success');
        }

        // ä¿æŒåŸæœ‰çš„updateOrderStatuså‡½æ•°ä½œä¸ºå¤‡ç”¨ï¼ˆå·²å¼ƒç”¨ï¼‰
        function updateOrderStatus(orderId) {
            openOrderStatusModal(orderId);
        }

        function findReviewByOrder(order) {
            if (!order) return null;
            if (order.productId && order.reviewId) {
                const product = products.find(p => p.id === order.productId);
                if (product && Array.isArray(product.reviews)) {
                    const index = product.reviews.findIndex(r => r.reviewId === order.reviewId);
                    if (index > -1) {
                        return { product, index };
                    }
                }
            }
            return findReviewContextByOrderId(order.id);
        }

        async function replyToReview(orderId) {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('åªæœ‰ç®¡ç†å‘˜å¯ä»¥å›å¤è¯„ä»·', 'warning');
                return;
            }

            const order = findOrderById(orderId);
            if (!order) {
                console.warn('æœªæ‰¾åˆ°è®¢å•ï¼Œä½†å°è¯•ç›´æ¥å®šä½è¯„ä»·è®°å½•');
            }

            const found = order ? findReviewByOrder(order) : findReviewContextByOrderId(orderId);
            if (!found || found.index === -1) {
                showNotification(t('reviewNotFound'), 'error');
                return;
            }

            const { product, index } = found;
            const currentReply = product.reviews[index].adminReply || '';
            const reply = prompt(t('adminReply'), currentReply);
            if (reply === null) return;

            product.reviews[index].adminReply = reply.trim();
            localStorage.setItem('products', JSON.stringify(products));

            if (cloudSync && cloudSync.isInitialized) {
                try {
                    await cloudSync.syncProducts();
                } catch (error) {
                    console.error('åŒæ­¥ç®¡ç†å‘˜å›å¤å¤±è´¥:', error);
                }
            }

            const productDetail = document.getElementById('product-detail');
            if (productDetail && productDetail.style.display !== 'none' && currentProduct && currentProduct.id === product.id) {
                showProductDetail(product.id);
            }
            const detailsModal = document.getElementById('order-details-modal');
            if (detailsModal) {
                detailsModal.remove();
                showOrderDetailsModal(orderId);
            }

            showNotification('å›å¤å·²ä¿å­˜', 'success');
        }

        async function deleteReview(orderId) {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤è¯„ä»·', 'warning');
                return;
            }

            const order = findOrderById(orderId);
            if (!order) {
                console.warn('æœªæ‰¾åˆ°è®¢å•è®°å½•ï¼Œå°†ç›´æ¥å°è¯•åˆ é™¤è¯„ä»·');
            } else if (!order.hasReview) {
                showNotification('è¯¥è®¢å•æš‚æ— è¯„ä»·', 'info');
                return;
            }

            if (!confirm(t('confirmDeleteReview'))) {
                return;
            }

            const found = order ? findReviewByOrder(order) : findReviewContextByOrderId(orderId);
            if (found && found.index > -1) {
                const { product, index } = found;
                product.reviews.splice(index, 1);
                localStorage.setItem('products', JSON.stringify(products));
            } else {
                showNotification('æœªæ‰¾åˆ°å¯¹åº”è¯„ä»·ï¼Œæ— æ³•åˆ é™¤', 'error');
                return;
            }

            if (order) {
                order.hasReview = false;
                delete order.reviewId;
                saveUserOrders();
            }

            if (cloudSync && cloudSync.isInitialized) {
                try {
                    await cloudSync.syncProducts();
                    await cloudSync.syncOrders();
                } catch (error) {
                    console.error('åˆ é™¤è¯„ä»·ååŒæ­¥å¤±è´¥:', error);
                }
            }

            const productDetail = document.getElementById('product-detail');
            if (productDetail && productDetail.style.display !== 'none' && currentProduct && currentProduct.id === order.productId) {
                showProductDetail(order.productId);
            }

            const detailsModal = document.getElementById('order-details-modal');
            if (detailsModal) {
                detailsModal.remove();
                showOrderDetailsModal(orderId);
            }

            showNotification('è¯„ä»·å·²åˆ é™¤', 'success');
        }

        async function handleReviewReply(productId, reviewId, targetType = 'review', targetReplyId = null, targetUserName = '') {
            if (!currentUser) {
                showNotification('è¯·å…ˆç™»å½•åå†å›å¤è¯„ä»·', 'warning');
                return;
            }

            const product = products.find(p => normalizeOrderId(p.id) === normalizeOrderId(productId));
            if (!product || !Array.isArray(product.reviews)) {
                showNotification('æœªæ‰¾åˆ°è¯¥è¯„ä»·', 'error');
                return;
            }

            const review = product.reviews.find(r => r.reviewId === reviewId);
            if (!review) {
                showNotification('æœªæ‰¾åˆ°è¯¥è¯„ä»·', 'error');
                return;
            }

            // æ„é€ æç¤ºæ–‡æ¡ˆï¼šåŒºåˆ†å›å¤ä¸»è¯„ä»·è¿˜æ˜¯å›å¤æŸæ¡å°è¯„è®º
            const basePlaceholder = t('replyPlaceholder');
            const promptLabel = targetUserName
                ? `${basePlaceholder} (@${targetUserName})`
                : basePlaceholder;

            const replyContent = prompt(promptLabel);
            if (replyContent === null) return;

            const message = replyContent.trim();
            if (!message) {
                showNotification(t('replyContentCannotBeEmpty'), 'warning');
                return;
            }

            if (!Array.isArray(review.replies)) {
                review.replies = [];
            }

            review.replies.push({
                replyId: 'reply_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                account: currentUser.account,
                userName: currentUser.username || currentUser.account,
                message,
                createdAt: Date.now(),
                replyToType: targetType,
                replyToReplyId: targetReplyId,
                replyToUserName: targetUserName || (targetType === 'review' ? (review.userName || '') : '')
            });

            localStorage.setItem('products', JSON.stringify(products));

            // åŒæ­¥å½“å‰äº§å“çš„è¯„ä»·åˆ°äº‘ç«¯ï¼ˆåŒ…å«ç”¨æˆ·å›å¤ï¼‰
            if (cloudSync && cloudSync.isInitialized && cloudSync.db) {
                try {
                    const productIndex = products.findIndex(p => normalizeOrderId(p.id) === normalizeOrderId(product.id));
                    if (productIndex !== -1) {
                        const reviewsToSync = products[productIndex].reviews || [];
                        await cloudSync.db.ref(`products/${productIndex}/reviews`).set(reviewsToSync);
                        console.log('âœ… è¯„ä»·å›å¤å·²åŒæ­¥åˆ°äº‘ç«¯');
                    } else {
                        console.warn('æœªæ‰¾åˆ°å¯¹åº”äº§å“ï¼Œæ— æ³•åŒæ­¥è¯„ä»·å›å¤åˆ°äº‘ç«¯:', product.id);
                    }
                } catch (error) {
                    console.error('åŒæ­¥å›å¤å¤±è´¥:', error);
                }
            }

            showProductDetail(product.id);
            showNotification(t('replySuccess') || 'å›å¤å·²æäº¤', 'success');
        }

        // ç®¡ç†å‘˜åˆ é™¤å•æ¡ç”¨æˆ·å›å¤ï¼ˆå°è¯„è®ºï¼‰
        async function deleteReviewReply(productId, reviewId, replyId) {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ç”¨æˆ·å›å¤', 'warning');
                return;
            }

            const product = products.find(p => normalizeOrderId(p.id) === normalizeOrderId(productId));
            if (!product || !Array.isArray(product.reviews)) {
                showNotification('æœªæ‰¾åˆ°å¯¹åº”äº§å“æˆ–è¯„ä»·', 'error');
                return;
            }

            const review = product.reviews.find(r => r.reviewId === reviewId);
            if (!review || !Array.isArray(review.replies)) {
                showNotification('æœªæ‰¾åˆ°å¯¹åº”å›å¤', 'error');
                return;
            }

            if (!confirm(t('confirmDeleteReview') || 'ç¡®å®šè¦åˆ é™¤è¿™æ¡å›å¤å—ï¼Ÿ')) {
                return;
            }

            const index = review.replies.findIndex(r => r.replyId === replyId);
            if (index === -1) {
                showNotification('æœªæ‰¾åˆ°å¯¹åº”å›å¤', 'error');
                return;
            }

            review.replies.splice(index, 1);
            localStorage.setItem('products', JSON.stringify(products));

            // åŒæ­¥å½“å‰äº§å“çš„è¯„ä»·åˆ°äº‘ç«¯
            if (cloudSync && cloudSync.isInitialized && cloudSync.db) {
                try {
                    const productIndex = products.findIndex(p => normalizeOrderId(p.id) === normalizeOrderId(product.id));
                    if (productIndex !== -1) {
                        const reviewsToSync = products[productIndex].reviews || [];
                        await cloudSync.db.ref(`products/${productIndex}/reviews`).set(reviewsToSync);
                        console.log('âœ… ç”¨æˆ·å›å¤å·²ä»äº‘ç«¯åˆ é™¤');
                    } else {
                        console.warn('æœªæ‰¾åˆ°å¯¹åº”äº§å“ï¼Œæ— æ³•åŒæ­¥åˆ é™¤åçš„å›å¤åˆ°äº‘ç«¯:', product.id);
                    }
                } catch (error) {
                    console.error('åˆ é™¤å›å¤ååŒæ­¥å¤±è´¥:', error);
                }
            }

            // åˆ·æ–°å½“å‰äº§å“è¯¦æƒ…é¡µ
            showProductDetail(product.id);
            showNotification('å›å¤å·²åˆ é™¤', 'success');
        }

        // å¯¼å‡ºç”¨æˆ·æ•°æ®
        function exportUsersData() {
            const csvContent = "data:text/csv;charset=utf-8," +
                "ID,ç”¨æˆ·å,è´¦å·,è§’è‰²,æ³¨å†Œæ—¶é—´,èœœç½,çŠ¶æ€\n" +
                [...Object.entries(ADMIN_ACCOUNTS).map(([account, info]) =>
                    `${account},${info.username},${account},ç®¡ç†å‘˜,ç³»ç»Ÿé¢„è®¾,0,æ­£å¸¸`
                ), ...allUsers.map(user => {
                    const points = (user.points == null || isNaN(user.points)) ? 1 : Number(user.points);
                    return `${user.id},${user.username},${user.account},æ™®é€šç”¨æˆ·,${user.registerTime},${points},${user.status}`;
                })].join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "users_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // å¯¼å‡ºè®¢å•æ•°æ®ï¼ˆExcelæ ¼å¼ï¼‰
        function exportOrdersData() {
            try {
                // è·å–æ‰€æœ‰è®¢å•ï¼ˆç®¡ç†å‘˜æ˜¾ç¤ºæ‰€æœ‰è®¢å•ï¼Œæ™®é€šç”¨æˆ·æ˜¾ç¤ºè‡ªå·±çš„è®¢å•ï¼‰
                let ordersToExport = [];
                if (currentUser && currentUser.role === 'admin') {
                    // ç®¡ç†å‘˜ï¼šå¯¼å‡ºæ‰€æœ‰è®¢å•
                    if (allOrders.length === 0) {
                        // å¦‚æœå…¨å±€è®¢å•æ•°ç»„ä¸ºç©ºï¼Œå°è¯•ä»localStorageåŠ è½½
                        const savedAllOrders = localStorage.getItem('allOrders');
                        if (savedAllOrders) {
                            try {
                                ordersToExport = JSON.parse(savedAllOrders);
                            } catch (e) {
                                console.error('è§£æä¿å­˜çš„æ‰€æœ‰è®¢å•å¤±è´¥:', e);
                                ordersToExport = userOrders;
                            }
                        } else {
                            ordersToExport = userOrders;
                        }
                    } else {
                        ordersToExport = allOrders;
                    }
                } else {
                    // æ™®é€šç”¨æˆ·ï¼šåªå¯¼å‡ºè‡ªå·±çš„è®¢å•
                    ordersToExport = userOrders.filter(order => 
                        !order.account || order.account === currentUser?.account
                    );
                }

                if (ordersToExport.length === 0) {
                    showNotification('æ²¡æœ‰è®¢å•æ•°æ®å¯å¯¼å‡º', 'warning');
                    return;
                }

                // å‡†å¤‡Excelæ•°æ®
                const excelData = ordersToExport.map(order => {
                    const customerInfo = order.customerInfo || {};
                    const username = order.account || customerInfo.account || customerInfo.name || '';
                    const phone = customerInfo.phone || '';
                    const email = customerInfo.email || '';
                    const name = customerInfo.name || customerInfo.fullName || '';
                    const addressDetail = customerInfo.addressDetail || customerInfo.detail || '';
                    const addressUnit = customerInfo.addressUnit || customerInfo.unit || '';
                    const city = customerInfo.addressCity || customerInfo.city || '';
                    const state = customerInfo.addressState || customerInfo.state || '';
                    const postal = customerInfo.addressPostal || customerInfo.postal || customerInfo.zip || '';
                    
                    // åŒ¹é…ä¿¡æ¯ï¼šå§“å-åœ°å€è¡Œ1-åœ°å€è¡Œ2-åŸå¸‚-å·-é‚®ç¼–
                    const matchingInfo = `${name}-${addressDetail}-${addressUnit}-${city}-${state}-${postal}`;
                    
                    // æ ¼å¼åŒ–ä¸‹å•æ—¶é—´
                    let orderDate = '';
                    if (order.date) {
                        try {
                            const date = new Date(order.date);
                            orderDate = date.toLocaleString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit',
                                second: '2-digit'
                            });
                        } catch (e) {
                            orderDate = String(order.date);
                        }
                    }

                    return {
                        'è®¢å•ID': String(order.id || ''),
                        'äº§å“åç§°': order.productName || '',
                        'ç”¨æˆ·å': username,
                        'ç”µè¯å·ç ': phone,
                        'è®¢å•çŠ¶æ€': getStatusText(order.status || 'pending'),
                        'å¿«é€’å•å·': order.trackingNumber || '',
                        'ä¸‹å•æ—¶é—´': orderDate,
                        'é‚®ç®±': email,
                        'åŒ¹é…ä¿¡æ¯': matchingInfo
                    };
                });

                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // è®¾ç½®åˆ—å®½
                const colWidths = [
                    { wch: 15 }, // è®¢å•ID
                    { wch: 30 }, // äº§å“åç§°
                    { wch: 20 }, // ç”¨æˆ·å
                    { wch: 15 }, // ç”µè¯å·ç 
                    { wch: 12 }, // è®¢å•çŠ¶æ€
                    { wch: 20 }, // å¿«é€’å•å·
                    { wch: 20 }, // ä¸‹å•æ—¶é—´
                    { wch: 30 }, // é‚®ç®±
                    { wch: 60 }  // åŒ¹é…ä¿¡æ¯
                ];
                ws['!cols'] = colWidths;

                // å¯ç”¨è‡ªåŠ¨ç­›é€‰åŠŸèƒ½ï¼ˆä»A1åˆ°I1ï¼ŒåŒ…å«æ‰€æœ‰åˆ—çš„è¡¨å¤´ï¼‰
                // è¿™æ ·åœ¨Excelä¸­æ‰“å¼€æ—¶ï¼Œæ¯åˆ—çš„è¡¨å¤´éƒ½ä¼šæ˜¾ç¤ºç­›é€‰ä¸‹æ‹‰ç®­å¤´
                const range = XLSX.utils.decode_range(ws['!ref'] || 'A1');
                // è®¾ç½®è‡ªåŠ¨ç­›é€‰èŒƒå›´ï¼šä»ç¬¬ä¸€è¡Œï¼ˆè¡¨å¤´ï¼‰åˆ°æ•°æ®æœ€åä¸€è¡Œï¼Œæ‰€æœ‰åˆ—
                ws['!autofilter'] = {
                    ref: XLSX.utils.encode_range({
                        s: { r: 0, c: 0 }, // èµ·å§‹ä½ç½®ï¼šç¬¬1è¡Œç¬¬1åˆ—ï¼ˆA1ï¼‰
                        e: { r: range.e.r, c: range.e.c } // ç»“æŸä½ç½®ï¼šæœ€åä¸€è¡Œæœ€åä¸€åˆ—
                    })
                };

                // å†»ç»“é¦–è¡Œï¼Œæ–¹ä¾¿æŸ¥çœ‹è¡¨å¤´
                ws['!freeze'] = { xSplit: 0, ySplit: 1, topLeftCell: 'A2', activePane: 'bottomLeft', state: 'frozen' };

                // è®¾ç½®å•å…ƒæ ¼æ ·å¼ï¼šå°†"è®¢å•ID"åˆ—ï¼ˆAåˆ—ï¼Œç´¢å¼•0ï¼‰è®¾ç½®ä¸ºç°è‰²èƒŒæ™¯ä½œä¸ºæç¤º
                // æ³¨æ„ï¼šä¸å¯ç”¨å·¥ä½œè¡¨ä¿æŠ¤ï¼Œç¡®ä¿æ‰€æœ‰å•å…ƒæ ¼éƒ½å¯ä»¥è‡ªç”±ç¼–è¾‘
                const cellRange = XLSX.utils.decode_range(ws['!ref'] || 'A1');
                
                // å°†æ‰€æœ‰å•å…ƒæ ¼è®¾ç½®ä¸ºæœªé”å®šï¼ˆå¯ç¼–è¾‘ï¼‰ï¼Œç¡®ä¿å¯¼å‡ºåå¯ä»¥è‡ªç”±ç¼–è¾‘
                for (let R = 0; R <= cellRange.e.r; R++) {
                    for (let C = 0; C <= cellRange.e.c; C++) {
                        const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
                        
                        // å¦‚æœå•å…ƒæ ¼ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª
                        if (!ws[cellAddress]) {
                            ws[cellAddress] = { t: 's', v: '' };
                        }
                        
                        // ç¡®ä¿å•å…ƒæ ¼æœ‰så±æ€§ï¼ˆæ ·å¼ï¼‰
                        if (!ws[cellAddress].s) {
                            ws[cellAddress].s = {};
                        }
                        if (!ws[cellAddress].s.protection) {
                            ws[cellAddress].s.protection = {};
                        }
                        
                        // æ‰€æœ‰å•å…ƒæ ¼éƒ½è®¾ç½®ä¸ºæœªé”å®šï¼ˆå¯ç¼–è¾‘ï¼‰
                        ws[cellAddress].s.protection.locked = false;
                    }
                }
                
                // ä¸ºè®¢å•IDåˆ—ï¼ˆAåˆ—ï¼Œç´¢å¼•0ï¼‰è®¾ç½®ç°è‰²èƒŒæ™¯ä½œä¸ºæç¤ºï¼ˆå»ºè®®ä¸è¦ä¿®æ”¹ï¼‰
                for (let R = 0; R <= cellRange.e.r; R++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: R, c: 0 }); // Aåˆ—ï¼Œç´¢å¼•0
                    
                    // ç¡®ä¿å•å…ƒæ ¼å­˜åœ¨
                    if (!ws[cellAddress]) {
                        ws[cellAddress] = { t: 's', v: '' };
                    }
                    if (!ws[cellAddress].s) {
                        ws[cellAddress].s = {};
                    }
                    
                    // è®¾ç½®è®¢å•IDåˆ—çš„æ ·å¼ï¼ˆç°è‰²èƒŒæ™¯æç¤ºï¼Œä½†ä¸é”å®šï¼‰
                    if (!ws[cellAddress].s.fill) {
                        ws[cellAddress].s.fill = {};
                    }
                    ws[cellAddress].s.fill.fgColor = { rgb: 'F2F2F2' }; // æµ…ç°è‰²èƒŒæ™¯
                    
                    // ç¡®ä¿è®¢å•IDåˆ—ä¹Ÿæ˜¯æœªé”å®šçš„ï¼ˆå¯ç¼–è¾‘ï¼‰
                    if (!ws[cellAddress].s.protection) {
                        ws[cellAddress].s.protection = {};
                    }
                    ws[cellAddress].s.protection.locked = false;
                }

                // ä¸å¯ç”¨å·¥ä½œè¡¨ä¿æŠ¤ï¼Œç¡®ä¿æ‰€æœ‰å•å…ƒæ ¼éƒ½å¯ä»¥è‡ªç”±ç¼–è¾‘
                // å¦‚æœä»¥åéœ€è¦ä¿æŠ¤æŸäº›åˆ—ï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨åœ¨Excelä¸­å¯ç”¨å·¥ä½œè¡¨ä¿æŠ¤

                // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(wb, ws, 'è®¢å•æ•°æ®');

                // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const fileName = `è®¢å•æ•°æ®_${timestamp}.xlsx`;

                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                showNotification(`æˆåŠŸå¯¼å‡º ${ordersToExport.length} æ¡è®¢å•æ•°æ®`, 'success');
            } catch (error) {
                console.error('å¯¼å‡ºè®¢å•æ•°æ®å¤±è´¥:', error);
                showNotification('å¯¼å‡ºè®¢å•æ•°æ®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¯¼å…¥è®¢å•æ•°æ®ï¼ˆä»Excelæ–‡ä»¶æ‰¹é‡æ›´æ–°è®¢å•ï¼‰
        async function importOrdersData(excelData) {
            try {
                if (!Array.isArray(excelData) || excelData.length === 0) {
                    showNotification('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆæ•°æ®', 'warning');
                    return;
                }

                // è·å–æ‰€æœ‰è®¢å•ï¼ˆç”¨äºåŒ¹é…å’Œæ›´æ–°ï¼‰
                let allOrdersToUpdate = [];
                if (currentUser && currentUser.role === 'admin') {
                    // ç®¡ç†å‘˜ï¼šæ›´æ–°æ‰€æœ‰è®¢å•
                    if (allOrders.length === 0) {
                        const savedAllOrders = localStorage.getItem('allOrders');
                        if (savedAllOrders) {
                            try {
                                allOrdersToUpdate = JSON.parse(savedAllOrders);
                            } catch (e) {
                                console.error('è§£æä¿å­˜çš„æ‰€æœ‰è®¢å•å¤±è´¥:', e);
                                allOrdersToUpdate = userOrders;
                            }
                        } else {
                            allOrdersToUpdate = userOrders;
                        }
                    } else {
                        allOrdersToUpdate = allOrders;
                    }
                } else {
                    // æ™®é€šç”¨æˆ·ï¼šåªæ›´æ–°è‡ªå·±çš„è®¢å•
                    allOrdersToUpdate = userOrders.filter(order => 
                        !order.account || order.account === currentUser?.account
                    );
                }

                let updatedCount = 0;
                let notFoundCount = 0;
                const errors = [];

                // çŠ¶æ€æ–‡æœ¬åˆ°çŠ¶æ€å€¼çš„æ˜ å°„ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰
                const statusMap = {
                    // ä¸­æ–‡çŠ¶æ€
                    'å¾…ä¸Šä¼ ': 'pending',
                    'å®¡æ ¸ä¸­': 'review',
                    'è¿è¾“ä¸­': 'shipping',
                    'å·²å®Œæˆ': 'completed',
                    'å·²é©³å›': 'rejected',
                    'å·²å–æ¶ˆ': 'cancelled',
                    // è‹±æ–‡çŠ¶æ€
                    'Pending': 'pending',
                    'Review': 'review',
                    'Shipping': 'shipping',
                    'Completed': 'completed',
                    'Rejected': 'rejected',
                    'Cancelled': 'cancelled',
                    // å°å†™è‹±æ–‡çŠ¶æ€ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰
                    'pending': 'pending',
                    'review': 'review',
                    'shipping': 'shipping',
                    'completed': 'completed',
                    'rejected': 'rejected',
                    'cancelled': 'cancelled'
                };

                // éå†Excelæ•°æ®ï¼Œæ›´æ–°è®¢å•
                for (const row of excelData) {
                    const orderId = String(row['è®¢å•ID'] || row['è®¢å•id'] || row['orderId'] || '').trim();
                    if (!orderId) {
                        continue; // è·³è¿‡æ²¡æœ‰è®¢å•IDçš„è¡Œ
                    }

                    // æŸ¥æ‰¾å¯¹åº”çš„è®¢å•
                    const orderIndex = allOrdersToUpdate.findIndex(order => 
                        String(order.id).trim() === orderId
                    );

                    if (orderIndex === -1) {
                        notFoundCount++;
                        errors.push(`è®¢å•ID ${orderId} æœªæ‰¾åˆ°`);
                        continue;
                    }

                    const order = allOrdersToUpdate[orderIndex];
                    let hasChanges = false;

                    // æ›´æ–°è®¢å•çŠ¶æ€
                    if (row['è®¢å•çŠ¶æ€'] || row['è®¢å•çŠ¶æ€'] === '') {
                        const statusText = String(row['è®¢å•çŠ¶æ€'] || '').trim();
                        const statusValue = statusMap[statusText] || statusText;
                        if (statusValue && statusValue !== order.status) {
                            order.status = statusValue;
                            hasChanges = true;
                        }
                    }

                    // æ›´æ–°å¿«é€’å•å·
                    if (row['å¿«é€’å•å·'] !== undefined) {
                        const trackingNumber = String(row['å¿«é€’å•å·'] || '').trim();
                        if (trackingNumber !== order.trackingNumber) {
                            order.trackingNumber = trackingNumber;
                            hasChanges = true;
                        }
                    }

                    // æ›´æ–°å®¢æˆ·ä¿¡æ¯ï¼ˆå¦‚æœæä¾›äº†åŒ¹é…ä¿¡æ¯ï¼‰
                    if (row['åŒ¹é…ä¿¡æ¯'] || row['åŒ¹é…ä¿¡æ¯'] === '') {
                        const matchingInfo = String(row['åŒ¹é…ä¿¡æ¯'] || '').trim();
                        if (matchingInfo) {
                            // è§£æåŒ¹é…ä¿¡æ¯ï¼šå§“å-åœ°å€è¡Œ1-åœ°å€è¡Œ2-åŸå¸‚-å·-é‚®ç¼–
                            const parts = matchingInfo.split('-');
                            if (parts.length >= 6) {
                                if (!order.customerInfo) {
                                    order.customerInfo = {};
                                }
                                
                                const name = parts[0] || '';
                                const addressDetail = parts[1] || '';
                                const addressUnit = parts[2] || '';
                                const city = parts[3] || '';
                                const state = parts[4] || '';
                                const postal = parts[5] || '';

                                if (name && name !== order.customerInfo.name) {
                                    order.customerInfo.name = name;
                                    order.customerInfo.fullName = name;
                                    hasChanges = true;
                                }
                                if (addressDetail && addressDetail !== order.customerInfo.addressDetail) {
                                    order.customerInfo.addressDetail = addressDetail;
                                    order.customerInfo.detail = addressDetail;
                                    hasChanges = true;
                                }
                                if (addressUnit !== order.customerInfo.addressUnit) {
                                    order.customerInfo.addressUnit = addressUnit;
                                    order.customerInfo.unit = addressUnit;
                                    hasChanges = true;
                                }
                                if (city && city !== order.customerInfo.addressCity) {
                                    order.customerInfo.addressCity = city;
                                    order.customerInfo.city = city;
                                    hasChanges = true;
                                }
                                if (state && state !== order.customerInfo.addressState) {
                                    order.customerInfo.addressState = state;
                                    order.customerInfo.state = state;
                                    hasChanges = true;
                                }
                                if (postal && postal !== order.customerInfo.addressPostal) {
                                    order.customerInfo.addressPostal = postal;
                                    order.customerInfo.postal = postal;
                                    order.customerInfo.zip = postal;
                                    hasChanges = true;
                                }
                            }
                        }
                    }

                    // æ›´æ–°ç”µè¯å·ç 
                    if (row['ç”µè¯å·ç '] !== undefined) {
                        const phone = String(row['ç”µè¯å·ç '] || '').trim();
                        if (!order.customerInfo) {
                            order.customerInfo = {};
                        }
                        if (phone !== order.customerInfo.phone) {
                            order.customerInfo.phone = phone;
                            hasChanges = true;
                        }
                    }

                    // æ›´æ–°é‚®ç®±
                    if (row['é‚®ç®±'] !== undefined) {
                        const email = String(row['é‚®ç®±'] || '').trim();
                        if (!order.customerInfo) {
                            order.customerInfo = {};
                        }
                        if (email !== order.customerInfo.email) {
                            order.customerInfo.email = email;
                            hasChanges = true;
                        }
                    }

                    if (hasChanges) {
                        updatedCount++;
                    }
                }

                // ä¿å­˜æ›´æ–°åçš„è®¢å•æ•°æ®
                if (currentUser && currentUser.role === 'admin') {
                    // ç®¡ç†å‘˜ï¼šæ›´æ–°allOrderså’ŒlocalStorage
                    allOrders = allOrdersToUpdate;
                    localStorage.setItem('allOrders', JSON.stringify(allOrders));
                    
                    // åŒæ—¶æ›´æ–°userOrdersï¼ˆå¦‚æœè®¢å•å±äºå½“å‰ç”¨æˆ·ï¼‰
                    userOrders.forEach((userOrder, index) => {
                        const updatedOrder = allOrdersToUpdate.find(o => 
                            String(o.id).trim() === String(userOrder.id).trim()
                        );
                        if (updatedOrder) {
                            userOrders[index] = updatedOrder;
                        }
                    });
                } else {
                    // æ™®é€šç”¨æˆ·ï¼šåªæ›´æ–°userOrders
                    userOrders = allOrdersToUpdate;
                }

                // ä¿å­˜åˆ°localStorage
                if (currentUser && currentUser.account) {
                    const userOrdersKey = `userOrders_${currentUser.account}`;
                    localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                } else {
                    localStorage.setItem('userOrders', JSON.stringify(userOrders));
                }

                // åŒæ­¥åˆ°äº‘ç«¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                if (cloudSync && cloudSync.isInitialized && currentUser) {
                    try {
                        await cloudSync.uploadData('orders', allOrdersToUpdate);
                        console.log('âœ… è®¢å•æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯');
                    } catch (syncError) {
                        console.error('åŒæ­¥åˆ°äº‘ç«¯å¤±è´¥:', syncError);
                    }
                }

                // åˆ·æ–°è®¢å•åˆ—è¡¨
                renderOrdersTable();
                if (typeof renderUserOrders === 'function') {
                    renderUserOrders();
                }

                // æ˜¾ç¤ºç»“æœ
                let message = `æˆåŠŸæ›´æ–° ${updatedCount} æ¡è®¢å•`;
                if (notFoundCount > 0) {
                    message += `ï¼Œ${notFoundCount} æ¡è®¢å•æœªæ‰¾åˆ°`;
                }
                if (errors.length > 0 && errors.length <= 5) {
                    message += '\n' + errors.slice(0, 5).join('\n');
                } else if (errors.length > 5) {
                    message += `\nï¼ˆè¿˜æœ‰ ${errors.length - 5} ä¸ªé”™è¯¯ï¼‰`;
                }
                showNotification(message, updatedCount > 0 ? 'success' : 'warning');

            } catch (error) {
                console.error('å¯¼å…¥è®¢å•æ•°æ®å¤±è´¥:', error);
                showNotification('å¯¼å…¥è®¢å•æ•°æ®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ”¹è¿›çš„æŒ‰é’®åé¦ˆå‡½æ•°ï¼Œæ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œ
        async function showButtonFeedback(buttonId, callback) {
            const button = document.getElementById(buttonId);
            if (!button) return;

            // å¦‚æœæŒ‰é’®å·²ç»ç¦ç”¨ï¼Œç›´æ¥è¿”å›ï¼ˆé˜²æ­¢é‡å¤ç‚¹å‡»ï¼‰
            if (button.disabled) {
                return;
            }

            const originalText = button.textContent;
            const originalDisabled = button.disabled;

            // æ˜¾ç¤ºåˆ·æ–°çŠ¶æ€
            button.classList.add('btn-refreshing');
            button.disabled = true;

            // æ‰§è¡Œå›è°ƒå‡½æ•°ï¼ˆæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ï¼‰
            try {
                const result = callback();
                
                // å¦‚æœæ˜¯ Promiseï¼Œç­‰å¾…å®Œæˆ
                if (result && typeof result.then === 'function') {
                    await result;
                }

                // æ“ä½œå®Œæˆåç«‹å³æ¢å¤æŒ‰é’®ï¼ˆå‡å°‘å»¶è¿Ÿï¼‰
                button.classList.remove('btn-refreshing');
                button.classList.add('btn-success');

                // çŸ­æš‚æ˜¾ç¤ºæˆåŠŸçŠ¶æ€åæ¢å¤
                setTimeout(() => {
                    button.classList.remove('btn-success');
                    button.disabled = originalDisabled;
                }, 500); // ä»1500mså‡å°‘åˆ°500ms

            } catch (error) {
                console.error('æŒ‰é’®æ“ä½œå¤±è´¥:', error);
                // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                button.classList.remove('btn-refreshing');
                button.classList.add('btn-danger');
                button.textContent = 'æ“ä½œå¤±è´¥';

                setTimeout(() => {
                    button.classList.remove('btn-danger');
                    button.textContent = originalText;
                    button.disabled = originalDisabled;
                }, 1500); // ä»2000mså‡å°‘åˆ°1500ms
            }
        }

        // ä¸»é¡µè®¾ç½®æ•°æ®
        let homepageSettings = JSON.parse(localStorage.getItem('homepageSettings')) || {
            siteTitle: 'ç”µå•†å¹³å°',
            siteSlogan: 'ä¼˜è´¨å•†å“ï¼Œå€¼å¾—ä¿¡èµ–',
            siteLogo: 'https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_ed7f33a7af67dcf7f114c4e3d8f22515_ProductImage_MAIN',
            primaryColor: '#3498db',
            secondaryColor: '#2ecc71',
            getItNowButtonColor: '#667eea',
            fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
            productsPerRow: 4,
            showCategories: true,
            showSearch: true,
            desktopCarousel: [
                {
                    id: 1,
                    image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_74a4f2a269eeee0e43f867fff8416a45_ProductImage_MAIN',
                    title: 'æ–°å“ä¸Šå¸‚',
                    description: 'æ¢ç´¢æˆ‘ä»¬æœ€æ–°çš„äº§å“ç³»åˆ—ï¼Œäº«å—é™æ—¶ä¼˜æƒ ',
                    buttonText: 'ç«‹å³è´­ä¹°',
                    active: true
                },
                {
                    id: 2,
                    image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_0c7821e20b2ca904579150a5c33caa82_ProductImage_PT01',
                    title: 'é™æ—¶ç‰¹æƒ ',
                    description: 'ç²¾é€‰å•†å“ä½è‡³5æŠ˜ï¼Œé”™è¿‡å†ç­‰ä¸€å¹´',
                    buttonText: 'æŸ¥çœ‹è¯¦æƒ…',
                    active: true
                }
            ],
            mobileCarousel: [
                {
                    id: 101,
                    image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_74a4f2a269eeee0e43f867fff8416a45_ProductImage_MAIN',
                    title: 'ç§»åŠ¨ç«¯ä¸“äº«',
                    description: 'ä¸“ä¸ºæ‰‹æœºå±å¹•è£åˆ‡çš„è§†è§‰ä½“éªŒ',
                    buttonText: 'ç«‹å³æŸ¥çœ‹',
                    active: true
                },
                {
                    id: 102,
                    image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_0c7821e20b2ca904579150a5c33caa82_ProductImage_PT01',
                    title: 'å£ç¢‘å¥½ç‰©',
                    description: 'çœŸå®ç”¨æˆ·åé¦ˆï¼Œæ”¾å¿ƒä½“éªŒ',
                    buttonText: 'æŸ¥çœ‹æ›´å¤š',
                    active: true
                }
            ]
        };

        homepageSettings = normalizeHomepageSettings(homepageSettings);

        function normalizeHomepageSettings(settings) {
            const normalized = { ...settings };

            if (!Array.isArray(normalized.desktopCarousel) && Array.isArray(normalized.carousel)) {
                normalized.desktopCarousel = normalized.carousel;
            }

            if (!Array.isArray(normalized.desktopCarousel)) {
                normalized.desktopCarousel = [];
            }

            if (!Array.isArray(normalized.mobileCarousel)) {
                normalized.mobileCarousel = JSON.parse(JSON.stringify(normalized.desktopCarousel));
            }

            normalized.desktopCarousel = normalized.desktopCarousel.map(item => ({
                active: true,
                ...item
            }));

            normalized.mobileCarousel = normalized.mobileCarousel.map(item => ({
                active: true,
                ...item
            }));

            if (normalized.carousel) {
                delete normalized.carousel;
            }

            // ç¡®ä¿ getItNowButtonColor å­˜åœ¨
            if (!normalized.getItNowButtonColor) {
                normalized.getItNowButtonColor = '#667eea';
            }

            return normalized;
        }

        // åŠ è½½ä¸»é¡µè®¾ç½®
        function loadHomepageSettings() {
            homepageSettings = normalizeHomepageSettings(homepageSettings);
            // åŠ è½½ç½‘ç«™ä¿¡æ¯
            document.getElementById('site-title').value = homepageSettings.siteTitle;
            document.getElementById('site-slogan').value = homepageSettings.siteSlogan;
            document.getElementById('site-logo').value = homepageSettings.siteLogo;

            // åŠ è½½ä¸»é¢˜è®¾ç½®
            document.getElementById('primary-color').value = homepageSettings.primaryColor;
            document.getElementById('secondary-color').value = homepageSettings.secondaryColor;
            document.getElementById('getitnow-button-color').value = homepageSettings.getItNowButtonColor || '#667eea';
            document.getElementById('font-family').value = homepageSettings.fontFamily;

            // åŠ è½½å¸ƒå±€è®¾ç½®
            document.getElementById('products-per-row').value = homepageSettings.productsPerRow;
            document.getElementById('show-categories').checked = homepageSettings.showCategories;
            document.getElementById('show-search').checked = homepageSettings.showSearch;

            // æ¸²æŸ“è½®æ’­å›¾åˆ—è¡¨
            renderCarouselList('desktop');
            renderCarouselList('mobile');
        }

        // æ¸²æŸ“è½®æ’­å›¾åˆ—è¡¨
        function renderCarouselList(type = 'desktop') {
            const listId = type === 'mobile' ? 'carousel-list-mobile' : 'carousel-list-desktop';
            const carouselList = document.getElementById(listId);
            if (!carouselList) return;

            const carouselData = type === 'mobile'
                ? (homepageSettings.mobileCarousel || [])
                : (homepageSettings.desktopCarousel || []);

            if (carouselData.length === 0) {
                carouselList.innerHTML = `<p style="text-align: center; color: #999; padding: 20px;">æš‚æ— ${type === 'mobile' ? 'ç§»åŠ¨ç«¯' : 'PCç«¯'}è½®æ’­å›¾</p>`;
                return;
            }

            carouselList.innerHTML = carouselData.map(item => `
                <div class="carousel-item">
                    <div class="carousel-preview" style="background-image: url('${item.image}')"></div>
                    <div class="carousel-info">
                        <div class="carousel-title">${item.title}</div>
                        <div class="carousel-desc">${item.description}</div>
                    </div>
                    <div class="carousel-actions">
                        <button class="btn btn-sm btn-primary" onclick="editCarouselItem(${item.id}, '${type}')">ç¼–è¾‘</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCarouselItem(${item.id}, '${type}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // ç¼–è¾‘è½®æ’­å›¾
        function editCarouselItem(id, type = 'desktop') {
            const collection = type === 'mobile'
                ? (homepageSettings.mobileCarousel || [])
                : (homepageSettings.desktopCarousel || []);
            const item = collection.find(c => c.id === id);
            if (!item) return;

            openCarouselEditModal(type, item);
        }

        // åˆ é™¤è½®æ’­å›¾
        function deleteCarouselItem(id, type = 'desktop') {
            const targetLabel = type === 'mobile' ? t('mobile') : t('desktop');
            customConfirm(t('confirmDeleteCarousel').replace('{targetLabel}', targetLabel), t('confirmTitle')).then(confirmed => {
                if (confirmed) {
                    if (type === 'mobile') {
                        homepageSettings.mobileCarousel = (homepageSettings.mobileCarousel || []).filter(c => c.id !== id);
                    } else {
                        homepageSettings.desktopCarousel = (homepageSettings.desktopCarousel || []).filter(c => c.id !== id);
                    }
                    saveHomepageSettings();
                    renderCarouselList(type);
                    showNotification(`${targetLabel}è½®æ’­å›¾å·²åˆ é™¤`, 'success');
                }
            });
        }

        // æ·»åŠ è½®æ’­å›¾
        function addCarouselItem(type = 'desktop') {
            openCarouselEditModal(type, null);
        }

        // ä¿å­˜ä¸»é¡µè®¾ç½®
        function saveHomepageSettings() {
            // æ›´æ–°è®¾ç½®å¯¹è±¡
            homepageSettings.siteTitle = document.getElementById('site-title').value;
            homepageSettings.siteSlogan = document.getElementById('site-slogan').value;
            homepageSettings.siteLogo = document.getElementById('site-logo').value;
            homepageSettings.primaryColor = document.getElementById('primary-color').value;
            homepageSettings.secondaryColor = document.getElementById('secondary-color').value;
            homepageSettings.getItNowButtonColor = document.getElementById('getitnow-button-color').value;
            homepageSettings.fontFamily = document.getElementById('font-family').value;
            homepageSettings.productsPerRow = parseInt(document.getElementById('products-per-row').value);
            homepageSettings.showCategories = document.getElementById('show-categories').checked;
            homepageSettings.showSearch = document.getElementById('show-search').checked;

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('homepageSettings', JSON.stringify(homepageSettings));

            // åº”ç”¨è®¾ç½®åˆ°é¡µé¢
            applyHomepageSettings();

            // åŒæ­¥åˆ°äº‘ç«¯
            if (cloudSync && cloudSync.isInitialized) {
                cloudSync.syncHomepageSettings().catch(err => {
                    console.warn('ä¸»é¡µè®¾ç½®äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                });
            }

            showNotification('ä¸»é¡µè®¾ç½®å·²ä¿å­˜', 'success');
        }

        // åº”ç”¨ä¸»é¡µè®¾ç½®åˆ°é¡µé¢
        function applyHomepageSettings() {
            // ç¡®ä¿ä¸»é¡µè®¾ç½®ç»“æ„å®Œæ•´ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®ï¼‰ï¼Œé¿å…è½®æ’­å›¾é¦–æ¬¡è¿›å…¥ä¸æ˜¾ç¤º
            try {
                homepageSettings = normalizeHomepageSettings(homepageSettings || {});
            } catch (e) {
                console.warn('è§„èŒƒåŒ–ä¸»é¡µè®¾ç½®å¤±è´¥ï¼Œæ¢å¤ä¸ºé»˜è®¤é…ç½®:', e);
                homepageSettings = normalizeHomepageSettings({
                    siteTitle: 'ç”µå•†å¹³å°',
                    siteSlogan: 'ä¼˜è´¨å•†å“ï¼Œå€¼å¾—ä¿¡èµ–',
                    siteLogo: 'https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_ed7f33a7af67dcf7f114c4e3d8f22515_ProductImage_MAIN',
                    primaryColor: '#3498db',
                    secondaryColor: '#2ecc71',
                    getItNowButtonColor: '#667eea',
                    fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                    productsPerRow: 4,
                    showCategories: true,
                    showSearch: true,
                    desktopCarousel: [],
                    mobileCarousel: []
                });
            }
            // æ›´æ–°ç½‘ç«™Logo
            const logoImg = document.getElementById('site-logo-img');
            if (logoImg) {
                const logoUrl = homepageSettings.siteLogo || 'https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_ed7f33a7af67dcf7f114c4e3d8f22515_ProductImage_MAIN';
                if (logoUrl) {
                    logoImg.src = logoUrl;
                    logoImg.style.display = 'block';
                    logoImg.style.visibility = 'visible';
                    logoImg.style.opacity = '1';
                    logoImg.style.height = '60px';
                    logoImg.style.maxWidth = '300px';
                    logoImg.style.width = 'auto';
                    // ç¡®ä¿logoå®¹å™¨ä¹Ÿå¯è§
                    const logoContainer = document.getElementById('home-link');
                    if (logoContainer) {
                        logoContainer.style.display = 'flex';
                        logoContainer.style.visibility = 'visible';
                        logoContainer.style.marginLeft = '20px';
                    }
                } else {
                    logoImg.style.display = 'none';
                }
            }

            // æ›´æ–°CSSå˜é‡
            document.documentElement.style.setProperty('--primary', homepageSettings.primaryColor);
            document.documentElement.style.setProperty('--secondary', homepageSettings.secondaryColor);
            document.documentElement.style.setProperty('--font-family', homepageSettings.fontFamily);
            // è®¾ç½®Get it nowæŒ‰é’®é¢œè‰²CSSå˜é‡
            const getItNowColor = homepageSettings.getItNowButtonColor || '#667eea';
            document.documentElement.style.setProperty('--get-it-now-color', getItNowColor);

            // æ›´æ–°äº§å“ç½‘æ ¼å¸ƒå±€
            const productsGrid = document.getElementById('products-grid');
            if (productsGrid) {
                // productsGrid.style.gridTemplateColumns = `repeat(auto-fill, minmax(${300 / homepageSettings.productsPerRow}px, 1fr))`;
            }

            // æ›´æ–°æ‰€æœ‰Get it nowæŒ‰é’®çš„é¢œè‰²ï¼ˆä½¿ç”¨CSSå˜é‡ï¼‰
            document.querySelectorAll('.signup-btn, .get-it-now-btn, .signup-now').forEach(btn => {
                const buttonText = btn.textContent.trim();
                const isClaimed = btn.getAttribute('data-is-claimed') === 'true';
                if (isClaimed && (buttonText === t('getItNow') || buttonText === 'Get it now' || buttonText.includes('Get it now'))) {
                    btn.style.background = getItNowColor;
                    btn.style.borderColor = getItNowColor;
                    btn.style.color = 'white';
                }
            });

            // é‡æ–°æ¸²æŸ“äº§å“åˆ—è¡¨ä»¥åº”ç”¨æ–°é¢œè‰²
            if (typeof renderProducts === 'function' && Array.isArray(products) && products.length > 0) {
                renderProducts(products);
            }
            
            // å¦‚æœäº§å“è¯¦æƒ…é¡µæ˜¯æ‰“å¼€çš„ï¼Œä¹Ÿéœ€è¦æ›´æ–°é‚£é‡Œçš„æŒ‰é’®
            const productDetail = document.getElementById('product-detail');
            if (productDetail && productDetail.style.display !== 'none') {
                const signupNowBtn = productDetail.querySelector('.signup-now');
                if (signupNowBtn && signupNowBtn.getAttribute('data-is-claimed') === 'true') {
                    signupNowBtn.style.background = getItNowColor;
                    signupNowBtn.style.borderColor = getItNowColor;
                    signupNowBtn.style.color = 'white';
                }
            }

            // æ›´æ–°è½®æ’­å›¾
            updateCarousel();

            // æ›´æ–°åˆ†ç±»ç­›é€‰æ˜¾ç¤º
            const categoryFilter = document.querySelector('.category-filter');
            if (categoryFilter) {
                categoryFilter.style.display = homepageSettings.showCategories ? 'flex' : 'none';
            }

            // æ›´æ–°æœç´¢æ¡†æ˜¾ç¤º
            const searchBar = document.querySelector('.search-bar');
            if (searchBar) {
                searchBar.style.display = homepageSettings.showSearch ? 'flex' : 'none';
            }
        }

        // æ›´æ–°è½®æ’­å›¾
        function updateCarousel() {
            const carousel = document.querySelector('.carousel');
            if (!carousel) return;

            const activeSlides = getSlidesForViewport();

            const slidesHTML = activeSlides.map((item, index) => `
                <div class="carousel-slide ${index === 0 ? 'active' : ''}" style="background-image: url('${item.image}')">
                    <div class="carousel-content">
                        <h2>${item.title}</h2>
                        <p>${item.description}</p>
                        <a href="#" class="carousel-btn">${item.buttonText}</a>
                    </div>
                </div>
            `).join('');

            const indicatorsHTML = activeSlides.map((_, index) => `
                <div class="indicator ${index === 0 ? 'active' : ''}"></div>
            `).join('');

            carousel.innerHTML = `<div class="carousel-arrow prev">&#10094;</div>` + 
                                 slidesHTML + 
                                 `<div class="carousel-arrow next">&#10095;</div>` +
                                 `<div class="carousel-indicators">${indicatorsHTML}</div>`;
            
            // é‡æ–°åˆå§‹åŒ–è½®æ’­å›¾åŠŸèƒ½
            initCarousel();
        }

        function getSlidesForViewport() {
            const isMobileView = window.innerWidth <= 768;
            const source = isMobileView
                ? (homepageSettings.mobileCarousel || [])
                : (homepageSettings.desktopCarousel || []);
            return source.filter(item => item.active !== false);
        }

        window.addEventListener('resize', debounce(() => {
            updateCarousel();
        }, 200));

        // è½®æ’­å›¾è‡ªåŠ¨åˆ‡æ¢å®šæ—¶å™¨ï¼ˆå…¨å±€å˜é‡ï¼Œç”¨äºæ¸…é™¤ï¼‰
        let carouselInterval = null;

        // åˆå§‹åŒ–è½®æ’­å›¾åŠŸèƒ½
        function initCarousel() {
            const carouselContainer = document.querySelector('.carousel');
            if (!carouselContainer) return;

            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (carouselInterval) {
                clearInterval(carouselInterval);
                carouselInterval = null;
            }

            const slides = document.querySelectorAll('.carousel-slide');
            const indicators = document.querySelectorAll('.indicator');
            const prevArrow = document.querySelector('.carousel-arrow.prev');
            const nextArrow = document.querySelector('.carousel-arrow.next');
            
            if (slides.length === 0) return;

            let currentSlide = 0;
            
            // æ‰¾åˆ°å½“å‰æ¿€æ´»çš„slide
            slides.forEach((slide, index) => {
                if (slide.classList.contains('active')) {
                    currentSlide = index;
                }
            });

            // å®šä¹‰showSlideå‡½æ•°
            function showSlide(n) {
                slides.forEach(slide => slide.classList.remove('active'));
                indicators.forEach(indicator => indicator.classList.remove('active'));

                currentSlide = (n + slides.length) % slides.length;

                if (slides[currentSlide]) {
                    slides[currentSlide].classList.add('active');
                }
                if (indicators[currentSlide]) {
                    indicators[currentSlide].classList.add('active');
                }
            }

            // è‡ªåŠ¨è½®æ’­
            carouselInterval = setInterval(() => {
                showSlide(currentSlide + 1);
            }, 5000);

            // æŒ‡ç¤ºç‚¹ç‚¹å‡»åˆ‡æ¢
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    if (carouselInterval) {
                        clearInterval(carouselInterval);
                    }
                    showSlide(index);
                    carouselInterval = setInterval(() => {
                        showSlide(currentSlide + 1);
                    }, 5000);
                });
            });

            // å·¦å³æŒ‰é’®ç‚¹å‡»åˆ‡æ¢
            if (prevArrow) {
                prevArrow.addEventListener('click', () => {
                    if (carouselInterval) {
                        clearInterval(carouselInterval);
                    }
                    showSlide(currentSlide - 1);
                    carouselInterval = setInterval(() => {
                        showSlide(currentSlide + 1);
                    }, 5000);
                });
            }

            if (nextArrow) {
                nextArrow.addEventListener('click', () => {
                    if (carouselInterval) {
                        clearInterval(carouselInterval);
                    }
                    showSlide(currentSlide + 1);
                    carouselInterval = setInterval(() => {
                        showSlide(currentSlide + 1);
                    }, 5000);
                });
            }

            // é¼ æ ‡æ‹–æ‹½ / è§¦æ‘¸æ»‘åŠ¨åˆ‡æ¢
            let dragStartX = null;
            let isDragging = false;

            function getClientX(event) {
                if (event.touches && event.touches.length) {
                    return event.touches[0].clientX;
                }
                if (event.changedTouches && event.changedTouches.length) {
                    return event.changedTouches[0].clientX;
                }
                return event.clientX;
            }

            function handleDragStart(event) {
                isDragging = true;
                dragStartX = getClientX(event);
            }

            function handleDragEnd(event) {
                if (!isDragging || dragStartX === null) return;
                const endX = getClientX(event);
                const deltaX = endX - dragStartX;
                const threshold = 50; // è¶…è¿‡ 50px åˆ¤å®šä¸ºæ»‘åŠ¨

                if (Math.abs(deltaX) > threshold) {
                    if (carouselInterval) {
                        clearInterval(carouselInterval);
                    }
                    if (deltaX < 0) {
                        // å‘å·¦æ‹–ï¼šä¸‹ä¸€å¼ 
                        showSlide(currentSlide + 1);
                    } else {
                        // å‘å³æ‹–ï¼šä¸Šä¸€å¼ 
                        showSlide(currentSlide - 1);
                    }
                    carouselInterval = setInterval(() => {
                        showSlide(currentSlide + 1);
                    }, 5000);
                }

                isDragging = false;
                dragStartX = null;
            }

            if (carouselContainer) {
                // é¼ æ ‡äº‹ä»¶
                carouselContainer.addEventListener('mousedown', handleDragStart);
                window.addEventListener('mouseup', handleDragEnd);

                // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
                carouselContainer.addEventListener('touchstart', handleDragStart, { passive: true });
                carouselContainer.addEventListener('touchend', handleDragEnd);
            }
        }

        // é‡ç½®ä¸»é¡µè®¾ç½®
        function resetHomepageSettings() {
            if (confirm(t('confirmResetHomepageSettings'))) {
                homepageSettings = normalizeHomepageSettings({
                    siteTitle: 'ç”µå•†å¹³å°',
                    siteSlogan: 'ä¼˜è´¨å•†å“ï¼Œå€¼å¾—ä¿¡èµ–',
                    siteLogo: 'https://d92ap0lo8fr10.cloudfront.net/A19TTJV74BN2OJ_ed7f33a7af67dcf7f114c4e3d8f22515_ProductImage_MAIN',
                    primaryColor: '#3498db',
                    secondaryColor: '#2ecc71',
                    getItNowButtonColor: '#667eea',
                    fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                    productsPerRow: 4,
                    showCategories: true,
                    showSearch: true,
                    desktopCarousel: [
                        {
                            id: 1,
                            image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_74a4f2a269eeee0e43f867fff8416a45_ProductImage_MAIN',
                            title: 'æ–°å“ä¸Šå¸‚',
                            description: 'æ¢ç´¢æˆ‘ä»¬æœ€æ–°çš„äº§å“ç³»åˆ—ï¼Œäº«å—é™æ—¶ä¼˜æƒ ',
                            buttonText: 'ç«‹å³è´­ä¹°',
                            active: true
                        },
                        {
                            id: 2,
                            image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_0c7821e20b2ca904579150a5c33caa82_ProductImage_PT01',
                            title: 'é™æ—¶ç‰¹æƒ ',
                            description: 'ç²¾é€‰å•†å“ä½è‡³5æŠ˜ï¼Œé”™è¿‡å†ç­‰ä¸€å¹´',
                            buttonText: 'æŸ¥çœ‹è¯¦æƒ…',
                            active: true
                        }
                    ],
                    mobileCarousel: [
                        {
                            id: 101,
                            image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_74a4f2a269eeee0e43f867fff8416a45_ProductImage_MAIN',
                            title: 'ç§»åŠ¨ç«¯ä¸“äº«',
                            description: 'ä¸“ä¸ºæ‰‹æœºå±å¹•è£åˆ‡çš„è§†è§‰ä½“éªŒ',
                            buttonText: 'ç«‹å³æŸ¥çœ‹',
                            active: true
                        },
                        {
                            id: 102,
                            image: 'https://d92ap0lo8fr10.cloudfront.net/A14TLSYJXI3UM6_0c7821e20b2ca904579150a5c33caa82_ProductImage_PT01',
                            title: 'å£ç¢‘å¥½ç‰©',
                            description: 'çœŸå®ç”¨æˆ·åé¦ˆï¼Œæ”¾å¿ƒä½“éªŒ',
                            buttonText: 'æŸ¥çœ‹æ›´å¤š',
                            active: true
                        }
                    ]
                });

                saveHomepageSettings();
                loadHomepageSettings();
                showNotification('ä¸»é¡µè®¾ç½®å·²é‡ç½®', 'success');
            }
        }

        // æ¸²æŸ“åå°ç®¡ç†äº§å“
        function renderAdminProducts() {
            const adminProductsGrid = document.getElementById('admin-products-grid');
            const searchTerm = (adminProductSearchTerm || '').trim();
            const normalizedTerm = searchTerm.toLowerCase();
            const filteredProducts = normalizedTerm
                ? products.filter(product => {
                    if (!product) return false;
                    const searchFields = [
                        product.name,
                        product.category,
                        product.description,
                        product.id,
                        product.sku,
                        Array.isArray(product.tags) ? product.tags.join(' ') : ''
                    ];
                    return searchFields.some(field => {
                        if (field === undefined || field === null) return false;
                        return field.toString().toLowerCase().includes(normalizedTerm);
                    });
                })
                : [...products];

            if (filteredProducts.length === 0) {
                const emptyMessage = searchTerm
                    ? 'æœªæ‰¾åˆ°åŒ¹é…çš„äº§å“ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯'
                    : t('noProductsAddOrImport');
                adminProductsGrid.innerHTML = `<div class="no-products">${emptyMessage}</div>`;
                updatePaginationControls('products', 0);
                return;
            }

            const { items: paginatedProducts } = getPaginatedItems(filteredProducts, 'products');

            // åªæœ‰åœ¨æ²¡æœ‰æœç´¢è¿‡æ»¤æ—¶æ‰å…è®¸æ‹–æ”¾æ’åº
            const allowDrag = !normalizedTerm;

            adminProductsGrid.innerHTML = paginatedProducts.map((product, index) => `
                <div class="product-card ${allowDrag ? 'draggable' : ''}" 
                     data-product-id="${product.id}" 
                     data-product-index="${index}"
                     ${allowDrag ? 'draggable="true"' : ''}>
                    <div style="position: absolute; top: 10px; left: 10px; z-index: 10;">
                        <input type="checkbox" class="product-checkbox" data-product-id="${product.id}" 
                               style="width: 20px; height: 20px; cursor: pointer;">
                    </div>
                    ${allowDrag ? '<div style="position: absolute; top: 10px; right: 10px; z-index: 10; color: #999; font-size: 18px; cursor: move; padding: 5px;" title="æ‹–åŠ¨ä»¥è°ƒæ•´é¡ºåº"><i class="fas fa-grip-vertical"></i></div>' : ''}
                    <div class="product-image">
                        <img src="${getPrimaryProductImage(product)}" alt="${product.name || 'product image'}">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">
                            <span style="text-decoration: line-through; color: #999; margin-right: 10px;">${formatCurrency(product.price)}</span>
                            <span style="color: #e74c3c; font-weight: bold; font-size: 1.1em;">${formatCurrency(product.newPrice !== undefined ? product.newPrice : 0)}</span>
                        </div>
                        <div class="product-category">${getCategoryName(product.category)}</div>
                        <div class="product-stock">${t('stock')}: ${product.stock}${t('pieces')}</div>
                        <div class="product-actions">
                            <button class="btn btn-primary edit-product">ç¼–è¾‘</button>
                            <button class="btn btn-danger delete-product">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // æ·»åŠ æ‹–æ”¾åŠŸèƒ½ï¼ˆä»…åœ¨æ— æœç´¢è¿‡æ»¤æ—¶ï¼‰
            if (allowDrag) {
                initDragAndDrop(adminProductsGrid, paginatedProducts);
            }

            // æ·»åŠ ç¼–è¾‘äº‹ä»¶
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const productCard = this.closest('.product-card');
                    const productId = parseInt(productCard.getAttribute('data-product-id'));
                    const product = products.find(p => parseInt(p.id) === productId);
                    if (product) {
                        openEditProductModal(product);
                    }
                });
            });

            // åˆ é™¤äº‹ä»¶ä¿æŒä¸å˜...
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const productCard = this.closest('.product-card');
                    const productId = parseInt(productCard.getAttribute('data-product-id'));
                    const product = products.find(p => parseInt(p.id) === productId);

                    if (!product) {
                        customAlert(t('deleteFailedProductNotFound'), t('errorTitle'));
                        return;
                    }

                    if (confirm(t('confirmDeleteProduct').replace('{name}', product.name))) {
                        try {
                            const productName = product.name; // ä¿å­˜äº§å“åç§°ï¼Œå› ä¸ºåé¢ä¼šä»æ•°ç»„ä¸­åˆ é™¤
                            products = products.filter(p => parseInt(p.id) !== productId);
                            
                            // ç«‹å³æ›´æ–°UIï¼ˆæä¾›å³æ—¶è§†è§‰åé¦ˆï¼‰
                            productCard.style.transition = 'all 0.3s ease';
                            productCard.style.transform = 'scale(0.8)';
                            productCard.style.opacity = '0';

                            setTimeout(() => {
                                productCard.remove();
                                // é‡æ–°æ¸²æŸ“ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
                                renderAdminProducts();
                            }, 300);
                            
                            // ç­‰å¾…ä¿å­˜å’ŒåŒæ­¥å®Œæˆï¼ˆç®¡ç†å‘˜éœ€è¦ç¡®ä¿æ•°æ®å·²ä¸Šä¼ åˆ°äº‘ç«¯ï¼‰
                            saveProducts().then(() => {
                                // åŒæ­¥å®Œæˆåï¼Œå†æ¬¡æ¸²æŸ“ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
                                // ç”±äºä¿æŠ¤æœºåˆ¶ï¼Œç›‘å¬å™¨ä¸ä¼šè¦†ç›–è‡ªå·±çš„æ›´æ–°
                                setTimeout(() => {
                                    renderAdminProducts();
                                    showNotification(`æˆåŠŸåˆ é™¤äº§å“: ${productName}`, 'success');
                                }, 100);
                            }).catch((error) => {
                                console.error('åˆ é™¤äº§å“ååŒæ­¥å¤±è´¥:', error);
                                // å³ä½¿åŒæ­¥å¤±è´¥ï¼Œä¹Ÿä¿æŒUIçŠ¶æ€ï¼ˆäº§å“å·²ä»UIç§»é™¤ï¼‰
                                showNotification(`äº§å“å·²åˆ é™¤ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ`, 'warning');
                            });

                        } catch (error) {
                            showNotification('åˆ é™¤å¤±è´¥ï¼š' + error.message, 'error');
                        }
                    }
                });
            });
            
            // å¤é€‰æ¡†å˜åŒ–ç›‘å¬
            document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateBatchButtons);
            });

            updatePaginationControls('products', filteredProducts.length, renderAdminProducts);
        }

        // åˆå§‹åŒ–æ‹–æ”¾æ’åºåŠŸèƒ½
        function initDragAndDrop(container, paginatedProducts) {
            let draggedElement = null;
            let draggedIndex = -1;

            // ä¸ºæ‰€æœ‰å¯æ‹–æ‹½çš„äº§å“å¡ç‰‡æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            container.querySelectorAll('.product-card.draggable').forEach((card, index) => {
                // é˜»æ­¢å¤é€‰æ¡†å’ŒæŒ‰é’®è§¦å‘æ‹–æ‹½
                const checkbox = card.querySelector('.product-checkbox');
                const buttons = card.querySelectorAll('button');
                
                [checkbox, ...buttons].forEach(element => {
                    if (element) {
                        element.addEventListener('mousedown', function(e) {
                            e.stopPropagation();
                        });
                    }
                });
                
                // æ‹–æ‹½å¼€å§‹
                card.addEventListener('dragstart', function(e) {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯å¤é€‰æ¡†æˆ–æŒ‰é’®ï¼Œä¸è§¦å‘æ‹–æ‹½
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON' || e.target.closest('button') || e.target.closest('input')) {
                        e.preventDefault();
                        return false;
                    }
                    
                    draggedElement = this;
                    draggedIndex = parseInt(this.getAttribute('data-product-index'));
                    this.classList.add('dragging');
                    container.classList.add('dragging-active');
                    
                    // è®¾ç½®æ‹–æ‹½æ•°æ®
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                    e.dataTransfer.setData('text/plain', draggedIndex.toString());
                    
                    // è®¾ç½®æ‹–æ‹½å›¾åƒ
                    const dragImage = this.cloneNode(true);
                    dragImage.style.opacity = '0.8';
                    dragImage.style.transform = 'rotate(5deg)';
                    document.body.appendChild(dragImage);
                    e.dataTransfer.setDragImage(dragImage, e.offsetX, e.offsetY);
                    setTimeout(() => document.body.removeChild(dragImage), 0);
                });

                // æ‹–æ‹½ç»“æŸ
                card.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    container.classList.remove('dragging-active');
                    container.querySelectorAll('.product-card').forEach(c => {
                        c.classList.remove('drag-over');
                    });
                    draggedElement = null;
                    draggedIndex = -1;
                });

                // æ‹–æ‹½æ‚¬åœ
                card.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    if (this !== draggedElement) {
                        // ç§»é™¤å…¶ä»–å¡ç‰‡çš„ drag-over ç±»
                        container.querySelectorAll('.product-card').forEach(c => {
                            if (c !== draggedElement) {
                                c.classList.remove('drag-over');
                            }
                        });
                        
                        // æ·»åŠ å½“å‰å¡ç‰‡çš„ drag-over ç±»
                        this.classList.add('drag-over');
                    }
                });

                // æ‹–æ‹½è¿›å…¥
                card.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    if (this !== draggedElement) {
                        this.classList.add('drag-over');
                    }
                });

                // æ‹–æ‹½ç¦»å¼€
                card.addEventListener('dragleave', function(e) {
                    // åªæœ‰å½“é¼ æ ‡çœŸæ­£ç¦»å¼€å…ƒç´ æ—¶æ‰ç§»é™¤æ ·å¼
                    if (!this.contains(e.relatedTarget)) {
                        this.classList.remove('drag-over');
                    }
                });

                // æ”¾ç½®
                card.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (draggedElement && draggedElement !== this) {
                        const dropIndex = parseInt(this.getAttribute('data-product-index'));
                        
                        // è·å–å®é™…äº§å“ID
                        const draggedProductId = parseInt(draggedElement.getAttribute('data-product-id'));
                        const dropProductId = parseInt(this.getAttribute('data-product-id'));
                        
                        // åœ¨å®Œæ•´äº§å“æ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„äº§å“ç´¢å¼•
                        const draggedProductIndex = products.findIndex(p => parseInt(p.id) === draggedProductId);
                        const dropProductIndex = products.findIndex(p => parseInt(p.id) === dropProductId);
                        
                        if (draggedProductIndex !== -1 && dropProductIndex !== -1) {
                            // é‡æ–°æ’åºäº§å“æ•°ç»„
                            const [movedProduct] = products.splice(draggedProductIndex, 1);
                            products.splice(dropProductIndex, 0, movedProduct);
                            
                            // ç«‹å³æ›´æ–°UIï¼ˆæä¾›å³æ—¶è§†è§‰åé¦ˆï¼‰
                            renderAdminProducts();
                            
                            // ä¿å­˜äº§å“æ•°æ®å¹¶ç­‰å¾…åŒæ­¥å®Œæˆ
                            const saveResult = saveProducts();
                            if (saveResult && typeof saveResult.then === 'function') {
                                saveResult.then(() => {
                                    // åŒæ­¥å®Œæˆåï¼Œå†æ¬¡æ¸²æŸ“ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
                                    // ç”±äºä¿æŠ¤æœºåˆ¶ï¼Œç›‘å¬å™¨ä¸ä¼šè¦†ç›–è‡ªå·±çš„æ›´æ–°
                                    setTimeout(() => {
                                        renderAdminProducts();
                                        showNotification('äº§å“é¡ºåºå·²æ›´æ–°', 'success');
                                    }, 100);
                                }).catch((error) => {
                                    console.error('äº§å“é¡ºåºæ›´æ–°å¤±è´¥:', error);
                                    // åŒæ­¥å¤±è´¥æ—¶ï¼Œä¿æŒå½“å‰UIçŠ¶æ€ï¼ˆç”¨æˆ·å·²çœ‹åˆ°ç§»åŠ¨æ•ˆæœï¼‰
                                    showNotification('äº§å“é¡ºåºå·²æ›´æ–°ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'warning');
                                });
                            } else {
                                // å¦‚æœsaveProductsä¸æ˜¯Promiseï¼Œç›´æ¥æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                                showNotification('äº§å“é¡ºåºå·²æ›´æ–°', 'success');
                            }
                        }
                    }
                    
                    this.classList.remove('drag-over');
                });
            });
        }

        // æ‰“å¼€ç¼–è¾‘äº§å“æ¨¡æ€æ¡†
        function openEditProductModal(product) {
            console.log('ğŸ“ ç¼–è¾‘äº§å“:', product);

            if (!product) {
                customAlert(t('productDataError'), t('errorTitle'));
                return;
            }

            // å¡«å……è¡¨å•æ•°æ®
            document.getElementById('edit-product-id').value = product.id;
            document.getElementById('edit-product-name').value = product.name;
            document.getElementById('edit-product-price').value = product.price;
            document.getElementById('edit-product-new-price').value = product.newPrice || 0;
            document.getElementById('edit-product-stock').value = product.stock;
            document.getElementById('edit-product-category').value = product.category;
            document.getElementById('edit-product-description').value = product.description;
            const editProductLinkInput = document.getElementById('edit-product-link');
            if (editProductLinkInput) {
                // ç¡®ä¿æ¯æ¬¡æ‰“å¼€æ—¶éƒ½ä½¿ç”¨å½“å‰äº§å“çš„é“¾æ¥ï¼Œé¿å…æ²¿ç”¨ä¸Šä¸€æ¬¡çš„å€¼
                editProductLinkInput.value = product.redirectUrl || '';
            }
            const editProductAmazonInput = document.getElementById('edit-product-amazon-review-link');
            if (editProductAmazonInput) {
                // æ–°å¢ï¼šç”¨äºæ’°å†™äºšé©¬é€Šè¯„è®ºçš„è‡ªå®šä¹‰é“¾æ¥
                editProductAmazonInput.value = product.amazonReviewUrl || '';
            }

            const editImageInputs = document.querySelectorAll('.edit-product-image-url');
            const storedImages = Array.isArray(product.imageUrls) && product.imageUrls.length
                ? product.imageUrls
                : (product.image ? [product.image] : []);
            editImageInputs.forEach((input, index) => {
                input.value = storedImages[index] || '';
            });

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('edit-product-modal').style.display = 'flex';
        }

        // é€šç”¨çš„æ¨¡æ€æ¡†å…³é—­å‡½æ•°
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                console.log('âœ… å…³é—­æ¨¡æ€æ¡†:', modalId);
            } else {
                console.error('âŒ æœªæ‰¾åˆ°æ¨¡æ€æ¡†:', modalId);
            }
            
            // å…³é—­ä»»æ„æ¨¡æ€æ¡†æ—¶ï¼Œè§£é™¤å¯¹é¡µé¢æ»šåŠ¨çš„é”å®š
            document.body.classList.remove('modal-open');
        }

        // WhatsApp æŒ‡å¼•ï¼ˆä¸¤æ­¥ / å•æ­¥å…±ç”¨ï¼‰
        let whatsappGuideMode = 'amazon';
        let whatsappGuideStep = 0;
        let whatsappGuideEventsBound = false;
        let whatsappGuideAutoplayTimer = null;

        // æŒ‰æ¨¡å¼å­˜å‚¨å¼•å¯¼å®ŒæˆçŠ¶æ€ï¼Œé¿å…é‡å¤æ‰“æ‰°
        const whatsappGuideStorageKey = (mode) => `whatsappGuideCompleted-${mode}`;
        const isWhatsAppGuideCompleted = (mode) => localStorage.getItem(whatsappGuideStorageKey(mode)) === 'true';
        const markWhatsAppGuideCompleted = (mode) => localStorage.setItem(whatsappGuideStorageKey(mode), 'true');
        const resetWhatsAppGuideCompleted = (mode) => localStorage.removeItem(whatsappGuideStorageKey(mode));

        const whatsappGuideConfigs = {
            amazon: [
                {
                    title: 'How It Works',
                    desc: '4 quick steps to get your product and 100% cash back.',
                    list: [
                        { icon: 'fas fa-shopping-cart', text: 'Order the product on Amazon' },
                        { icon: 'fas fa-copy', text: 'Copy the message with your order number' },
                        { icon: 'fas fa-paper-plane', text: 'Send it to us via Messenger or WhatsApp' },
                        { icon: 'fas fa-money-bill-wave', text: 'Receive 100% cash back!' }
                    ]
                },
                {
                    title: 'Step 1 Â· Order on Amazon',
                    desc: 'Tap the Amazon button to open the product page and place your order.',
            
                    highlight: highlightAmazonStep
                },
                {
                    title: 'Step 2 Â· Get Your Cash Back',
                    descHtml: '<span class="guide-action">Message us to get your 100% cash back.</span><span class="guide-subtext">You can use Messenger or WhatsApp</span>',
                  
                    highlight: highlightTwoStepCopy
                },
                {
                    title: "You're All Set!",
                    descHtml: '<span class="guide-subtext">Now you know the process:</span><div class="guide-steps"><span class="guide-step-chip"><span class="step-number">1</span>Order on Amazon</span><span class="guide-step-chip"><span class="step-number">2</span>Message us for cash back</span></div>',
                  
                    highlight: highlightTwoStepSend
                }
            ],
            direct: [
                {
                    title: 'How this works',
                    desc: 'Confirm your order so we can ship now.',
                    list: [
                        { icon: 'fas fa-copy', text: 'Copy the message with your order number' },
                        { icon: 'fas fa-paper-plane', text: 'Send it to us via Messenger or WhatsApp' },
                        { icon: 'fas fa-shipping-fast', text: 'We ship your product immediately' }
                    ]
                },
                {
                    title: 'Step 1 Â· Copy your order',
                    desc: 'Copy the message so we can confirm your order.',
                    highlight: highlightSingleCopy
                },
                {
                    title: 'Step 2 Â· Send & confirm',
                    desc: 'Send the message and tap Confirmed so we can ship.',
                    highlight: highlightSingleSend
                }
            ]
        };

        function bindWhatsAppGuideEvents() {
            if (whatsappGuideEventsBound) return;
            const toggle = document.getElementById('whatsapp-guide-toggle');
            const nextBtn = document.getElementById('whatsapp-guide-next');

            if (toggle) {
                toggle.addEventListener('click', openWhatsAppGuide);
            }
            if (nextBtn) {
                nextBtn.addEventListener('click', nextWhatsAppGuideStep);
            }

            whatsappGuideEventsBound = true;
        }

        function setupWhatsAppGuide(mode, autoStart = false) {
            bindWhatsAppGuideEvents();
            whatsappGuideMode = mode === 'direct' ? 'direct' : 'amazon';
            whatsappGuideStep = 0;

            if (whatsappGuideAutoplayTimer) {
                clearTimeout(whatsappGuideAutoplayTimer);
                whatsappGuideAutoplayTimer = null;
            }

            const toggle = document.getElementById('whatsapp-guide-toggle');
            if (toggle) {
                toggle.style.display = 'flex';
                const label = toggle.querySelector('span');
                if (label) {
                    label.textContent = 'Guide';
                }
            }

            hideWhatsAppGuide(true);
            updateWhatsAppGuideContent();

            // é¦–æ¬¡è¿›å…¥å¯¹åº”æ¨¡å¼æ—¶è‡ªåŠ¨å¼¹å‡ºå¼•å¯¼
            if (autoStart && !isWhatsAppGuideCompleted(whatsappGuideMode)) {
                whatsappGuideAutoplayTimer = setTimeout(() => {
                    openWhatsAppGuide();
                }, 200);
            }
        }

        function openWhatsAppGuide() {
            const overlay = document.getElementById('whatsapp-guide-overlay');
            if (!overlay) return;

            overlay.style.display = 'flex';
            requestAnimationFrame(() => {
                overlay.classList.add('active');
            });

            whatsappGuideStep = 0;
            updateWhatsAppGuideContent();
        }
        function hideWhatsAppGuide(resetOnly = false) {
            if (whatsappGuideAutoplayTimer) {
                clearTimeout(whatsappGuideAutoplayTimer);
                whatsappGuideAutoplayTimer = null;
            }

            const overlay = document.getElementById('whatsapp-guide-overlay');
            if (overlay) {
                overlay.classList.remove('active');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 180);
            }

            clearWhatsAppGuideHighlights();

            if (resetOnly) {
                whatsappGuideStep = 0;
                updateWhatsAppGuideContent();
            }
        }

        function nextWhatsAppGuideStep() {
            const config = whatsappGuideConfigs[whatsappGuideMode] || [];
            if (!config.length) return;

            if (whatsappGuideStep < config.length - 1) {
                whatsappGuideStep += 1;
                updateWhatsAppGuideContent();
            } else {
                const modalBody = document.querySelector('.modal-body.whatsapp-modal-body');
                if (modalBody && typeof modalBody.scrollTo === 'function') {
                    modalBody.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
                completeWhatsAppGuide();
            }
        }

        function completeWhatsAppGuide(markComplete = true) {
            if (markComplete) {
                markWhatsAppGuideCompleted(whatsappGuideMode);
            }
            hideWhatsAppGuide();
        }

        function updateWhatsAppGuideContent() {
            const config = whatsappGuideConfigs[whatsappGuideMode] || [];
            if (!config.length) return;

            const stepData = config[whatsappGuideStep] || config[0];
            const total = config.length;

            const stepEl = document.getElementById('whatsapp-guide-step');
            const titleEl = document.getElementById('whatsapp-guide-title');
            const descEl = document.getElementById('whatsapp-guide-desc');
            const listEl = document.getElementById('whatsapp-guide-list');
            const progressEl = document.getElementById('whatsapp-guide-progress-fill');
            const nextBtn = document.getElementById('whatsapp-guide-next');

            if (stepEl) {
                stepEl.textContent = `Step ${whatsappGuideStep + 1} of ${total}`;
            }
            if (titleEl) {
                titleEl.textContent = stepData.title || '';
            }
            if (descEl) {
                if (stepData.descHtml) {
                    descEl.innerHTML = stepData.descHtml;
                } else {
                    descEl.textContent = stepData.desc || '';
                }
            }
            if (listEl) {
                if (stepData.list && stepData.list.length) {
                    listEl.innerHTML = stepData.list.map(item => `<div class="guide-item guide-step-item guide-dark-gray-text"><i class="${item.icon}"></i><span>${item.text}</span></div>`).join('');
                    listEl.style.display = 'flex';
                } else {
                    listEl.innerHTML = '';
                    listEl.style.display = 'none';
                }
            }
            if (progressEl) {
                const percent = ((whatsappGuideStep + 1) / total) * 100;
                progressEl.style.width = `${percent}%`;
            }
            if (nextBtn) {
                nextBtn.textContent = whatsappGuideStep >= total - 1 ? 'Start Now' : 'Next';
            }

            clearWhatsAppGuideHighlights();
            if (typeof stepData.highlight === 'function') {
                stepData.highlight();
            }
        }

        function clearWhatsAppGuideHighlights() {
            const highlighted = document.querySelectorAll('.whatsapp-guide-highlight, .whatsapp-guide-highlight-button');
            highlighted.forEach(el => {
                el.classList.remove('whatsapp-guide-highlight', 'whatsapp-guide-highlight-button');
            });
        }

        function applyWhatsAppGuideHighlight(target, isButton = false) {
            if (!target) return;
            target.classList.add('whatsapp-guide-highlight');
            if (isButton) {
                target.classList.add('whatsapp-guide-highlight-button');
            }
            if (typeof target.scrollIntoView === 'function') {
                target.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
            }
        }

        function highlightAmazonStep() {
            const step = document.getElementById('whatsapp-amazon-link');
            applyWhatsAppGuideHighlight(step);
        }

        function highlightTwoStepCopy() {
            const copyBox = document.getElementById('whatsapp-copy-container-two-step');
            applyWhatsAppGuideHighlight(copyBox);
        }

        function highlightTwoStepSend() {
            const sendBtn = document.getElementById('send-message-btn');
            applyWhatsAppGuideHighlight(sendBtn, true);
        }

        function highlightSingleCopy() {
            const copyBox = document.getElementById('whatsapp-copy-container-single');
            applyWhatsAppGuideHighlight(copyBox);
        }

        function highlightSingleSend() {
            const sendBtn = document.getElementById('sendBtn');
            applyWhatsAppGuideHighlight(sendBtn, true);
        }
        
        // æ˜¾ç¤ºWhatsAppæç¤ºæ¨¡æ€æ¡†
        // å­˜å‚¨å½“å‰è®¢å•å·ï¼ˆç”¨äºWhatsAppæ¶ˆæ¯ï¼‰
        let currentOrderIdForWhatsApp = null;
        let currentProductIdForWhatsApp = null;
        // å…³é—­æŒ‰é’®å»¶è¿Ÿè®¡æ—¶å™¨ï¼ˆç”¨äºä¸¤æ­¥/å•æ­¥å¼¹çª—ï¼‰
        let whatsappCloseBtnTimer = null;
        let whatsappCloseBtnTimerSingle = null;

        function showWhatsAppModal(orderId = null) {
            // æ£€æŸ¥è®¢å•çŠ¶æ€ï¼šå¦‚æœæ˜¯è¿è¾“ä¸­æˆ–å·²å®Œæˆï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (orderId) {
                const order = findOrderById(orderId);
                if (order && (order.status === 'shipping' || order.status === 'completed')) {
                    if (typeof customAlert === 'function') {
                        customAlert('You have already claimed this product.\n\nPlease select a different item.', 'Information');
                    } else if (typeof showNotification === 'function') {
                        showNotification('You have already claimed this product. Please select a different item.', 'warning');
                    } else {
                        alert('You have already claimed this product.\n\nPlease select a different item.');
                    }
                    return;
                }
            }
            
            const whatsappModal = document.getElementById('whatsapp-modal');
            const twoStepsModal = document.getElementById('whatsapp-modal-two-steps');
            const singleStepModal = document.getElementById('whatsapp-modal-single-step');
            const amazonLink = document.getElementById('whatsapp-amazon-link');
            currentProductIdForWhatsApp = null;

            if (whatsappModal) {
                // æ‰“å¼€æ¨¡æ€æ¡†æ—¶é”å®šé¡µé¢æ»šåŠ¨ï¼Œé˜²æ­¢èƒŒæ™¯äº§å“é¡µè·Ÿéšæ»‘åŠ¨
                document.body.classList.add('modal-open');
                // ä¿å­˜è®¢å•å·
                currentOrderIdForWhatsApp = orderId;
                
                // å°è¯•è¯»å–äº§å“è·³è½¬é“¾æ¥
                let hasRedirectUrl = false;
                let redirectLink = '';
                let guideMode = 'direct';
                
                if (orderId) {
                    // ä½¿ç”¨findOrderByIdå‡½æ•°æŸ¥æ‰¾è®¢å•ï¼Œè¿™æ ·å¯ä»¥ä»userOrdersæˆ–allOrdersä¸­æŸ¥æ‰¾
                    const order = findOrderById(orderId);
                    if (order) {
                        const linkedProductId = order.productId;
                        currentProductIdForWhatsApp = linkedProductId;
                        const product = Array.isArray(products) ? products.find(p => normalizeOrderId(p.id) === normalizeOrderId(linkedProductId)) : null;
                        redirectLink = product && product.redirectUrl ? product.redirectUrl : '';
                        hasRedirectUrl = !!redirectLink;
                    }
                }

                // æ ¹æ®æ˜¯å¦æœ‰è·³è½¬é“¾æ¥æ˜¾ç¤ºä¸åŒçš„æ¨¡æ€æ¡†æ ·å¼
                if (hasRedirectUrl && redirectLink) {
                    // æœ‰è·³è½¬é“¾æ¥ï¼šæ˜¾ç¤ºä¸¤æ­¥æµç¨‹æ ·å¼
                    if (twoStepsModal) {
                        twoStepsModal.style.display = 'block';
                    }
                    if (singleStepModal) {
                        singleStepModal.style.display = 'none';
                    }
                    // è®¾ç½®Amazoné“¾æ¥
                    if (amazonLink) {
                        amazonLink.href = redirectLink;
                    }
                    guideMode = 'amazon';
                    
                    // åˆå§‹åŒ–åˆ‡æ¢å™¨äº‹ä»¶
                    setTimeout(() => {
                        const messengerBtn = document.getElementById('messenger-switch-btn');
                        const whatsappBtn = document.getElementById('whatsapp-switch-btn');
                        const copyBtn = document.getElementById('copy-message-btn');
                        
                        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                        if (messengerBtn) {
                            messengerBtn.replaceWith(messengerBtn.cloneNode(true));
                        }
                        if (whatsappBtn) {
                            whatsappBtn.replaceWith(whatsappBtn.cloneNode(true));
                        }
                        if (copyBtn) {
                            copyBtn.replaceWith(copyBtn.cloneNode(true));
                        }
                        
                        // é‡æ–°ç»‘å®šäº‹ä»¶
                        const newMessengerBtn = document.getElementById('messenger-switch-btn');
                        const newWhatsappBtn = document.getElementById('whatsapp-switch-btn');
                        const newCopyBtn = document.getElementById('copy-message-btn');
                        
                        if (newMessengerBtn) {
                            newMessengerBtn.addEventListener('click', () => switchContactMethod('messenger'));
                        }
                        if (newWhatsappBtn) {
                            newWhatsappBtn.addEventListener('click', () => switchContactMethod('whatsapp'));
                        }
                        if (newCopyBtn) {
                            newCopyBtn.addEventListener('click', copyMessengerPrepayText);
                        }
                        
                        // æ›´æ–°æ¶ˆæ¯æ–‡æœ¬ï¼ˆåŒ…å«è®¢å•å·ï¼‰
                        const messageText = document.getElementById('messenger-prepay-text');
                        if (messageText) {
                            let message = contactMethods[currentContactMethod].message;
                            if (orderId) {
                                message = message.replace('XXX', String(orderId));
                            }
                            messageText.textContent = message;
                        }
                        
                        // åˆå§‹åŒ–å½“å‰è”ç³»æ–¹å¼çš„æ˜¾ç¤º
                        switchContactMethod(currentContactMethod);
                    }, 100);
                } else {
                    // æ— è·³è½¬é“¾æ¥ï¼šæ˜¾ç¤ºå•æ­¥æµç¨‹æ ·å¼
                    if (twoStepsModal) {
                        twoStepsModal.style.display = 'none';
                    }
                    if (singleStepModal) {
                        singleStepModal.style.display = 'block';
                        // ç¡®ä¿å•æ­¥æµç¨‹çš„çª—å£å®¹å™¨åœ¨é‡æ–°æ‰“å¼€æ—¶ç§»é™¤å…³é—­åŠ¨ç”»ç±»ï¼ˆé˜²æ­¢ä¸Šæ¬¡å…³é—­æ®‹ç•™å¯¼è‡´å†…å®¹ä¸å¯è§ï¼‰
                        const windowContainer = document.getElementById('windowContainer');
                        if (windowContainer) {
                            windowContainer.classList.remove('window-closed');
                            // é‡ç½®å¯èƒ½è¢«åŠ¨ç”»æˆ–æ ·å¼è®¾ç½®çš„å¯è§æ€§/ä¸é€æ˜åº¦ï¼ˆæ¢å¤é»˜è®¤ï¼‰
                            windowContainer.style.opacity = '';
                            windowContainer.style.visibility = '';
                        }
                        // å•æ­¥å¼¹çª—çš„å…³é—­æŒ‰é’® 15 ç§’åæ˜¾ç¤ºï¼ˆæ¯æ¬¡æ‰“å¼€éƒ½é‡æ–°è®¡æ—¶ï¼‰
                        const singleCloseBtn = document.getElementById('whatsapp-close-btn-single');
                        if (singleCloseBtn) {
                            singleCloseBtn.style.opacity = '0';
                            singleCloseBtn.style.visibility = 'hidden';
                            if (whatsappCloseBtnTimerSingle) {
                                clearTimeout(whatsappCloseBtnTimerSingle);
                            }
                            whatsappCloseBtnTimerSingle = setTimeout(() => {
                                singleCloseBtn.style.opacity = '1';
                                singleCloseBtn.style.visibility = 'visible';
                            }, 15000); // 15 ç§’åæ˜¾ç¤º
                        }
                    }
                    guideMode = 'direct';
                }

                whatsappModal.style.display = 'flex';

                // åˆå§‹åŒ–æŒ‡å¼•æ¨¡å¼ï¼ˆä¸¤æ­¥ = Amazonï¼Œä¸‹å•ç›´å‘ = directï¼‰ï¼Œé¦–æ¬¡è‡ªåŠ¨å¼¹å‡º
                setupWhatsAppGuide(guideMode, true);
                
                // å¦‚æœæ˜¯ä¸¤æ­¥æµç¨‹ï¼Œåˆå§‹åŒ–ç›¸å…³åŠŸèƒ½
                if (twoStepsModal && twoStepsModal.style.display !== 'none') {
                    // 15ç§’åæ˜¾ç¤ºå…³é—­æŒ‰é’®ï¼ˆæ¯æ¬¡æ‰“å¼€éƒ½é‡æ–°è®¡æ—¶ï¼‰
                    const closeBtn = document.getElementById('whatsapp-close-btn');
                    if (closeBtn) {
                        closeBtn.style.opacity = '0';
                        closeBtn.style.visibility = 'hidden';
                        if (whatsappCloseBtnTimer) {
                            clearTimeout(whatsappCloseBtnTimer);
                        }
                        whatsappCloseBtnTimer = setTimeout(() => {
                            closeBtn.style.opacity = '1';
                            closeBtn.style.visibility = 'visible';
                        }, 15000); // 15ç§’åæ˜¾ç¤º
                    }
                    
                    // åˆå§‹åŒ–ç§»åŠ¨ç«¯æ»šåŠ¨æç¤º
                    initMobileScrollHint();
                    
                    // é‡ç½®ç¡®è®¤æŒ‰é’®çŠ¶æ€
                    const sendBtn = document.getElementById('send-message-btn');
                    const confirmedBtn = document.getElementById('whatsapp-confirmed-btn');
                    if (sendBtn) {
                        sendBtn.style.display = 'flex';
                    }
                    if (confirmedBtn) {
                        confirmedBtn.style.display = 'none';
                    }
                    
                    // ç§»é™¤å…³é—­åŠ¨ç”»ç±»
                    twoStepsModal.classList.remove('window-closed');
                }
                
                // ç¡®ä¿å•æ­¥/ä¸¤æ­¥æµç¨‹çš„æŒ‰é’®çŠ¶æ€è¢«é‡ç½®ï¼ˆé˜²æ­¢ä¸Šæ¬¡å±•ç¤ºé—ç•™çš„å·²ç¡®è®¤çŠ¶æ€ï¼‰
                try {
                    const sendBtnTwoSteps = document.getElementById('send-message-btn');
                    const confirmedBtn = document.getElementById('whatsapp-confirmed-btn');
                    const sendBtnSingle = document.getElementById('sendBtn');
                    const confirmedBtnSingle = document.getElementById('single-step-confirmed-btn');

                    if (sendBtnTwoSteps) sendBtnTwoSteps.style.display = 'flex';
                    if (confirmedBtn) confirmedBtn.style.display = 'none';
                    if (sendBtnSingle) sendBtnSingle.style.display = 'flex';
                    if (confirmedBtnSingle) confirmedBtnSingle.style.display = 'none';
                } catch (err) {
                    console.warn('é‡ç½®WhatsAppæ¨¡æ€æŒ‰é’®çŠ¶æ€æ—¶å‡ºé”™:', err);
                }
            }
        }

        // å½“å‰é€‰æ‹©çš„è”ç³»æ–¹å¼
        let currentContactMethod = 'messenger';
        
        // è”ç³»æ–¹å¼é…ç½®
        const contactMethods = {
            messenger: {
                link: "https://m.me/beefreebie",
                iconClass: "fab fa-facebook-messenger",
                btnText: "Step 2: Send via Messenger",
                iconBg: "messenger-icon-container",
                btnClass: "messenger-btn",
                message: "Please confirm my order. The order number is XXX"
            },
            whatsapp: {
                link: "https://wa.me/12132756555?text=",
                iconClass: "fab fa-whatsapp",
                btnText: "Step 2: Send via WhatsApp",
                iconBg: "whatsapp-icon-container",
                btnClass: "whatsapp-btn",
                message: "Please confirm my order. The order number is XXX"
            }
        };
        
        // åˆ‡æ¢è”ç³»æ–¹å¼ï¼ˆåŒæ—¶æ”¯æŒä¸¤æ­¥å¼¹çª—å’Œå•æ­¥å¼¹çª—ï¼‰
        function switchContactMethod(method) {
            if (method === currentContactMethod) return;
            
            currentContactMethod = method;
            const contact = contactMethods[method];
            
            // æ›´æ–°ä¸¤æ­¥å¼¹çª—çš„æŒ‰é’®æ¿€æ´»çŠ¶æ€
            const messengerBtn = document.getElementById('messenger-switch-btn');
            const whatsappBtn = document.getElementById('whatsapp-switch-btn');
            if (messengerBtn && whatsappBtn) {
                if (method === 'messenger') {
                    messengerBtn.classList.add('active');
                    whatsappBtn.classList.remove('active');
                } else {
                    whatsappBtn.classList.add('active');
                    messengerBtn.classList.remove('active');
                }
            }

            // æ›´æ–°å•æ­¥å¼¹çª—çš„æŒ‰é’®æ¿€æ´»çŠ¶æ€ï¼ˆå‚è€ƒæ–‡ä»¶é€»è¾‘ï¼‰
            const singleStepButtons = document.querySelectorAll('#whatsapp-modal-single-step .contact-btn');
            singleStepButtons.forEach(btn => {
                if (btn.dataset.option === method) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // æ›´æ–°ä¸¤æ­¥å¼¹çª—çš„å›¾æ ‡ï¼ˆä¿ç•™ Step 1 çš„ Amazon å›¾æ ‡ï¼‰
            const stepIconContainer = document.getElementById('step-icon-container');
            const stepIcon = document.getElementById('step-icon');
            if (stepIconContainer && stepIcon) {
                stepIconContainer.className = `step-icon-container ${contact.iconBg}`;
                stepIcon.className = `step-icon ${contact.iconClass}`;
            }
            
            // æ›´æ–°å•æ­¥å¼¹çª—çš„å›¾æ ‡ï¼ˆå‚è€ƒæ–‡ä»¶é€»è¾‘ï¼šç›´æ¥è®¾ç½®èƒŒæ™¯æ¸å˜ï¼‰
            const singleStepIconContainer = document.getElementById('single-step-icon-container');
            const singleStepIcon = document.getElementById('single-step-icon');
            if (singleStepIconContainer && singleStepIcon) {
                // å‚è€ƒæ–‡ä»¶ä½¿ç”¨ç›´æ¥è®¾ç½®èƒŒæ™¯æ¸å˜çš„æ–¹å¼
                singleStepIconContainer.style.background = method === 'messenger' 
                    ? 'linear-gradient(135deg, #006AFF 0%, #0084FF 100%)'
                    : 'linear-gradient(135deg, #25D366 0%, #128C7E 100%)';
                singleStepIcon.className = `step-icon ${contact.iconClass}`;
                
                // è§¦å‘åˆ‡æ¢åŠ¨ç”»ï¼ˆå‚è€ƒæ–‡ä»¶é€»è¾‘ï¼‰
                singleStepIconContainer.style.animation = 'none';
                setTimeout(() => {
                    singleStepIconContainer.style.animation = 'float 4s ease-in-out infinite';
                }, 10);
            }
            
            // æ›´æ–°æ¶ˆæ¯æ–‡æœ¬ï¼ˆä¸¤æ­¥å¼¹çª—ï¼‰
            const messageText = document.getElementById('messenger-prepay-text');
            // æ›´æ–°æ¶ˆæ¯æ–‡æœ¬ï¼ˆå•æ­¥å¼¹çª—ï¼‰
            const messageTextSingle = document.getElementById('messenger-prepay-text-single');
            const updateMessageText = (el) => {
                if (!el) return;
                let message = contact.message;
                if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                    // æ›¿æ¢ XXX æˆ– XXXXX å ä½ç¬¦
                    message = message.replace(/XXX+|XXXXX+/g, String(currentOrderIdForWhatsApp));
                } else {
                    // å¦‚æœæ²¡æœ‰è®¢å•å·ï¼Œä¿æŒå ä½ç¬¦ä¸º XXXXXï¼ˆä¸å‚è€ƒæ–‡ä»¶ä¸€è‡´ï¼‰
                    message = message.replace(/XXX+/g, 'XXXXX');
                }
                el.textContent = message;
            };
            updateMessageText(messageText);
            updateMessageText(messageTextSingle);
            
            // æ›´æ–°å‘é€æŒ‰é’®ï¼ˆä¸¤æ­¥å¼¹çª—ï¼‰
            const sendBtnTwoSteps = document.getElementById('send-message-btn');
            if (sendBtnTwoSteps) {
                let link = contact.link;
                if (method === 'whatsapp') {
                    // WhatsAppéœ€è¦é¢„å¡«å……æ¶ˆæ¯
                    let message = contact.message;
                    if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                        message = message.replace('XXX', String(currentOrderIdForWhatsApp));
                    }
                    link = contact.link + encodeURIComponent(message);
                }
                sendBtnTwoSteps.href = link;
                sendBtnTwoSteps.className = `action-btn ${contact.btnClass}`;
                sendBtnTwoSteps.innerHTML = `<i class="${contact.iconClass}"></i> ${contact.btnText}`;
                
                // é‡ç½®ç¡®è®¤æŒ‰é’®çŠ¶æ€
                const confirmedBtn = document.getElementById('whatsapp-confirmed-btn');
                if (confirmedBtn) {
                    sendBtnTwoSteps.style.display = 'flex';
                    confirmedBtn.style.display = 'none';
                }
            }
            
            // æ›´æ–°å‘é€æŒ‰é’®ï¼ˆå•æ­¥å¼¹çª— - å‚è€ƒæ–‡ä»¶é€»è¾‘ï¼‰
            const sendBtnSingle = document.getElementById('sendBtn');
            if (sendBtnSingle) {
                let link = contact.link;
                if (method === 'whatsapp') {
                    // WhatsAppéœ€è¦é¢„å¡«å……æ¶ˆæ¯
                    let message = contact.message;
                    if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                        message = message.replace(/XXX+|XXXXX+/g, String(currentOrderIdForWhatsApp));
                    } else {
                        message = message.replace(/XXX+/g, 'XXXXX');
                    }
                    link = contact.link + encodeURIComponent(message);
                }
                // å‚è€ƒæ–‡ä»¶é€»è¾‘ï¼šç›´æ¥æ›´æ–°hrefã€classNameå’ŒinnerHTML
                sendBtnSingle.href = link;
                sendBtnSingle.className = `send-btn ${contact.btnClass}`;
                sendBtnSingle.innerHTML = `<i class="${contact.iconClass}"></i> ${contact.btnText}`;
                
                // é‡ç½®ç¡®è®¤æŒ‰é’®çŠ¶æ€ï¼ˆå‚è€ƒæ–‡ä»¶é€»è¾‘ï¼‰
                const confirmedBtnSingle = document.getElementById('single-step-confirmed-btn');
                if (confirmedBtnSingle) {
                    sendBtnSingle.style.display = 'flex';
                    confirmedBtnSingle.style.display = 'none';
                }
            }
        }
        
        // å¤åˆ¶ Messenger é¢„ä»˜æ¬¾æ¶ˆæ¯
        function copyMessengerPrepayText() {
            try {
                const textElement = document.getElementById('messenger-prepay-text');
                if (!textElement) return;

                // å¦‚æœæœ‰å½“å‰è®¢å•å·ï¼ŒåŠ¨æ€æ›¿æ¢å ä½ç¬¦ï¼Œå¹¶å»æ‰å‰åç©ºç™½
                let rawText = textElement.innerText || textElement.textContent || '';
                if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                    rawText = rawText.replace('XXX', String(currentOrderIdForWhatsApp));
                }
                const text = rawText.trim();

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCopySuccess();
                    });
                } else {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = text;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showCopySuccess();
                }

                // æ˜¾ç¤ºåº•éƒ¨æç¤ºæ°”æ³¡
                const toast = document.getElementById('messenger-copy-toast');
                if (toast) {
                    toast.classList.add('show');
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, 1800);
                }

                // æ›´æ–°å¤åˆ¶æŒ‰é’®çŠ¶æ€
                const copyBtn = document.getElementById('copy-message-btn');
                if (copyBtn) {
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    copyBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }, 2000);
                }

                console.log('âœ… æ¶ˆæ¯å·²å¤åˆ¶');
            } catch (e) {
                console.warn('å¤åˆ¶æ¶ˆæ¯å¤±è´¥:', e);
            }
        }
        
        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
        function showCopySuccess() {
            let successToast = document.getElementById('copy-success-toast');
            if (!successToast) {
                successToast = document.createElement('div');
                successToast.id = 'copy-success-toast';
                successToast.className = 'copy-success';
                successToast.innerHTML = '<i class="fas fa-check-circle"></i><span>Message copied to clipboard!</span>';
                document.body.appendChild(successToast);
            }
            successToast.style.display = 'flex';
            setTimeout(() => {
                successToast.style.display = 'none';
            }, 3000);
        }

        // å•æ­¥æµç¨‹å¤åˆ¶æ¶ˆæ¯
        function copySingleStepMessage() {
            try {
                const textElement = document.getElementById('messenger-prepay-text-single');
                if (!textElement) return;

                // å¦‚æœæœ‰å½“å‰è®¢å•å·ï¼ŒåŠ¨æ€æ›¿æ¢å ä½ç¬¦ï¼Œå¹¶å»æ‰å‰åç©ºç™½
                let rawText = textElement.innerText || textElement.textContent || '';
                if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                    // æ›¿æ¢ XXX æˆ– XXXXX å ä½ç¬¦
                    rawText = rawText.replace(/XXX+|XXXXX+/g, String(currentOrderIdForWhatsApp));
                }
                const text = rawText.trim();

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCopySuccess();
                    });
                } else {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = text;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showCopySuccess();
                }

                // æ˜¾ç¤ºåº•éƒ¨æç¤ºæ°”æ³¡
                const toast = document.getElementById('messenger-copy-toast');
                if (toast) {
                    toast.classList.add('show');
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, 1800);
                }

                // æ›´æ–°å¤åˆ¶æŒ‰é’®çŠ¶æ€
                const copyBtn = document.querySelector('#whatsapp-modal-single-step .copy-btn');
                if (copyBtn) {
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    copyBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }, 2000);
                }

                console.log('âœ… å•æ­¥æµç¨‹æ¶ˆæ¯å·²å¤åˆ¶');
            } catch (e) {
                console.warn('å¤åˆ¶å•æ­¥æµç¨‹æ¶ˆæ¯å¤±è´¥:', e);
            }
        }

        // å…³é—­ä¸¤æ­¥æµç¨‹æ¨¡æ€çª—å£
        function closeWhatsAppModalWindow() {
            const twoStepsModal = document.getElementById('whatsapp-modal-two-steps');
            const singleStepModal = document.getElementById('whatsapp-modal-single-step');
            const whatsappModal = document.getElementById('whatsapp-modal');
            hideWhatsAppGuide(true);
            const guideToggle = document.getElementById('whatsapp-guide-toggle');
            if (guideToggle) {
                guideToggle.style.display = 'none';
            }
            // ç«‹å³æ¸…é™¤å…³é—­æŒ‰é’®è®¡æ—¶å™¨å¹¶éšè—å…³é—­æŒ‰é’®ï¼Œé˜²æ­¢æ®‹ç•™å®šæ—¶å™¨åœ¨åå°è§¦å‘
            const closeBtnImmediate = document.getElementById('whatsapp-close-btn');
            const singleCloseBtnImmediate = document.getElementById('whatsapp-close-btn-single');
            if (whatsappCloseBtnTimer) {
                clearTimeout(whatsappCloseBtnTimer);
                whatsappCloseBtnTimer = null;
            }
            if (whatsappCloseBtnTimerSingle) {
                clearTimeout(whatsappCloseBtnTimerSingle);
                whatsappCloseBtnTimerSingle = null;
            }
            if (closeBtnImmediate) {
                closeBtnImmediate.style.opacity = '0';
                closeBtnImmediate.style.visibility = 'hidden';
            }
            if (singleCloseBtnImmediate) {
                singleCloseBtnImmediate.style.opacity = '0';
                singleCloseBtnImmediate.style.visibility = 'hidden';
            }
            
            if (twoStepsModal) {
                // æ·»åŠ å…³é—­åŠ¨ç”»
                twoStepsModal.classList.add('window-closed');
                
                // éšè—æ¨¡æ€çª—å£
                setTimeout(() => {
                    twoStepsModal.style.display = 'none';
                    // å…³é—­å¤–å±‚é®ç½©å±‚ï¼Œç§»é™¤æ¨¡ç³Šæ•ˆæœ
                    if (whatsappModal) {
                        whatsappModal.style.display = 'none';
                    }
                    // ç§»é™¤ modal-open ç±»ï¼Œæ¢å¤é¡µé¢æ»šåŠ¨
                    document.body.classList.remove('modal-open');
                }, 400);
            }
            
            // å¦‚æœå•æ­¥æµç¨‹æ¨¡æ€æ¡†æ˜¯æ‰“å¼€çš„ï¼Œä¹Ÿå…³é—­å®ƒ
            if (singleStepModal && singleStepModal.style.display !== 'none') {
                singleStepModal.style.display = 'none';
                // å…³é—­å¤–å±‚é®ç½©å±‚ï¼Œç§»é™¤æ¨¡ç³Šæ•ˆæœ
                if (whatsappModal) {
                    whatsappModal.style.display = 'none';
                }
                // ç§»é™¤ modal-open ç±»ï¼Œæ¢å¤é¡µé¢æ»šåŠ¨
                document.body.classList.remove('modal-open');
            }
        }
        
        // åˆå§‹åŒ–ç§»åŠ¨ç«¯æ»šåŠ¨æç¤º
        function initMobileScrollHint() {
            const mobileScrollHint = document.getElementById('whatsapp-mobile-scroll-hint');
            if (!mobileScrollHint || window.innerWidth > 768) return;
            
            function handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // å½“ç”¨æˆ·å‘ä¸‹æ»šåŠ¨ä¸€å®šè·ç¦»åéšè—æç¤º
                if (scrollTop > 50) {
                    mobileScrollHint.style.opacity = '0';
                    mobileScrollHint.style.transform = 'translateY(10px)';
                    mobileScrollHint.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    
                    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
                    window.removeEventListener('scroll', handleScroll);
                    window.removeEventListener('touchmove', handleScroll);
                }
            }
            
            window.addEventListener('scroll', handleScroll);
            window.addEventListener('touchmove', handleScroll);
            
            // æ»šåŠ¨æç¤ºä¿æŒ10ç§’é’Ÿ
            setTimeout(() => {
                if (mobileScrollHint.style.opacity !== '0') {
                    mobileScrollHint.style.opacity = '0';
                    mobileScrollHint.style.transform = 'translateY(10px)';
                    mobileScrollHint.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                }
            }, 10000); // 10ç§’åéšè—
        }
        
        // æ‰“å¼€ Messenger/WhatsApp é¢„ä»˜æ¬¾èŠå¤©
        function openMessengerPrepay() {
            const contact = contactMethods[currentContactMethod];
            let link = contact.link;
            
            // å¦‚æœæ˜¯WhatsAppï¼Œéœ€è¦é¢„å¡«å……æ¶ˆæ¯
            if (currentContactMethod === 'whatsapp') {
                let message = contact.message;
                if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                    message = message.replace('XXX', String(currentOrderIdForWhatsApp));
                }
                link = contact.link + encodeURIComponent(message);
            }
            
            // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(link, '_blank');
            
            // ä¸å…³é—­æ¨¡æ€çª—å£ï¼Œè€Œæ˜¯æ˜¾ç¤ºç¡®è®¤æŒ‰é’®ï¼ˆä¸¤æ­¥æµç¨‹å’Œå•æ­¥æµç¨‹éƒ½æ”¯æŒï¼‰
            const sendBtnTwoSteps = document.getElementById('send-message-btn');
            const confirmedBtn = document.getElementById('whatsapp-confirmed-btn');
            const sendBtnSingle = document.getElementById('sendBtn');
            const confirmedBtnSingle = document.getElementById('single-step-confirmed-btn');
            
            // ä¸¤æ­¥æµç¨‹
            if (sendBtnTwoSteps && confirmedBtn) {
                sendBtnTwoSteps.style.display = 'none';
                confirmedBtn.style.display = 'flex';
            }
            
            // å•æ­¥æµç¨‹
            if (sendBtnSingle && confirmedBtnSingle) {
                sendBtnSingle.style.display = 'none';
                confirmedBtnSingle.style.display = 'flex';
            }
        }
        
        // å¤„ç†å•æ­¥æµç¨‹å‘é€æŒ‰é’®ç‚¹å‡»ï¼ˆå‚è€ƒ"éäºšé©¬é€Šä¸‹å•æ­¥éª¤.html"çš„é€»è¾‘ï¼‰
        function handleSingleStepSend(e) {
            if (e) {
                e.preventDefault();
            }
            
            const sendBtn = document.getElementById('sendBtn');
            if (!sendBtn) return;
            
            const contact = contactMethods[currentContactMethod];
            let link = contact.link;
            
            // å¦‚æœæ˜¯WhatsAppï¼Œéœ€è¦é¢„å¡«å……æ¶ˆæ¯
            if (currentContactMethod === 'whatsapp') {
                let message = contact.message;
                if (typeof currentOrderIdForWhatsApp !== 'undefined' && currentOrderIdForWhatsApp) {
                    message = message.replace(/XXX+|XXXXX+/g, String(currentOrderIdForWhatsApp));
                } else {
                    message = message.replace(/XXX+/g, 'XXXXX');
                }
                link = contact.link + encodeURIComponent(message);
            }
            
            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(link, '_blank');
            
            // éšè—å‘é€æŒ‰é’®ï¼Œæ˜¾ç¤ºå·²ç¡®è®¤æŒ‰é’®
            const confirmedBtnSingle = document.getElementById('single-step-confirmed-btn');
            if (sendBtn && confirmedBtnSingle) {
                sendBtn.style.display = 'none';
                confirmedBtnSingle.style.display = 'flex';
            }
        }
        
        // å¤„ç†å•æ­¥æµç¨‹ç¡®è®¤æŒ‰é’®ç‚¹å‡»ï¼ˆå‚è€ƒ"éäºšé©¬é€Šä¸‹å•æ­¥éª¤.html"çš„é€»è¾‘ï¼‰
        function handleSingleStepConfirmed() {
            const windowContainer = document.getElementById('windowContainer');
            if (!windowContainer) return;
            
            // æ·»åŠ å…³é—­åŠ¨ç”»
            windowContainer.classList.add('window-closed');
            
            // å»¶è¿Ÿå…³é—­çª—å£
            setTimeout(() => {
                closeWhatsAppModalWindow();
            }, 400);
        }

        // å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†
        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            console.log('âœ… å·²å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†');
            document.body.classList.remove('modal-open');

            hideWhatsAppGuide(true);
            const guideToggle = document.getElementById('whatsapp-guide-toggle');
            if (guideToggle) {
                guideToggle.style.display = 'none';
            }
        }
        // åˆ†ç±»åç§°æ˜ å°„
        function getCategoryName(category) {
            const categoryMap = {
                'electronics': 'Electronics',
                'home': 'Home & Living',
                'clothing': 'Clothing & Shoes',
                'beauty': 'Beauty & Skincare',
                'sports': 'è¿åŠ¨æˆ·å¤–',
                'other': 'å…¶ä»–'
            };
            return categoryMap[category] || category;
        }

        // æ˜¾ç¤ºåˆ é™¤æˆåŠŸæ¶ˆæ¯
        function showDeleteSuccess(productName) {
            // åˆ›å»ºè‡ªå®šä¹‰æç¤ºæ¶ˆæ¯
            const successMsg = document.createElement('div');
            successMsg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--secondary);
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            successMsg.innerHTML = `
                <i class="fas fa-check-circle"></i>
                æˆåŠŸåˆ é™¤äº§å“: ${productName}
            `;

            document.body.appendChild(successMsg);

            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }

        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            .no-products {
                text-align: center;
                padding: 40px;
                color: var(--gray);
                font-size: 18px;
                grid-column: 1 / -1;
            }
        `;
        document.head.appendChild(style);

        // å¤„ç†Excelæ–‡ä»¶
        function handleExcelFile(file) {
            const fileName = file.name;

            if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
                customAlert(t('pleaseUploadExcel'), t('infoTitle'));
                return;
            }

            const excelUploadArea = document.getElementById('excel-upload-area');
            const setStatus = (state, title, message, iconHtml = '') => {
                excelUploadArea.innerHTML = `
                    ${iconHtml || ''}
                    <h3>${title}</h3>
                    <p>${message}</p>
                    ${state === 'success' || state === 'error' ? '<small>ç‚¹å‡»å¯é‡æ–°ä¸Šä¼ </small>' : ''}
                `;
                excelUploadArea.classList.remove('processing', 'success', 'error');
                if (state) {
                    excelUploadArea.classList.add(state);
                }
            };

            setStatus('processing', 'æ­£åœ¨è§£æExcelæ–‡ä»¶...', fileName, '<i class="fas fa-spinner fa-spin"></i>');

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const workbook = XLSX.read(event.target.result, { type: 'array' });
                    const parsedData = extractProductsFromWorkbook(workbook);

                    if (!parsedData.length) {
                        throw new Error(t('noProductDataDetected'));
                    }

                    setStatus('success', t('parseSuccess') || 'è§£ææˆåŠŸï¼', t('foundProducts')?.replace('{count}', parsedData.length) || `å‘ç° ${parsedData.length} ä¸ªäº§å“`, '<i class="fas fa-check-circle" style="color: #2ecc71;"></i>');
                    showExcelDataPreview(parsedData);
                } catch (error) {
                    console.error('è§£æExcelå¤±è´¥:', error);
                    setStatus('error', t('parseFailed'), error.message || t('checkExcelFormat'), '<i class="fas fa-times-circle" style="color: #e74c3c;"></i>');
                }
            };

            reader.onerror = () => {
                setStatus('error', t('readFailed'), t('fileReadError'), '<i class="fas fa-times-circle" style="color: #e74c3c;"></i>');
            };

            reader.readAsArrayBuffer(file);
        }

        function extractProductsFromWorkbook(workbook) {
            if (!workbook || !workbook.SheetNames || !workbook.SheetNames.length) {
                throw new Error('Excelæ–‡ä»¶ä¸­æ²¡æœ‰å¯ç”¨çš„å·¥ä½œè¡¨');
            }

            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
            return convertRowsToProducts(rows);
        }

        function convertRowsToProducts(rows) {
            if (!Array.isArray(rows) || rows.length < 2) {
                throw new Error('Excelä¸­æ²¡æœ‰æœ‰æ•ˆçš„æ•°æ®è¡Œ');
            }

            const headerRow = rows[0].map(cell => cell?.toString().trim());
            const headerInfo = buildHeaderInfo(headerRow, rows[1]);

            if (headerInfo.name === -1) {
                throw new Error('è¯·åœ¨Excelä¸­æ·»åŠ â€œäº§å“åç§°â€åˆ—');
            }
            if (!headerInfo.imageIndexes.length) {
                throw new Error('è¯·åœ¨Excelä¸­è‡³å°‘æä¾›ä¸€åˆ—â€œå›¾ç‰‡URLâ€');
            }

            const parsedProducts = [];

            rows.slice(1).forEach((row, rowIdx) => {
                if (!row || row.every(cell => !String(cell || '').trim())) {
                    return;
                }

                const name = getCellValue(row, headerInfo.name) || `æœªå‘½åäº§å“ ${rowIdx + 1}`;
                const price = parseNumberCell(getCellValue(row, headerInfo.price));
                const newPrice = parseNumberCell(getCellValue(row, headerInfo.newPrice));
                const stock = parseStockCell(getCellValue(row, headerInfo.stock));
                const category = normalizeCategoryName(getCellValue(row, headerInfo.category));
                const description = getCellValue(row, headerInfo.description) || 'æš‚æ— æè¿°';
                const imageUrls = extractImageUrlsFromRow(row, headerInfo.imageIndexes);

                if (!imageUrls.length) {
                    console.warn(`ç¬¬ ${rowIdx + 2} è¡Œæ²¡æœ‰æ£€æµ‹åˆ°æœ‰æ•ˆå›¾ç‰‡URLï¼Œå·²è·³è¿‡è¯¥äº§å“ã€‚`);
                    return;
                }

                const product = {
                    name,
                    price: Number.isFinite(price) ? price : 0,
                    newPrice: Number.isFinite(newPrice) ? newPrice : (Number.isFinite(price) ? price : 0),
                    stock: Number.isFinite(stock) ? stock : 0,
                    category,
                    description,
                    image: imageUrls[0],
                    imageUrls
                };

                for (let i = 1; i <= 6; i++) {
                    product[`imageUrl${i}`] = imageUrls[i - 1] || '';
                }

                parsedProducts.push(product);
            });

            if (!parsedProducts.length) {
                throw new Error('æ‰€æœ‰æ•°æ®è¡Œå‡æ— æ•ˆï¼Œè¯·ç¡®è®¤å¡«å†™äº†äº§å“åç§°ä¸å›¾ç‰‡URL');
            }

            return parsedProducts;
        }

        function buildHeaderInfo(headers, sampleRow = []) {
            const normalizedHeaders = headers.map(h => (h || '').toString().trim().toLowerCase());

            const info = {
                name: findHeaderIndex(normalizedHeaders, ['äº§å“åç§°', 'å•†å“åç§°', 'name', 'title']),
                price: findHeaderIndex(normalizedHeaders, ['äº§å“ä»·æ ¼', 'ä»·æ ¼', 'åŸä»·', 'price']),
                newPrice: findHeaderIndex(normalizedHeaders, ['ç°ä»·', 'ä¿ƒé”€ä»·', 'æ–°ä»·æ ¼', 'æŠ˜åä»·', 'newprice', 'saleprice']),
                stock: findHeaderIndex(normalizedHeaders, ['åº“å­˜', 'stock', 'æ•°é‡', 'qty']),
                category: findHeaderIndex(normalizedHeaders, ['åˆ†ç±»', 'å“ç±»', 'category']),
                description: findHeaderIndex(normalizedHeaders, ['æè¿°', 'è¯¦æƒ…', 'è¯´æ˜', 'description', 'detail']),
                imageIndexes: []
            };

            if (info.name === -1 && headers.length > 1) info.name = 1;
            if (info.price === -1) info.price = 0;

            normalizedHeaders.forEach((header, idx) => {
                if (/å›¾ç‰‡.*url/.test(header) || /image.*url/.test(header) || /^url\d*/.test(header)) {
                    info.imageIndexes.push(idx);
                }
            });

            // æ— è®ºæ˜¯å¦åŒ¹é…åˆ°è¡¨å¤´ï¼Œåªè¦ç¤ºä¾‹è¡Œä¸­æœ‰ URLï¼Œå°±æŠŠè¯¥åˆ—è§†ä¸ºå›¾ç‰‡åˆ—ï¼ˆé¿å…åªè¯†åˆ«åˆ°â€œå›¾ç‰‡URL1â€ï¼‰
            if (Array.isArray(sampleRow)) {
                sampleRow.forEach((cell, idx) => {
                    const value = (cell || '').toString().trim();
                    if (/^https?:\/\//i.test(value) && !info.imageIndexes.includes(idx)) {
                        info.imageIndexes.push(idx);
                    }
                });
            }

            info.imageIndexes = info.imageIndexes.slice(0, 6);
            return info;
        }

        function findHeaderIndex(headers, keywords) {
            for (const keyword of keywords) {
                const normalizedKeyword = keyword.toLowerCase();
                const index = headers.findIndex(header => header === normalizedKeyword || header.includes(normalizedKeyword));
                if (index !== -1) {
                    return index;
                }
            }
            return -1;
        }

        function getCellValue(row, index) {
            if (!row || index === -1 || index >= row.length) {
                return '';
            }
            const cell = row[index];
            if (cell === undefined || cell === null) {
                return '';
            }
            return typeof cell === 'string' ? cell.trim() : cell.toString().trim();
        }

        function parseNumberCell(value) {
            if (value === '' || value === null || value === undefined) return NaN;
            if (typeof value === 'number') return value;
            const sanitized = value.replace(/[^\d.,-]/g, '').replace(/,/g, '');
            return sanitized ? parseFloat(sanitized) : NaN;
        }

        function parseStockCell(value) {
            if (value === '' || value === null || value === undefined) return NaN;
            if (typeof value === 'number') return value;
            const sanitized = value.replace(/[^\d-]/g, '');
            return sanitized ? parseInt(sanitized, 10) : NaN;
        }

        function normalizeCategoryName(value) {
            if (!value) return 'other';
            const text = value.toString().trim().toLowerCase();
            if (!text) return 'other';
            if (text.includes('ç”µ') || text.includes('æ•°ç ') || text.includes('tech') || text.includes('digital')) return 'electronics';
            if (text.includes('å®¶') || text.includes('home')) return 'home';
            if (text.includes('æœ') || text.includes('clo') || text.includes('é‹')) return 'clothing';
            if (text.includes('ç¾') || text.includes('beauty')) return 'beauty';
            if (text.includes('è¿') || text.includes('sport')) return 'sports';
            return text;
        }

        function extractImageUrlsFromRow(row, imageIndexes) {
            const urls = [];
            imageIndexes.forEach(idx => {
                const raw = getCellValue(row, idx);
                if (!raw) return;

                raw.split(/[\s\n\r]+/).forEach(segment => {
                    const candidate = segment.trim();
                    if (/^https?:\/\//i.test(candidate) && !urls.includes(candidate)) {
                        urls.push(candidate);
                    }
                });
            });
            return urls.slice(0, 6);
        }

        // å¤åˆ¶è®¢å•å·
        function copyOrderId(orderId) {
            // ä½¿ç”¨ç°ä»£ Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(orderId).then(() => {
                    showNotification(t('orderIdCopied') || 'è®¢å•å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                    fallbackCopyOrderId(orderId);
                });
            } else {
                // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                fallbackCopyOrderId(orderId);
            }
        }

        // é™çº§å¤åˆ¶æ–¹æ³•ï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰
        function fallbackCopyOrderId(orderId) {
            const textArea = document.createElement('textarea');
            textArea.value = orderId;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification(t('orderIdCopied') || 'è®¢å•å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            }
            document.body.removeChild(textArea);
        }

        // å†æ¬¡ç¡®è®¤è®¢å•ï¼šæ”¹ä¸ºæ˜¾ç¤ºç¡®è®¤å¼¹çª—ï¼ˆæ ¹æ®äº§å“æ˜¯å¦æœ‰è·³è½¬é“¾æ¥å†³å®šå•æ­¥æˆ–ä¸¤æ­¥æµç¨‹ï¼‰
        function confirmOrderAgain(orderId) {
            // å°è¯•æŸ¥æ‰¾è®¢å•ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æç¤º
            const order = findOrderById(orderId) || (Array.isArray(userOrders) ? userOrders.find(o => o.id === orderId) : null);
            if (!order) {
                if (typeof showNotification === 'function') {
                    showNotification(t('orderNotFound') || 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                } else {
                    alert(t('orderNotFound') || 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯');
                }
                return;
            }

            // ä½¿ç”¨å·²æœ‰çš„ showWhatsAppModal å‡½æ•°å±•ç¤ºç›¸åº”çš„å¼¹çª—ï¼ˆä¸¤æ­¥æˆ–å•æ­¥ï¼‰
            if (typeof showWhatsAppModal === 'function') {
                showWhatsAppModal(orderId);
            } else {
                // å…œåº•ï¼šè‹¥å‡½æ•°ä¸å¯ç”¨åˆ™ä»è·³è½¬åˆ° WhatsAppï¼ˆä¿ç•™åŸå…¼å®¹è¡Œä¸ºï¼‰
                const orderIdText = String(order.id || orderId);
                const message = `Please confirm my Beefreebies order #${orderIdText}`;
                const url = `https://wa.me/12132756555?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
        }

        // å–æ¶ˆè®¢å•
        async function cancelOrder(orderId) {
            const order = userOrders.find(o => o.id === orderId);
            if (!order) {
                showNotification(t('orderNotFound') || 'æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'error');
                return;
            }

            // ç¡®è®¤å–æ¶ˆ
            if (!confirm(t('confirmCancelOrder'))) {
                return;
            }

            try {
                // æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²å–æ¶ˆ
                order.status = 'cancelled';
                order.updatedAt = Date.now();

                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                if (currentUser && currentUser.account) {
                    const userOrdersKey = `userOrders_${currentUser.account}`;
                    localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
                }
                localStorage.setItem('userOrders', JSON.stringify(userOrders));

                // åŒæ­¥åˆ°äº‘ç«¯
                if (cloudSync && cloudSync.isInitialized) {
                    try {
                        await cloudSync.syncOrders();
                        console.log('âœ… è®¢å•å–æ¶ˆçŠ¶æ€å·²åŒæ­¥åˆ°äº‘ç«¯');
                    } catch (err) {
                        console.error('äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                    }
                }

                // å¦‚æœè®¢å•åœ¨allOrdersä¸­ï¼Œä¹Ÿéœ€è¦æ›´æ–°
                const allOrder = allOrders.find(o => o.id === orderId);
                if (allOrder) {
                    allOrder.status = 'cancelled';
                    allOrder.updatedAt = Date.now();
                    localStorage.setItem('allOrders', JSON.stringify(allOrders));
                }

                // âœ… æ™®é€šç”¨æˆ·ï¼šè®¢å•å–æ¶ˆåè¿”è¿˜ 1 ä¸ªèœœç½ï¼ˆç®¡ç†å‘˜ä¸å—é™åˆ¶ï¼‰
                if (!isCurrentUserAdmin()) {
                    try {
                        if (currentUser && currentUser.account) {
                            const user = findUserByAccount(currentUser.account);
                            let currentPoints = (user && typeof user.points === 'number' && !isNaN(user.points))
                                ? Number(user.points)
                                : (typeof currentUser.points === 'number' ? Number(currentUser.points) : 0);

                            const newPoints = currentPoints + 1;

                            if (user) {
                                user.points = newPoints;
                            }
                            currentUser.points = newPoints;
                            saveAllUsers();
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));

                            const badge = document.getElementById('user-points-badge');
                            const valueEl = document.getElementById('user-points-value');
                            if (badge && valueEl) {
                                badge.style.display = 'inline-flex';
                                valueEl.textContent = newPoints;
                            }

                            showNotification((t('orderCancelled') || 'è®¢å•å·²å–æ¶ˆ') + `ï¼Œèœœç½ +1`, 'success');
                        } else {
                            showNotification(t('orderCancelled') || 'è®¢å•å·²å–æ¶ˆ', 'success');
                        }
                    } catch (ptsErr) {
                        console.warn('å–æ¶ˆè®¢å•è¿”è¿˜èœœç½æ—¶å‡ºé”™:', ptsErr);
                        showNotification(t('orderCancelled') || 'è®¢å•å·²å–æ¶ˆ', 'success');
                    }
                } else {
                    showNotification(t('orderCancelled') || 'è®¢å•å·²å–æ¶ˆ', 'success');
                }
                
                // åˆ·æ–°è®¢å•åˆ—è¡¨
                renderUserOrders();
            } catch (error) {
                console.error('å–æ¶ˆè®¢å•å¤±è´¥:', error);
                showNotification('å–æ¶ˆè®¢å•å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // ç”¨æˆ·é¡µé¢åˆ‡æ¢
        function showUserPage(tab) {
            const pages = document.querySelectorAll('.user-page');
            pages.forEach(page => page.classList.remove('active'));

            switch (tab) {
                case 'orders':
                    document.getElementById('user-orders').classList.add('active');
                    renderUserOrders();
                    break;
                case 'profile':
                    document.getElementById('user-profile').classList.add('active');
                    loadUserProfile();
                    break;
                case 'address':
                    document.getElementById('user-address').classList.add('active');
                    renderAddressList();
                    break;
                case 'security':
                    document.getElementById('user-security').classList.add('active');
                    loadSecuritySettings();
                    break;
            }
            
            // å¦‚æœæ˜¾ç¤ºè®¢å•é¡µé¢ä¸”ä¾§è¾¹æ è¢«éšè—ï¼Œè°ƒæ•´å¸ƒå±€
            const userSidebar = document.querySelector('.user-sidebar');
            const userCenter = document.getElementById('user-center');
            if (tab === 'orders' && userSidebar && userSidebar.style.display === 'none') {
                if (userCenter) {
                    userCenter.classList.add('sidebar-hidden');
                }
            } else {
                if (userCenter) {
                    userCenter.classList.remove('sidebar-hidden');
                }
            }
        }

        // åŠ è½½ç”¨æˆ·ä¸ªäººä¿¡æ¯
        function loadUserProfile() {
            if (!currentUser) return;

            // ä»allUsersæ•°ç»„ä¸­è·å–æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯
            const latestUserData = findUserByAccount(currentUser.account);
            const username = latestUserData ? latestUserData.username : currentUser.username;

            const profile = userProfile[currentUser.account] || {};
            document.getElementById('profile-username').value = username || '';
            document.getElementById('profile-account').value = currentUser.account || '';
            document.getElementById('profile-nickname').value = profile.nickname || '';
            document.getElementById('profile-phone').value = extractUSPhoneDigits(profile.phone);
            document.getElementById('profile-email').value = profile.email || '';
            document.getElementById('profile-birthday').value = profile.birthday || '';
            document.getElementById('profile-gender').value = profile.gender || '';
        }

        // ä¿å­˜ç”¨æˆ·ä¸ªäººä¿¡æ¯
        function saveProfile() {
            if (!currentUser) return;

            const rawPhone = document.getElementById('profile-phone').value.trim();
            const normalizedPhone = rawPhone ? normalizeUSPhone(rawPhone) : '';

            if (rawPhone && !normalizedPhone) {
                customAlert(t('invalidPhoneFormat'), t('infoTitle'));
                const wrapper = document.getElementById('profile-phone')?.closest('.phone-input-wrapper');
                if (wrapper) wrapper.classList.add('error');
                return;
            }

            const profile = {
                nickname: document.getElementById('profile-nickname').value.trim(),
                phone: normalizedPhone,
                email: document.getElementById('profile-email').value.trim(),
                birthday: document.getElementById('profile-birthday').value,
                gender: document.getElementById('profile-gender').value
            };

            // éªŒè¯é‚®ç®±
            if (profile.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(profile.email)) {
                customAlert(t('invalidEmailFormat'), t('infoTitle'));
                return;
            }

            userProfile[currentUser.account] = profile;
            saveUserProfile();
            customAlert(t('profileSaveSuccess'), t('successTitle'));
        }

        // åŠ è½½å®‰å…¨è®¾ç½®
        function loadSecuritySettings() {
            if (!currentUser) return;

            // ç™»å½•ä¿æŠ¤åŠŸèƒ½å·²åˆ é™¤ï¼Œæ­¤å‡½æ•°ä¿ç•™ç”¨äºæœªæ¥æ‰©å±•
        }

        // ä¿®æ”¹å¯†ç 
        function changePassword() {
            if (!currentUser) return;

            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification(t('pleaseFillAllFields') || 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'warning');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification(t('passwordMismatch') || 'ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showNotification(t('passwordTooShort') || 'æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½', 'warning');
                return;
            }

            // éªŒè¯å½“å‰å¯†ç 
            let actualPassword = '';

            // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜è´¦å·
            if (ADMIN_ACCOUNTS[currentUser.account]) {
                actualPassword = ADMIN_ACCOUNTS[currentUser.account].password;
            } else {
                // æŸ¥æ‰¾æ™®é€šç”¨æˆ·çš„å¯†ç 
                const user = findUserByAccount(currentUser.account);
                if (user) {
                    actualPassword = user.password;
                }
            }

            if (currentPassword !== actualPassword) {
                showNotification(t('currentPasswordIncorrect') || 'å½“å‰å¯†ç é”™è¯¯', 'error');
                return;
            }

            // æ›´æ–°å¯†ç 
            if (ADMIN_ACCOUNTS[currentUser.account]) {
                // ç®¡ç†å‘˜å¯†ç ä¸å…è®¸é€šè¿‡å‰ç«¯ä¿®æ”¹
                showNotification(t('adminPasswordCannotChange') || 'ç®¡ç†å‘˜å¯†ç ä¸å…è®¸ä¿®æ”¹ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜', 'warning');
                return;
            } else {
                // æ›´æ–°æ™®é€šç”¨æˆ·å¯†ç 
                const user = findUserByAccount(currentUser.account);
                if (user) {
                    user.password = newPassword;
                    saveAllUsers();
                    
                    // åŒæ­¥åˆ°äº‘ç«¯
                    if (cloudSync && cloudSync.isInitialized) {
                        cloudSync.syncAllUsers().then(() => {
                            console.log('âœ… å¯†ç å·²åŒæ­¥åˆ°äº‘ç«¯');
                        }).catch(err => {
                            console.error('å¯†ç äº‘ç«¯åŒæ­¥å¤±è´¥:', err);
                        });
                    }
                    
                    showNotification(t('passwordChangedSuccess') || 'å¯†ç ä¿®æ”¹æˆåŠŸï¼è¯·ç‰¢è®°æ–°å¯†ç ', 'success');
                    document.getElementById('change-password-form').reset();
                } else {
                    showNotification(t('userNotFound') || 'æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯', 'error');
                }
            }
        }

        // æ‰“å¼€åœ°å€ç¼–è¾‘æ¨¡æ€æ¡†
        function openAddressModal(address = null) {
            const modal = document.getElementById('address-modal');
            const title = document.getElementById('address-modal-title');
            const form = document.getElementById('address-form');

            if (!modal || !form) {
                console.error('Address modal or form not found');
                return;
            }

            if (address) {
                title.textContent = 'Edit address';
                document.getElementById('address-id').value = address.id;
                document.getElementById('address-name').value = address.name || '';
                document.getElementById('address-phone').value = extractUSPhoneDigits(address.phone);
                document.getElementById('address-country').value = 'US';
                document.getElementById('address-detail').value = address.detail || '';
                document.getElementById('address-unit').value = address.unit || '';
                document.getElementById('address-city').value = address.city || '';
                document.getElementById('address-state').value = address.state || '';
                document.getElementById('address-postal').value = address.postal || '';
                document.getElementById('address-default').checked = address.isDefault || false;
            } else {
                title.textContent = 'Add a new address';
                form.reset();
                document.getElementById('address-id').value = '';
                document.getElementById('address-country').value = 'US';
            }

            // ä¸å†åœ¨è¿™é‡Œç»‘å®šäº‹ä»¶ï¼Œé¿å…é‡å¤ç»‘å®š
            // äº‹ä»¶å·²åœ¨DOMContentLoadedä¸­ç»‘å®š

            modal.style.display = 'flex';
        }

        // ä¿å­˜åœ°å€
        function saveAddress() {
            console.log('saveAddress called');
            
            const id = document.getElementById('address-id').value;
            const name = document.getElementById('address-name').value.trim();
            const phone = document.getElementById('address-phone').value.trim();
            const country = document.getElementById('address-country').value;
            const detail = document.getElementById('address-detail').value.trim();
            const unit = document.getElementById('address-unit').value.trim();
            const city = document.getElementById('address-city').value.trim();
            const state = document.getElementById('address-state').value;
            const postal = document.getElementById('address-postal').value.trim();
            const isDefault = document.getElementById('address-default').checked;

            console.log('Form values:', { name, phone, detail, city, state, postal });

            if (!name || !phone || !detail || !city || !state || !postal) {
                customAlert(t('pleaseFillAllFields'), t('infoTitle'));
                return;
            }

            // éªŒè¯ç”µè¯å·ç ï¼ˆç¾å›½æ ¼å¼ï¼‰
            const normalizedPhone = normalizeUSPhone(phone);
            if (!normalizedPhone) {
                customAlert(t('invalidPhoneFormat'), t('infoTitle'));
                const phoneWrapper = document.getElementById('address-phone')?.closest('.phone-input-wrapper');
                if (phoneWrapper) phoneWrapper.classList.add('error');
                return;
            }

            // éªŒè¯é‚®ç¼–ï¼ˆç¾å›½æ ¼å¼ï¼š5ä½æˆ–5+4ä½ï¼‰
            if (!/^\d{5}(-\d{4})?$/.test(postal)) {
                customAlert('Please enter a valid ZIP code (e.g., 12345 or 12345-6789)', 'æç¤º');
                return;
            }

            // ç”Ÿæˆå”¯ä¸€IDï¼ˆç¡®ä¿ä¸ä¼šé‡å¤ï¼‰
            let addressId;
            if (id) {
                addressId = String(id);
            } else {
                // ç”Ÿæˆå”¯ä¸€IDï¼šæ—¶é—´æˆ³ + éšæœºæ•°
                addressId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            }

            const address = {
                id: addressId,
                name,
                phone: normalizedPhone,
                country: country || 'US',
                detail,
                unit,
                city,
                state,
                postal,
                isDefault,
                account: currentUser ? currentUser.account : null // æ·»åŠ ç”¨æˆ·æ ‡è¯†
            };

            if (isDefault) {
                // å–æ¶ˆå…¶ä»–åœ°å€çš„é»˜è®¤çŠ¶æ€
                userAddresses.forEach(addr => {
                    if (String(addr.id) !== String(address.id)) {
                        addr.isDefault = false;
                    }
                });
            }

            if (id) {
                // ç¼–è¾‘åœ°å€ - ä½¿ç”¨ä¸¥æ ¼æ¯”è¾ƒ
                const index = userAddresses.findIndex(addr => String(addr.id) === String(id));
                if (index !== -1) {
                    userAddresses[index] = address;
                } else {
                    console.warn('è¦ç¼–è¾‘çš„åœ°å€æœªæ‰¾åˆ°ï¼Œå°†ä½œä¸ºæ–°åœ°å€æ·»åŠ ');
                    userAddresses.push(address);
                }
            } else {
                // æ·»åŠ æ–°åœ°å€å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆé˜²æ­¢é‡å¤æ·»åŠ ï¼‰
                const existingIndex = userAddresses.findIndex(addr => 
                    String(addr.id) === String(address.id) ||
                    (addr.name === address.name && 
                     addr.phone === address.phone && 
                     addr.detail === address.detail &&
                     addr.city === address.city &&
                     addr.state === address.state &&
                     addr.postal === address.postal)
                );
                
                if (existingIndex === -1) {
                userAddresses.push(address);
                } else {
                    console.warn('åœ°å€å·²å­˜åœ¨ï¼Œè·³è¿‡æ·»åŠ ');
                    showNotification('This address already exists', 'warning');
                    return;
                }
            }

            saveUserAddresses();
            if (cloudSync && cloudSync.isInitialized) {
                cloudSync.syncAddresses();
            }
            closeModal('address-modal');
            renderAddressList();
            // å¦‚æœæŠ¥åæ¨¡æ€æ¡†æ‰“å¼€ç€ï¼Œåˆ·æ–°åœ°å€é€‰æ‹©å™¨
            const signupModal = document.getElementById('signup-modal');
            if (signupModal && signupModal.style.display === 'flex') {
                updateSignupAddressSelector();
            }
            showNotification('Address saved successfully!', 'success');

            if (shouldReturnToSignup) {
                setTimeout(() => {
                    shouldReturnToSignup = false;
                    if (typeof showHomePage === 'function') {
                        showHomePage();
                    }
                    const targetProduct = currentProduct || pendingSignupProduct;
                    if (targetProduct) {
                        openSignupModal(targetProduct);
                    }
                }, 300);
            }
        }

        // æ¸²æŸ“åœ°å€åˆ—è¡¨
        function renderAddressList() {
            const addressList = document.getElementById('address-list');

            if (!addressList) return;

            // ç¡®ä¿userAddressesæ˜¯æ•°ç»„ä¸”åªåŒ…å«å½“å‰ç”¨æˆ·çš„åœ°å€
            if (!Array.isArray(userAddresses)) {
                userAddresses = [];
            }

            // è¿‡æ»¤æ‰ä¸å±äºå½“å‰ç”¨æˆ·çš„åœ°å€ï¼ˆå¦‚æœæœ‰accountå­—æ®µï¼‰
            if (currentUser && currentUser.account) {
                userAddresses = userAddresses.filter(address => {
                    // å¦‚æœåœ°å€æœ‰accountå­—æ®µï¼Œåªæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„åœ°å€
                    if (address.account) {
                        return address.account === currentUser.account;
                    }
                    // æ—§æ•°æ®æ²¡æœ‰accountå­—æ®µï¼Œä¿ç•™ï¼ˆå…¼å®¹æ€§ï¼‰
                    return true;
                });
            }

            // æ·»åŠ "Add Address"å¡ç‰‡
            let addressCardsHtml = `
                <div class="add-address-card" onclick="document.getElementById('add-address-btn').click()">
                    <div class="add-address-icon">+</div>
                    <div class="add-address-text">Add Address</div>
                </div>
            `;

            addressCardsHtml += userAddresses.map(address => {
                // å…¼å®¹æ—§æ•°æ®æ ¼å¼
                const fullAddress = address.state 
                    ? [
                        address.detail,
                        address.unit,
                        address.city,
                        address.state,
                        address.postal
                      ].filter(Boolean).join(', ')
                    : [
                        address.province || '',
                        address.city || '',
                        address.district || '',
                        address.detail || ''
                      ].filter(Boolean).join(' ');

                return `
                <div class="address-item ${address.isDefault ? 'default' : ''}">
                        ${address.isDefault ? '<div class="address-default-badge">Default</div>' : ''}
                    <div class="address-info">
                        <div class="address-name">${address.name}</div>
                        <div class="address-phone">${address.phone}</div>
                            <div class="address-full">${fullAddress}</div>
                            ${address.country ? `<div class="address-country">${address.country}</div>` : ''}
                    </div>
                    <div class="address-actions">
                            <button class="btn btn-primary edit-address" data-id="${address.id}">Edit</button>
                            <button class="btn btn-secondary set-default-address" data-id="${address.id}" ${address.isDefault ? 'disabled' : ''}>Set as default</button>
                            <button class="btn btn-danger delete-address" data-id="${address.id}">Delete</button>
                    </div>
                </div>
                `;
            }).join('');

            addressList.innerHTML = addressCardsHtml;

            // ç»‘å®šåœ°å€æ“ä½œäº‹ä»¶
            document.querySelectorAll('.edit-address').forEach(btn => {
                btn.addEventListener('click', () => {
                    const addressId = btn.getAttribute('data-id');
                    const address = userAddresses.find(addr => String(addr.id) === String(addressId));
                    if (address) {
                        openAddressModal(address);
                    }
                });
            });

            document.querySelectorAll('.set-default-address').forEach(btn => {
                btn.addEventListener('click', () => {
                    const addressId = btn.getAttribute('data-id');
                    setDefaultAddress(addressId);
                });
            });

            document.querySelectorAll('.delete-address').forEach(btn => {
                btn.addEventListener('click', () => {
                    const addressId = btn.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this address?')) {
                    deleteAddress(addressId);
                    }
                });
            });
        }

        // è®¾ç½®é»˜è®¤åœ°å€
        function setDefaultAddress(addressId) {
            // ä½¿ç”¨ä¸¥æ ¼æ¯”è¾ƒï¼Œç¡®ä¿åªè®¾ç½®ä¸€ä¸ªåœ°å€ä¸ºé»˜è®¤
            let found = false;
            userAddresses.forEach(addr => {
                if (String(addr.id) === String(addressId)) {
                    addr.isDefault = true;
                    found = true;
                } else {
                    addr.isDefault = false;
                }
            });
            
            if (!found) {
                console.error('è¦è®¾ç½®ä¸ºé»˜è®¤çš„åœ°å€æœªæ‰¾åˆ°:', addressId);
                showNotification('Address not found', 'error');
                return;
            }
            
            saveUserAddresses();
            if (cloudSync && cloudSync.isInitialized) {
                cloudSync.syncAddresses();
            }
            renderAddressList();
            showNotification('Default address updated', 'success');
        }

        // åˆ é™¤åœ°å€
        function deleteAddress(addressId) {
            // ä½¿ç”¨ä¸¥æ ¼æ¯”è¾ƒï¼Œç¡®ä¿åªåˆ é™¤ä¸€ä¸ªåœ°å€
            const initialLength = userAddresses.length;
            userAddresses = userAddresses.filter(addr => String(addr.id) !== String(addressId));
            
            if (userAddresses.length === initialLength) {
                console.error('è¦åˆ é™¤çš„åœ°å€æœªæ‰¾åˆ°:', addressId);
                showNotification('Address not found', 'error');
                return;
            }
            
                saveUserAddresses();
            if (cloudSync && cloudSync.isInitialized) {
                cloudSync.syncAddresses();
            }
                renderAddressList();
            showNotification('Address deleted', 'success');
        }

        // æ˜¾ç¤ºExcelæ•°æ®é¢„è§ˆ
        function showExcelDataPreview(importedProducts) {
            const adminContent = document.querySelector('.admin-content');

            // ç§»é™¤å·²å­˜åœ¨çš„é¢„è§ˆåŒºåŸŸ
            const existingPreview = document.querySelector('.excel-preview');
            if (existingPreview) {
                existingPreview.remove();
            }

            // åˆ›å»ºæ•°æ®é¢„è§ˆåŒºåŸŸ
            const previewSection = document.createElement('div');
            previewSection.className = 'excel-preview';
            previewSection.innerHTML = `
                <h4>Excelæ•°æ®é¢„è§ˆ</h4>
                <div class="preview-info">
                    <p>å…±å‘ç° <strong>${importedProducts.length}</strong> ä¸ªäº§å“ï¼Œè¯·ç¡®è®¤å¯¼å…¥ï¼š</p>
                </div>
                <div class="preview-products">
                    ${importedProducts.map((product, index) => `
                        <div class="preview-product-item">
                            <div class="preview-product-image" style="background-image: url('${getPrimaryProductImage(product)}')"></div>
                            <div class="preview-product-info">
                                <div class="preview-product-name">${product.name}</div>
                                <div class="preview-product-price">
                                    <span style="text-decoration: line-through; color: #999; margin-right: 8px; font-size: 0.9em;">${formatCurrency(product.price)}</span>
                                    <span style="color: #e74c3c; font-weight: bold;">${formatCurrency(product.newPrice !== undefined ? product.newPrice : 0)}</span>
                                </div>
                                <div class="preview-product-category">${product.category}</div>
                            </div>
                            <div class="preview-product-status">
                                <span class="status-pending">å¾…å¯¼å…¥</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="preview-actions">
                    <button class="btn btn-primary" id="confirm-import">ç¡®è®¤å¯¼å…¥äº§å“</button>
                    <button class="btn btn-secondary" id="cancel-import">å–æ¶ˆ</button>
                </div>
            `;

            // æ’å…¥åˆ°Excelä¸Šä¼ åŒºåŸŸåé¢
            const excelUploadArea = document.getElementById('excel-upload-area');
            excelUploadArea.parentNode.insertBefore(previewSection, excelUploadArea.nextSibling);

            // æ·»åŠ ç¡®è®¤å¯¼å…¥äº‹ä»¶
            document.getElementById('confirm-import').addEventListener('click', () => {
                // è·å–ç°æœ‰äº§å“çš„æœ€å¤§IDï¼ˆç¡®ä¿æ˜¯æ•°å­—ï¼‰
                const existingIds = products.map(p => parseInt(p.id));
                let maxId = existingIds.length > 0 ? Math.max(...existingIds) : 0;

                console.log('ğŸ”§ å¯¼å…¥è°ƒè¯• - å½“å‰æœ€å¤§ID:', maxId);
                console.log('ğŸ”§ å¯¼å…¥è°ƒè¯• - ç°æœ‰äº§å“ID:', existingIds);

                // ä¸ºå¯¼å…¥çš„äº§å“ç”Ÿæˆå”¯ä¸€IDï¼ˆç¡®ä¿æ˜¯æ•°å­—ï¼‰
                importedProducts.forEach((product, index) => {
                    const newId = maxId + index + 1;
                    product.id = newId;
                    product.stock = product.stock || 10;
                    product.category = product.category || 'other';
                    product.description = product.description || 'æš‚æ— æè¿°';

                    console.log(`ğŸ”§ å¯¼å…¥è°ƒè¯• - äº§å“ ${product.name} åˆ†é…ID:`, newId);
                });

                // æ·»åŠ åˆ°äº§å“åˆ—è¡¨
                products.push(...importedProducts);

                // ä¿å­˜æ•°æ®
                const saveResult = saveProducts();
                console.log('ğŸ”§ å¯¼å…¥è°ƒè¯• - ä¿å­˜ç»“æœ:', saveResult);
                console.log('ğŸ”§ å¯¼å…¥è°ƒè¯• - å¯¼å…¥åçš„äº§å“:', products);

                if (saveResult) {
                    customAlert(`âœ… ${t('importProductsSuccess').replace('{count}', importedProducts.length)}`, t('successTitle'));
                } else {
                    customAlert(t('importDataSaveError'), t('errorTitle'));
                }

                previewSection.remove();

                // é‡ç½®ä¸Šä¼ åŒºåŸŸ
                excelUploadArea.classList.remove('success');
                excelUploadArea.innerHTML = `
                    <i class="fas fa-file-excel"></i>
                    <h3>ç‚¹å‡»ä¸Šä¼ Excelæ–‡ä»¶</h3>
                    <p>æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼ï¼Œç”¨äºæ‰¹é‡ç¼–è¾‘äº§å“ä¿¡æ¯</p>
                    <p><small>è¯·ç¡®ä¿ExcelåŒ…å«"å›¾ç‰‡URL"åˆ—</small></p>
                    <p><small>æˆ–å°†Excelæ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„</small></p>
                `;

                // æ›´æ–°äº§å“æ˜¾ç¤º
                if (document.getElementById('home-page').style.display !== 'none') {
                    renderProducts(products);
                }
                if (document.getElementById('admin-panel').style.display !== 'none') {
                    renderAdminProducts();
                }
            });

            // æ·»åŠ å–æ¶ˆäº‹ä»¶
            document.getElementById('cancel-import').addEventListener('click', () => {
                previewSection.remove();
                excelUploadArea.classList.remove('success');
                excelUploadArea.innerHTML = `
                    <i class="fas fa-file-excel"></i>
                    <h3>ç‚¹å‡»ä¸Šä¼ Excelæ–‡ä»¶</h3>
                    <p>æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼ï¼Œç”¨äºæ‰¹é‡ç¼–è¾‘äº§å“ä¿¡æ¯</p>
                    <p><small>è¯·ç¡®ä¿ExcelåŒ…å«"å›¾ç‰‡URL"åˆ—</small></p>
                    <p><small>æˆ–å°†Excelæ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„</small></p>
                `;
            });
        }

        // ===================== æ‰¹é‡æ“ä½œåŠŸèƒ½ =====================

        // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
        function updateBatchButtons() {
            const selectedCheckboxes = document.querySelectorAll('.product-checkbox:checked');
            const allCheckboxes = document.querySelectorAll('.product-checkbox');
            const batchEditBtn = document.getElementById('batch-edit-btn');
            const batchPublishBtn = document.getElementById('batch-publish-btn');
            const batchHideBtn = document.getElementById('batch-hide-btn');
            const batchDeleteBtn = document.getElementById('batch-delete-btn');
            const selectAllCheckbox = document.getElementById('select-all-products');

            // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®æ˜¾ç¤º
            if (selectedCheckboxes.length > 0) {
                batchEditBtn.style.display = 'inline-block';
                batchPublishBtn.style.display = 'inline-block';
                batchHideBtn.style.display = 'inline-block';
                batchDeleteBtn.style.display = 'inline-block';
                batchEditBtn.textContent = `æ‰¹é‡ç¼–è¾‘ (${selectedCheckboxes.length})`;
                batchPublishBtn.textContent = `æ‰¹é‡ä¸Šæ¶ (${selectedCheckboxes.length})`;
                batchHideBtn.textContent = `æ‰¹é‡ä¸‹æ¶ (${selectedCheckboxes.length})`;
                batchDeleteBtn.textContent = `æ‰¹é‡åˆ é™¤ (${selectedCheckboxes.length})`;
            } else {
                batchEditBtn.style.display = 'none';
                batchPublishBtn.style.display = 'none';
                batchHideBtn.style.display = 'none';
                batchDeleteBtn.style.display = 'none';
                batchEditBtn.textContent = 'æ‰¹é‡ç¼–è¾‘';
                batchPublishBtn.textContent = 'æ‰¹é‡ä¸Šæ¶';
                batchHideBtn.textContent = 'æ‰¹é‡ä¸‹æ¶';
                batchDeleteBtn.textContent = 'æ‰¹é‡åˆ é™¤';
            }

            // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
            if (allCheckboxes.length > 0) {
                if (selectedCheckboxes.length === allCheckboxes.length) {
                    // å…¨éƒ¨é€‰ä¸­
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else if (selectedCheckboxes.length > 0) {
                    // éƒ¨åˆ†é€‰ä¸­
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                } else {
                    // å…¨éƒ¨æœªé€‰ä¸­
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                }
            }
        }

        // å…¨é€‰/å–æ¶ˆå…¨é€‰
        function toggleSelectAllProducts() {
            const selectAllCheckbox = document.getElementById('select-all-products');
            const productCheckboxes = document.querySelectorAll('.product-checkbox');

            productCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });

            updateBatchButtons();
        }

        // è·å–é€‰ä¸­çš„äº§å“IDåˆ—è¡¨
        function getSelectedProductIds() {
            const selectedCheckboxes = document.querySelectorAll('.product-checkbox:checked');
            return Array.from(selectedCheckboxes).map(cb => parseInt(cb.getAttribute('data-product-id')));
        }

        // æ‰¹é‡åˆ é™¤äº§å“
        function batchDeleteProducts() {
            const selectedIds = getSelectedProductIds();

            if (selectedIds.length === 0) {
                showNotification('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„äº§å“', 'warning');
                return;
            }

            const selectedProducts = products.filter(p => selectedIds.includes(parseInt(p.id)));
            const productNames = selectedProducts.map(p => p.name).join('ã€');

            if (!confirm(t('confirmDeleteSelectedProducts').replace('{count}', selectedIds.length).replace('{productNames}', productNames))) {
                return;
            }

            // åˆ é™¤äº§å“
            const deletedCount = selectedIds.length;
            products = products.filter(p => !selectedIds.includes(parseInt(p.id)));
            
            // ç«‹å³æ›´æ–°UIï¼ˆæä¾›å³æ—¶è§†è§‰åé¦ˆï¼‰
            renderAdminProducts();
            document.getElementById('select-all-products').checked = false;
            updateBatchButtons();
            
            // ç­‰å¾…ä¿å­˜å’ŒåŒæ­¥å®Œæˆï¼ˆç®¡ç†å‘˜éœ€è¦ç¡®ä¿æ•°æ®å·²ä¸Šä¼ åˆ°äº‘ç«¯ï¼‰
            saveProducts().then(() => {
                // åŒæ­¥å®Œæˆåï¼Œå†æ¬¡æ¸²æŸ“ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
                // ç”±äºä¿æŠ¤æœºåˆ¶ï¼Œç›‘å¬å™¨ä¸ä¼šè¦†ç›–è‡ªå·±çš„æ›´æ–°
                setTimeout(() => {
                    renderAdminProducts();
                    document.getElementById('select-all-products').checked = false;
                    updateBatchButtons();
                    showNotification(`æˆåŠŸåˆ é™¤ ${deletedCount} ä¸ªäº§å“`, 'success');
                }, 100);
            }).catch((error) => {
                console.error('æ‰¹é‡åˆ é™¤äº§å“ååŒæ­¥å¤±è´¥:', error);
                // å³ä½¿åŒæ­¥å¤±è´¥ï¼Œä¹Ÿä¿æŒUIçŠ¶æ€ï¼ˆäº§å“å·²ä»UIç§»é™¤ï¼‰
                showNotification(`äº§å“å·²åˆ é™¤ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ`, 'warning');
            });
        }

        // æ‰¹é‡ä¸Šæ¶äº§å“
        function batchPublishProducts() {
            const selectedIds = getSelectedProductIds();

            if (selectedIds.length === 0) {
                showNotification('è¯·å…ˆé€‰æ‹©è¦ä¸Šæ¶çš„äº§å“', 'warning');
                return;
            }

            const selectedProducts = products.filter(p => selectedIds.includes(parseInt(p.id)));
            const hiddenProducts = selectedProducts.filter(p => p.visible === false);

            if (hiddenProducts.length === 0) {
                showNotification('é€‰ä¸­çš„äº§å“éƒ½å·²ä¸Šæ¶', 'info');
                return;
            }

            if (!confirm(`ç¡®å®šè¦ä¸Šæ¶ ${hiddenProducts.length} ä¸ªäº§å“å—ï¼Ÿ\n\näº§å“åç§°ï¼š${hiddenProducts.map(p => p.name).join('ã€')}`)) {
                return;
            }

            // æ›´æ–°äº§å“å¯è§æ€§
            let updatedCount = 0;
            products.forEach(p => {
                if (selectedIds.includes(parseInt(p.id)) && p.visible === false) {
                    p.visible = true;
                    updatedCount++;
                }
            });

            // ç«‹å³æ›´æ–°UIï¼ˆæä¾›å³æ—¶è§†è§‰åé¦ˆï¼‰
            renderAdminProducts();
            renderProducts(products); // åŒæ—¶æ›´æ–°ä¸»é¡µ
            document.getElementById('select-all-products').checked = false;
            updateBatchButtons();

            // ç­‰å¾…ä¿å­˜å’ŒåŒæ­¥å®Œæˆ
            saveProducts().then(() => {
                setTimeout(() => {
                    renderAdminProducts();
                    renderProducts(products); // å†æ¬¡ç¡®ä¿ä¸»é¡µæ›´æ–°
                    document.getElementById('select-all-products').checked = false;
                    updateBatchButtons();
                    showNotification(`æˆåŠŸä¸Šæ¶ ${updatedCount} ä¸ªäº§å“`, 'success');
                }, 100);
            }).catch((error) => {
                console.error('æ‰¹é‡ä¸Šæ¶äº§å“ååŒæ­¥å¤±è´¥:', error);
                showNotification(`äº§å“å·²ä¸Šæ¶ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ`, 'warning');
            });
        }

        // æ‰¹é‡ä¸‹æ¶äº§å“
        function batchHideProducts() {
            const selectedIds = getSelectedProductIds();

            if (selectedIds.length === 0) {
                showNotification('è¯·å…ˆé€‰æ‹©è¦ä¸‹æ¶çš„äº§å“', 'warning');
                return;
            }

            const selectedProducts = products.filter(p => selectedIds.includes(parseInt(p.id)));
            const visibleProducts = selectedProducts.filter(p => p.visible !== false);

            if (visibleProducts.length === 0) {
                showNotification('é€‰ä¸­çš„äº§å“éƒ½å·²ä¸‹æ¶', 'info');
                return;
            }

            if (!confirm(`ç¡®å®šè¦ä¸‹æ¶ ${visibleProducts.length} ä¸ªäº§å“å—ï¼Ÿ\n\näº§å“åç§°ï¼š${visibleProducts.map(p => p.name).join('ã€')}`)) {
                return;
            }

            // æ›´æ–°äº§å“å¯è§æ€§
            let updatedCount = 0;
            products.forEach(p => {
                if (selectedIds.includes(parseInt(p.id)) && p.visible !== false) {
                    p.visible = false;
                    updatedCount++;
                }
            });

            // ç«‹å³æ›´æ–°UIï¼ˆæä¾›å³æ—¶è§†è§‰åé¦ˆï¼‰
            renderAdminProducts();
            renderProducts(products); // åŒæ—¶æ›´æ–°ä¸»é¡µ
            document.getElementById('select-all-products').checked = false;
            updateBatchButtons();

            // ç­‰å¾…ä¿å­˜å’ŒåŒæ­¥å®Œæˆ
            saveProducts().then(() => {
                setTimeout(() => {
                    renderAdminProducts();
                    renderProducts(products); // å†æ¬¡ç¡®ä¿ä¸»é¡µæ›´æ–°
                    document.getElementById('select-all-products').checked = false;
                    updateBatchButtons();
                    showNotification(`æˆåŠŸä¸‹æ¶ ${updatedCount} ä¸ªäº§å“`, 'success');
                }, 100);
            }).catch((error) => {
                console.error('æ‰¹é‡ä¸‹æ¶äº§å“ååŒæ­¥å¤±è´¥:', error);
                showNotification(`äº§å“å·²ä¸‹æ¶ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ`, 'warning');
            });
        }

        // æ‰“å¼€æ‰¹é‡ç¼–è¾‘æ¨¡æ€æ¡†
        function openBatchEditModal() {
            const selectedIds = getSelectedProductIds();

            if (selectedIds.length === 0) {
                showNotification('è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„äº§å“', 'warning');
                return;
            }

            // æ›´æ–°é€‰ä¸­æ•°é‡
            document.getElementById('batch-edit-count').textContent = selectedIds.length;

            // é‡ç½®è¡¨å•
            document.getElementById('batch-edit-form').reset();
            document.getElementById('batch-price-value-group').style.display = 'none';
            document.getElementById('batch-stock-value-group').style.display = 'none';

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('batch-edit-modal').style.display = 'flex';
        }

        // åº”ç”¨æ‰¹é‡ç¼–è¾‘
        function applyBatchEdit(e) {
            e.preventDefault();

            const selectedIds = getSelectedProductIds();
            if (selectedIds.length === 0) {
                showNotification('æ²¡æœ‰é€‰ä¸­çš„äº§å“', 'error');
                return;
            }

            const priceAction = document.getElementById('batch-edit-price-action').value;
            const priceValue = parseFloat(document.getElementById('batch-edit-price-value').value) || 0;
            const stockAction = document.getElementById('batch-edit-stock-action').value;
            const stockValue = parseInt(document.getElementById('batch-edit-stock-value').value) || 0;
            const category = document.getElementById('batch-edit-category').value;

            let updatedCount = 0;

            // éå†é€‰ä¸­çš„äº§å“å¹¶åº”ç”¨ä¿®æ”¹
            products.forEach(product => {
                if (selectedIds.includes(parseInt(product.id))) {
                    // ä»·æ ¼æ“ä½œ
                    if (priceAction && priceValue) {
                        switch (priceAction) {
                            case 'set':
                                product.price = priceValue;
                                break;
                            case 'increase':
                                product.price += priceValue;
                                break;
                            case 'decrease':
                                product.price = Math.max(0, product.price - priceValue);
                                break;
                            case 'multiply':
                                product.price *= priceValue;
                                break;
                        }
                        product.price = Math.round(product.price * 100) / 100; // ä¿ç•™ä¸¤ä½å°æ•°
                    }

                    // åº“å­˜æ“ä½œ
                    if (stockAction && stockValue >= 0) {
                        switch (stockAction) {
                            case 'set':
                                product.stock = stockValue;
                                break;
                            case 'increase':
                                product.stock += stockValue;
                                break;
                            case 'decrease':
                                product.stock = Math.max(0, product.stock - stockValue);
                                break;
                        }
                    }

                    // åˆ†ç±»ä¿®æ”¹
                    if (category) {
                        product.category = category;
                    }

                    updatedCount++;
                }
            });

            // ä¿å­˜ä¿®æ”¹å¹¶ç­‰å¾…åŒæ­¥å®Œæˆï¼ˆç®¡ç†å‘˜éœ€è¦ç¡®ä¿æ•°æ®å·²ä¸Šä¼ åˆ°äº‘ç«¯ï¼‰
            saveProducts().then(() => {
                // å…³é—­æ¨¡æ€æ¡†
                document.getElementById('batch-edit-modal').style.display = 'none';

                // é‡æ–°æ¸²æŸ“äº§å“åˆ—è¡¨
                renderAdminProducts();

                showNotification(`æˆåŠŸæ‰¹é‡ç¼–è¾‘ ${updatedCount} ä¸ªäº§å“`, 'success');
            }).catch((error) => {
                console.error('æ‰¹é‡ç¼–è¾‘ååŒæ­¥å¤±è´¥:', error);
                // å³ä½¿åŒæ­¥å¤±è´¥ï¼Œä¹Ÿæ›´æ–°UIï¼ˆæœ¬åœ°å·²ä¿®æ”¹ï¼‰
                document.getElementById('batch-edit-modal').style.display = 'none';
                renderAdminProducts();
                showNotification(`äº§å“å·²ä¿®æ”¹ï¼Œä½†äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ`, 'warning');
            });

            // å–æ¶ˆå…¨é€‰çŠ¶æ€
            document.getElementById('select-all-products').checked = false;
            updateBatchButtons();

            showNotification(`æˆåŠŸç¼–è¾‘ ${updatedCount} ä¸ªäº§å“`, 'success');
        }

        // ===================== æ•°æ®åŒæ­¥æ”¹è¿› =====================

        // æ·»åŠ æ•°æ®åŒæ­¥é€šçŸ¥
        // å·²ç¦ç”¨åŒæ­¥é€šçŸ¥åŠŸèƒ½ï¼Œé¿å…å¼¹çª—å¹²æ‰°
        function showSyncNotification() {
            // åŠŸèƒ½å·²ç¦ç”¨ï¼Œä¸å†æ˜¾ç¤ºåŒæ­¥é€šçŸ¥
            return;
            /*
            const syncNotification = document.createElement('div');
            syncNotification.id = 'sync-notification';
            syncNotification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #ff9800;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10001;
                max-width: 400px;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            syncNotification.innerHTML = `
                <i class="fas fa-sync-alt fa-spin"></i>
                <div>
                    <div style="font-weight: 600;">æ•°æ®å·²æ›´æ–°</div>
                    <div style="font-size: 12px; opacity: 0.9;">å…¶ä»–è®¾å¤‡éœ€è¦åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°æœ€æ–°æ•°æ®</div>
                </div>
            `;

            document.body.appendChild(syncNotification);

            setTimeout(() => {
                syncNotification.remove();
            }, 5000);
            */
        }

        // æ”¹è¿›saveProductså‡½æ•°ï¼Œæ·»åŠ åŒæ­¥æç¤ºå’Œäº‘åŒæ­¥
        const originalSaveProducts = saveProducts;
        saveProducts = async function () {
            const result = originalSaveProducts();
            if (result && cloudSync && cloudSync.isInitialized) {
                try {
                    // åŒæ­¥åˆ°äº‘ç«¯ï¼Œç­‰å¾…å®Œæˆ
                    await cloudSync.syncProducts();
                    console.log('âœ… saveProducts: äº§å“æ•°æ®å·²æˆåŠŸåŒæ­¥åˆ°äº‘ç«¯ï¼ŒåŒ…æ‹¬newPriceå­—æ®µ');
                } catch (err) {
                    console.warn('âš ï¸ saveProducts: äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œä½†æœ¬åœ°å·²ä¿å­˜:', err);
                }
            }
            return result;
        };

        // æ”¹è¿›saveAllUserså‡½æ•°ï¼Œæ·»åŠ åŒæ­¥æç¤ºå’Œäº‘åŒæ­¥
        const originalSaveAllUsers = saveAllUsers;
        saveAllUsers = async function () {
            originalSaveAllUsers();
            // åŒæ­¥åˆ°äº‘ç«¯
            if (cloudSync && cloudSync.isInitialized) {
                await cloudSync.syncAllUsers();
            }
            if (isAdmin()) {
                showSyncNotification();
            }
        };

        // ===================== äº‘ç«¯åŒæ­¥æŒ‰é’®äº‹ä»¶ =====================

        // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
        function updateSyncStatus() {
            const syncStatusText = document.getElementById('sync-status-text');
            if (!syncStatusText) return;

            if (cloudSync && cloudSync.isInitialized) {
                if (cloudSync.lastSyncTime) {
                    const timeAgo = getTimeAgo(cloudSync.lastSyncTime);
                    syncStatusText.textContent = `ä¸Šæ¬¡åŒæ­¥ï¼š${timeAgo}`;
                    syncStatusText.style.color = '#2ecc71';
                } else {
                    syncStatusText.textContent = 'ç­‰å¾…é¦–æ¬¡åŒæ­¥...';
                    syncStatusText.style.color = '#f39c12';
                }
            } else {
                syncStatusText.textContent = 'äº‘ç«¯åŒæ­¥æœªå¯ç”¨';
                syncStatusText.style.color = '#999';
            }
        }

        // è·å–ç›¸å¯¹æ—¶é—´
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);

            if (seconds < 60) return 'åˆšåˆš';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}åˆ†é’Ÿå‰`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}å°æ—¶å‰`;
            return `${Math.floor(seconds / 86400)}å¤©å‰`;
        }

        // æ‰‹åŠ¨åŒæ­¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function () {
            // åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨ç‚¹å‡»äº‹ä»¶
            const syncStatus = document.getElementById('sync-status');
            if (syncStatus) {
                syncStatus.addEventListener('click', function () {
                    if (cloudSync && cloudSync.isInitialized) {
                        const lastSyncInfo = cloudSync.lastSyncTime
                            ? `ä¸Šæ¬¡åŒæ­¥ï¼š${getTimeAgo(cloudSync.lastSyncTime)}`
                            : 'ç­‰å¾…é¦–æ¬¡åŒæ­¥';

                        showNotification(
                            `âœ… äº‘ç«¯åŒæ­¥å·²å¯ç”¨\n\n` +
                            `${lastSyncInfo}\n` +
                            `æ•°æ®æ­£åœ¨æ‰€æœ‰è®¾å¤‡é—´å®æ—¶åŒæ­¥\n\n` +
                            `åŒæ­¥å†…å®¹ï¼š\n` +
                            `â€¢ äº§å“æ•°æ®\n` +
                            `â€¢ ç”¨æˆ·è´¦æˆ·\n` +
                            `â€¢ è®¢å•è®°å½•\n` +
                            `â€¢ æ”¶è´§åœ°å€`,
                            'info'
                        );
                    } else {
                        showNotification(
                            `ğŸ’¡ äº‘ç«¯åŒæ­¥æœªå¯ç”¨\n\n` +
                            `å½“å‰ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼Œæ•°æ®ä»…ä¿å­˜åœ¨å½“å‰è®¾å¤‡\n\n` +
                            `å¦‚éœ€å¯ç”¨è·¨è®¾å¤‡åŒæ­¥ï¼Œè¯·ï¼š\n` +
                            `1. æŸ¥çœ‹æ§åˆ¶å°çš„é…ç½®è¯´æ˜\n` +
                            `2. é˜…è¯» FIREBASE_SETUP.md æ–‡ä»¶\n` +
                            `3. é…ç½®ä»…éœ€çº¦5åˆ†é’Ÿ\n\n` +
                            `å¯ç”¨åå¯å®ç°ï¼š\n` +
                            `âœ… å¤šè®¾å¤‡æ•°æ®åŒæ­¥\n` +
                            `âœ… å›¢é˜Ÿåä½œ\n` +
                            `âœ… æ•°æ®äº‘ç«¯å¤‡ä»½`,
                            'info'
                        );
                    }
                });
            }

            const manualSyncBtn = document.getElementById('manual-sync-btn');
            if (manualSyncBtn) {
                manualSyncBtn.addEventListener('click', async function () {
                    if (!cloudSync || !cloudSync.isInitialized) {
                        showNotification('äº‘ç«¯åŒæ­¥æœªå¯ç”¨', 'warning');
                        return;
                    }

                    // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                    const icon = manualSyncBtn.querySelector('i');
                    const originalClass = icon.className;
                    icon.className = 'fas fa-sync-alt fa-spin';
                    manualSyncBtn.disabled = true;

                    try {
                        await cloudSync.manualSync();
                        updateSyncStatus();
                    } catch (error) {
                        console.error('æ‰‹åŠ¨åŒæ­¥å¤±è´¥:', error);
                        showNotification('åŒæ­¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                    } finally {
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        icon.className = originalClass;
                        manualSyncBtn.disabled = false;
                    }
                });
            }

            // è‡ªåŠ¨åŒæ­¥å¼€å…³
            const autoSyncCheckbox = document.getElementById('auto-sync');
            if (autoSyncCheckbox) {
                // ä»localStorageåŠ è½½è®¾ç½®
                const autoSyncEnabled = localStorage.getItem('autoSyncEnabled') !== 'false';
                autoSyncCheckbox.checked = autoSyncEnabled;

                autoSyncCheckbox.addEventListener('change', function () {
                    localStorage.setItem('autoSyncEnabled', this.checked);

                    if (this.checked) {
                        showNotification('è‡ªåŠ¨åŒæ­¥å·²å¼€å¯', 'success');
                        if (cloudSync && cloudSync.isInitialized) {
                            cloudSync.syncAllData();
                        }
                    } else {
                        showNotification('è‡ªåŠ¨åŒæ­¥å·²å…³é—­', 'info');
                    }
                });
            }

            // å®šæœŸæ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
            setInterval(updateSyncStatus, 10000); // æ¯10ç§’æ›´æ–°ä¸€æ¬¡

            // å®šæœŸæ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆè¢«ç¦ç”¨æ£€æµ‹ï¼‰
            setInterval(() => {
                if (currentUser) {
                    updateUserInterface();
                }
            }, 5000); // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡ç”¨æˆ·çŠ¶æ€

            // åˆå§‹æ›´æ–°
            setTimeout(updateSyncStatus, 2000);
        });

        // ===================== ç¦»çº¿æ¨¡å¼æç¤º =====================

        // åœ¨é¡µé¢é¡¶éƒ¨æ·»åŠ ç¦»çº¿çŠ¶æ€æŒ‡ç¤ºå™¨
        function createOfflineIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'offline-indicator';
            indicator.style.cssText = `
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                background: #f39c12;
                color: white;
                text-align: center;
                padding: 10px;
                z-index: 9999;
                display: none;
                animation: slideDown 0.3s ease;
            `;
            indicator.innerHTML = `
                <i class="fas fa-wifi" style="text-decoration: line-through;"></i>
                æ‚¨å½“å‰å¤„äºç¦»çº¿æ¨¡å¼ï¼Œæ•°æ®å°†åœ¨ç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥
            `;
            document.body.appendChild(indicator);

            // ç›‘å¬ç½‘ç»œçŠ¶æ€
            window.addEventListener('offline', () => {
                indicator.style.display = 'block';
            });

            window.addEventListener('online', () => {
                indicator.style.display = 'none';
            });

            // åˆå§‹çŠ¶æ€
            if (!navigator.onLine) {
                indicator.style.display = 'block';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆ›å»ºç¦»çº¿æŒ‡ç¤ºå™¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', createOfflineIndicator);
        } else {
            createOfflineIndicator();
        }

        // ===================== Firebase è¯Šæ–­å·¥å…· =====================

        // æ£€æŸ¥ Firebase çŠ¶æ€
        window.checkFirebaseStatus = function () {
            console.log('');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸ“Š Firebase çŠ¶æ€è¯Šæ–­æŠ¥å‘Š');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('');

            // 1. æ£€æŸ¥ SDK åŠ è½½
            console.log('1ï¸âƒ£ Firebase SDK åŠ è½½çŠ¶æ€:');
            if (typeof firebase === 'undefined') {
                console.log('   âŒ Firebase SDK æœªåŠ è½½');
                console.log('   ğŸ’¡ å¯èƒ½åŸå› : CDN è¢«é˜»æ­¢æˆ–ç½‘ç»œé—®é¢˜');
            } else {
                console.log('   âœ… Firebase SDK å·²åŠ è½½');
                console.log('   ğŸ“¦ ç‰ˆæœ¬:', firebase.SDK_VERSION || 'unknown');
            }
            console.log('');

            // 2. æ£€æŸ¥ CloudSync å®ä¾‹
            console.log('2ï¸âƒ£ CloudSync ç®¡ç†å™¨çŠ¶æ€:');
            if (typeof cloudSync === 'undefined' || cloudSync === null) {
                console.log('   âŒ CloudSync ç®¡ç†å™¨æœªåˆ›å»º');
            } else {
                console.log('   âœ… CloudSync ç®¡ç†å™¨å·²åˆ›å»º');
                console.log('   ğŸ“Š åˆå§‹åŒ–çŠ¶æ€:', cloudSync.isInitialized ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–');
                console.log('   ğŸ“Š åŒæ­¥è¿›è¡Œä¸­:', cloudSync._syncState?.inProgress ? 'æ˜¯' : 'å¦');
                console.log('   ğŸ“Š æœ€ååŒæ­¥æ—¶é—´:', cloudSync._syncState?.lastSyncTime || cloudSync.lastSyncTime || 'ä»æœªåŒæ­¥');
            }
            console.log('');

            // 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
            console.log('3ï¸âƒ£ æ•°æ®åº“è¿æ¥çŠ¶æ€:');
            if (cloudSync && cloudSync.isInitialized && cloudSync.db) {
                console.log('   âœ… æ•°æ®åº“å®ä¾‹å·²åˆ›å»º');
                console.log('   ğŸ”— æ•°æ®åº“ URL:', cloudSync.firebaseConfig.databaseURL);

                // å°è¯•æ£€æŸ¥è¿æ¥çŠ¶æ€
                cloudSync.db.ref('.info/connected').once('value')
                    .then(snapshot => {
                        if (snapshot.val() === true) {
                            console.log('   âœ… å®æ—¶è¿æ¥å·²å»ºç«‹');
                        } else {
                            console.log('   âš ï¸ è¿æ¥çŠ¶æ€æœªçŸ¥');
                        }
                    })
                    .catch(error => {
                        console.log('   âŒ è¿æ¥æ£€æŸ¥å¤±è´¥:', error.message);
                    });
            } else {
                console.log('   âŒ æ•°æ®åº“æœªåˆå§‹åŒ–');
            }
            console.log('');

            // 4. ç½‘ç»œçŠ¶æ€
            console.log('4ï¸âƒ£ ç½‘ç»œçŠ¶æ€:');
            console.log('   ğŸ“¶ åœ¨çº¿çŠ¶æ€:', navigator.onLine ? 'âœ… åœ¨çº¿' : 'âŒ ç¦»çº¿');
            console.log('');

            // 5. æœ¬åœ°å­˜å‚¨æ•°æ®
            console.log('5ï¸âƒ£ æœ¬åœ°å­˜å‚¨æ•°æ®:');
            console.log('   ğŸ“¦ äº§å“æ•°é‡:', products.length);
            console.log('   ğŸ‘¥ ç”¨æˆ·æ•°é‡:', allUsers.length);
            console.log('   ğŸ“ è®¢å•æ•°é‡:', userOrders.length);
            console.log('   ğŸ“ åœ°å€æ•°é‡:', userAddresses.length);
            console.log('');

            // 6. å½“å‰ç”¨æˆ·
            console.log('6ï¸âƒ£ å½“å‰ç”¨æˆ·:');
            if (currentUser) {
                console.log('   âœ… å·²ç™»å½•');
                console.log('   ğŸ‘¤ ç”¨æˆ·å:', currentUser.username);
                console.log('   ğŸ“§ é‚®ç®±:', currentUser.email);
            } else {
                console.log('   â„¹ï¸ æœªç™»å½•ï¼ˆæ¸¸å®¢æ¨¡å¼ï¼‰');
            }
            console.log('');

            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸ’¡ æç¤º: å¦‚éœ€é‡æ–°åˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('');

            return {
                sdkLoaded: typeof firebase !== 'undefined',
                cloudSyncCreated: cloudSync !== null,
                cloudSyncInitialized: cloudSync?.isInitialized || false,
                online: navigator.onLine,
                currentUser: currentUser?.username || 'guest'
            };
        };

        // åœ¨æ§åˆ¶å°æ˜¾ç¤ºæç¤º
        console.log('');
        console.log('ğŸ’¡ ä½¿ç”¨ checkFirebaseStatus() æŸ¥çœ‹å®Œæ•´çš„ Firebase çŠ¶æ€');
        console.log('');

        // ===================== æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ =====================

        // åœ¨é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
        function checkDataIntegrity() {
            console.log('ğŸ” æ£€æŸ¥æ•°æ®å®Œæ•´æ€§...');

            // æ£€æŸ¥äº§å“æ•°æ®
            if (!Array.isArray(products)) {
                console.warn('âš ï¸ äº§å“æ•°æ®å¼‚å¸¸ï¼Œæ­£åœ¨ä¿®å¤...');
                products = [];
                // ä¸è‡ªåŠ¨åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®ï¼Œä¿æŒç©ºæ•°ç»„
                localStorage.setItem('products', JSON.stringify(products));
            } else {
                // è¯¦ç»†æ£€æŸ¥äº§å“æ•°æ®è´¨é‡
                const validProducts = products.filter(p => p && typeof p === 'object' && p.id && p.name);
                const invalidCount = products.length - validProducts.length;
                
                if (invalidCount > 0) {
                    console.warn(`âš ï¸ å‘ç° ${invalidCount} ä¸ªæ— æ•ˆäº§å“ï¼Œæ­£åœ¨æ¸…ç†...`);
                    products = validProducts;
                    localStorage.setItem('products', JSON.stringify(products));
                }
                
                console.log(`ğŸ“¦ äº§å“æ•°æ®æ£€æŸ¥å®Œæˆï¼šå…± ${products.length} ä¸ªæœ‰æ•ˆäº§å“`);
            }

            // æ£€æŸ¥ç”¨æˆ·æ•°æ®
            if (!Array.isArray(allUsers)) {
                console.warn('âš ï¸ ç”¨æˆ·æ•°æ®å¼‚å¸¸ï¼Œæ­£åœ¨ä¿®å¤...');
                allUsers = [];
                initDefaultUsers();
            }

            // æ£€æŸ¥è®¢å•æ•°æ®
            if (!Array.isArray(userOrders)) {
                console.warn('âš ï¸ è®¢å•æ•°æ®å¼‚å¸¸ï¼Œæ­£åœ¨ä¿®å¤...');
                userOrders = [];
            }

            // æ£€æŸ¥åœ°å€æ•°æ®
            if (!Array.isArray(userAddresses)) {
                console.warn('âš ï¸ åœ°å€æ•°æ®å¼‚å¸¸ï¼Œæ­£åœ¨ä¿®å¤...');
                userAddresses = [];
            }

            console.log('âœ… æ•°æ®å®Œæ•´æ€§æ£€æŸ¥å®Œæˆ');
            
            // è¿”å›äº§å“æ•°æ®çŠ¶æ€
            return {
                productsValid: Array.isArray(products) && products.length > 0,
                productsCount: Array.isArray(products) ? products.length : 0,
                usersValid: Array.isArray(allUsers) && allUsers.length > 0,
                ordersValid: Array.isArray(userOrders)
            };
        }
        
        // éªŒè¯å¹¶é‡æ–°åŠ è½½äº§å“æ•°æ®ï¼ˆå¦‚æœä¸ºç©ºï¼‰
        async function verifyAndReloadProducts() {
            // ä½¿ç”¨å†…å­˜ä¸­çš„äº§å“æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œé¿å…ä¾èµ–æœ¬åœ°ç¼“å­˜
            const validProducts = Array.isArray(products)
                ? products.filter(p => p && typeof p === 'object' && p.id && p.name)
                : [];
            
            console.log(`ğŸ” éªŒè¯äº§å“æ•°æ®ï¼šå½“å‰å†…å­˜æœ‰ ${validProducts.length} ä¸ªæœ‰æ•ˆäº§å“`);
            
            // å¦‚æœäº§å“ä¸ºç©ºä¸”Firebaseå·²åˆå§‹åŒ–ï¼Œå°è¯•ä»äº‘ç«¯é‡æ–°åŠ è½½ï¼ˆå¤šæ¬¡é‡è¯•ï¼‰
            if (validProducts.length === 0 && cloudSync && cloudSync.isInitialized) {
                console.log('âš ï¸ äº§å“æ•°æ®ä¸ºç©ºï¼Œå°è¯•ä»äº‘ç«¯é‡æ–°åŠ è½½ï¼ˆå¤šæ¬¡é‡è¯•ï¼‰...');
                try {
                    const loaded = await cloudSync.loadProducts(4, 1000);
                    if (loaded) {
                        const reloadedProducts = JSON.parse(localStorage.getItem('products') || '[]');
                        const validReloaded = Array.isArray(reloadedProducts)
                            ? reloadedProducts.filter(p => p && typeof p === 'object' && p.id && p.name)
                            : [];
                        
                        if (validReloaded.length > 0) {
                            products = validReloaded;
                            console.log(`âœ… é‡æ–°åŠ è½½æˆåŠŸï¼Œè·å¾— ${products.length} ä¸ªäº§å“`);
                            
                            // é‡æ–°æ¸²æŸ“äº§å“åˆ—è¡¨
                            if (typeof renderProducts === 'function') {
                                renderProducts(products);
                            }
                            return true;
                        } else {
                            console.warn('âš ï¸ é‡æ–°åŠ è½½åä»æ— æœ‰æ•ˆäº§å“');
                        }
                    } else {
                        console.warn('âš ï¸ ä»äº‘ç«¯åŠ è½½äº§å“å¤±è´¥ï¼ˆå¤šæ¬¡é‡è¯•åï¼‰');
                    }
                } catch (error) {
                    console.error('âŒ é‡æ–°åŠ è½½äº§å“æ—¶å‡ºé”™:', error);
                }
            }
            
            return validProducts.length > 0;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
        window.addEventListener('load', () => {
            const integrityResult = checkDataIntegrity();
            
            // å»¶è¿ŸéªŒè¯äº§å“æ•°æ®ï¼ˆç»™FirebaseåŠ è½½æ—¶é—´ï¼‰
            setTimeout(async () => {
                console.log('ğŸ” å»¶è¿ŸéªŒè¯äº§å“æ•°æ®...');
                const verified = await verifyAndReloadProducts();
                
                if (!verified && cloudSync && cloudSync.isInitialized) {
                    console.warn('âš ï¸ äº§å“æ•°æ®éªŒè¯å¤±è´¥ï¼Œå°è¯•æœ€åä¸€æ¬¡é‡æ–°åŠ è½½...');
                    // æœ€åä¸€æ¬¡å°è¯•ï¼ˆå¢åŠ é‡è¯•æ¬¡æ•°ä¸å»¶è¿Ÿï¼‰
                    setTimeout(async () => {
                        try {
                            const finalLoad = await cloudSync.loadProducts(5, 1200);
                            if (finalLoad) {
                                const finalProducts = JSON.parse(localStorage.getItem('products') || '[]');
                                const validFinal = Array.isArray(finalProducts)
                                    ? finalProducts.filter(p => p && typeof p === 'object' && p.id && p.name)
                                    : [];
                                if (validFinal.length > 0) {
                                    products = validFinal;
                                    console.log(`âœ… æœ€ç»ˆåŠ è½½æˆåŠŸï¼Œè·å¾— ${products.length} ä¸ªäº§å“`);
                                    if (typeof renderProducts === 'function') {
                                        renderProducts(products);
                                    }
                                } else {
                                    console.error('âŒ æœ€ç»ˆåŠ è½½åä»æ— æœ‰æ•ˆäº§å“');
                                }
                            }
                        } catch (error) {
                            console.error('âŒ æœ€ç»ˆåŠ è½½å¤±è´¥:', error);
                        }
                    }, 2000);
                }
            }, 2000); // å»¶è¿Ÿ2ç§’ï¼Œç¡®ä¿Firebaseå·²å®Œå…¨åŠ è½½
        });

        // ===================== æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½å›¾ç‰‡ =====================

        // å›¾ç‰‡æ‡’åŠ è½½
        function lazyLoadImages() {
            const images = document.querySelectorAll('img[data-src]');

            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                });
            });

            images.forEach(img => imageObserver.observe(img));
        }

        // é¡µé¢åŠ è½½æ—¶å¯ç”¨æ‡’åŠ è½½
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', lazyLoadImages);
        } else {
            lazyLoadImages();
        }

        console.log('âœ… ç”µå•†å¹³å°ç³»ç»Ÿå·²å®Œå…¨åŠ è½½');
        console.log('ğŸ“Š åŠŸèƒ½æ¨¡å—ï¼š');
        console.log('  - ç”¨æˆ·è®¤è¯ç³»ç»Ÿ');
        console.log('  - äº§å“ç®¡ç†ç³»ç»Ÿ');
        console.log('  - è®¢å•ç®¡ç†ç³»ç»Ÿ');
        console.log('  - åå°ç®¡ç†ç³»ç»Ÿ');
        console.log('  - å®æ—¶æœç´¢ä¸ç­›é€‰');
        console.log('  - è´­ç‰©è½¦ç³»ç»Ÿ');
        console.log('  - æ”¶è´§åœ°å€ç®¡ç†');
        console.log('  - æ•°æ®ç»Ÿè®¡åˆ†æ');
        console.log('  - ä¸»é¡µè‡ªå®šä¹‰ç¼–è¾‘');
        console.log('  - Excelæ‰¹é‡å¯¼å…¥å¯¼å‡º');
        console.log('  - äº‘ç«¯æ•°æ®åŒæ­¥');
        console.log('  - ç¦»çº¿ç¼“å­˜æ”¯æŒ');
        console.log('  - å®æ—¶åœ¨çº¿å®¢æœ');

        // ===================== åˆå§‹åŒ–äº‘ç«¯åŒæ­¥ =====================

        // å»¶è¿Ÿåˆå§‹åŒ–äº‘ç«¯åŒæ­¥ï¼Œç¡®ä¿ Firebase SDK å·²å®Œå…¨åŠ è½½
        window.addEventListener('load', async () => {
            // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ï¼Œç¡®ä¿æ‰€æœ‰å¤–éƒ¨è„šæœ¬éƒ½å·²åŠ è½½
            await new Promise(resolve => setTimeout(resolve, 1000));

            console.log('');
            console.log('ğŸš€ ========== åˆå§‹åŒ–äº‘ç«¯åŒæ­¥ ==========');
            console.log('');

            // æ£€æŸ¥ Firebase SDK æ˜¯å¦å·²åŠ è½½
            if (typeof firebase === 'undefined') {
                console.error('âŒ Firebase SDK æœªåŠ è½½ï¼Œè·³è¿‡äº‘ç«¯åŒæ­¥åˆå§‹åŒ–');
                console.log('ğŸ’¡ åº”ç”¨å°†ä»¥æœ¬åœ°æ¨¡å¼è¿è¡Œ');
                console.log('');
                return;
            }

            try {
                // åˆ›å»º CloudSyncManager å®ä¾‹
                console.log('ğŸ”§ åˆ›å»º CloudSyncManager å®ä¾‹...');
                cloudSync = new CloudSyncManager();
                window.cloudSync = cloudSync; // åŒæ—¶è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡å±æ€§ï¼Œæ–¹ä¾¿è°ƒè¯•

                // åˆå§‹åŒ–äº‘ç«¯åŒæ­¥
                console.log('ğŸ”§ å¼€å§‹åˆå§‹åŒ–äº‘ç«¯åŒæ­¥...');
                await cloudSync.init();

                console.log('');
                console.log('âœ… äº‘ç«¯åŒæ­¥åˆå§‹åŒ–å®Œæˆï¼');
                console.log('');
                console.log('========================================');
                console.log('');
            } catch (error) {
                console.error('âŒ äº‘ç«¯åŒæ­¥åˆå§‹åŒ–å¤±è´¥:', error);
                console.log('ğŸ’¡ åº”ç”¨å°†ä»¥æœ¬åœ°æ¨¡å¼è¿è¡Œ');
                console.log('');
            }
        });

        // ========== Firebase è°ƒè¯•æ§åˆ¶å° ==========
        // åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè°ƒè¯•ï¼š

        // é‡æ–°åˆå§‹åŒ– Firebase
        window.reinitFirebase = async function () {
            console.log('');
            console.log('ğŸ”„ ========== æ‰‹åŠ¨é‡æ–°åˆå§‹åŒ– Firebase ==========');
            console.log('');

            if (cloudSync) {
                // æ¸…ç†æ—§çš„å®ä¾‹
                if (cloudSync.syncInterval) {
                    clearInterval(cloudSync.syncInterval);
                    console.log('ğŸ§¹ å·²æ¸…ç†å®šæœŸåŒæ­¥ä»»åŠ¡');
                }

                if (cloudSync.listeners && cloudSync.listeners.length > 0) {
                    cloudSync.listeners.forEach(listener => {
                        if (listener && typeof listener.off === 'function') {
                            listener.off();
                        }
                    });
                    cloudSync.listeners = [];
                    console.log('ğŸ§¹ å·²æ¸…ç†å®æ—¶ç›‘å¬å™¨');
                }

                cloudSync.isInitialized = false;
                console.log('âœ… æ—§å®ä¾‹å·²æ¸…ç†');
                console.log('');
            }

            // åˆ›å»ºæ–°å®ä¾‹å¹¶åˆå§‹åŒ–
            console.log('ğŸ”„ åˆ›å»ºæ–°çš„ CloudSyncManager å®ä¾‹...');
            cloudSync = new CloudSyncManager();
            window.cloudSync = cloudSync;

            console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–...');
            await cloudSync.init();

            console.log('');
            console.log('========================================');
            console.log('');
        };

        // è¯Šæ–­é…ç½®
        window.diagnoseFirebase = function () {
            if (cloudSync) {
                return cloudSync.diagnoseConfiguration();
            } else {
                console.error('âŒ CloudSyncManager æœªåˆå§‹åŒ–');
                return null;
            }
        };

        // æµ‹è¯•è¿æ¥
        window.testFirebaseConnection = async function () {
            if (cloudSync && cloudSync.db) {
                try {
                    await cloudSync.testConnection();
                    console.log('âœ… è¿æ¥æµ‹è¯•å®Œæˆ');
                } catch (error) {
                    console.error('âŒ è¿æ¥æµ‹è¯•å¤±è´¥:', error);
                }
            } else {
                console.error('âŒ Firebase æœªåˆå§‹åŒ–æˆ–æ•°æ®åº“å®ä¾‹ä¸å­˜åœ¨');
            }
        };

        // æ˜¾ç¤ºå½“å‰çŠ¶æ€
        window.showFirebaseStatus = function () {
            console.log('');
            console.log('ğŸ“Š ========== Firebase çŠ¶æ€ ==========');
            console.log('');
            console.log('SDK åŠ è½½çŠ¶æ€:', typeof firebase !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            if (typeof firebase !== 'undefined') {
                console.log('SDK ç‰ˆæœ¬:', firebase.SDK_VERSION || 'unknown');
            }
            console.log('');
            console.log('CloudSyncManager:');
            console.log('  - å·²åˆå§‹åŒ–:', cloudSync?.isInitialized ? 'âœ… æ˜¯' : 'âŒ å¦');
            console.log('  - æ•°æ®åº“å®ä¾‹:', cloudSync?.db ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
            console.log('  - åŒæ­¥è¿›è¡Œä¸­:', cloudSync?._syncState?.inProgress ? 'æ˜¯' : 'å¦');
            console.log('  - ä¸Šæ¬¡åŒæ­¥:', cloudSync?._syncState?.lastSyncTime ? new Date(cloudSync._syncState.lastSyncTime).toLocaleString() : (cloudSync?.lastSyncTime ? new Date(cloudSync.lastSyncTime).toLocaleString() : 'ä»æœªåŒæ­¥'));
            console.log('  - ç›‘å¬å™¨æ•°é‡:', cloudSync?.listeners?.length || 0);
            console.log('');

            if (cloudSync?.firebaseConfig) {
                console.log('é…ç½®ä¿¡æ¯:');
                console.log('  - Project ID:', cloudSync.firebaseConfig.projectId);
                console.log('  - Database URL:', cloudSync.firebaseConfig.databaseURL);
                console.log('  - Auth Domain:', cloudSync.firebaseConfig.authDomain);
            }

            console.log('');
            console.log('====================================');
            console.log('');
        };

        // æ‰‹åŠ¨è§¦å‘åŒæ­¥
        window.manualSync = async function () {
            if (cloudSync && cloudSync.isInitialized) {
                console.log('ğŸ”„ æ‰‹åŠ¨è§¦å‘æ•°æ®åŒæ­¥...');
                try {
                    await cloudSync.syncAllData();
                    console.log('âœ… åŒæ­¥å®Œæˆ');
                } catch (error) {
                    console.error('âŒ åŒæ­¥å¤±è´¥:', error);
                }
            } else {
                console.error('âŒ Firebase æœªåˆå§‹åŒ–ï¼Œæ— æ³•åŒæ­¥');
            }
        };

        // æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
        window.firebaseHelp = function () {
            console.log('');
            console.log('ğŸ”§ ========== Firebase è°ƒè¯•å·¥å…· ==========');
            console.log('');
            console.log('å¯ç”¨å‘½ä»¤ï¼š');
            console.log('');
            console.log('  reinitFirebase()           - é‡æ–°åˆå§‹åŒ– Firebase');
            console.log('  diagnoseFirebase()         - è¯Šæ–­é…ç½®é—®é¢˜');
            console.log('  testFirebaseConnection()   - æµ‹è¯•æ•°æ®åº“è¿æ¥');
            console.log('  showFirebaseStatus()       - æ˜¾ç¤ºå½“å‰çŠ¶æ€');
            console.log('  manualSync()               - æ‰‹åŠ¨è§¦å‘åŒæ­¥');
            console.log('  firebaseHelp()             - æ˜¾ç¤ºæ­¤å¸®åŠ©');
            console.log('');
            console.log('ç¤ºä¾‹ï¼š');
            console.log('  1. æ£€æŸ¥çŠ¶æ€:  showFirebaseStatus()');
            console.log('  2. è¯Šæ–­é…ç½®:  diagnoseFirebase()');
            console.log('  3. æµ‹è¯•è¿æ¥:  testFirebaseConnection()');
            console.log('  4. é‡æ–°åˆå§‹åŒ–: reinitFirebase()');
            console.log('');
            console.log('========================================');
            console.log('');
        };

        // å¯åŠ¨æ—¶æ˜¾ç¤ºè°ƒè¯•æç¤ºï¼ˆä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼‰
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('');
            console.log('ğŸ’¡ Firebase è°ƒè¯•å·¥å…·å·²åŠ è½½ï¼');
            console.log('   è¾“å…¥ firebaseHelp() æŸ¥çœ‹å¯ç”¨å‘½ä»¤');
            console.log('');
        }
    </script>

    <!-- é€šç”¨æ¶ˆæ¯æ¨¡æ€æ¡†ï¼ˆæ›¿ä»£alertå’Œconfirmï¼‰ -->
    <div class="modal" id="message-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header" id="message-modal-header">
                <h3 id="message-modal-title">æç¤º</h3>
                <button class="close-modal" onclick="closeMessageModal()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <p id="message-modal-text" style="margin: 0; color: var(--dark); font-size: 16px; line-height: 1.6;"></p>
            </div>
            <div class="modal-footer" id="message-modal-footer" style="padding: 15px 20px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid var(--border-subtle);">
                <button class="btn btn-secondary" id="message-modal-cancel" onclick="closeMessageModal()" style="display: none;">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="message-modal-confirm" onclick="confirmMessageModal()" style="display: none;">OK</button>
                <button class="btn btn-primary" id="message-modal-ok" onclick="closeMessageModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- è½®æ’­å›¾ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="carousel-edit-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="carousel-edit-title">æ·»åŠ è½®æ’­å›¾</h3>
                <button class="close-modal" onclick="closeCarouselEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="carousel-edit-form">
                    <div class="form-group">
                        <label for="carousel-title-input">è½®æ’­å›¾æ ‡é¢˜</label>
                        <input type="text" id="carousel-title-input" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="carousel-description-input">è½®æ’­å›¾æè¿°</label>
                        <textarea id="carousel-description-input" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="carousel-button-text-input">æŒ‰é’®æ–‡å­—</label>
                        <input type="text" id="carousel-button-text-input" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="carousel-image-input">å›¾ç‰‡URL</label>
                        <input type="url" id="carousel-image-input" class="form-control" required>
                        <small style="color: var(--gray); font-size: 12px; margin-top: 5px; display: block;">è¯·è¾“å…¥å®Œæ•´çš„å›¾ç‰‡URLåœ°å€</small>
                    </div>
                    <div class="form-group" id="carousel-preview-group" style="display: none;">
                        <label>å›¾ç‰‡é¢„è§ˆ</label>
                        <div style="width: 100%; height: 200px; border: 1px solid var(--border-subtle); border-radius: 2px; overflow: hidden; background: var(--light); display: flex; align-items: center; justify-content: center;">
                            <img id="carousel-preview-img" src="" alt="é¢„è§ˆ" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="padding: 15px 20px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid var(--border-subtle);">
                <button class="btn btn-secondary" onclick="closeCarouselEditModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveCarouselItem()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- äº§å“æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="product-edit-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="product-edit-title">æ·»åŠ äº§å“</h3>
                <button class="close-modal" onclick="closeProductEditModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <form id="product-edit-form">
                    <div class="form-group">
                        <label for="product-name-input">äº§å“åç§° <span style="color: var(--danger);">*</span></label>
                        <input type="text" id="product-name-input" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="product-price-input">äº§å“ä»·æ ¼ <span style="color: var(--danger);">*</span></label>
                        <input type="number" id="product-price-input" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="product-stock-input">äº§å“åº“å­˜</label>
                        <input type="number" id="product-stock-input" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="product-category-input">äº§å“åˆ†ç±»</label>
                        <select id="product-category-input" class="form-control">
                            <option value="electronics">Electronics</option>
                            <option value="home">Home & Living</option>
                            <option value="clothing">Clothing & Shoes</option>
                            <option value="beauty">Beauty & Skincare</option>
                            <option value="sports">Sports & Outdoors</option>
                            <option value="other" selected>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>äº§å“å›¾ç‰‡URLï¼ˆæœ€å¤š6å¼ ï¼‰ <span style="color: var(--danger);">*</span></label>
                        <div class="product-image-inputs">
                            <input type="url" id="product-image-input-1" class="form-control product-image-url-input" placeholder="å›¾ç‰‡URL 1ï¼ˆå¿…å¡«ï¼‰" required>
                            <input type="url" id="product-image-input-2" class="form-control product-image-url-input" placeholder="å›¾ç‰‡URL 2ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="product-image-input-3" class="form-control product-image-url-input" placeholder="å›¾ç‰‡URL 3ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="product-image-input-4" class="form-control product-image-url-input" placeholder="å›¾ç‰‡URL 4ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="product-image-input-5" class="form-control product-image-url-input" placeholder="å›¾ç‰‡URL 5ï¼ˆå¯é€‰ï¼‰">
                            <input type="url" id="product-image-input-6" class="form-control product-image-url-input" placeholder="å›¾ç‰‡URL 6ï¼ˆå¯é€‰ï¼‰">
                        </div>
                        <small style="color: var(--gray); font-size: 12px; margin-top: 5px; display: block;">ç¬¬ä¸€å¼ å›¾ç‰‡å°†ä½œä¸ºå°é¢å±•ç¤ºï¼Œæ”¯æŒæœ€å¤š6å¼ å›¾ç‰‡URL</small>
                    </div>
                    <div class="form-group" id="product-preview-group" style="display: none;">
                        <label>å›¾ç‰‡é¢„è§ˆ</label>
                        <div style="width: 100%; height: 200px; border: 1px solid var(--border-subtle); border-radius: 2px; overflow: hidden; background: var(--light); display: flex; align-items: center; justify-content: center;">
                            <img id="product-preview-img" src="" alt="é¢„è§ˆ" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="product-link-input">è·³è½¬é“¾æ¥ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="url" id="product-link-input" class="form-control" placeholder="è®¾ç½®åï¼Œå‰å°ä¼šæ˜¾ç¤ºâ€œå‰å¾€é“¾æ¥â€æŒ‰é’®">
                        <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">ä»…å½“å¡«å†™é“¾æ¥æ—¶ï¼Œå‰å°æŒ‰é’®æ‰ä¼šå±•ç¤º</small>
                    </div>
                    <div class="form-group">
                        <label for="product-description-input">äº§å“æè¿°</label>
                        <textarea id="product-description-input" class="form-control" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="padding: 15px 20px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid var(--border-subtle);">
                <button class="btn btn-secondary" onclick="closeProductEditModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveProductItem()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ========== é€šç”¨æ¶ˆæ¯æ¨¡æ€æ¡†å‡½æ•°ï¼ˆæ›¿ä»£alertå’Œconfirmï¼‰ ==========
        let messageModalCallback = null;
        let messageModalType = 'alert'; // 'alert' æˆ– 'confirm'

        // ç®€æ˜“ç¿»è¯‘æ˜ å°„ï¼ˆç”¨äºå…œåº•å°†å¸¸è§ä¸­æ–‡æç¤ºç¿»ä¸ºè‹±æ–‡ï¼‰
        const INLINE_CN_EN_MAP = {
            'ç½‘ç»œå·²è¿æ¥': 'Network connected',
            'æ‚¨å·²ç¦»çº¿ï¼Œæ•°æ®å°†è¢«ç¼“å­˜': 'You are offline. Data will be cached',
            'æ­£åœ¨åŒæ­¥æ•°æ®...': 'Syncing data...',
            'æˆåŠŸåŒæ­¥': 'Sync successful',
            'ç¼“å­˜å·²æ¸…é™¤': 'Cache cleared',
            'è¯·å…ˆç™»å½•': 'Please login first',
            'æƒé™ä¸è¶³': 'Insufficient permissions',
            'è´¦å·è¢«ç¦ç”¨': 'Account disabled',
            'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•': 'Login failed, please try again later',
            'æ³¨å†ŒæˆåŠŸï¼': 'Registration successful!',
            'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•': 'Registration failed, please try again later',
            'è¯·è¾“å…¥è´¦å·': 'Please enter account',
            'è´¦å·é•¿åº¦è‡³å°‘ä¸º3ä¸ªå­—ç¬¦': 'Account must be at least 3 characters',
            'è¯·è¾“å…¥å¯†ç ': 'Please enter password',
            'è¯·ç¡®è®¤å¯†ç ': 'Please confirm password',
            'å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä¸ªå­—ç¬¦': 'Password must be at least 6 characters',
            'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°è¾“å…¥': 'The two passwords do not match, please re-enter',
            'äº§å“åç§°ä¸èƒ½ä¸ºç©º': 'Product name cannot be empty',
            'è¯·è¾“å…¥æœ‰æ•ˆçš„äº§å“ä»·æ ¼': 'Please enter a valid price',
            'è¯·è‡³å°‘è¾“å…¥ä¸€å¼ äº§å“å›¾ç‰‡URL': 'Please enter at least one product image URL',
            'äº§å“å·²æ›´æ–°': 'Product updated',
            'äº§å“æ·»åŠ æˆåŠŸï¼': 'Product added successfully!',
            'äº§å“æ·»åŠ å¤±è´¥': 'Failed to add product',
            'ç”¨æˆ·ä¸å­˜åœ¨': 'User not found',
            'ç”¨æˆ·æ•°æ®å·²é‡ç½®': 'User data has been reset',
            'ç”¨æˆ·å·²ç¦ç”¨': 'User has been disabled',
            'ç”¨æˆ·å·²è§£ç¦': 'User has been unbanned',
            'è®¢å•å·²åˆ é™¤': 'Order deleted',
            'è¯·å…ˆå‹¾é€‰è¦åˆ é™¤çš„è®¢å•': 'Please select orders to delete first'
        };
        function translateInline(msg){
            if (!msg || currentLanguage !== 'en') return msg;
            return INLINE_CN_EN_MAP[msg] || msg;
        }

        function showMessageModal(title, message, type = 'alert', callback = null) {
            const modal = document.getElementById('message-modal');
            const titleEl = document.getElementById('message-modal-title');
            const textEl = document.getElementById('message-modal-text');
            const headerEl = document.getElementById('message-modal-header');
            const okBtn = document.getElementById('message-modal-ok');
            const confirmBtn = document.getElementById('message-modal-confirm');
            const cancelBtn = document.getElementById('message-modal-cancel');

            // æ ‡é¢˜ä¸æ¶ˆæ¯ç»Ÿä¸€å›½é™…åŒ–
            const titleMap = { 'é”™è¯¯': (t('errorTitle')||'Error'), 'æˆåŠŸ': (t('successTitle')||'Success'), 'æç¤º': (t('infoTitle')||'Notice'), 'ç¡®è®¤': (t('confirmTitle')||'Confirm'), 'ç³»ç»Ÿé”™è¯¯': (t('errorTitle')||'Error')};
            const finalTitle = titleMap[title] || title || (t('infoTitle') || 'Notice');
            titleEl.textContent = finalTitle;
            // æ”¯æŒ HTML å†…å®¹ï¼ˆå¦‚æœ message åŒ…å« HTML æ ‡ç­¾åˆ™ä½¿ç”¨ innerHTMLï¼Œå¦åˆ™ä½¿ç”¨ textContentï¼‰
            if (typeof message === 'string' && (message.includes('<') && message.includes('>'))) {
                textEl.innerHTML = translateInline(message);
            } else {
                textEl.textContent = translateInline(message);
            }
            messageModalType = type;
            messageModalCallback = callback;

            // æ›´æ–°æŒ‰é’®æ–‡æ¡ˆ
            okBtn.textContent = (t('ok') || 'OK');
            confirmBtn.textContent = (t('confirm') || 'Confirm');
            cancelBtn.textContent = (t('cancel') || 'Cancel');

            if (type === 'confirm') {
                okBtn.style.display = 'none';
                confirmBtn.style.display = 'inline-flex';
                cancelBtn.style.display = 'inline-flex';
                headerEl.style.background = 'var(--primary)';
            } else {
                okBtn.style.display = 'inline-flex';
                confirmBtn.style.display = 'none';
                cancelBtn.style.display = 'none';
                headerEl.style.background = 'var(--primary)';
            }

            modal.style.display = 'flex';
        }

        function closeMessageModal() {
            const modal = document.getElementById('message-modal');
            modal.style.display = 'none';
            if (messageModalCallback && messageModalType === 'confirm') {
                messageModalCallback(false);
            }
            messageModalCallback = null;
        }

        function confirmMessageModal() {
            const modal = document.getElementById('message-modal');
            modal.style.display = 'none';
            if (messageModalCallback) {
                messageModalCallback(true);
            }
            messageModalCallback = null;
        }

            // æ›¿ä»£alertå‡½æ•°ï¼ˆæ”¯æŒå¤šè¯­è¨€æ ‡é¢˜ï¼‰
            function customAlert(message, title) {
                const finalTitle = title || (typeof t === 'function' ? t('infoTitle') : 'Info');
            return new Promise((resolve) => {
                    showMessageModal(finalTitle, message, 'alert', () => resolve());
            });
        }

        // æ›¿ä»£confirmå‡½æ•°
            function customConfirm(message, title) {
                const finalTitle = title || (typeof t === 'function' ? t('confirmTitle') : 'Confirm');
            return new Promise((resolve) => {
                    showMessageModal(finalTitle, message, 'confirm', (result) => resolve(result));
            });
        }

        // ========== è½®æ’­å›¾ç¼–è¾‘æ¨¡æ€æ¡†å‡½æ•° ==========
        let currentCarouselEditData = { id: null, type: 'desktop', isEdit: false };

        function openCarouselEditModal(type = 'desktop', item = null) {
            const modal = document.getElementById('carousel-edit-modal');
            const titleEl = document.getElementById('carousel-edit-title');
            const form = document.getElementById('carousel-edit-form');

            currentCarouselEditData.type = type;
            currentCarouselEditData.isEdit = !!item;
            currentCarouselEditData.id = item ? item.id : null;

            if (item) {
                titleEl.textContent = `ç¼–è¾‘${type === 'mobile' ? 'ç§»åŠ¨ç«¯' : 'PCç«¯'}è½®æ’­å›¾`;
                document.getElementById('carousel-title-input').value = item.title || '';
                document.getElementById('carousel-description-input').value = item.description || '';
                document.getElementById('carousel-button-text-input').value = item.buttonText || '';
                document.getElementById('carousel-image-input').value = item.image || '';
                updateCarouselPreview(item.image);
            } else {
                titleEl.textContent = `æ·»åŠ ${type === 'mobile' ? 'ç§»åŠ¨ç«¯' : 'PCç«¯'}è½®æ’­å›¾`;
                form.reset();
                document.getElementById('carousel-preview-group').style.display = 'none';
            }

            modal.style.display = 'flex';
        }

        function closeCarouselEditModal() {
            const modal = document.getElementById('carousel-edit-modal');
            modal.style.display = 'none';
            document.getElementById('carousel-edit-form').reset();
            document.getElementById('carousel-preview-group').style.display = 'none';
            currentCarouselEditData = { id: null, type: 'desktop', isEdit: false };
        }

        function saveCarouselItem() {
            const title = document.getElementById('carousel-title-input').value.trim();
            const description = document.getElementById('carousel-description-input').value.trim();
            const buttonText = document.getElementById('carousel-button-text-input').value.trim();
            const image = document.getElementById('carousel-image-input').value.trim();

            if (!title || !description || !buttonText || !image) {
                showMessageModal(t('errorTitle'), t('pleaseFillAllRequiredFields'), 'alert');
                return;
            }

            if (currentCarouselEditData.isEdit && currentCarouselEditData.id) {
                // ç¼–è¾‘æ¨¡å¼
                const collection = currentCarouselEditData.type === 'mobile'
                    ? (homepageSettings.mobileCarousel || [])
                    : (homepageSettings.desktopCarousel || []);
                const item = collection.find(c => c.id === currentCarouselEditData.id);
                if (item) {
                    item.title = title;
                    item.description = description;
                    item.buttonText = buttonText;
                    item.image = image;
                    saveHomepageSettings();
                    renderCarouselList(currentCarouselEditData.type);
                    showMessageModal(t('successTitle'), t('carouselUpdated'), 'alert');
                    closeCarouselEditModal();
                }
            } else {
                // æ·»åŠ æ¨¡å¼
                const newItem = {
                    id: Date.now(),
                    title,
                    description,
                    buttonText,
                    image,
                    active: true
                };

                if (currentCarouselEditData.type === 'mobile') {
                    if (!Array.isArray(homepageSettings.mobileCarousel)) {
                        homepageSettings.mobileCarousel = [];
                    }
                    homepageSettings.mobileCarousel.push(newItem);
                } else {
                    if (!Array.isArray(homepageSettings.desktopCarousel)) {
                        homepageSettings.desktopCarousel = [];
                    }
                    homepageSettings.desktopCarousel.push(newItem);
                }
                saveHomepageSettings();
                renderCarouselList(currentCarouselEditData.type);
                showMessageModal(t('successTitle'), currentCarouselEditData.type === 'mobile' ? t('mobileCarouselAdded') : t('pcCarouselAdded'), 'alert');
                closeCarouselEditModal();
            }
        }

        function updateCarouselPreview(imageUrl) {
            const previewGroup = document.getElementById('carousel-preview-group');
            const previewImg = document.getElementById('carousel-preview-img');
            if (imageUrl) {
                previewImg.src = imageUrl;
                previewGroup.style.display = 'block';
                previewImg.onerror = function() {
                    previewImg.src = '';
                    previewImg.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';
                };
            } else {
                previewGroup.style.display = 'none';
            }
        }

        // å›¾ç‰‡URLè¾“å…¥æ—¶æ›´æ–°é¢„è§ˆ
        document.getElementById('carousel-image-input').addEventListener('input', function() {
            updateCarouselPreview(this.value);
        });


        // ========== äº§å“ç¼–è¾‘æ¨¡æ€æ¡†å‡½æ•° ==========
        let currentProductEditData = { id: null, isEdit: false };

        function openProductEditModal(product = null) {
            const modal = document.getElementById('product-edit-modal');
            const titleEl = document.getElementById('product-edit-title');
            const form = document.getElementById('product-edit-form');
            const linkInput = document.getElementById('product-link-input');

            currentProductEditData.isEdit = !!product;
            currentProductEditData.id = product ? product.id : null;

            const imageInputs = document.querySelectorAll('.product-image-url-input');

            if (product) {
                titleEl.textContent = 'ç¼–è¾‘äº§å“';
                document.getElementById('product-name-input').value = product.name || '';
                document.getElementById('product-price-input').value = product.price || '';
                document.getElementById('product-stock-input').value = product.stock || 0;
                document.getElementById('product-category-input').value = product.category || 'other';
                document.getElementById('product-description-input').value = product.description || '';
                if (linkInput) {
                    linkInput.value = product.redirectUrl || '';
                }

                const storedImages = Array.isArray(product.imageUrls) && product.imageUrls.length
                    ? product.imageUrls
                    : (product.image ? [product.image] : []);

                imageInputs.forEach((input, index) => {
                    input.value = storedImages[index] || '';
                });

                updateProductPreview(storedImages[0] || '');
            } else {
                titleEl.textContent = 'æ·»åŠ äº§å“';
                form.reset();
                document.getElementById('product-preview-group').style.display = 'none';
                imageInputs.forEach(input => input.value = '');
                if (linkInput) {
                    linkInput.value = '';
                }
            }

            modal.style.display = 'flex';
        }

        function closeProductEditModal() {
            const modal = document.getElementById('product-edit-modal');
            modal.style.display = 'none';
            document.getElementById('product-edit-form').reset();
            document.getElementById('product-preview-group').style.display = 'none';
            currentProductEditData = { id: null, isEdit: false };
        }

        function saveProductItem() {
            const name = document.getElementById('product-name-input').value.trim();
            const priceInput = document.getElementById('product-price-input').value;
            const stockInput = document.getElementById('product-stock-input').value;
            const category = document.getElementById('product-category-input').value;
            const imageInputs = Array.from(document.querySelectorAll('.product-image-url-input'));
            const imageUrls = imageInputs
                .map(input => input.value.trim())
                .filter(url => !!url)
                .slice(0, 6);
            const redirectUrl = (document.getElementById('product-link-input')?.value || '').trim();
            const description = document.getElementById('product-description-input').value.trim();

            if (!name) {
                showMessageModal(t('errorTitle'), t('pleaseEnterProductName'), 'alert');
                return;
            }

            const price = parseFloat(priceInput);
            if (!priceInput || isNaN(price) || price <= 0) {
                showMessageModal(t('errorTitle'), t('pleaseEnterValidPrice'), 'alert');
                return;
            }

            if (imageUrls.length === 0) {
                showMessageModal(t('errorTitle'), t('pleaseEnterAtLeastOneImage'), 'alert');
                return;
            }

            const stock = parseInt(stockInput) || 0;

            if (currentProductEditData.isEdit && currentProductEditData.id) {
                // ç¼–è¾‘æ¨¡å¼ - éœ€è¦æ‰¾åˆ°äº§å“å¹¶æ›´æ–°
                const product = products.find(p => p.id == currentProductEditData.id);
                if (product) {
                    product.name = name;
                    product.price = price;
                    product.stock = stock;
                    product.category = category;
                    product.image = imageUrls[0];
                    product.imageUrls = imageUrls;
                    for (let i = 1; i <= 6; i++) {
                        product[`imageUrl${i}`] = imageUrls[i - 1] || '';
                    }
                    product.description = description;
                    product.redirectUrl = redirectUrl;
                    saveProducts().then(() => {
                        renderAdminProducts();
                        renderProducts(products);
                        showMessageModal(t('successTitle'), t('productUpdated'), 'alert');
                        closeProductEditModal();
                    }).catch(err => {
                        showMessageModal(t('errorTitle'), t('productUpdateFailedError'), 'alert');
                    });
                }
            } else {
                // æ·»åŠ æ¨¡å¼
                let newId = 1;
                if (products.length > 0) {
                    const existingIds = products.map(p => parseInt(p.id) || 0);
                    const maxId = Math.max(...existingIds);
                    newId = maxId + 1;
                }

                const product = {
                    id: newId,
                    name,
                    price,
                    visible: true,
                    newPrice: 0,
                    stock: stock < 0 ? 0 : stock,
                    category,
                    image: imageUrls[0],
                    imageUrls,
                    description,
                    redirectUrl
                };

                for (let i = 1; i <= 6; i++) {
                    product[`imageUrl${i}`] = imageUrls[i - 1] || '';
                }

                products.push(product);
                saveProducts().then((saveResult) => {
                    if (saveResult) {
                        renderAdminProducts();
                        renderProducts(products);
                        showMessageModal(t('successTitle'), t('productAddedSuccess').replace('{id}', product.id), 'alert');
                        closeProductEditModal();
                    } else {
                        showMessageModal(t('errorTitle'), t('productAddFailedError'), 'alert');
                    }
                }).catch(err => {
                    showMessageModal(t('errorTitle'), t('productAddFailedError'), 'alert');
                });
            }
        }

        function updateProductPreview(imageUrl) {
            const previewGroup = document.getElementById('product-preview-group');
            const previewImg = document.getElementById('product-preview-img');
            if (imageUrl) {
                previewImg.src = imageUrl;
                previewGroup.style.display = 'block';
                previewImg.onerror = function() {
                    previewImg.src = '';
                    previewImg.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';
                };
            } else {
                previewGroup.style.display = 'none';
            }
        }

        // å›¾ç‰‡URLè¾“å…¥æ—¶æ›´æ–°é¢„è§ˆ
        const productCoverInput = document.getElementById('product-image-input-1');
        if (productCoverInput) {
            productCoverInput.addEventListener('input', function() {
            updateProductPreview(this.value);
            });
        }

    </script>

    <!-- é…·ç‚«ç©¿å¿ƒå½©è›‹é¡µé¢ -->
    <div id="romantic-easter-egg" style="display: none;">
        <canvas id="particles-canvas"></canvas>
        <div class="romantic-container">
            <!-- åŠ¨æ€èƒŒæ™¯å…‰æ•ˆ -->
            <div class="bg-lights">
                <div class="light light1"></div>
                <div class="light light2"></div>
                <div class="light light3"></div>
            </div>
            
            <!-- ä¸€ç®­ç©¿å¿ƒåŠ¨ç”» -->
            <div class="arrow-heart-container">
                <!-- çˆ±å¿ƒ -->
                <div class="pierced-heart-3d" id="heart-container">
                    <div class="heart-3d-wrapper">
                        <div class="heart-3d" id="heart-3d">
                            <div class="heart-half heart-left-3d"></div>
                            <div class="heart-half heart-right-3d"></div>
                            <div class="heart-glow"></div>
                        </div>
                    </div>
                </div>
                <!-- ç®­ -->
                <div class="arrow-flying" id="arrow-flying">
                    <div class="arrow-shaft"></div>
                    <div class="arrow-head"></div>
                    <div class="arrow-trail"></div>
                </div>
                <!-- çˆ†ç‚¸ç²’å­å®¹å™¨ -->
                <div class="explosion-particles" id="explosion-particles"></div>
            </div>
            
            <!-- ä¼˜é›…æ–‡å­— -->
            <div class="romantic-text">
                <h1 class="text-animation-3d">
                    <span class="text-gradient">æˆ‘ä»¬çš„ç¼˜åˆ†ä»æ­¤åˆ»å¼€å§‹</span>
                </h1>
                <p class="subtitle-animation-3d"è‡´ç¦ç¦ è®©å¹³å‡¡çš„æ—¥å­éƒ½å˜æˆè¯—ç¯‡</p>
            </div>
            
            <!-- ç²’å­æ•ˆæœå®¹å™¨ -->
            <div class="particles-container" id="particles-container"></div>
            
            <!-- å€’è®¡æ—¶æ˜¾ç¤º -->
            <div class="countdown" id="countdown">10</div>
            
            <button class="close-romantic-btn" onclick="closeRomanticEasterEgg()">è·³è¿‡</button>
        </div>
    </div>

    <style>
        /* ä¼˜é›…æµªæ¼«å½©è›‹é¡µé¢æ ·å¼ */
        #romantic-easter-egg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: 
                radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, #1a0a1a 0%, #2d1b2d 30%, #3d2b3d 50%, #2d1b2d 70%, #1a0a1a 100%);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            animation: fadeIn 1s ease-in;
            position: relative;
        }

        #romantic-easter-egg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 40%);
            animation: backgroundPulse 8s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes backgroundPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Canvasç²’å­èƒŒæ™¯ */
        #particles-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .romantic-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* åŠ¨æ€èƒŒæ™¯å…‰æ•ˆ */
        .bg-lights {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 2;
        }

        .light {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: lightMove 8s ease-in-out infinite;
        }

        .light1 {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.7), rgba(99, 102, 241, 0.3), transparent);
            top: -250px;
            left: -250px;
            animation-duration: 12s;
            filter: blur(60px);
        }

        .light2 {
            width: 700px;
            height: 700px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.6), rgba(139, 92, 246, 0.2), transparent);
            bottom: -350px;
            right: -350px;
            animation-duration: 15s;
            animation-delay: 2s;
            filter: blur(70px);
        }

        .light3 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.5), rgba(168, 85, 247, 0.2), transparent);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-duration: 18s;
            animation-delay: 4s;
            filter: blur(50px);
        }

        @keyframes lightMove {
            0%, 100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.6;
            }
            25% {
                transform: translate(150px, 100px) scale(1.3);
                opacity: 0.8;
            }
            50% {
                transform: translate(-100px, 150px) scale(1.1);
                opacity: 0.7;
            }
            75% {
                transform: translate(100px, -100px) scale(0.9);
                opacity: 0.6;
            }
        }

        /* ä¸€ç®­ç©¿å¿ƒå®¹å™¨ */
        .arrow-heart-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin-bottom: 60px;
            perspective: 1000px;
            z-index: 5;
        }

        /* çˆ±å¿ƒå®¹å™¨ */
        .pierced-heart-3d {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            perspective: 1000px;
            z-index: 3;
        }

        .heart-3d-wrapper {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: heart3DRotate 20s linear infinite;
        }

        @keyframes heart3DRotate {
            0% {
                transform: rotateY(0deg) rotateX(0deg);
            }
            25% {
                transform: rotateY(90deg) rotateX(10deg);
            }
            50% {
                transform: rotateY(180deg) rotateX(0deg);
            }
            75% {
                transform: rotateY(270deg) rotateX(-10deg);
            }
            100% {
                transform: rotateY(360deg) rotateX(0deg);
            }
        }

        .heart-3d {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: heartbeat3D 1.2s ease-in-out infinite;
        }

        @keyframes heartbeat3D {
            0%, 100% {
                transform: scale(1) translateZ(0);
            }
            25% {
                transform: scale(1.15) translateZ(20px);
            }
            50% {
                transform: scale(1) translateZ(0);
            }
            75% {
                transform: scale(1.08) translateZ(10px);
            }
        }

        /* çˆ±å¿ƒçˆ†ç‚¸åŠ¨ç”» */
        .heart-3d.exploding {
            animation: heartExplode 0.8s ease-out forwards;
        }

        @keyframes heartExplode {
            0% {
                transform: scale(1) translateZ(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.5) translateZ(50px);
                opacity: 0.8;
            }
            100% {
                transform: scale(2) translateZ(100px);
                opacity: 0;
            }
        }

        .heart-half {
            position: absolute;
            width: 160px;
            height: 260px;
            border-radius: 160px 160px 0 0;
            filter: drop-shadow(0 0 30px currentColor);
            transition: all 0.3s ease;
        }

        .heart-left-3d {
            left: 80px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            transform: rotate(-45deg) translateZ(0);
            transform-origin: 0 100%;
            color: #6366f1;
            animation: pulseLeft 2s ease-in-out infinite;
        }

        .heart-right-3d {
            right: 80px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 50%, #a855f7 100%);
            transform: rotate(45deg) translateZ(0);
            transform-origin: 100% 100%;
            color: #8b5cf6;
            animation: pulseRight 2s ease-in-out infinite;
        }

        @keyframes pulseLeft {
            0%, 100% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.6), 0 0 80px rgba(99, 102, 241, 0.3);
            }
            50% {
                box-shadow: 0 0 60px rgba(99, 102, 241, 0.8), 0 0 120px rgba(99, 102, 241, 0.5);
            }
        }

        @keyframes pulseRight {
            0%, 100% {
                box-shadow: 0 0 40px rgba(139, 92, 246, 0.6), 0 0 80px rgba(139, 92, 246, 0.3);
            }
            50% {
                box-shadow: 0 0 60px rgba(139, 92, 246, 0.8), 0 0 120px rgba(139, 92, 246, 0.5);
            }
        }

        /* é£è¡Œçš„ç®­ - ä»å·¦è¾¹é£åˆ°å³è¾¹ */
        .arrow-flying {
            position: absolute;
            top: 50%;
            left: -260px; /* èµ·ç‚¹æ›´é å·¦ï¼Œæ°´å¹³é£è¡Œ */
            width: 240px; /* æ¨ªå‘é•¿åº¦ */
            height: 16px;  /* ç«–å‘åšåº¦ */
            transform-origin: center center;
            z-index: 10;
            opacity: 0;
            transform: translateY(-50%) translateX(0) rotate(0deg);
            will-change: transform, opacity, filter;
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .arrow-flying.flying {
            animation: arrowFlyHorizontal 1.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            will-change: transform, opacity, filter;
        }

        /* ä»å·¦åˆ°å³ï¼šæµç•…çš„é£è¡Œè½¨è¿¹ï¼Œä½¿ç”¨æ›´å¹³æ»‘çš„ç¼“åŠ¨å‡½æ•° */
        @keyframes arrowFlyHorizontal {
            0% {
                opacity: 0;
                transform: translateY(-50%) translateX(-360px) scale(0.8);
                filter: blur(6px);
            }
            8% {
                opacity: 0.6;
                transform: translateY(-50%) translateX(-280px) scale(0.85);
                filter: blur(4px);
            }
            16% {
                opacity: 1;
                transform: translateY(-50%) translateX(-200px) scale(0.9);
                filter: blur(2px);
            }
            28% {
                opacity: 1;
                transform: translateY(-50%) translateX(-100px) scale(0.95);
                filter: blur(1px);
            }
            40% {
                opacity: 1;
                transform: translateY(-50%) translateX(0px) scale(1);
                filter: blur(0px);
            }
            52% {
                opacity: 1;
                transform: translateY(-50%) translateX(80px) scale(1.01);
                filter: blur(0px);
            }
            /* çº¦ 65% åœ¨çˆ±å¿ƒä¸­å¿ƒä½ç½® */
            65% {
                opacity: 1;
                transform: translateY(-50%) translateX(180px) scale(1.02);
                filter: blur(0px);
            }
            75% {
                opacity: 1;
                transform: translateY(-50%) translateX(260px) scale(1);
                filter: blur(0px);
            }
            85% {
                opacity: 0.95;
                transform: translateY(-50%) translateX(380px) scale(0.98);
                filter: blur(1px);
            }
            92% {
                opacity: 0.7;
                transform: translateY(-50%) translateX(460px) scale(0.92);
                filter: blur(3px);
            }
            100% {
                opacity: 0;
                transform: translateY(-50%) translateX(520px) scale(0.85);
                filter: blur(6px);
            }
        }

        .arrow-shaft {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, 
                rgba(255, 255, 255, 1) 0%, 
                rgba(238, 242, 255, 0.95) 10%,
                #6366f1 30%, 
                #8b5cf6 55%, 
                #a855f7 75%,
                rgba(139, 92, 246, 0.9) 100%);
            border-radius: 8px;
            box-shadow: 
                0 0 16px rgba(99, 102, 241, 0.9),
                0 0 32px rgba(139, 92, 246, 0.7),
                0 0 56px rgba(168, 85, 247, 0.5),
                inset 0 0 18px rgba(255, 255, 255, 0.35);
            position: relative;
            animation: shaftShimmer 2s ease-in-out infinite;
        }

        @keyframes shaftShimmer {
            0%, 100% {
                box-shadow: 
                    0 0 16px rgba(99, 102, 241, 0.9),
                    0 0 32px rgba(99, 102, 241, 0.7),
                    0 0 56px rgba(99, 102, 241, 0.5),
                    inset 0 0 18px rgba(255, 255, 255, 0.35);
            }
            50% {
                box-shadow: 
                    0 0 22px rgba(99, 102, 241, 1),
                    0 0 42px rgba(99, 102, 241, 0.85),
                    0 0 70px rgba(99, 102, 241, 0.65),
                    inset 0 0 26px rgba(255, 255, 255, 0.45);
            }
        }

        .arrow-head {
            position: absolute;
            top: 50%;
            right: -26px;
            transform: translateY(-50%) rotate(0deg);
            width: 0;
            height: 0;
            border-top: 12px solid transparent;
            border-bottom: 12px solid transparent;
            border-left: 28px solid #fff;
            filter: 
                drop-shadow(0 0 14px rgba(99, 102, 241, 1))
                drop-shadow(0 0 28px rgba(99, 102, 241, 0.8))
                drop-shadow(0 0 44px rgba(99, 102, 241, 0.6));
            z-index: 2;
            animation: headGlow 1.5s ease-in-out infinite;
        }

        @keyframes headGlow {
            0%, 100% {
                filter: 
                    drop-shadow(0 0 15px rgba(99, 102, 241, 1))
                    drop-shadow(0 0 30px rgba(99, 102, 241, 0.8))
                    drop-shadow(0 0 50px rgba(99, 102, 241, 0.6));
            }
            50% {
                filter: 
                    drop-shadow(0 0 25px rgba(99, 102, 241, 1.2))
                    drop-shadow(0 0 50px rgba(99, 102, 241, 1))
                    drop-shadow(0 0 80px rgba(99, 102, 241, 0.8));
            }
        }

        .arrow-head::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -4px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-left: 20px solid #6366f1;
        }

        .arrow-head::after {
            content: '';
            position: absolute;
            top: -4px;
            left: 0px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 16px solid #8b5cf6;
        }

        /* ç®­å°¾æ‹–å°¾æ•ˆæœ - å¢å¼ºç‰ˆ */
        .arrow-trail {
            position: absolute;
            top: 50%;
            left: -12px;
            transform: translateY(-50%);
            width: 120px;
            height: 10px;
            background: linear-gradient(to right, 
                rgba(99, 102, 241, 0.1) 0%,
                rgba(99, 102, 241, 0.45) 40%,
                rgba(99, 102, 241, 0.7) 70%,
                rgba(99, 102, 241, 0.2) 100%);
            border-radius: 6px;
            filter: blur(12px);
            animation: trailGlow 0.6s ease-in-out infinite;
            box-shadow: 0 0 18px rgba(99, 102, 241, 0.45);
        }

        @keyframes trailGlow {
            0%, 100% {
                opacity: 0.65;
                transform: translateY(-50%) scaleX(1);
                filter: blur(12px);
            }
            50% {
                opacity: 1;
                transform: translateY(-50%) scaleX(1.15);
                filter: blur(6px);
            }
        }

        /* çˆ†ç‚¸ç²’å­å®¹å™¨ */
        .explosion-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            pointer-events: none;
            z-index: 15;
        }

        /* å¿ƒå½¢å…‰æ™• */
        .heart-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: glowPulse 3s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes glowPulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3);
                opacity: 0.3;
            }
        }

        /* ä¼˜é›…æ–‡å­— */
        .romantic-text {
            text-align: center;
            z-index: 10;
            margin-top: 40px;
        }

        .text-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 30%, #a855f7 60%, #6366f1 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 56px;
            font-weight: 400;
            letter-spacing: 5px;
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            animation: textShimmer 4s ease-in-out infinite, textFloat 5s ease-in-out infinite;
            filter: 
                drop-shadow(0 0 15px rgba(99, 102, 241, 0.8))
                drop-shadow(0 0 30px rgba(139, 92, 246, 0.6))
                drop-shadow(0 0 50px rgba(168, 85, 247, 0.4));
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
        }

        @keyframes textShimmer {
            0%, 100% {
                background-position: 0% 50%;
                filter: 
                    drop-shadow(0 0 15px rgba(99, 102, 241, 0.8))
                    drop-shadow(0 0 30px rgba(99, 102, 241, 0.6))
                    drop-shadow(0 0 50px rgba(139, 92, 246, 0.4));
            }
            50% {
                background-position: 100% 50%;
                filter: 
                    drop-shadow(0 0 25px rgba(99, 102, 241, 1))
                    drop-shadow(0 0 50px rgba(99, 102, 241, 0.8))
                    drop-shadow(0 0 80px rgba(139, 92, 246, 0.6));
            }
        }

        @keyframes textFloat {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-12px) scale(1.02);
            }
        }

        .text-animation-3d {
            margin: 0 0 25px 0;
            opacity: 0;
            animation: textSlideIn 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.8s forwards;
        }

        .subtitle-animation-3d {
            color: rgba(255, 250, 250, 0.98);
            font-size: 32px;
            margin: 30px 0 0 0;
            font-weight: 300;
            letter-spacing: 4px;
            text-shadow: 
                0 0 20px rgba(99, 102, 241, 0.8),
                0 0 40px rgba(139, 92, 246, 0.6),
                0 0 60px rgba(168, 85, 247, 0.4);
            opacity: 0;
            animation: subtitleSlideIn 2s ease-out 3.2s both, subtitleGlow 3s ease-in-out infinite 5s, subtitleFloat 4s ease-in-out infinite 5s;
            line-height: 1.8;
        }

        @keyframes textSlideIn {
            from {
                transform: translateY(-80px) scale(0.5) rotateX(-20deg);
                opacity: 0;
                filter: blur(10px);
            }
            to {
                transform: translateY(0) scale(1) rotateX(0deg);
                opacity: 1;
                filter: blur(0px);
            }
        }

        @keyframes subtitleSlideIn {
            from {
                transform: translateY(60px) scale(0.8);
                opacity: 0;
                filter: blur(8px);
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
                filter: blur(0px);
            }
        }

        @keyframes subtitleGlow {
            0%, 100% {
                text-shadow: 
                    0 0 20px rgba(99, 102, 241, 0.8),
                    0 0 40px rgba(139, 92, 246, 0.6),
                    0 0 60px rgba(168, 85, 247, 0.4);
            }
            50% {
                text-shadow: 
                    0 0 30px rgba(99, 102, 241, 1),
                    0 0 60px rgba(139, 92, 246, 0.8),
                    0 0 90px rgba(168, 85, 247, 0.6);
            }
        }

        @keyframes subtitleFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        /* å€’è®¡æ—¶ */
        .countdown {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: 
                radial-gradient(circle, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.15) 100%);
            backdrop-filter: blur(15px);
            border: 3px solid rgba(99, 102, 241, 0.6);
            box-shadow: 
                0 0 20px rgba(99, 102, 241, 0.5),
                0 0 40px rgba(139, 92, 246, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 400;
            color: #fff;
            text-shadow: 
                0 0 15px rgba(99, 102, 241, 0.8),
                0 0 30px rgba(99, 102, 241, 0.6),
                0 0 50px rgba(139, 92, 246, 0.4);
            animation: countdownPulse 1.2s ease-in-out infinite;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .countdown:hover {
            transform: scale(1.1);
            box-shadow: 
                0 0 30px rgba(99, 102, 241, 0.8),
                0 0 60px rgba(99, 102, 241, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
        }

        @keyframes countdownPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 
                    0 0 20px rgba(99, 102, 241, 0.5),
                    0 0 40px rgba(99, 102, 241, 0.3),
                    inset 0 0 20px rgba(255, 255, 255, 0.1);
            }
            50% {
                transform: scale(1.08);
                box-shadow: 
                    0 0 30px rgba(99, 102, 241, 0.8),
                    0 0 60px rgba(99, 102, 241, 0.6),
                    inset 0 0 30px rgba(255, 255, 255, 0.2);
            }
        }

        /* å…³é—­æŒ‰é’® */
        .close-romantic-btn {
            position: absolute;
            bottom: 50px;
            padding: 18px 50px;
            background: 
                linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 2px solid rgba(99, 102, 241, 0.5);
            color: rgba(255, 250, 250, 0.98);
            font-size: 17px;
            font-weight: 400;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(20px);
            z-index: 100;
            letter-spacing: 3px;
            box-shadow: 
                0 0 20px rgba(99, 102, 241, 0.3),
                0 0 40px rgba(139, 92, 246, 0.2),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.6);
            animation: buttonGlow 2s ease-in-out infinite;
        }

        @keyframes buttonGlow {
            0%, 100% {
                box-shadow: 
                    0 0 20px rgba(99, 102, 241, 0.3),
                    0 0 40px rgba(139, 92, 246, 0.2),
                    inset 0 0 15px rgba(255, 255, 255, 0.1);
            }
            50% {
                box-shadow: 
                    0 0 30px rgba(99, 102, 241, 0.5),
                    0 0 60px rgba(139, 92, 246, 0.3),
                    inset 0 0 20px rgba(255, 255, 255, 0.15);
            }
        }

        .close-romantic-btn:hover {
            background: 
                linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(139, 92, 246, 0.25) 100%);
            border-color: rgba(99, 102, 241, 0.8);
            transform: scale(1.08) translateY(-5px);
            box-shadow: 
                0 10px 50px rgba(99, 102, 241, 0.6),
                0 0 80px rgba(99, 102, 241, 0.4),
                inset 0 0 25px rgba(255, 255, 255, 0.2);
            text-shadow: 
                0 0 15px rgba(99, 102, 241, 0.9),
                0 0 30px rgba(99, 102, 241, 0.6);
        }

        .close-romantic-btn:active {
            transform: scale(0.95);
        }

        /* æ‰‹æœºç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .arrow-heart-container {
                width: 350px;
                height: 350px;
                margin-bottom: 40px;
            }

            .pierced-heart-3d {
                width: 280px;
                height: 280px;
            }

            .heart-half {
                width: 110px;
                height: 180px;
            }

            .heart-left-3d {
                left: 55px;
            }

            .heart-right-3d {
                right: 55px;
            }

            .arrow-flying {
                height: 150px;
                width: 12px;
            }

            .arrow-head {
                border-left-width: 14px;
                border-right-width: 14px;
                border-bottom-width: 28px;
                top: 50%;
                right: -15px;
                transform: translateY(-50%) rotate(90deg);
            }

            .arrow-head::before {
                border-left-width: 10px;
                border-right-width: 10px;
                border-bottom-width: 20px;
            }

            .heart-glow {
                width: 250px;
                height: 250px;
            }

            .explosion-particles {
                width: 300px;
                height: 300px;
            }

            .text-gradient {
                font-size: 36px;
                padding: 0 20px;
                letter-spacing: 2px;
            }

            .subtitle-animation-3d {
                font-size: 20px;
                padding: 0 20px;
                letter-spacing: 2px;
            }

            .arrow-heart-container {
                width: 350px;
                height: 350px;
            }

            .pierced-heart-3d {
                width: 300px;
                height: 300px;
            }

            .countdown {
                width: 60px;
                height: 60px;
                font-size: 24px;
                top: 20px;
                right: 20px;
            }

            .close-romantic-btn {
                bottom: 30px;
                padding: 14px 35px;
                font-size: 16px;
            }

            .light {
                filter: blur(60px);
            }

            .light1 {
                width: 300px;
                height: 300px;
            }

            .light2 {
                width: 350px;
                height: 350px;
            }

            .light3 {
                width: 250px;
                height: 250px;
            }
        }
    </style>

    <script>
        // ç²’å­ç³»ç»Ÿ
        window.particles = [];
        window.animationId = null;
        window.countdownInterval = null;
        let countdownTime = 10;
        // å½©è›‹ç™»å½•ä¿¡æ¯å·²åœ¨DOMContentLoadedä¹‹å‰å®šä¹‰

        window.initParticles = function() {
            let particles = window.particles || [];
            const canvas = document.getElementById('particles-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // åˆ›å»ºç²’å­
            particles = [];
            window.particles = particles;
            const particleCount = Math.min(100, Math.floor((canvas.width * canvas.height) / 15000));
            
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 2 + 1,
                    speedX: (Math.random() - 0.5) * 0.5,
                    speedY: (Math.random() - 0.5) * 0.5,
                    color: `hsl(${Math.random() * 30 + 330}, ${Math.random() * 30 + 60}%, ${Math.random() * 20 + 75}%)`,
                    opacity: Math.random() * 0.4 + 0.2
                });
            }
            window.particles = particles;

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
                particles.forEach((particle, i) => {
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;
                    
                    // è¾¹ç•Œæ£€æµ‹
                    if (particle.x < 0 || particle.x > canvas.width) particle.speedX *= -1;
                    if (particle.y < 0 || particle.y > canvas.height) particle.speedY *= -1;
                    
                    // ç»˜åˆ¶ç²’å­
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fillStyle = particle.color;
                    ctx.globalAlpha = particle.opacity;
                    ctx.fill();
                    
                    // ç»˜åˆ¶è¿çº¿
                    particles.slice(i + 1).forEach(otherParticle => {
                        const dx = particle.x - otherParticle.x;
                        const dy = particle.y - otherParticle.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 150) {
                            ctx.beginPath();
                            ctx.moveTo(particle.x, particle.y);
                            ctx.lineTo(otherParticle.x, otherParticle.y);
                            ctx.strokeStyle = particle.color;
                            ctx.globalAlpha = (1 - distance / 150) * 0.3;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                        }
                    });
                });
                
                ctx.globalAlpha = 1;
                window.animationId = requestAnimationFrame(animate);
            }
            
            animate();
        };

        window.startCountdown = function() {
            countdownTime = 10;
            const countdownEl = document.getElementById('countdown');
            if (!countdownEl) return;
            
            countdownEl.textContent = countdownTime;
            
            window.countdownInterval = setInterval(() => {
                countdownTime--;
                if (countdownEl) {
                    countdownEl.textContent = countdownTime;
                    // æœ€å3ç§’æ—¶æ·»åŠ é—ªçƒæ•ˆæœ
                    if (countdownTime <= 3) {
                        countdownEl.style.animation = 'countdownPulse 0.5s ease-in-out infinite';
                    }
                }
                
                if (countdownTime <= 0) {
                    clearInterval(window.countdownInterval);
                    // æ¸…é™¤setTimeoutï¼Œé¿å…é‡å¤è°ƒç”¨
                    if (window.romanticLoginTimeout) {
                        clearTimeout(window.romanticLoginTimeout);
                        window.romanticLoginTimeout = null;
                    }
                    if (typeof window.closeRomanticEasterEgg === 'function') {
                        window.closeRomanticEasterEgg();
                    }
                    // ç»§ç»­ç™»å½•æµç¨‹
                    if (window.romanticLoginAccount && window.romanticLoginPassword) {
                        if (typeof handleRomanticLogin === 'function') {
                            handleRomanticLogin(window.romanticLoginAccount, window.romanticLoginPassword);
                        }
                        // æ¸…é™¤ä¿å­˜çš„ç™»å½•ä¿¡æ¯
                        window.romanticLoginAccount = null;
                        window.romanticLoginPassword = null;
                    }
                }
            }, 1000);
        };

        // çˆ†ç‚¸ç²’å­ç³»ç»Ÿ
        window.explosionParticles = [];
        window.explosionAnimationId = null;

        window.createExplosionParticles = function() {
            const container = document.getElementById('explosion-particles');
            if (!container) return;
            
            container.innerHTML = '';
            let explosionParticles = [];
            window.explosionParticles = explosionParticles;
            
            const particleCount = 120;
            const centerX = 200;
            const centerY = 200;
            const colors = [
                'radial-gradient(circle, #6366f1, #8b5cf6)',
                'radial-gradient(circle, #8b5cf6, #a855f7)',
                'radial-gradient(circle, #fff, #c7d2fe)',
                'radial-gradient(circle, #7c3aed, #6d28d9)',
                'radial-gradient(circle, #6366f1, #fff)'
            ];
            
            for (let i = 0; i < particleCount; i++) {
                const angle = (Math.PI * 2 * i) / particleCount + (Math.random() - 0.5) * 0.8;
                const speed = 3 + Math.random() * 5;
                const size = 4 + Math.random() * 8;
                const colorIndex = Math.floor(Math.random() * colors.length);
                
                const particle = document.createElement('div');
                particle.className = 'explosion-particle';
                particle.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${colors[colorIndex]};
                    border-radius: 50%;
                    left: ${centerX}px;
                    top: ${centerY}px;
                    box-shadow: 0 0 ${size * 3}px ${colors[colorIndex].includes('#6366f1') ? '#6366f1' : '#8b5cf6'}, 
                                0 0 ${size * 5}px ${colors[colorIndex].includes('#6366f1') ? '#8b5cf6' : '#6366f1'};
                    opacity: 0;
                    transition: opacity 0.1s ease-out;
                `;
                
                container.appendChild(particle);
                
                explosionParticles.push({
                    element: particle,
                    x: centerX,
                    y: centerY,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    size: size,
                    life: 1,
                    decay: 0.012 + Math.random() * 0.008,
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 10
                });
            }
            window.explosionParticles = explosionParticles;
            
            // å¼€å§‹çˆ†ç‚¸åŠ¨ç”»
            animateExplosion();
        };

        function animateExplosion() {
            if (window.explosionAnimationId) {
                cancelAnimationFrame(window.explosionAnimationId);
            }
            
            let activeParticles = (window.explosionParticles || []).filter(p => p.life > 0);
            
            if (activeParticles.length === 0) {
                return;
            }
            
            activeParticles.forEach(particle => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vx *= 0.97;
                particle.vy *= 0.97;
                particle.vy += 0.15; // é‡åŠ›æ•ˆæœ
                particle.life -= particle.decay;
                particle.rotation += particle.rotationSpeed;
                
                const opacity = Math.max(0, particle.life);
                const scale = 0.8 + (1 - particle.life) * 0.4;
                
                particle.element.style.left = particle.x + 'px';
                particle.element.style.top = particle.y + 'px';
                particle.element.style.opacity = opacity;
                particle.element.style.transform = `scale(${scale}) rotate(${particle.rotation}deg)`;
            });
            
            window.explosionAnimationId = requestAnimationFrame(animateExplosion);
        };

        // æµªæ¼«å½©è›‹åŠŸèƒ½å·²åœ¨DOMContentLoadedä¹‹å‰å®šä¹‰ï¼Œè¿™é‡Œä¸å†é‡å¤å®šä¹‰
        // å¦‚æœå‡½æ•°æœªå®šä¹‰ï¼Œè¯´æ˜å‰é¢çš„ä»£ç æœ‰é—®é¢˜ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç®€å•çš„å¤‡ç”¨æ–¹æ¡ˆ
        if (!window.showRomanticEasterEgg) {
            console.warn('âš ï¸ showRomanticEasterEgg å‡½æ•°æœªå®šä¹‰ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
            window.showRomanticEasterEgg = function(account = null, password = null) {
                console.error('âŒ å½©è›‹å‡½æ•°æœªæ­£ç¡®åŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢');
                const egg = document.getElementById('romantic-easter-egg');
                if (egg) {
                    egg.style.display = 'flex';
                    egg.style.zIndex = '99999';
                    document.body.style.overflow = 'hidden';
                }
            };
        }

        if (!window.closeRomanticEasterEgg) {
            console.warn('âš ï¸ closeRomanticEasterEgg å‡½æ•°æœªå®šä¹‰ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
            window.closeRomanticEasterEgg = function() {
                const egg = document.getElementById('romantic-easter-egg');
                if (egg) {
                    egg.style.display = 'none';
                    document.body.style.overflow = '';
                }
            };
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°åˆå§‹åŒ–ç²’å­
        window.addEventListener('resize', () => {
            const egg = document.getElementById('romantic-easter-egg');
            if (egg && egg.style.display === 'flex') {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                initParticles();
            }
        });

        // ç‚¹å‡»èƒŒæ™¯å…³é—­åŠŸèƒ½å·²ç§»é™¤ - åªèƒ½é€šè¿‡å…³é—­æŒ‰é’®å…³é—­
        // document.getElementById('romantic-easter-egg')?.addEventListener('click', function(e) {
        //     if (e.target === this) {
        //         closeRomanticEasterEgg();
        //     }
        // });

        // å¤„ç†å½©è›‹è´¦å·çš„æ­£å¸¸ç™»å½•æµç¨‹
        async function handleRomanticLogin(account, password) {
            // ========== ç™»å½•å‰æ¸…é™¤æœ¬åœ°ç¼“å­˜å’Œç™»å½•çŠ¶æ€ ==========
            console.log('ğŸ§¹ ç™»å½•å‰æ¸…é™¤æœ¬åœ°ç¼“å­˜å’Œæ—§çš„ç™»å½•çŠ¶æ€...');
            try {
                currentUser = null;
                try {
                    if (typeof Storage !== 'undefined' && Storage.remove) {
                        Storage.remove('currentUser');
                    } else {
                        localStorage.removeItem('currentUser');
                    }
                } catch (e1) {
                    console.warn('âš ï¸ æ¸…é™¤ currentUser æœ¬åœ°è®°å½•æ—¶å‡ºé”™:', e1);
                    try {
                        localStorage.removeItem('currentUser');
                    } catch (e2) {
                        console.warn('âš ï¸ ç›´æ¥æ“ä½œ localStorage æ¸…é™¤ currentUser å¤±è´¥:', e2);
                    }
                }

                localStorage.removeItem('userOrders');
                localStorage.removeItem('userAddresses');
                
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('userOrders_') || key.startsWith('userAddresses_'))) {
                        keysToRemove.push(key);
                    }
                }
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                    console.log('ğŸ—‘ï¸ å·²æ¸…é™¤ç¼“å­˜:', key);
                });
                
                userOrders = [];
                userAddresses = [];
                userProfile = {};
                
                console.log('âœ… ç™»å½•ç›¸å…³æœ¬åœ°ç¼“å­˜å’Œæ—§ä¼šè¯å·²æ¸…é™¤');
            } catch (error) {
                console.warn('âš ï¸ æ¸…é™¤ç™»å½•ç¼“å­˜/æ—§ä¼šè¯æ—¶å‡ºç°é”™è¯¯:', error);
            }

            const authResult = authenticateUser(account, password);
            
            // æ£€æŸ¥ç™»å½•ç»“æœ
            if (authResult && !authResult.banned && authResult.success !== false && authResult.account) {
                // ç™»å½•æˆåŠŸ
                console.log('ğŸ”„ ç™»å½•æˆåŠŸï¼Œå‡†å¤‡åŠ è½½æ–°ç”¨æˆ·æ•°æ®...');
                
                currentUser = authResult;
                saveCurrentUser();
                refreshCurrentUserSnapshot(authResult.account);

                showNotification(`ç™»å½•æˆåŠŸï¼æ­£åœ¨ä»äº‘ç«¯åŠ è½½æ•°æ®...`, 'success');

                // ========== å¼ºåˆ¶ä½¿ç”¨äº‘ç«¯æ¨¡å¼åŠ è½½æ•°æ® ==========
                console.log('ğŸ”„ ç™»å½•æˆåŠŸï¼Œå¼ºåˆ¶ä½¿ç”¨äº‘ç«¯æ¨¡å¼');

                try {
                    if (cloudSync && cloudSync.isInitialized) {
                        console.log('â˜ï¸ äº‘ç«¯æ¨¡å¼ - ä»äº‘ç«¯æ•°æ®åº“åŠ è½½æ•°æ®...');

                        const cloudProducts = await cloudSync.downloadData('products');
                        if (cloudProducts && cloudProducts.length > 0) {
                            products = cloudProducts;
                            localStorage.setItem('products', JSON.stringify(products));
                            console.log('âœ… äº§å“æ•°æ®å·²ä»äº‘ç«¯åŠ è½½:', products.length, 'ä¸ªäº§å“');
                        } else {
                            console.log('â„¹ï¸ äº‘ç«¯æš‚æ— äº§å“æ•°æ®');
                            products = [];
                        }

                        if (authResult.role === 'admin') {
                            const cloudUsers = await cloudSync.downloadData('users');
                            if (cloudUsers && cloudUsers.length > 0) {
                                allUsers = cloudUsers;
                                localStorage.setItem('allUsers', JSON.stringify(allUsers));
                                console.log('âœ… ç”¨æˆ·æ•°æ®å·²ä»äº‘ç«¯åŠ è½½:', allUsers.length, 'ä¸ªç”¨æˆ·');
                            }
                        }

                        await cloudSync.handleUserSessionChange();
                        
                        const userOrdersKey = `userOrders_${authResult.account}`;
                        const userAddressesKey = `userAddresses_${authResult.account}`;
                        userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || JSON.parse(localStorage.getItem('userOrders')) || [];
                        userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || JSON.parse(localStorage.getItem('userAddresses')) || [];
                        
                        console.log('âœ… ç™»å½•åæ•°æ®å·²åŒæ­¥ - è®¢å•æ•°:', userOrders.length, 'åœ°å€æ•°:', userAddresses.length);

                        updateUserInterface();
                        renderProducts(products);
                        renderUserOrders();
                        renderAddressList();

                        showNotification(`â˜ï¸ äº‘ç«¯æ•°æ®åŠ è½½å®Œæˆï¼æ¬¢è¿ ${authResult.username}`, 'success');
                    } else {
                        console.log('âš ï¸ äº‘ç«¯åŒæ­¥æœªå¯ç”¨,ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ•°æ®');
                        products = JSON.parse(localStorage.getItem('products')) || [];
                        const userOrdersKey = `userOrders_${authResult.account}`;
                        const userAddressesKey = `userAddresses_${authResult.account}`;
                        userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || [];
                        userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || [];
                        allUsers = JSON.parse(localStorage.getItem('allUsers')) || [];
                        
                        updateUserInterface();
                        renderProducts(products);
                        renderUserOrders();
                        renderAddressList();
                        
                        showNotification(`ğŸ’¾ äº‘ç«¯æœªè¿æ¥ï¼Œå·²åŠ è½½æœ¬åœ°æ•°æ®ï¼æ¬¢è¿ ${authResult.username}`, 'warning');
                    }
                } catch (error) {
                    console.error('âŒ æ•°æ®åŠ è½½å¤±è´¥:', error);
                    showNotification('æ•°æ®åŠ è½½å¤±è´¥,ä½¿ç”¨æœ¬åœ°ç¼“å­˜', 'warning');
                    products = JSON.parse(localStorage.getItem('products')) || [];
                    const userOrdersKey = `userOrders_${authResult.account}`;
                    const userAddressesKey = `userAddresses_${authResult.account}`;
                    userOrders = JSON.parse(localStorage.getItem(userOrdersKey)) || [];
                    userAddresses = JSON.parse(localStorage.getItem(userAddressesKey)) || [];
                    allUsers = JSON.parse(localStorage.getItem('allUsers')) || [];
                    
                    updateUserInterface();
                    renderProducts(products);
                    renderUserOrders();
                    renderAddressList();
                }

                if (authResult.role === 'admin') {
                    const controlPanel = document.getElementById('admin-control-panel');
                    if (controlPanel) {
                        controlPanel.style.display = 'block';
                    }
                }

                if (pendingSignupProduct) {
                    setTimeout(() => {
                        openSignupModal(pendingSignupProduct);
                        pendingSignupProduct = null;
                    }, 500);
                }

            } else if (authResult && authResult.banned) {
                customAlert(authResult.message, t('accountDisabled'));
            } else if (authResult && authResult.success === false) {
                customAlert(authResult.message, t('loginFailed'));
            } else {
                customAlert(t('loginFailedRetry'), t('errorTitle'));
            }
        }

        // ========== å®¢æœæŒ‰é’®æ§åˆ¶ ==========
        (function() {
            const mainButton = document.getElementById('mainButton');
            const contactOptions = document.getElementById('contactOptions');
            
            if (!mainButton || !contactOptions) return;

            // åˆ‡æ¢è”ç³»é€‰é¡¹çš„æ˜¾ç¤º/éšè—
            mainButton.addEventListener('click', function(e) {
                e.stopPropagation();
                this.classList.toggle('active');
                contactOptions.classList.toggle('active');
            });

            // ç‚¹å‡»é€‰é¡¹åå…³é—­èœå•
            const optionButtons = document.querySelectorAll('.option-button');
            optionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    mainButton.classList.remove('active');
                    contactOptions.classList.remove('active');
                });
            });

            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­è”ç³»é€‰é¡¹
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.contact-button')) {
                    mainButton.classList.remove('active');
                    contactOptions.classList.remove('active');
                }
            });

            // æ·»åŠ é”®ç›˜æ”¯æŒï¼ˆESC é”®å…³é—­ï¼‰
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    mainButton.classList.remove('active');
                    contactOptions.classList.remove('active');
                }
            });
        })();

        // ========== ç§»åŠ¨ç«¯ç‚¹å‡»åé¦ˆä¸é˜²è¯¯è§¦ ==========

        // è§¦å‘ç§»åŠ¨ç«¯æ›´å¿« click äº‹ä»¶
        document.addEventListener('touchstart', function () {}, { passive: true });

        // äº§å“å¡ç‰‡ç‚¹å‡»åé¦ˆï¼šæ·»åŠ  .tapped ç±»ï¼ŒçŸ­æš‚æŠ¬å‡
        document.addEventListener(
            'click',
            function (e) {
                const target = e.target;
                const card = target.classList.contains('product-card')
                    ? target
                    : target.closest('.product-card');

                if (card) {
                    card.classList.add('tapped');
                    setTimeout(() => card.classList.remove('tapped'), 300);
                }
            },
            { passive: true }
        );

        // é˜²æ­¢æäº¤æŒ‰é’®å¿«é€ŸåŒå‡»é€ æˆé‡å¤æäº¤ï¼ˆä»…é™è¡¨å•å†…çš„ submit æ§ä»¶ï¼‰
        let lastClickTime = 0;
        document.addEventListener(
            'click',
            function (e) {
                const submitBtn = e.target.closest('button[type=\"submit\"], input[type=\"submit\"]');
                // å¿…é¡»å±äºè¡¨å•ï¼Œé¿å…è¯¯ä¼¤å¯¼èˆª/æ“ä½œæŒ‰é’®
                if (!submitBtn || !submitBtn.form) return;

                const now = Date.now();
                if (now - lastClickTime < 500) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                lastClickTime = now;
            },
            true
        );

        // ========== ç®€å•æ»‘åŠ¨æ£€æµ‹ï¼ˆå·¦å³ï¼‰ ==========
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener(
            'touchstart',
            function (e) {
                if (!e.changedTouches || !e.changedTouches.length) return;
                touchStartX = e.changedTouches[0].screenX;
            },
            { passive: true }
        );

        document.addEventListener(
            'touchend',
            function (e) {
                if (!e.changedTouches || !e.changedTouches.length) return;
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            },
            { passive: true }
        );

        function handleSwipe() {
            const threshold = 50;
            const diff = touchEndX - touchStartX;

            if (Math.abs(diff) <= threshold) return;

            if (diff > 0) {
                // å‘å³æ»‘åŠ¨ï¼šå¯æ ¹æ®éœ€è¦è§¦å‘è½®æ’­ä¸Šä¸€å¼ ç­‰è¡Œä¸º
                console.log('Swiped right');
            } else {
                // å‘å·¦æ»‘åŠ¨
                console.log('Swiped left');
            }
        }

        // ========== ä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºçŠ¶æ€ï¼ˆå¯é€‰ï¼‰ ==========
        (function () {
            const ptr = document.getElementById('pull-to-refresh');
            if (!ptr) return;

            let startY = 0;
            let pulling = false;

            document.addEventListener(
                'touchstart',
                function (e) {
                    if (window.scrollY > 0) return;
                    startY = e.touches[0].clientY;
                    pulling = false;
                },
                { passive: true }
            );

            document.addEventListener(
                'touchmove',
                function (e) {
                    if (window.scrollY > 0) return;
                    const currentY = e.touches[0].clientY;
                    const distance = currentY - startY;

                    if (distance > 60) {
                        ptr.classList.add('pulling');
                        pulling = true;
                    }
                },
                { passive: true }
            );

            document.addEventListener(
                'touchend',
                function () {
                    if (!pulling) return;
                    // è¿™é‡Œåªåšè§†è§‰åé¦ˆï¼Œä¸å¼ºåˆ¶åˆ·æ–°ï¼›éœ€è¦æ—¶å¯åœ¨æ­¤è°ƒç”¨ location.reload()
                    setTimeout(() => {
                        ptr.classList.remove('pulling');
                    }, 600);
                    pulling = false;
                },
                { passive: true }
            );
        })();
    </script>

    <script>
        // Inject publish toggle buttons into admin product cards and handle toggle via delegation.
        (function () {
            function ensureToggleButtons() {
                const adminGrid = document.getElementById('admin-products-grid');
                if (!adminGrid) return;
                adminGrid.querySelectorAll('.product-card').forEach(card => {
                    if (!card.querySelector('.toggle-publish')) {
                        const actions = card.querySelector('.product-actions');
                        if (actions) {
                            const productId = parseInt(card.getAttribute('data-product-id'), 10);
                            const prod = products && products.find ? products.find(p => parseInt(p.id) === productId) : null;
                            const btn = document.createElement('button');
                            btn.className = 'btn btn-outline-secondary toggle-publish';
                            btn.textContent = (prod && prod.visible === false) ? 'ä¸Šæ¶' : 'ä¸‹æ¶';
                            // äº§å“ä¸‹æ¶å¾½ç« ï¼ˆä»…ç®¡ç†å‘˜åå°æ˜¾ç¤ºï¼‰
                            const titleEl = card.querySelector('.product-title');
                            if (prod && prod.visible === false) {
                                if (!card.querySelector('.product-hidden-badge')) {
                                    const badge = document.createElement('span');
                                    badge.className = 'product-hidden-badge';
                                    badge.textContent = 'å·²ä¸‹æ¶';
                                    badge.style.cssText = 'display:inline-block;background:#ff6b6b;color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;margin-left:8px;';
                                    if (titleEl && titleEl.parentNode) titleEl.parentNode.insertBefore(badge, titleEl.nextSibling);
                                } else {
                                    card.querySelector('.product-hidden-badge').textContent = 'å·²ä¸‹æ¶';
                                }
                            } else {
                                const existingBadge = card.querySelector('.product-hidden-badge');
                                if (existingBadge) existingBadge.remove();
                            }
                            // Insert before delete button if present, otherwise append
                            const deleteBtn = actions.querySelector('.delete-product');
                            if (deleteBtn) {
                                actions.insertBefore(btn, deleteBtn);
                            } else {
                                actions.appendChild(btn);
                            }
                        }
                    }
                });
            }

            // Event delegation for toggle clicks
            function onToggleClick(e) {
                const btn = e.target.closest('.toggle-publish');
                if (!btn) return;
                e.preventDefault();
                e.stopPropagation();
                const card = btn.closest('.product-card');
                if (!card) return;
                const productId = parseInt(card.getAttribute('data-product-id'), 10);
                const product = products && products.find ? products.find(p => parseInt(p.id) === productId) : null;
                if (!product) {
                    if (typeof showNotification === 'function') showNotification('äº§å“æœªæ‰¾åˆ°', 'error');
                    return;
                }
                // Toggle visibility correctly: invert the truthy/falsy visible flag.
                product.visible = !product.visible;
                // ç«‹å³æ›´æ–°æŒ‰é’®æ–‡å­—
                btn.textContent = product.visible === false ? 'ä¸Šæ¶' : 'ä¸‹æ¶';

                const p = saveProducts();
                if (p && typeof p.then === 'function') {
                    p.then(() => {
                        renderAdminProducts();
                        // åŒæ—¶æ›´æ–°ä¸»é¡µçš„äº§å“æ˜¾ç¤º
                        renderProducts(products);
                        if (typeof showNotification === 'function') showNotification(product.visible === false ? 'äº§å“å·²ä¸‹æ¶' : 'äº§å“å·²ä¸Šæ¶', 'success');
                    }).catch(err => {
                        console.error('åˆ‡æ¢å¤±è´¥', err);
                        if (typeof showNotification === 'function') showNotification('æ›´æ–°å¤±è´¥', 'error');
                    });
                } else {
                    renderAdminProducts();
                    // åŒæ—¶æ›´æ–°ä¸»é¡µçš„äº§å“æ˜¾ç¤º
                    renderProducts(products);
                    if (typeof showNotification === 'function') showNotification(product.visible === false ? 'äº§å“å·²ä¸‹æ¶' : 'äº§å“å·²ä¸Šæ¶', 'success');
                }
            }

            const adminGrid = document.getElementById('admin-products-grid');
            if (adminGrid) {
                adminGrid.addEventListener('click', onToggleClick);
                ensureToggleButtons();
                const observer = new MutationObserver(() => ensureToggleButtons());
                observer.observe(adminGrid, { childList: true, subtree: true });
            } else {
                document.addEventListener('DOMContentLoaded', function () {
                    setTimeout(() => {
                        const g = document.getElementById('admin-products-grid');
                        if (g) {
                            g.addEventListener('click', onToggleClick);
                            ensureToggleButtons();
                            const observer = new MutationObserver(() => ensureToggleButtons());
                            observer.observe(g, { childList: true, subtree: true });
                        }
                    }, 300);
                });
            }
        })();
    </script>
    <script>
        // Capture-phase listener to ensure per-button clicks are handled even if inner handlers stop propagation.
        (function () {
            document.addEventListener('click', function (e) {
                const btn = e.target && e.target.closest ? e.target.closest('.toggle-publish') : null;
                if (!btn) return;
                // Run in capture phase; ensure default prevented and propagation stopped for consistency
                try {
                    e.preventDefault();
                } catch (err) {}
                try {
                    e.stopPropagation();
                } catch (err) {}

                // Prefer calling existing onToggleClick if available
                if (typeof onToggleClick === 'function') {
                    try {
                        onToggleClick(e);
                        return;
                    } catch (err) {
                        console.error('onToggleClick call failed:', err);
                    }
                }

                // Fallback: toggle product visibility directly
                const card = btn.closest('.product-card');
                if (!card) return;
                const productId = parseInt(card.getAttribute('data-product-id'), 10);
                const product = products && products.find ? products.find(p => parseInt(p.id) === productId) : null;
                if (!product) {
                    if (typeof showNotification === 'function') showNotification('äº§å“æœªæ‰¾åˆ°', 'error');
                    return;
                }
                // Toggle visibility correctly in fallback handler as well
                product.visible = !product.visible;

                const p = saveProducts();
                if (p && typeof p.then === 'function') {
                    p.then(() => {
                        renderAdminProducts();
                        renderProducts(products);
                        if (typeof showNotification === 'function') showNotification(product.visible === false ? 'äº§å“å·²ä¸‹æ¶' : 'äº§å“å·²ä¸Šæ¶', 'success');
                    }).catch(err => {
                        console.error('åˆ‡æ¢å¤±è´¥', err);
                        if (typeof showNotification === 'function') showNotification('æ›´æ–°å¤±è´¥', 'error');
                    });
                } else {
                    renderAdminProducts();
                    renderProducts(products);
                    if (typeof showNotification === 'function') showNotification(product.visible === false ? 'äº§å“å·²ä¸‹æ¶' : 'äº§å“å·²ä¸Šæ¶', 'success');
                }
            }, true);
        })();
    </script>
</body>
</html>
